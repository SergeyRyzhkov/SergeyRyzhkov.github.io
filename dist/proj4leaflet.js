L.Proj={},L.Proj._isProj4Proj=function(a){return"undefined"!=typeof a.projName},L.Proj.Projection=L.Class.extend({initialize:function(a,b){if(L.Proj._isProj4Proj(a))this._proj=a;else{var c=a;b&&(Proj4js.defs[c]=b),this._proj=new Proj4js.Proj(c)}},project:function(a){var b=new L.Point(a.lng,a.lat);return Proj4js.transform(Proj4js.WGS84,this._proj,b)},unproject:function(a,b){var c=Proj4js.transform(this._proj,Proj4js.WGS84,a.clone());return new L.LatLng(c.y,c.x,b)}}),L.Proj.CRS=L.Class.extend({includes:L.CRS,options:{transformation:new L.Transformation(1,0,-1,0)},initialize:function(a,b,c){var d,e,f,g;if(L.Proj._isProj4Proj(a)?(e=a,d=e.srsCode,g=b||{},this.projection=new L.Proj.Projection(e)):(d=a,f=b,g=c||{},this.projection=new L.Proj.Projection(d,f)),L.Util.setOptions(this,g),this.code=d,this.transformation=this.options.transformation,this.options.origin&&(this.transformation=new L.Transformation(1,-this.options.origin[0],-1,this.options.origin[1])),this.options.resolutions)for(this.options.scales=[],i=0;i<this.options.resolutions.length;i++)this.options.scales[i]=1/this.options.resolutions[i];this._scales=this.options.scales},scale:function(a){var b,c,d,e,f=Math.floor(a);return a===f?this._scales[a]:(b=this._scales[f],c=this._scales[f+1],d=c-b,e=a-f,b+d*e)}}),L.Proj.CRS.TMS=L.Proj.CRS.extend({initialize:function(a,b,c,d){if(L.Proj._isProj4Proj(a)){var e=a,f=b,g=c||{};g.origin=[f[0],f[3]],L.Proj.CRS.prototype.initialize(e,g)}else{var h=a,i=b,f=c,g=d||{};g.origin=[f[0],f[3]],L.Proj.CRS.prototype.initialize(h,i,g)}this.projectedBounds=f}}),L.Proj.TileLayer={},L.Proj.TileLayer.TMS=L.TileLayer.extend({options:{tms:!0,continuousWorld:!0},initialize:function(a,b,c){if(!(b instanceof L.Proj.CRS.TMS))throw new Error("CRS is not L.Proj.CRS.TMS.");L.TileLayer.prototype.initialize.call(this,a,c),this.crs=b;for(var d=this.options.minZoom;d<this.options.maxZoom;d++){var e=(this.crs.projectedBounds[3]-this.crs.projectedBounds[1])/this._projectedTileSize(d);if(Math.abs(e-Math.round(e))>.001)throw new Error("Projected bounds does not match grid at zoom "+d)}},getTileUrl:function(a){var b=Math.round((this.crs.projectedBounds[3]-this.crs.projectedBounds[1])/this._projectedTileSize(this._map.getZoom()));return L.Util.template(this._url,L.Util.extend({s:this._getSubdomain(a),z:this._getZoomForUrl(),x:a.x,y:b-a.y-1},this.options))},_projectedTileSize:function(a){return this.options.tileSize/this.crs.scale(a)}}),L.Proj.GeoJSON=L.GeoJSON.extend({initialize:function(a,b){this._callLevel=0,L.GeoJSON.prototype.initialize.call(this,null,b),this.addData(a)},addData:function(a){var b;a&&(a.crs&&"name"===a.crs.type?b=new L.Proj.CRS(a.crs.properties.name):a.crs&&a.crs.type&&(b=new L.Proj.CRS(a.crs.type+":"+a.crs.properties.code)),void 0!==b&&(this.options.coordsToLatLng=function(a){var c=L.point(a[0],a[1]);return b.projection.unproject(c)})),this._callLevel++;try{L.GeoJSON.prototype.addData.call(this,a)}finally{this._callLevel--,0===this._callLevel&&delete this.options.coordsToLatLng}}}),L.Proj.geoJson=function(a,b){return new L.Proj.GeoJSON(a,b)},"undefined"!=typeof module&&(module.exports=L.Proj),"undefined"!=typeof L&&"undefined"!=typeof L.CRS&&(L.CRS.proj4js=function(){return function(a,b,c,d){return d=d||{},c&&(d.transformation=c),new L.Proj.CRS(a,b,d)}}());