MapExpress={Controls:{},Service:{},Geo:{},Layers:{},Utils:{Promise:{}},Mapping:{},Tools:{},Styles:{},Search:{},Edit:{}},"undefined"!=typeof window&&window.L&&(window.MapExpress=MapExpress),MapExpress.Controls.BaseStatusbarSection=L.Class.extend({options:{containerClassName:"mapexpress-statusbar__section",contentClassName:"mapexpress-section_name"},initialize:function(e,t,r){r&&(this.template=r),this._mapManager=e,L.setOptions(this,t)},remove:function(){$(this._container).remove(),this._container=null},addTo:function(e){return $(this._addContainer()).appendTo($(e)),this},getId:function(){return this.options.id?this.options.id:null},getContainer:function(){return this._container},setContainerStyle:function(e){return this._container&&MapExpress.Controls.MapControlUtils.setStyle(this._container,e),this},setContentStyle:function(e){return this.section&&MapExpress.Controls.MapControlUtils.setStyle(this.section,e),this},setContent:function(e){this.section&&$(this.section).html(e)},updateContent:function(){},initListeners:function(){},removeListeners:function(){},addDivider:function(e){return L.DomUtil.create("span","mapexpress-section__devider",e),this},_addContainer:function(){return this._container=L.DomUtil.create("div",this.options.containerClassName),this._container.style.padding="2px",this.createContent(),this.initListeners(),this._container},createContent:function(){return this.section=L.DomUtil.create("div",this.options.contentClassName,this._container),this.section},createContentFromTemplate:function(e,t,r,o){var s=this;s.section=L.DomUtil.create("div",s.options.contentClassName,s._container),MapExpress.Controls.MapControlUtils.generateTemplate(e,t,r,function(e){$(s.section).html(e),o&&"function"==typeof o&&o()})}}),MapExpress.Controls.LayerOrderControl=L.Control.extend({options:{position:"topright",className:"mapexpress-control-wrapper",layerItemClassName:"layer-order-item"},initialize:function(e,t){this._mapManager=e,L.setOptions(this,t);this._mapManager.on("mapexspress:mapmanager:layer:visiblechanged",this._updateViaListeners,this),this._mapManager._map.on("zoomend",this._updateViaListeners,this)},onAdd:function(){return this._div=L.DomUtil.create("div",this.options.className),this._div.setAttribute("id","layer-order-control"),this._div},addTo:function(e){L.Control.prototype.addTo.call(this,this._mapManager._map),this.render(this._div)},render:function(e){var o=this,t=this._mapManager.getMapModel(),r=t.getOverlayLayers();t.sortLayersByVisibleIndex(r);var s=e||document.getElementById("layer-order-control");if(!s)return this._mapManager.off("mapexspress:mapmanager:layer:visiblechanged",this._updateViaListeners,this),void this._mapManager._map.off("zoomend",this._updateViaListeners,this);L.DomUtil.empty(s),MapExpress.Controls.MapControlUtils.stopMousePropagation(s);for(var i=0;i<r.length;i++){var a=r[i];if(!1===a.options.showOnTOC);else{var n=this._mapManager._mapModel.getLayerById(a.id);if(n&&n.mapLayer&&n.mapLayer.options&&!0===n.mapLayer.options.visible){var l=L.DomUtil.create("div",this.options.layerItemClassName,s);if(l.setAttribute("id",a.id),this._mapManager.layerLabelingEnabledInZoom(a.id)){var p=L.DomUtil.create("img","",l);p.setAttribute("id",a.id),m(p),p.onclick=_}var d=this._mapManager.layerVisibleEnableInZoom(a.id),c=L.DomUtil.create("img","",l);c.setAttribute("id",a.id),u(c),c.onclick=g;var h=d?"layer-order-item-text":"layer-order-item-text disabled";L.DomUtil.create("span",h,l).textContent=a.options.displayName}}}function u(e){var t="images/visibility_y.png";o._mapManager.layerVisibleEnableInZoom(e.getAttribute("id"))||(t="images/visibility_n.png"),e.setAttribute("src",t)}function m(e){var t="images/label_n.gif",r=o._mapManager._mapModel.getLayerById(e.getAttribute("id"));r&&r.mapLayer&&r.mapLayer.options&&r.mapLayer.options.labelEnabled&&(t="images/label_y.gif"),e.setAttribute("src",t)}function g(e){o._mapManager.toogleLayerVisible(e.target.getAttribute("id")),o._mapManager._map.fire("layerorder:layer:toggle",{id:e.target.getAttribute("id")}),u(e.target)}function _(e){o._mapManager.toogleLabelLayer(e.target.getAttribute("id")),m(e.target)}var f={onEnd:function(e){var t=e;setTimeout(function(){o._mapManager.moveOverlay(t.item.id,t.newIndex)},10)},animation:100};Sortable.create(s,f)},_updateViaListeners:function(){this.render(this._div)}}),MapExpress.Controls.LegendControl=L.Control.extend({options:{position:"topright",className:"mapexpress-control-legend"},initialize:function(e,t){this._mapManager=e,L.setOptions(this,t);this._onListenersOnControl()},_offListenersOnControl:function(e,t){this._mapManager.off("mapexspress:mapmanager:layer:visiblechanged",this._updateViaListeners,this),this._mapManager._map.off("moveend",this._updateViaListeners,this);for(var r=MapExpress.Utils.legendUtils.getAllLegends(),o=r.length-1;0<=o;o--){window.MapManager.getMapModel().getLayerById(r[o].id).mapLayer.off("mapexspress:layer:data:added",this._updateViaListeners,this)}},_onListenersOnControl:function(){this._mapManager.on("mapexspress:mapmanager:layer:visiblechanged",this._updateViaListeners,this),this._mapManager._map.on("moveend",this._updateViaListeners,this)},onAdd:function(){return this._div=L.DomUtil.create("div",this.options.className),this._div.setAttribute("id","legendcontrol"),this._div},addTo:function(e){L.Control.prototype.addTo.call(this,this._mapManager._map),this.render(this._div)},render:function(e){this._mapManager.getMapModel();if(this._div=e||document.getElementById("legend-control"),this._div){$(this._div).empty();for(var t=$('<div class="mapexpress-legend"></div>'),r=MapExpress.Utils.legendUtils.getAllLegends(),o=r.length-1;0<=o;o--){window.MapManager.getMapModel().getLayerById(r[o].id).mapLayer.on("mapexspress:layer:data:added",this._updateViaListeners,this)}this._processLayerModel(r,t),t.appendTo($(this._div))}else this._offListenersOnControl()},_processLayerModel:function(e,t){for(var r=0;r<e.length;r++){var o;if(e[r].legendItems){var s=$('<div id="'+e[r].id+'-legend" class="mapexpress-legend__items"></div>');if(1===e[r].legendItems.length)o=$('<div class="legend-item_single"></div>'),$(e[r].legendItems[0].element).appendTo(o),o.appendTo(s),$('<span class="noselect legend-item_single_label" style="white-space: nowrap;">'+e[r].displayName+"</span>").appendTo(s),s.appendTo(t);else{o=$('<div class="legend-item_multiple"></div>'),$('<span class="noselect legend-item_single_label" style="white-space: nowrap;">'+e[r].displayName+"</span>").appendTo(o);for(var i=0;i<e[r].legendItems.length;i++){var a=$('<div class="mapexpress-legend__subitems"></div>'),n=$('<div class="legend-item_single"></div>');$(e[r].legendItems[i].element).appendTo(n),n.appendTo(a),$('<span class="noselect legend-item_single_label" style="white-space: nowrap;">'+e[r].legendItems[i].label+"</span>").appendTo(a),a.appendTo(o)}o.appendTo(s),s.appendTo(t)}}}},_updateViaListeners:function(){this.render(this._div)},_checkLayerLegendType:function(e,t){var r=MapExpress.Utils.LegendUtils._getLayerStyleTypesByZoomAndId(e);return"noGeometryTypes"===t&&0===r.length||-1!==r.indexOf(t)},_processLayerStyleToDiv:function(e,t){return MapExpress.Utils.LegendUtils.processLayerLegendToDiv(e,t)}}),MapExpress.Controls.MapControl=L.Evented.extend({options:{className:"",position:"center",modal:!1,titleText:!1,headerEnabled:!1,footerEnabled:!1,closeButtonEnabled:!0,draggable:!0,removalDelay:0,parentContainer:!1,closeOnLeave:!1,closeOnEsc:!0,resizeable:!1,controlId:"mapexpress-control-id",controlContentId:"mapexpress-control-content",destroyOnClose:!0,maxHeightMinus:.4,maxWidthMinus:.5},initialize:function(e,t){this._map=e,L.setOptions(this,t),this._initLayout()},show:function(){if(this._control||this._initLayout(),this._control){if(this.options.draggable&&this._controlHeaderBar)new L.Draggable(this._control,this._controlHeaderBar).enable();this.options.resizeable&&(this._control.style.resize="both"),this._control.style.visibility="visible",this.options.closeOnLeave&&this.closeOnLeave(),this.options.closeOnEsc&&this._closeOnEsc(),this.setMaxHeightWidthByContainer(),MapExpress.Controls.MapControlUtils.stopMousePropagationExceptClick(this._control),this.setPosition(this.options.position),0<this.options.removalDelay&&setTimeout(this.destroy.bind(this),this.options.removalDelay)}return this},setMaxHeightWidthByContainer:function(){var e=this._getContainer(),t=(e.clientHeight-e.clientHeight*this.options.maxHeightMinus).toString()+"px",r=(e.clientWidth-e.clientWidth*this.options.maxWidthMinus).toString()+"px";return this.setControlStyle({"max-height":t,"max-width":r}),this},setPosition:function(e){return e&&this._control&&(this.options.position=e,MapExpress.Controls.MapControlUtils.setPosition(this._getContainer(),this._control,this.options.position)),this},showErrorWindow:function(e,t){this._showSpecificWindow("Ошибка",e,t,"error")},showWarnWindow:function(e,t){this._showSpecificWindow(" Внимание",e,t,"warn")},showNotifyWindow:function(e,t){this.options.position="bottomRight",this._showSpecificWindow("Выполнено",e,t,"notify"),this.setControlStyle({opacity:1})},_showSpecificWindow:function(e,t,r,o){this.destroy(),this.options.headerEnabled=!0,this.options.closeButtonEnabled=!1,this.options.removalDelay=r||2500,this.show(),this.setTitle(e),this.setContent(t),MapExpress.Controls.MapControlUtils.addClassName(this._controlHeaderBar,"mapexpress-control-headerbar_"+o),MapExpress.Controls.MapControlUtils.addClassName(this._controlContent,"mapexpress-control-content_"+o)},showSmallCircleWaitControl:function(){return this.options.headerEnabled=!1,this.show(),this.setControlStyle({height:"36px",width:"36px","border-radius":"50%",padding:"0px",margin:"0px"}),this.setContentStyle({padding:"6px",display:"block"}),this.setContent(this.getPreloaderContent(24,12,10,4)),this._control&&$(this._control).attr("data-html2canvas-ignore","true"),this},showCircleWaitControl:function(){return this.options.headerEnabled=!1,this.show(),this.setControlStyle({height:"36px",width:"36px","border-radius":"50%",padding:"0px",margin:"0px"}),this.setContentStyle({padding:"0px",display:"block"}),this.setContent(this.getPreloaderContent(36,18,14,5)),this._control&&$(this._control).attr("data-html2canvas-ignore","true"),this},showWaitControl:function(e){return this.options.headerEnabled=!1,this.setControlStyle({height:"36px","border-radius":"36px"}),this.setContentStyle({padding:"0px",margin:"0px",display:"block"}),this.setContent(this.getPreloaderContent(36,18,14,5)+"<div class='noselect' style='margin-right:8px;margin-left:4px;float:right;font-size:13px;font-weight:500;display: inline-block;line-height: 36px;'>"+e+"</div>"),this._control&&$(this._control).attr("data-html2canvas-ignore","true"),this.show(),this},showSidebar:function(e,t,r,o){var s=this;this.options.position=!1,this.options.controlType="Sidebar",this.destroy();var i=this._getContainer();this._control=L.DomUtil.create("div",this.options.className+" mapexpress-sidebar-wrapper",i);var a=$(this._control);return a.attr("data-html2canvas-ignore","true"),a.attr("id","sidebar-"+t),MapExpress.Controls.MapControlUtils.stopMousePropagation(this._control),MapExpress.Controls.MapControlUtils.generateTemplate(e,t,r,function(e){a.html(e),a.addClass("active"),o&&"function"==typeof o&&o();s.options.closeOnLeave&&s.closeOnLeave()}),this},hide:function(){this.fire("mapcontrol:remove:before",this),this._map&&this._map.fire("mapcontrol:remove:before",this),this._control&&(!0===this.options.destroyOnClose?this.destroy():this._control.style&&(this._control.style.visibility="hidden"))},destroy:function(){this._control&&($(this._control).remove(),delete this._control,this._modalWrapper&&($(this._modalWrapper).remove(),delete this._modalWrapper)),this.fire("mapcontrol:remove:after",this),this._map&&this._map.fire("mapcontrol:remove:after",this)},setContent:function(e){return this._controlContent&&$(this._controlContent).html(e),this.setPosition(this.options.position),this},setContentFromTemplate:function(e,t,r,o){var s=this;return MapExpress.Controls.MapControlUtils.generateTemplate(e,t,r,function(e){s.setContent(e),o&&"function"==typeof o&&o()}),this},setTitle:function(e){return this._controlTitle&&$(this._controlTitle).html(e),this},setFooterContent:function(e){return this._controlFooterBar&&$(this._controlFooterBar).html(e),this},setControlStyle:function(e){return this._control&&MapExpress.Controls.MapControlUtils.setStyle(this._control,e),this},setContentStyle:function(e){return MapExpress.Controls.MapControlUtils.setStyle(this._controlContent,e),this},setHeaderBarStyle:function(e){return MapExpress.Controls.MapControlUtils.setStyle(this._controlHeaderBar,e),this},setTitleBarStyle:function(e){return MapExpress.Controls.MapControlUtils.setStyle(this._controlTitleBar,e),this},setTitleStyle:function(e){return MapExpress.Controls.MapControlUtils.setStyle(this._controlTitle,e),this},setCloseButtonStyle:function(e){return MapExpress.Controls.MapControlUtils.setStyle(this._closeButton,e),this},setFooterBarStyle:function(e){return MapExpress.Controls.MapControlUtils.setStyle(this._controlFooterBar,e),this},_initLayout:function(){if(!this._control){var e=this._getContainer();if(this.options.modal&&(this._modalWrapper=L.DomUtil.create("div","modalWindow",e),MapExpress.Controls.MapControlUtils.stopMousePropagationExceptClick(this._modalWrapper)),this._control=L.DomUtil.create("div",this.options.className+" mapexpress-control-wrapper",e),this._control.style.visibility="hidden",$(this._control).attr("data-html2canvas-ignore","true"),$(this._control).attr("id",this.options.controlId),this.options.titleText&&(this.options.headerEnabled=!0),this.options.headerEnabled&&(this._controlHeaderBar=L.DomUtil.create("header","mapexpress-control-headerbar",this._control),this._controlTitleBar=L.DomUtil.create("div","mapexpress-control-titlebar",this._controlHeaderBar),this._controlTitle=L.DomUtil.create("div","mapexpress-control-title",this._controlTitleBar),this.options.titleText&&this.setTitle(this.options.titleText),this._controlToolbar=L.DomUtil.create("div","mapexpress-control-toolbar",this._controlHeaderBar),this.options.closeButtonEnabled)){this._closeButton=L.DomUtil.create("div","mapexpress-control-toolbar-btn",this._controlToolbar),$(this._closeButton).html("&#215");var t=this;$(this._closeButton).click(function(){t.hide()})}return this._controlContent=L.DomUtil.create("div","mapexpress-control-content",this._control),$(this._controlContent).attr("id",this.options.controlContentId),this.options.footerEnabled&&(this._controlFooterBar=L.DomUtil.create("footer","mapexpress-control-footerbar",this._control)),this}},bringToFront:function(){return this._control&&L.DomUtil.toFront(this._control),this},closeOnLeave:function(){if(this._control){var o=this;$(document).on("click",function e(t){var r=$(o._control);r.is(t.target)||0!==r.has(t.target).length||o.hide();$(document).off("click",e)})}},_closeOnEsc:function(){if(this._control){var r=this,o=this._getContainer();$(o).on("keydown",function e(t){27===t.keyCode&&(r.hide(),$(o).off("keydown",e))})}},getPreloaderContent:function(e,t,r,o){var s=".md-preloader{font-size:0;display:inline-block;-webkit-animation:outer 6600ms linear infinite;animation:outer 6600ms linear infinite}.md-preloader svg{-webkit-animation:inner 1320ms linear infinite;animation:inner 1320ms linear infinite}.md-preloader svg circle{fill:none;stroke:#3F51B5;stroke-linecap:square;-webkit-animation:arc 1320ms cubic-bezier(.8, 0, .4, .8) infinite;animation:arc 1320ms cubic-bezier(.8, 0, .4, .8) infinite}@-webkit-keyframes outer{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes outer{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes inner{0%{-webkit-transform:rotate(-100.8deg);transform:rotate(-100.8deg)}100%{-webkit-transform:rotate(0);transform:rotate(0)}}@keyframes inner{0%{-webkit-transform:rotate(-100.8deg);transform:rotate(-100.8deg)}100%{-webkit-transform:rotate(0);transform:rotate(0)}}@-webkit-keyframes arc{0%{stroke-dasharray:1 210.48670779px;stroke-dashoffset:0}40%{stroke-dasharray:151.55042961px,210.48670779px;stroke-dashoffset:0}100%{stroke-dasharray:1 210.48670779px;stroke-dashoffset:-151.55042961px}}@keyframes arc{0%{stroke-dasharray:1 210.48670779px;stroke-dashoffset:0}40%{stroke-dasharray:151.55042961px,210.48670779px;stroke-dashoffset:0}100%{stroke-dasharray:1 210.48670779px;stroke-dashoffset:-151.55042961px}}",i=document.createElement("style");i.styleSheet?i.styleSheet.cssText=s:i.appendChild(document.createTextNode(s)),this.preloaderStyleElement=document.getElementsByTagName("head")[0].appendChild(i);return L.Util.template("<div class='md-preloader'><svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='{size}' width='{size}' viewbox='0 0 {size} {size}'><circle cx='{cx}' cy='{cx}' r='{r}' stroke-width='{strokewidth}'/></svg></div>",{size:e,cx:t,r:r,strokewidth:o})},_getContainer:function(){return!this._container&&this.options.parentContainer&&(this._container=this.options.parentContainer),!this._container&&this._map&&(this._container=this._map.getContainer()),this._container||(this._container=document.body),this._container}}),MapExpress.Controls.MapControlUtils={stopMousePropagation:function(e){if(e){var t=L.DomEvent.stopPropagation;this.stopMousePropagationExceptClick(e),L.DomEvent.addListener(e,"click",t)}},stopMousePropagationExceptClick:function(e){if(e){var t=L.DomEvent.stopPropagation;L.DomEvent.addListener(e,"dblclick",t).addListener(e,"onwheel",t).addListener(e,"wheel",t).addListener(e,"dragenter",t).addListener(e,"dragover",t).addListener(e,"mousedown",t).addListener(e,"touchstart",t).addListener(e,"mousewheel",t)}},setPosition:function(e,t,r){window.onresize=function(){MapExpress.Controls.MapControlUtils.setPosition(e,t,r)},"center"!==r?"topLeft"!==r?"left"!==r?"bottomLeft"!==r?"right"!==r?"topRight"!==r?"top"!==r?"bottom"!==r?"bottomRight"!==r?this.setCenterPosition(e,t):this.setBottomRightPosition(e,t):this.setBottomPosition(e,t):this.setTopPosition(e,t):this.setTopRightPosition(e,t):this.setRightPosition(e,t):this.setBottomLeftPosition(e,t):this.setLeftPosition(e,t):this.setTopLeftPosition(e,t):this.setCenterPosition(e,t)},setCenterPosition:function(e,t){var r=$(e),o=$(t);t.style.left=Math.round((r.width()-o.width())/2)+"px",t.style.top=Math.round((r.height()-o.height())/2)+"px"},setTopLeftPosition:function(e,t){t.style.marginLeft="10px",t.style.marginTop="10px"},setLeftPosition:function(e,t){var r=$(e),o=$(t);t.style.marginLeft="10px",t.style.top=Math.round((r.height()-o.height())/2)+"px"},setTopPosition:function(e,t){var r=$(e),o=$(t);t.style.left=Math.round((r.width()-o.width())/2)+"px",t.style.marginTop="10px"},setRightPosition:function(e,t){var r=$(e),o=$(t);t.style.right="0px",t.style.marginRight="10px",t.style.top=Math.round((r.height()-o.height())/2)+"px"},setTopRightPosition:function(e,t){t.style.top="0px",t.style.right="0px",t.style.marginRight="10px",t.style.marginTop="10px"},setBottomLeftPosition:function(e,t){t.style.bottom="0px",t.style.left="0px",t.style.marginLeft="10px",t.style.marginBottom="10px"},setBottomRightPosition:function(e,t){t.style.bottom="0px",t.style.right="0px",t.style.marginRight="10px",t.style.marginBottom="30px"},setBottomPosition:function(e,t){var r=$(e),o=$(t);t.style.bottom="0px",t.style.marginBottom="10px",t.style.left=Math.round((r.width()-o.width())/2)+"px"},setStyle:function(e,t){if(e)if(t&&"string"==typeof t&&0<t.length)e.style.cssText=e.style.cssText+";"+t;else if(t&&"object"==typeof t)for(var r in t)e.style[r]=t[r]},addClassName:function(e,t){e&&t&&"string"==typeof t&&0<t.length&&(e.className=e.className+" "+t)},generateTemplate:function(e,r,o,s){var t=window.MAPEXPRESS_ROOT_PATH?window.MAPEXPRESS_ROOT_PATH+e:e,i=document.createElement("div");document.body.appendChild(i),$(i).load(t,function(){var e=$.templates("#"+r);if(e){var t=e.render(o);$(i).remove(),s&&"function"==typeof s&&s(t)}else $(i).remove()})}},MapExpress.Controls.MapPopupControl=MapExpress.Controls.MapControl.extend({options:{maxHeightMinus:.1,maxWidthMinus:.5,controlShift:60},initialize:function(e,t){MapExpress.Controls.MapControl.prototype.initialize.call(this,e,t)},setPosition:function(e){return this},setMaxHeightWidthByContainer:function(){var e=this._map.getContainer(),t=(e.clientHeight-e.clientHeight*this.options.maxHeightMinus).toString()+"px",r=(e.clientWidth-e.clientWidth*this.options.maxWidthMinus).toString()+"px";return this.setControlStyle({"max-height":t,"max-width":r}),this},setLatLngPosition:function(e){return this._latlng=L.latLng(e),this._updatePosition()},hide:function(){return this._map&&this._map.off(this.getEvents(),this),MapExpress.Controls.MapControl.prototype.hide.call(this)},show:function(){return this._map&&this._map.on(this.getEvents(),this),MapExpress.Controls.MapControl.prototype.show.call(this)},_getContainer:function(){return this._container=this._map.getPane("mapPane"),this._container},_updatePosition:function(){if(this._map&&this._latlng&&this._control){var e=$(this._control),t=this._map.latLngToLayerPoint(this._latlng),r=t.x-Math.round(e.width()/2),o=t.y-e.height()-12;this._control.style.top=o+"px",this._control.style.left=r+"px",this._adjustPan()}return this},getEvents:function(){var e={zoom:this._updatePosition};return this._map._zoomAnimated&&(e.zoomanim=this._updatePosition),e},_adjustPan:function(){if((!this._map._panAnim||!this._map._panAnim._inProgress)&&this._control){var e=$(this._control),t=0,r=0,o=$(this._map.getContainer()).width(),s=$(this._map.getContainer()).offset(),i=s.left,a=s.top,n=e.offset().left-i,l=e.offset().top-a,p=e.width();n>this.options.controlShift&&n+p+this.options.controlShift>o?r=-(o-n-p-this.options.controlShift):n<this.options.controlShift&&(r=n-this.options.controlShift),(l<this.options.controlShift&&0<=l||l<this.options.controlShift)&&(t=l-this.options.controlShift),0===t&&0===r||this._map.fire("autopanstart").panBy([r,t])}}}),MapExpress.Controls.MapStatusbarControl=L.Control.extend({sections:[],options:{position:"bottomright",className:"mapexpress-statusbar"},initialize:function(e,t){this._mapManager=e,L.setOptions(this,t),this.sections&&0<this.sections.length&&this.clearAllSection()},onAdd:function(){return this._createContainer()},addTo:function(){L.Control.prototype.addTo.call(this,this._mapManager._map)},removeSectionById:function(e){this._removeOrHideSectionById(e,!0)},hideSectionById:function(e){this._removeOrHideSectionById(e)},showSectionById:function(e){this._showSectionById(e)},addSection:function(e){return this.sections.push(e),this},clearAllSection:function(){for(var e=0;e<this.sections.length;e++)null!==this.sections[e].getContainer()&&this.sections[e].remove();this.sections=[]},getSectionById:function(e){for(var t=this.sections.length-1;0<=t;t--)if(this.sections[t].getId()===e)return this.sections[t];return null},refreshSections:function(){for(var e=0;e<this.sections.length;e++)null!==this.sections[e].getContainer()&&(this.sections[e].remove(),this.sections[e].addTo(this._container));this._refreshDividers()},setControlStyle:function(e){return this._container&&MapExpress.Controls.MapControlUtils.setStyle(this._container,e),this},_removeOrHideSectionById:function(e,t){var r=this.getSectionById(e);null!=r?(r.remove(),t&&this.sections.splice(this.sections.indexOf(r),1),this._refreshDividers()):console.warn("Неверно задан id сексии или секции не существует")},_showSectionById:function(e){var t=this.getSectionById(e);null!=t?(t.addTo(this._container),this.refreshSections()):console.warn("Неверно задан id сексии или секции не существует")},addDivider:function(){return L.DomUtil.create("span","mapexpress-statusbar__devider",this._container)},_refreshDividers:function(){$(".mapexpress-statusbar__devider").remove();for(var e=0,t=0;t<this.sections.length;t++)null!==this.sections[t].getContainer()&&(e=t);for(var r=0;r<this.sections.length;r++)null!==this.sections[r].getContainer()&&r!==e&&$(this.addDivider()).insertAfter($(this.sections[r].getContainer()))},_createContainer:function(){this._container=L.DomUtil.create("div",this.options.className),this._container.style.padding="2px";for(var e=0;e<this.sections.length;e++)this.sections[e].addTo(this._container);return this._refreshDividers(),MapExpress.Controls.MapControlUtils.stopMousePropagation(this._container),L.DomEvent.addListener(this._container,"mousemove",L.DomEvent.stopPropagation),this._container}}),MapExpress.Controls.mapStatusbarControl=function(e,t){return new MapExpress.Controls.MapStatusbarControl(e,t)},MapExpress.Controls.OkCancelDialog=MapExpress.Controls.MapControl.extend({options:{okButtonText:"ОК",cancelButtonText:"Отмена"},initialize:function(e,t){this._map=e,L.setOptions(this,t),this.options.footerEnabled=!0,this.options.headerEnabled=!0,this.options.modal=!0,this._initLayout(),this._initButtonGroup(),MapExpress.Controls.MapControlUtils.addClassName(this._controlContent,"mapexpress-control-content_notify")},onOK:function(e,t){this.okButton.onclick=function(){e.call(t,this)}},onCancel:function(e,t){this.cancelButton.onclick=function(){e.call(t,this)}},_initButtonGroup:function(){var e=this,t=L.DomUtil.create("div","mapexpress-control-footerbar__buttongroup",this._controlFooterBar);this.okButton=L.DomUtil.create("button","mapexpress-control-footerbar__buttongroup__button",t),this.okButton.setAttribute("id","okbutton"),L.DomUtil.create("span","mapexpress-control-footerbar__buttongroup__button__text",this.okButton).textContent=this.options.okButtonText,$(this.okButton).click(function(){e.hide()}),MapExpress.Controls.MapControlUtils.stopMousePropagation(this.okButton),this.cancelButton=L.DomUtil.create("button","mapexpress-control-footerbar__buttongroup__button cancel",t),this.cancelButton.setAttribute("id","cancelbutton"),L.DomUtil.create("span","mapexpress-control-footerbar__buttongroup__button__text",this.cancelButton).textContent=this.options.cancelButtonText,$(this.cancelButton).click(function(){e.hide()}),MapExpress.Controls.MapControlUtils.stopMousePropagation(this.cancelButton)}});var geoJSONAutoComplete=function(e){};function TinyQueue(e,t){if(!(this instanceof TinyQueue))return new TinyQueue(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||defaultCompare,0<this.length)for(var r=(this.length>>1)-1;0<=r;r--)this._down(r)}function defaultCompare(e,t){return e<t?-1:t<e?1:0}geoJSONAutoComplete.prototype={initialize:function(e,t){this.options=e,this.activeSearchProvider=e.startProvider,void 0===e.drawStyleOptions&&(e.drawStyleOptions={color:"blue",weight:2,opacity:.65,fillColor:"red",fillOpacity:.2}),this.options.delay=300,this.options.limitToShowResults=25,this.features=[];var r=$(t.toString()).addClass("mapExpress-searchContainer");r.append('<input id="mapExpress-searchBox" class="mapExpress-searchBox" />'),r.append('<span class="mapExpress-divider"></span>'),r.append('<span class="mapExpress-searchServices"/>'),r.append('<div class="mapExpress-resultsDiv"/>'),this.createSearchProviderList(),this.searchBoxManage()},createSearchProviderList:function(){for(var e,r=this,t=$(".mapExpress-searchServices").attr("title",this.activeSearchProvider.getName()),o=$("<ul/>").addClass("mapExpress-searchServicesList").appendTo(t).hide(),s=0;s<this.options.providers.length;s++)this.options.providers[s].getName()===this.activeSearchProvider.getName()?(e=$("<li/>").appendTo(o),$("<a />").addClass("mapExpress-activeSearchProvider").text(this.activeSearchProvider.getName()).appendTo(e)):(e=$("<li/>").appendTo(o),$("<a />").addClass("mapExpress-SearchProvider").text(this.options.providers[s].getName()).appendTo(e));return $(".mapExpress-searchServices").click(function(){$(".mapExpress-resultList").hide(),o.is(":visible")?o.hide():o.show()}),$(o).click(function(e){if(e.stopPropagation(),"mapExpress-searchServicesList"!==$(e.target).attr("class"))if("mapExpress-SearchProvider"===$(e.target).attr("class")||"mapExpress-activeSearchProvider"===$(e.target).attr("class")){$(".mapExpress-activeSearchProvider").attr("class","mapExpress-SearchProvider"),$(e.target).attr("class","mapExpress-activeSearchProvider");for(var t=r.options.providers.length-1;0<=t;t--)r.options.providers[t].getName()===$(".mapExpress-activeSearchProvider").text()&&(r.activeSearchProvider=r.options.providers[t],$(".mapExpress-searchBox")[0].placeholder=r.activeSearchProvider.getName(),$(".mapExpress-searchServices").attr("title",r.activeSearchProvider.getName()));r.clearDivClick(),o.hide()}else o.hide()}),$(document).click(function(){o.is(":visible")&&o.hide()}),o.html()},searchBoxManage:function(){var t=$(".mapExpress-searchBox"),r=this;t[0].placeholder=r.activeSearchProvider.getName(),t.delayKeyup=function(t,r){var o=0;return $(this).keyup(function(e){13!==e.keyCode&&38!==e.keyCode&&40!==e.keyCode?(clearTimeout(o),o=setTimeout(function(){t(e)},r)):t(e)}),$(this)},t.value="",t.delayKeyup(function(e){switch(e.keyCode){case 13:r.getValuesAsGeoJson();break;default:0<t[0].value.length?r.getValuesAsGeoJson():r.clearDivClick()}},r.options.delay),t.focus(function(){void 0!==$(".mapExpress-resultList")[0]&&($(".mapExpress-resultList")[0].style.visibility="visible")}),t.blur(function(){void 0!==$(".mapExpress-resultList")[0]&&window.setTimeout(function(){t.focus()},0)}),t.click(function(){0<r.features.length&&r.createDropDown(r.features)}),$(document).click(function(){$(".mapExpress-resultList").is(":visible")&&$(".mapExpress-resultList").hide()})},clearDivClick:function(){$(".mapExpress-resultList").remove(),this.features=[],$(".mapExpress-searchBox")[0].value=""},getValuesAsGeoJson:function(){var t=this,e=$(".mapExpress-searchBox")[0].value;this.activeSearchProvider.getDataByMaskAsynch(e).then(function(e){0<(t.features=e).length?t.createDropDown(e):t.processNoRecordsFoundOrError()},function(e){t.processNoRecordsFoundOrError()})},createDropDown:function(e){var t=this;$(".mapExpress-searchServicesList").hide(),$(".mapExpress-resultList").remove();$(".mapExpress-searchContainer");for(var r=$(".mapExpress-resultsDiv"),o=$("<ul/>").addClass("mapExpress-resultList").appendTo(r),s=0;s<e.length;s++){if(s>t.options.limitToShowResults)return;var i=$("<li />").attr("id","mapExpress-listelement"+s).addClass("mapExpress-listelement").appendTo(o),a=$("<span />").addClass("mapExpress-content").appendTo(i);$("<img />").addClass("mapExpress-listElementContentImage").attr("src","images/"+(e[s].geojson||e[s].geometry).type+".png").attr("align","middle").appendTo(a),$("<font />").addClass("mapExpress-listElementContentText").text(e[s].display_name).appendTo(a)}$(".mapExpress-listelement").click(function(e){if("mapExpress-listelement"===$(e.target).attr("class"))t.dropDownManage(e.target);else{if("content"!==$(e.target).attr("class")&&"mapExpress-listElementContentText"!==$(e.target).attr("class"))return;t.dropDownManage(e.currentTarget)}})},dropDownManage:function(e){var t=parseInt(e.id.substr(22));this.activeSearchProvider.processResult(this.features[t],this.options),$(".mapExpress-searchBox")[0].value=this.features[t].display_name,$(".mapExpress-resultList").remove()},processNoRecordsFoundOrError:function(){$(".mapExpress-resultList").remove();var e=$("<ul/>").addClass("mapExpress-resultList").appendTo($(".mapExpress-resultsDiv")),t=$("<li />").addClass("mapExpress-listelementError").appendTo(e),r=$("<span />").addClass("mapExpress-content").appendTo(t);$("<font />").addClass("mapExpress-listElementContentText").text("По вашему запросу ничего не найдено").appendTo(r)}},MapExpress.Controls.ZoomStandartStatusbarSection=MapExpress.Controls.BaseStatusbarSection.extend({options:{id:"mapexpress-statusbar-section-zoom",containerClassName:"mapexpress-statusbar__section",contentClassName:"mapexpress-section__zoom",zoomTeplate:"Уровень: {zoom}"},initListeners:function(){MapExpress.Controls.BaseStatusbarSection.prototype.initListeners.call(this),this._mapManager._map.on("zoomend",this.updateContent,this)},updateContent:function(){$(this.section).html(L.Util.template(this.options.zoomTeplate,{zoom:this._mapManager._map.getZoom()}))},createContent:function(){return this.section=L.DomUtil.create("div",this.options.contentClassName,this.getContainer()),this.updateContent(),this.section}}),MapExpress.Controls.CoordinatesStandartStatusbarSection=MapExpress.Controls.BaseStatusbarSection.extend({options:{id:"mapexpress-statusbar-section-coordinates",containerClassName:"mapexpress-statusbar__section",contentClassName:"mapexpress-section__coordinates",latTemplate:"Широта: {lat}",lngTemplate:"Долгота: {lng}",useDMS:!0,separator:".",roundDecimals:4},initListeners:function(){return MapExpress.Controls.BaseStatusbarSection.prototype.initListeners.call(this),this._mapManager._map.on("mousemove",this.updateContent,this),this},removeListeners:function(){return MapExpress.Controls.BaseStatusbarSection.prototype.initListeners.call(this),this._mapManager._map.off("mousemove",this.updateContent,this),this},updateContent:function(e){var t=L.Util.template(this.options.lngTemplate,{lng:this.readableCords((e.latlng||e).lng)}),r=L.Util.template(this.options.latTemplate,{lat:this.readableCords((e.latlng||e).lat)});$(this.section).html(r+", "+t)},createContent:function(){return this.section=L.DomUtil.create("div",this.options.contentClassName,this.getContainer()),this.updateContent(this._mapManager._map.getCenter()),this.section},readableCords:function(e){return this.options.useDMS?this.toDMS(e):this.round(e,this.options.roundDecimals,this.options.separator)},toDMS:function(e){var t=Math.floor(Math.abs(e)),r=60*(Math.abs(e)-t),o=Math.floor(r),s=60*(r-o),i=Math.round(s);60===i&&(o++,i="00"),60===o&&(t++,o="00"),i<10&&(i="0"+i),o<10&&(o="0"+o);var a="";return e<0&&(a="-"),""+a+t+"&deg; "+o+"' "+i+"''"},round:function(e,t,r){var o=L.Util.formatNum(e,t)+"",s=o.split(".");if(s[1]){for(var i=t-s[1].length;0<i;i--)s[1]+="0";o=s.join(r||".")}return o}}),MapExpress.Controls.AttibutionStandartStatusbarSection=MapExpress.Controls.BaseStatusbarSection.extend({options:{id:"mapexpress-statusbar-section-attibution",containerClassName:"mapexpress-statusbar__section",contentClassName:"mapexpress-section__attibution",attibution:[]},createContent:function(){if(this.section=L.DomUtil.create("div",this.options.contentClassName,this.getContainer()),this.options.attibution&&0<this.options.attibution.length)for(var e=0;e<this.options.attibution.length;e++)$(L.DomUtil.create("a",!1,this.section)).attr("href",this.options.attibution[e].href).attr("target","_blank").html(this.options.attibution[e].prefix),e!==this.options.attibution.length-1&&this.addDivider(this.section);return this.section}}),MapExpress.Controls.CurrentToolStatusbarSection=MapExpress.Controls.BaseStatusbarSection.extend({options:{id:"mapexpress-statusbar-section-current-tool",containerClassName:"mapexpress-statusbar__section",contentClassName:"mapexpress-section__currenttool",toolTemplate:"Инструмент: {tool}"},initialize:function(e,t,r){MapExpress.Controls.BaseStatusbarSection.prototype.initialize.call(this,e,t,r),window.MapManager.on("mapexpress:maptoolbar:command:activated",this._onActiveToolChanged,this)},createContent:function(){return this.section=L.DomUtil.create("div",this.options.contentClassName,this.getContainer()),this.updateContent(),this.section},_onActiveToolChanged:function(e){var t="Неизвестно";void 0!==e.options.title&&(t=e.options.title);var r=L.Util.template(this.options.toolTemplate,{tool:t});this.setContent(r)}}),MapExpress.Controls.ScaleStatusbarSection=MapExpress.Controls.BaseStatusbarSection.extend({options:{id:"mapexpress-statusbar-section-coordinates",containerClassName:"mapexpress-statusbar__section",contentClassName:"mapexpress-section__scale",scaleTemplate:" М 1: {formatScale}",separator:" "},initListeners:function(){this._mapManager._map.on("moveend",this.updateContent,this)},removeListeners:function(){return MapExpress.Controls.BaseStatusbarSection.prototype.removeListeners.call(this),this._mapManager._map.off("moveend",this.updateContent,this),this},pixelsInMeter:function(){var e=document.createElement("div");e.style.cssText="position: absolute;  left: -100%;  top: -100%;  width: 100cm;",document.body.appendChild(e);var t=e.offsetWidth;return document.body.removeChild(e),t},updateContent:function(e){var t=this._mapManager._map.getSize().y,r=this._mapManager._map.getSize().x,o=this._mapManager._map.containerPointToLatLng([0,t]).distanceTo(this._mapManager._map.containerPointToLatLng([r,t]))/r*this.pixelsInMeter(),s=L.Util.template(this.options.scaleTemplate,{formatScale:this.readableScale(o)});$(this.section).html(s)},readableScale:function(e){return(10*Math.round(e/10)).toFixed(0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.options.separator)},createContent:function(){return this.section=L.DomUtil.create("label",this.options.contentClassName,this.getContainer()),this.updateContent(this._mapManager._map.getCenter()),this.section}}),MapExpress.Controls.TreeLayerControl=L.Control.extend({options:{position:"topright",className:"mapexpress-control-treelayercontrol"},initialize:function(e,t){this._mapManager=e,L.setOptions(this,t),this._mapManager.on("mapexspress:mapmanager:layer:visiblechanged",this._updateViaListeners,this)},onAdd:function(){return this._div=L.DomUtil.create("div",this.options.className),this._div.setAttribute("id","treelayercontrol"),this._div},addTo:function(e){L.Control.prototype.addTo.call(this,this._mapManager._map),this.render(this._div)},render:function(e){var r=this,t=this._mapManager.getMapModel(),o={};o.id=t.id,o.text=t.options.displayName,this._processLayerModel(o,t._layers);var s={core:{data:o.children},plugins:["checkbox","wholerow"]};$.jstree.defaults.checkbox.keep_selected_style=!1,$.jstree.defaults.checkbox.tie_selection=!1;var i=e||document.getElementById("treelayercontrol");if(i){L.DomUtil.empty(i),MapExpress.Controls.MapControlUtils.stopMousePropagation(i),$.jstree.destroy();var a=$(i).jstree(s);a.on("check_node.jstree",function(e,t){t.node.parent&&"Базовые карты"===t.node.parent?r._mapManager.setActiveBaseMap(t.node.id):r._mapManager.setLayerVisible(t.node.id,!0),r._mapManager.fire("treelayer:layer:show",{id:t.node.id})}),a.on("uncheck_node.jstree",function(e,t){t.node&&(r._mapManager.setLayerVisible(t.node.id,!1),r._mapManager.fire("treelayer:layer:hide",{id:t.node.id}))})}else this._mapManager.off("mapexspress:mapmanager:layer:visiblechanged",this._updateViaListeners,this)},_processLayerModel:function(e,t){e.children=[];for(var r=0;r<t.length;r++){var o=t[r],s={};"base"===o.options.type&&"Базовые карты"!==e.text||!1===o.options.showOnTOC||(s=this._createNode(o),e.children.push(s)),o.hasChildren()&&(s||(s=e),this._processLayerModel(s,o._layers))}},_createNode:function(e){var t={};return t.id=e.id,t.text=e.options.displayName,e.mapLayer&&(t.state={checked:e.mapLayer.options.visible}),t},_updateViaListeners:function(e){var t=$("#treelayercontrol");t&&!t.hasClass("active")&&this.render(this._div)}}),L.PathDraggable=L.Draggable.extend({initialize:function(e){this._path=e,this._canvas=e._map.getRenderer(e)instanceof L.Canvas;var t=this._canvas?this._path._map.getRenderer(this._path)._container:this._path._path;L.Draggable.prototype.initialize.call(this,t,t,!0)},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("drag",e)},_onDown:function(e){var t=e.touches?e.touches[0]:e;this._startPoint=new L.Point(t.clientX,t.clientY),this._canvas&&!this._path._containsPoint(this._path._map.mouseEventToLayerPoint(t))||L.Draggable.prototype._onDown.call(this,e)}}),L.Handler.PathDrag=L.Handler.extend({initialize:function(e){this._path=e},getEvents:function(){return{dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd}},addHooks:function(){this._draggable||(this._draggable=new L.PathDraggable(this._path)),this._draggable.on(this.getEvents(),this).enable(),L.DomUtil.addClass(this._draggable._element,"leaflet-path-draggable")},removeHooks:function(){this._draggable&&(this._draggable.off(this.getEvents(),this).disable(),L.DomUtil.removeClass(this._draggable._element,"leaflet-path-draggable"))},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._startPoint=this._draggable._startPoint,this._path.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(e){var t=this._path,r=e.originalEvent.touches&&1===e.originalEvent.touches.length?e.originalEvent.touches[0]:e.originalEvent,o=L.point(r.clientX,r.clientY),s=t._map.layerPointToLatLng(o);this._offset=o.subtract(this._startPoint),this._startPoint=o,this._path.eachLatLng(this.updateLatLng,this),t.redraw(),e.latlng=s,e.offset=this._offset,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){this._path._bounds&&this.resetBounds(),this._path.fire("moveend").fire("dragend",e)},latLngToLayerPoint:function(e){return this._path._map.project(L.latLng(e))._subtract(this._path._map.getPixelOrigin())},updateLatLng:function(e){var t=this.latLngToLayerPoint(e);t._add(this._offset);var r=this._path._map.layerPointToLatLng(t);e.lat=r.lat,e.lng=r.lng},resetBounds:function(){this._path._bounds=new L.LatLngBounds,this._path.eachLatLng(function(e){this._bounds.extend(e)})}}),L.Path.include({eachLatLng:function(r,o){o=o||this;var s=function(e){for(var t=0;t<e.length;t++)L.Util.isArray(e[t])?s(e[t]):r.call(o,e[t])};s(this.getLatLngs?this.getLatLngs():[this.getLatLng()])}}),MapExpress.Edit.VertexMarker=L.Editable.VertexMarker.extend({options:{draggable:!0,className:"leaflet-div-icon leaflet-vertex-icon mapexpress-edit-vertexmarker"},initialize:function(e,t,r,o){L.Editable.VertexMarker.prototype.initialize.call(this,e,t,r,o)}}),MapExpress.Edit.MiddleMarker=L.Editable.MiddleMarker.extend({options:{draggable:!0,className:"leaflet-div-icon leaflet-middle-icon mapexpress-edit-vertexmarker_middle"},initialize:function(e,t,r,o,s){L.Editable.MiddleMarker.prototype.initialize.call(this,e,t,r,o,s)}}),MapExpress.Edit.BaseLayerEditor=L.Evented.extend({CHANGE_TYPE:{insert:"insert",update:"update",delete:"delete"},options:{featureKeyFieldName:"id",useEditFeatureOriginalStyle:!1,editFeatureStyle:{color:"#424447",weight:3,fillOpacity:.1,stroke:!0,opacity:1},draggable:!1,editIcon:!1},initialize:function(e,t){L.setOptions(this,t),this.editTools=new L.Editable(window.MapManager._map,t),this.editTools.options.vertexMarkerClass=this.options.vertexMarkerClass||MapExpress.Edit.VertexMarker,this.editTools.options.middleMarkerClass=this.options.middleMarkerClass||MapExpress.Edit.MiddleMarker,this.options.useEditFeatureOriginalStyle||this.editTools.on("editable:editing",function(e){e.layer instanceof L.Marker||!e.layer.setStyle||e.layer.setStyle(this.options.editFeatureStyle)},this),window.MapManager._map.editTools=this.editTools,this.setEditableLayer(e)},setEditableLayer:function(e){this.layerId=e,this._layerModel=window.MapManager._mapModel.getLayerById(this.layerId),this._recreateEditLayerGroup()},getEditLayerGroup:function(){return this._editLayerGroup},getEditableLayerModel:function(){return this._layerModel},getEditableMapLayer:function(){return this._layerModel.mapLayer},getEditTools:function(){return this.editTools},startEdit:function(){this._layerModel=window.MapManager._mapModel.getLayerById(this.layerId),this._layerModel&&this._layerModel.mapLayer&&(this._layerModel.mapLayer.layerEditor&&delete this._layerModel.mapLayer.layerEditor,(this._layerModel.mapLayer.layerEditor=this)._layerModel.on("mapexspress:layermodel:visiblechanged",function(e){this._layerModel.mapLayer.options.visible||this.clearEditLayer()},this),this._layerModel.mapLayer.on("mapexspress:layer:data:clear",function(e){this.clearEditLayer()},this)),window.MapManager._map.on("mousedown",this._onMapClick,this)},stopEdit:function(){this.clearEditLayer(),this.stopDrawing(),window.MapManager._map._container.style.cursor="",window.MapManager.off("mapexspress:mapmanager:layer:overlaysreordered",this._bringToFrontEditLayer,this),window.MapManager._map.off("mousedown",this._onMapClick,this)},startAddCircleMarker:function(){this.editTools.off("editable:drawing:commit",this._onInsertFeatureComplete,this),this.editTools.on("editable:drawing:commit",this._onInsertFeatureComplete,this),this.editTools.startCircle()},startAddPolyline:function(){this.editTools.off("editable:drawing:commit",this._onInsertFeatureComplete,this),this.editTools.on("editable:drawing:commit",this._onInsertFeatureComplete,this),this.editTools.startPolyline()},startAddPolygon:function(){this.editTools.off("editable:drawing:commit",this._onInsertFeatureComplete,this),this.editTools.on("editable:drawing:commit",this._onInsertFeatureComplete,this),this.editTools.startPolygon()},startAddPolygonShape:function(e){e&&e instanceof L.Polygon&&e.editor.newShape()},startAddRectangle:function(){this.editTools.off("editable:drawing:commit",this._onInsertFeatureComplete,this),this.editTools.on("editable:drawing:commit",this._onInsertFeatureComplete,this),this.editTools.startRectangle()},stopDrawing:function(){this.editTools&&(this.editTools.off("editable:drawing:commit",this._onInsertFeatureComplete,this),this.editTools.stopDrawing())},onSaveFeature:function(e){},onSaveAsFeatureCollection:function(e){},saveChanges:function(){this.onSaveAsFeatureCollection(this._editLayerGroup.toGeoJSON());for(var e=this._editLayerGroup.getLayers(),t=e.length-1;0<=t;t--){var r=e[t].toGeoJSON();this.onSaveFeature(r)}this.clearEditLayer()},rejectChanges:function(){this.clearEditLayer()},clearEditLayer:function(){this._editLayerGroup&&this._editLayerGroup.clearLayers()},addEditGeoJsonLayerFromFile:function(){var o=this,s=new MapExpress.Tools.FileLoaderAndShowAsLayerCommand(window.MapManager);s.processConvertedGeoJSON=function(e,t){var r=s.createGeoJsonLayer(e,t);r&&(r.eachLayer(function(e){o._addFeatureToEditLayer(e,o.CHANGE_TYPE.insert)}),window.MapManager.removeLayerById(r.id))},s.activate()},_recreateEditLayerGroup:function(){this.clearEditLayer(),this._editLayerGroup&&delete this._editLayerGroup;var e=this._layerModel&&this._layerModel.mapLayer?this._layerModel.mapLayer.options:null;e&&(e.interactive=!0,e.zIndex=1e4),this._editLayerGroup=new L.geoJSON(null,e).addTo(window.MapManager._map),this._bringToFrontEditLayer()},_onMapClick:function(e){if(this._layerModel||this._layerModel.mapLayer){var r=this,o=window.MapManager._map,t=e.latlng,s=e.containerPoint,i=o.getZoom(),a=o.getBounds(),n=o.getSize(),l=this._layerModel.mapLayer;l instanceof MapExpress.Layers.GeoJSONServiceLayer?l._getFeaturesAtPoint(t,e.layerPoint,a,n,i).then(function(e){var t=new L.GeoJSON(e);t.addTo(window.MapManager._map),t.eachLayer(function(e){r._addFeatureToEditLayer(e,r.CHANGE_TYPE.update)}),o.removeLayer(t)}):l._dataPovider.getFeatureInfoAsync(t,s,a,n,i).then(function(e){var t=new L.GeoJSON(e,{coordsToLatLng:function(e){return L.CRS.EPSG3857.unproject(L.point(e[0],e[1]))}});t&&(t.addTo(window.MapManager._map),t.eachLayer(function(e){r._addFeatureToEditLayer(e,r.CHANGE_TYPE.update)}),o.removeLayer(t))})}},_onInsertFeatureComplete:function(e){var r=this;this._addFeatureToEditLayer(e.layer,this.CHANGE_TYPE.insert,function(e){var t={};t.layer=e.layer,t.geoJSON=e.layer.toGeoJSON(),r._fireAndForward("mapexpress:edit:newfeatureadded",t)}),window.MapManager._map.removeLayer(e.layer)},_addFeatureToEditLayer:function(o,e,s){if(o&&!this._getLayerByIdFromEditLayerGroup(o)){var t=o.toGeoJSON();MapExpress.Utils.GeoJSONUtils.featureHasCoordinates(t)&&(this._editLayerGroup.on("layeradd",r,this),this._editLayerGroup.addData(t),this._editLayerGroup.off("layeradd",r,this))}function r(e){var t=this;e.layer instanceof L.CircleMarker||(e.layer instanceof L.Marker||!t.options.draggable||(e.layer.options.draggable=!0,e.layer.dragging=new L.Handler.PathDrag(e.layer)),e.layer.off("click",L.DomEvent.stop).on("click",function(){t._toggleEditFeature(e.layer)}),this._updateTempEditFeatureStyle(e.layer,o.options),this._toggleEditFeature(e.layer)),e.layer instanceof L.CircleMarker&&this._setCircleMarkerMoveble(e),s&&"function"==typeof s&&s(e);var r={};r.layer=e.layer,r.geoJSON=e.layer.toGeoJSON(),this._fireAndForward("mapexpress:edit:featureaddedtoeditlayer",r)}},_setCircleMarkerMoveble:function(e){var r=this,o=e.layer;o.bringToFront();var s={};function t(){window.MapManager._map.dragging.disable();var e=r.getEditableMapLayer(),t=MapExpress.Utils.GeoJSONUtils.getLayerByPropertyValueFromLayerGroup(e,r.options.featureKeyFieldName,o.feature.properties[r.options.featureKeyFieldName]);t&&t._mapToAdd&&(s.circleMarker.setStyle(t.options),window.MapManager._map.removeLayer(t)),s.circleMarker.on("mouseup",i),window.MapManager._map.on("mousemove touchmove",function(e){s.circleMarker.setLatLng(e.latlng),s.circleMarker.bringToFront(),r._fireAndForward("mapexpress:edit:circleMarker:drag",s)}),r._fireAndForward("mapexpress:edit:circleMarker:dragstart",s)}function i(){window.MapManager._map.removeEventListener("mousemove touchmove"),window.MapManager._map.dragging.enable(),r._fireAndForward("mapexpress:edit:circleMarker:dragend",s)}s.editor=r,s.circleMarker=o,r._editLayerGroup.eachLayer(function(e){e.off("mouseup",i)}),o.on("mousedown touchstart",t),t()},_toggleEditFeature:function(e){e instanceof L.CircleMarker||(this._bringToFrontEditLayer(),e.toggleEdit&&e.toggleEdit())},_updateTempEditFeatureStyle:function(e,t){if(!this.options.useEditFeatureOriginalStyle&&e.setStyle){var r=this.options.useEditFeatureOriginalStyle?t:this.options.editFeatureStyle;e.setStyle(r)}e instanceof L.Marker&&this._updateTempEditMarkerIcon(e)},_updateTempEditMarkerIcon:function(e){if(e.setIcon){var t=this.options.editIcon;t||(t=L.icon({iconUrl:"images/edit_marker.png",iconSize:[25,41],iconAnchor:[12,41],shadowUrl:"images/edit_marker_shadow.png",shadowSize:[41,41],shadowAnchor:[12,41]})),e.setIcon(t)}},_getLayerByIdFromEditLayerGroup:function(e){var t=this.options.featureKeyFieldName;return!!(e&&e.feature&&e.feature.properties&&e.feature.properties.hasOwnProperty(t))&&MapExpress.Utils.GeoJSONUtils.getLayerByPropertyValueFromLayerGroup(this._editLayerGroup,this.options.featureKeyFieldName,e.feature.properties[t])},_bringToFrontEditLayer:function(){this._editLayerGroup&&this._editLayerGroup.bringToFront()},_fireAndForward:function(e,t){((t=t||{}).editor=this).fire(e,t),window.MapManager._map.fire(e,t)}}),MapExpress.Utils.BufferBuilder={createLineStringBuffer:function(e,t){return this._buffer(e,t/=111120)},_buffer:function(e,t){var r=new jsts.io.GeoJSONReader,o=new jsts.io.GeoJSONWriter,s=r.read(e).geometry.buffer(t,10,3);return o.write(s)}},MapExpress.Utils.BufferLine=L.Polyline.extend({options:{className:"leaflet-interactive mapexpress-buffer-linestring"}}),MapExpress.Utils.BufferPolygon=L.Polygon.extend({options:{className:"leaflet-interactive mapexpress-buffer-polygon"}}),MapExpress.Utils.BufferVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon mapexpress-buffer-edge"},initialize:function(e,t,r,o){L.Editable.VertexMarker.prototype.initialize.call(this,e,t,r,o)},onAdd:function(e){L.Editable.VertexMarker.prototype.onAdd.call(this,e),this.on("drag",this.onVertexDrag),this.addMiddleMarkers()},onVertexDrag:function(e){}}),MapExpress.Utils.BufferMiddleVertex=L.Editable.MiddleMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon mapexpress-buffer-middle-edge"},initialize:function(e,t,r,o,s,i){this.middle=i,L.Editable.MiddleMarker.prototype.initialize.call(this,e,t,r,o,s)},computeLatLng:function(e){var t,r,o,s;return this.middle&&void 0!==this.middle.m?(o=this.editor.map.latLngToContainerPoint(this.middle.m).y,s=this.editor.map.latLngToContainerPoint(this.middle.m).x):(t=this.editor.map.latLngToContainerPoint(this.left.latlng),r=this.editor.map.latLngToContainerPoint(this.right.latlng),o=(t.y+r.y)/2,s=(t.x+r.x)/2),this.editor.map.containerPointToLatLng([s,o])},onMouseDown:function(e){var t=L.DomUtil.getPosition(this._icon);if(e={originalEvent:e,latlng:this.editor.map.layerPointToLatLng(t)},0!==this.options.opacity&&(L.Editable.makeCancellable(e),this.editor.onMiddleMarkerMouseDown(e),!e._cancelled)){this.latlngs.splice(this.index(),0,e.latlng),this.editor.refresh();this._icon;var r=this.editor.addVertexMarker(e.latlng,this.latlngs);L.Draggable._dragging=!1,r.dragging._draggable._onDown(e.originalEvent),this.delete()}}}),L.BufferPathEditorInclude={addNonMiddleMarker:function(e,t,r,o){return new this.tools.options.middleMarkerClass(e,t,o,this,{},r)},onVertexDeleted:function(e){for(var t in this.fireAndForward("editable:vertex:deleted",e),this.editLayer._layers)this.editLayer._layers[t].middle&&this.editLayer._layers[t].remove()},onPathClick:function(){this.feature.on("click",function(e){e.layerPoint;var t=this.feature.toGeoJSON();for(var r in this.editLayer._layers)this.editLayer._layers[r].middle&&this.editLayer._layers[r].remove();var o,s,i,a,n,l={},p={},d={m:e.latlng};if("LineString"===t.geometry.type||"MultiLineString"===t.geometry.type){for(var c=0;c<this.feature._rings.length;c++)for(var h=0;h<this.feature._rings[c].length-1;h++)if([this.feature._rings[c][h],this.feature._rings[c][h+1]],l.x=e.layerPoint.x-this.feature._rings[c][h].x,l.y=e.layerPoint.y-this.feature._rings[c][h].y,p.x=e.layerPoint.x-this.feature._rings[c][h+1].x,p.y=e.layerPoint.y-this.feature._rings[c][h+1].y,o=l.x*p.x+l.y*p.y,s=L.LineUtil.pointToSegmentDistance(e.layerPoint,L.point(this.feature._rings[c][h].x,this.feature._rings[c][h].y),L.point(this.feature._rings[c][h+1].x,this.feature._rings[c][h+1].y)).toFixed(0),o<=0&&Number(s)<=1){for(n in this.editLayer._layers)this.editLayer._layers[n]._latlng.lat===this.feature._latlngs[h].lat&&this.editLayer._layers[n]._latlng.lng===this.feature._latlngs[h].lng&&(i=this.editLayer._layers[n]),this.editLayer._layers[n]._latlng.lat===this.feature._latlngs[h+1].lat&&this.editLayer._layers[n]._latlng.lng===this.feature._latlngs[h+1].lng&&(a=this.editLayer._layers[n]);this.addNonMiddleMarker(i,a,d,this.feature._latlngs)}}else if("Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type)for(var u=0;u<this.feature._rings.length;u++){for(var m=[],g=[],_=0;_<this.feature._rings[u].length;_++)m.push(this.feature._rings[u][_]),g.push(this.feature._latlngs[u][_]);m.push(this.feature._rings[u][0]),g.push(this.feature._latlngs[u][0]);for(var f=0;f<m.length-1;f++)if([m[f],m[f+1]],l.x=e.layerPoint.x-m[f].x,l.y=e.layerPoint.y-m[f].y,p.x=e.layerPoint.x-m[f+1].x,p.y=e.layerPoint.y-m[f+1].y,o=l.x*p.x+l.y*p.y,s=L.LineUtil.pointToSegmentDistance(e.layerPoint,L.point(m[f].x,m[f].y),L.point(m[f+1].x,m[f+1].y)).toFixed(0),o<=0&&Number(s)<=1){for(n in this.editLayer._layers)this.editLayer._layers[n]._latlng.lat===g[f].lat&&this.editLayer._layers[n]._latlng.lng===g[f].lng&&(i=this.editLayer._layers[n]),this.editLayer._layers[n]._latlng.lat===g[f+1].lat&&this.editLayer._layers[n]._latlng.lng===g[f+1].lng&&(a=this.editLayer._layers[n]);this.addNonMiddleMarker(i,a,d,this.feature._latlngs[u])}}},this)},endDrawing:function(){this.tools.detachForwardLineGuide(),this.tools.detachBackwardLineGuide(),this._drawnLatLngs&&this._drawnLatLngs.length<this.MIN_VERTEX&&this.deleteShape(this._drawnLatLngs),L.Editable.BaseEditor.prototype.endDrawing.call(this),this.onPathClick(),delete this._drawnLatLngs}},MapExpress.Utils.BufferLineEditorClass=L.Editable.PolylineEditor.extend({includes:L.BufferPathEditorInclude}),MapExpress.Utils.BufferEditor=L.Editable.extend({options:{vertexMarkerClass:MapExpress.Utils.BufferVertex,middleMarkerClass:MapExpress.Utils.BufferMiddleVertex,polylineClass:MapExpress.Utils.BufferLine,polygonClass:MapExpress.Utils.BufferPolygon,polylineEditorClass:MapExpress.Utils.BufferLineEditorClass,lineGuideOptions:{color:"#1eb300"},skipMiddleMarkers:!0},initialize:function(e,t){L.Editable.prototype.initialize.call(this,e),L.setOptions(this,t),(this.map=e).bufferTools&&(e.bufferTools.removeDrawing(),delete e.bufferTools),e.bufferTools=this},abortDrawing:function(){this.stopDrawing()},removeDrawing:function(){this.stopDrawing();var t=this;this.featuresLayer.eachLayer(function(e){e.remove(),delete t.featuresLayer._layers[e._leaflet_id]}),this.editLayer.eachLayer(function(e){e.remove(),delete t.editLayer._layers[e._leaflet_id]})},startPolyline:function(){return this.map.doubleClickZoom&&this.map.doubleClickZoom.disable(),this.on("editable:drawing:commit",this._endPolylineBuffer,this),this.on("editable:vertex:drag",this._redrawPolylineBuffers,this),L.Editable.prototype.startPolyline.call(this),this},_endPolylineBuffer:function(e){var t=this;setTimeout(function(){t.map.doubleClickZoom.enable()},400),this._drawBuffer(e.layer),this.on("editable:vertex:new",this._redrawPolylineBuffers,this),this.on("editable:vertex:deleted",this._redrawPolylineBuffers,this)},_redrawPolylineBuffers:function(){var t=this;this.featuresLayer.eachLayer(function(e){"bufferLineString"===e.type&&(e.remove(),delete t.featuresLayer._layers[e._leaflet_id])}),this.featuresLayer.eachLayer(function(e){t._drawBuffer(e)})},_drawBuffer:function(e){var t=MapExpress.Utils.BufferBuilder.createLineStringBuffer(e.toGeoJSON(),this.getDistance()),r=L.geoJSON(t);r.type="bufferLineString",r.eachLayer(function(e){e.options.className="leaflet-interactive mapexpress-buffer-polygon"}),this.featuresLayer.addLayer(r),this.featuresLayer.eachLayer(function(e){"bufferLineString"===e.type&&e.bringToBack()})},setDistance:function(e,t){if(Number(e)<0)throw new Error("Дистанция не может быть отрицательной!");if(isNaN(Number(e)))throw new Error("Ошибка задания дистанции!");this.distance=Number(e),t&&this._redrawPolylineBuffers()},getDistance:function(){if(!this.distance)throw new Error("Не задана дистанция буффера!");return this.distance},bufferDataToGeoJSON:function(t){var r=null;return this.featuresLayer.eachLayer(function(e){"bufferLineString"===e.type&&t?r=e.toGeoJSON().features[0]:"bufferLineString"===e.type||t||(r=e.toGeoJSON())}),r},createBufferResult:function(){return this.featuresLayer.toGeoJSON().features.length?{bufferGeoJSON:this.bufferDataToGeoJSON(!0),lineStringGeoJSON:this.bufferDataToGeoJSON(!1)}:null}}),L.MeasureLine=L.Polyline.extend({options:{className:"leaflet-interactive leaflet-measure-line"}}),L.MeasurePolygon=L.Polygon.extend({options:{className:"leaflet-interactive leaflet-measure-polygon"}}),L.MeasureVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon leaflet-measure-edge"},initialize:function(e,t,r,o){L.Editable.VertexMarker.prototype.initialize.call(this,e,t,r,o)},onAdd:function(e){L.Editable.VertexMarker.prototype.onAdd.call(this,e),this.on("mouseover",this.onMouseOver),this.on("mouseout",this.onMouseOut),this.on("drag",this.onVertexDrag),this.addMiddleMarkers()},onVertexDrag:function(e){this.editor.continueBackward?e.target.editor.tools.getMeasureLength(e):this.editor.addNewEmptyHole&&e.target.editor.tools.getMeasureArea(e)},onMouseOver:function(e){this.editor.continueBackward?e.target.editor.tools.getMeasureLength(e):this.editor.addNewEmptyHole&&e.target.editor.tools.getMeasureArea(e)},onMouseOut:function(e){e.target._map.doubleClickZoom.enable(),this.editor.continueBackward?e.target.editor.tools.getMeasureLength(e):this.editor.addNewEmptyHole&&e.target.editor.tools.getMeasureArea(e)}}),L.MeasureMiddleVertex=L.Editable.MiddleMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon leaflet-measure-middleEdge"},initialize:function(e,t,r,o,s,i){this.middle=i,L.Editable.MiddleMarker.prototype.initialize.call(this,e,t,r,o,s)},onAdd:function(e){L.Editable.MiddleMarker.prototype.onAdd.call(this,e),this.map=e,this.on("mouseover",this.calculateLength),this.on("mouseout",this.calculateLength)},computeLatLng:function(e){var t,r,o,s;return this.middle&&void 0!==this.middle.m?(o=this.editor.map.latLngToContainerPoint(this.middle.m).y,s=this.editor.map.latLngToContainerPoint(this.middle.m).x):(t=this.editor.map.latLngToContainerPoint(this.left.latlng),r=this.editor.map.latLngToContainerPoint(this.right.latlng),o=(t.y+r.y)/2,s=(t.x+r.x)/2),this.editor.map.containerPointToLatLng([s,o])},calculateLength:function(e){var t=[this.left.latlng,this.right.latlng],r=L.GeoUtil.lineLength(this.map,t),o=this.map.latLngToLayerPoint(this._latlng),s=L.GeoUtil.readableDistance(r),i=this.editor.options.editTools.options.labelStyle;"mouseover"===e.type?(o.newLabel("Длина сегмента: "+s,!0,"middle",null,i),this.layerPoint=o):void 0!==this.layerPoint&&this.layerPoint.removeLabel("middle")},onRemove:function(e){L.Editable.MiddleMarker.prototype.onRemove.call(this,e),void 0!==this.layerPoint&&this.layerPoint.removeLabel("middle")},onMouseDown:function(e){var t=L.DomUtil.getPosition(this._icon);if(e={originalEvent:e,latlng:this.editor.map.layerPointToLatLng(t)},0!==this.options.opacity&&(L.Editable.makeCancellable(e),this.editor.onMiddleMarkerMouseDown(e),!e._cancelled)){this.latlngs.splice(this.index(),0,e.latlng),this.editor.refresh();this._icon;var r=this.editor.addVertexMarker(e.latlng,this.latlngs);L.Draggable._dragging=!1,r.dragging._draggable._onDown(e.originalEvent),this.delete()}}}),L.MeasurablePathEditorInclude={addNonMiddleMarker:function(e,t,r,o){return new this.tools.options.middleMarkerClass(e,t,o,this,{},r)},onVertexDeleted:function(e){for(var t in this.fireAndForward("editable:vertex:deleted",e),this.editLayer._layers)this.editLayer._layers[t].middle&&this.editLayer._layers[t].remove()},onPathClick:function(){this.feature.on("click",function(e){e.layerPoint;var t=this.feature.toGeoJSON();for(var r in this.editLayer._layers)this.editLayer._layers[r].middle&&this.editLayer._layers[r].remove();var o,s,i,a,n,l={},p={},d={m:e.latlng};if("LineString"===t.geometry.type||"MultiLineString"===t.geometry.type){for(var c=0;c<this.feature._rings.length;c++)for(var h=0;h<this.feature._rings[c].length-1;h++)if([this.feature._rings[c][h],this.feature._rings[c][h+1]],l.x=e.layerPoint.x-this.feature._rings[c][h].x,l.y=e.layerPoint.y-this.feature._rings[c][h].y,p.x=e.layerPoint.x-this.feature._rings[c][h+1].x,p.y=e.layerPoint.y-this.feature._rings[c][h+1].y,o=l.x*p.x+l.y*p.y,s=L.LineUtil.pointToSegmentDistance(e.layerPoint,L.point(this.feature._rings[c][h].x,this.feature._rings[c][h].y),L.point(this.feature._rings[c][h+1].x,this.feature._rings[c][h+1].y)).toFixed(0),o<=0&&Number(s)<=1){for(n in this.editLayer._layers)this.editLayer._layers[n]._latlng.lat===this.feature._latlngs[h].lat&&this.editLayer._layers[n]._latlng.lng===this.feature._latlngs[h].lng&&(i=this.editLayer._layers[n]),this.editLayer._layers[n]._latlng.lat===this.feature._latlngs[h+1].lat&&this.editLayer._layers[n]._latlng.lng===this.feature._latlngs[h+1].lng&&(a=this.editLayer._layers[n]);this.addNonMiddleMarker(i,a,d,this.feature._latlngs)}}else if("Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type)for(var u=0;u<this.feature._rings.length;u++){for(var m=[],g=[],_=0;_<this.feature._rings[u].length;_++)m.push(this.feature._rings[u][_]),g.push(this.feature._latlngs[u][_]);m.push(this.feature._rings[u][0]),g.push(this.feature._latlngs[u][0]);for(var f=0;f<m.length-1;f++)if([m[f],m[f+1]],l.x=e.layerPoint.x-m[f].x,l.y=e.layerPoint.y-m[f].y,p.x=e.layerPoint.x-m[f+1].x,p.y=e.layerPoint.y-m[f+1].y,o=l.x*p.x+l.y*p.y,s=L.LineUtil.pointToSegmentDistance(e.layerPoint,L.point(m[f].x,m[f].y),L.point(m[f+1].x,m[f+1].y)).toFixed(0),o<=0&&Number(s)<=1){for(n in this.editLayer._layers)this.editLayer._layers[n]._latlng.lat===g[f].lat&&this.editLayer._layers[n]._latlng.lng===g[f].lng&&(i=this.editLayer._layers[n]),this.editLayer._layers[n]._latlng.lat===g[f+1].lat&&this.editLayer._layers[n]._latlng.lng===g[f+1].lng&&(a=this.editLayer._layers[n]);this.addNonMiddleMarker(i,a,d,this.feature._latlngs[u])}}},this)},endDrawing:function(){this.tools.detachForwardLineGuide(),this.tools.detachBackwardLineGuide(),this._drawnLatLngs&&this._drawnLatLngs.length<this.MIN_VERTEX&&this.deleteShape(this._drawnLatLngs),L.Editable.BaseEditor.prototype.endDrawing.call(this),this.onPathClick(),delete this._drawnLatLngs}},L.MeasureablePolylineEditorClass=L.Editable.PolylineEditor.extend({includes:L.MeasurablePathEditorInclude}),L.MeasureablePolygonEditorClass=L.Editable.PolygonEditor.extend({includes:L.MeasurablePathEditorInclude}),L.Measurable=L.Editable.extend({options:{vertexMarkerClass:L.MeasureVertex,polylineClass:L.MeasureLine,polygonClass:L.MeasurePolygon,middleMarkerClass:L.MeasureMiddleVertex,polylineEditorClass:L.MeasureablePolylineEditorClass,polygonEditorClass:L.MeasureablePolygonEditorClass,lineGuideOptions:{color:"#424447"},skipMiddleMarkers:!0,labelStyle:{rec:{rx:1,ry:1,stroke:"#424447","stroke-width":"0px",fill:"#424447","fill-opacity":1},cross:{stroke:"#424447","stroke-width":"0px",fill:"#424447"},text:{"fill-opacity":1,"text-anchor":"middle","font-size":"12px",color:"white",stroke:"white",fill:"white","stroke-width":"0px"}}},initialize:function(e,t){L.Editable.prototype.initialize.call(this,e),L.setOptions(this,t),e.measureTools&&(e.measureTools.abortDrawing(),delete e.measureTools),(e.measureTools=this).id=Math.floor(65536*(1+Math.random())).toString(16).substring(1),this.map=e,this.endedPoint={}},initBaseListeners:function(){var e=this;this.map.doubleClickZoom&&this.map.doubleClickZoom.disable(),this.on("editable:drawing:commit editable:vertex:dragend editable:vertex:clicked",function(){e.layerPoint.removeLabel("vertex")})},abortDrawing:function(){this.stopDrawing()},removeDrawing:function(){this.stopDrawing();var t=this;this.featuresLayer.eachLayer(function(e){t.layerPoint&&(t.layerPoint.removeLabel("vertex"),t.layerPoint.removeLabelById("null"),t.layerPoint.removeLabelById(e._leaflet_id)),e.remove()}),this.editLayer.eachLayer(function(e){e.remove()})},startPolyline:function(){var e=this;return this.initBaseListeners(),this.on("editable:drawing:start",function(){e.on("editable:drawing:move",e.getMeasureLength)}),this.on("editable:drawing:commit",this._endPolyline,this),L.Editable.prototype.startPolyline.call(this),this},_endPolyline:function(){var t=this;this.map.doubleClickZoom&&this.map.doubleClickZoom.disable(),this.off("editable:drawing:move",this.getMeasureLength),this.createEndedLabel(this,"Polyline"),this.featuresLayer.eachLayer(function(e){e.toGeoJSON&&e.toGeoJSON().geometry&&"LineString"===e.toGeoJSON().geometry.type&&e.on({mousemove:t.getMeasureLength,mouseover:t.getMeasureLength,mouseout:t.getMeasureLength})})},startPolygon:function(){var e=this;return this.initBaseListeners(),this.on("editable:drawing:start",function(){e.on("editable:drawing:move",e.getMeasureArea)}),this.on("editable:drawing:commit",this._endPolygon,this),L.Editable.prototype.startPolygon.call(this),this},_endPolygon:function(){this.map.doubleClickZoom&&this.map.doubleClickZoom.disable(),this.off("editable:drawing:move",this.getMeasureArea),this.createEndedLabel(this,"Polygon")},getMeasureLength:function(e){var t,r,o,s=[];s[0]=e.latlng,r=this.map?this.map:this._map,e.target.latlngs?t=e.target.latlngs:e.target._latlngs?t=e.target._latlngs:e.layer._defaultShape()&&(t=e.layer._defaultShape());var i=[];if("editable:drawing:move"===e.type)i=t.concat(s);else if(!e.target._icon&&"mouseover"===e.type||"mousemove"===e.type||"mouseout"!==e.type&&e.target._path)for(var a=1;a<e.target._parts[0].length;a++){var n=e.layerPoint,l=e.target._parts[0][a-1],p=e.target._parts[0][a];if(L.LineUtil.pointToSegmentDistance(n,l,p,!0)<5)for(var d=1;d<t.length;d++)i=[t[a-1],t[a]]}else{for(var c,h=0;h<t.length;h++){e.latlng;t[h].lat===e.latlng.lat&&(c=h)}i=t.slice(0,c+1)}for(var u=0;u<i.length;u++)this.layerPoint&&this.layerPoint.removeLabel("vertex");if("mouseout"!==e.type){var m,g=L.GeoUtil.readableDistance(L.GeoUtil.lineLength(r,i));if(this.layerPoint=r.latLngToLayerPoint(e.latlng),o=e.target._path?"Длина сегмента: ":"Расстояние: ",m=void 0!==this.options&&void 0!==this.options.labelStyle?this.options.labelStyle:this.editor.options.editTools.options.labelStyle,void 0!==i[i.length-1])this.layerPoint.newLabel(o+g,!0,"vertex",null,m);else if(!i[i.length-1]&&1<i.length)this.layerPoint.newLabel(o+g,!0,"vertex",null,m);else if(void 0===i[i.length-1])return}else this.layerPoint.removeLabel("vertex")},getMeasureArea:function(e){var t,r,o=[];o[0]=e.latlng,r=this.map?this.map:this._map,e.target.latlngs?t=e.target.latlngs:e.target._latlngs?t=e.target._latlngs[0]:e.layer._defaultShape()&&(t=e.layer._defaultShape());var s=[];s="editable:drawing:move"===e.type?t.concat(o):t;for(var i=0;i<s.length;i++)this.layerPoint&&this.layerPoint.removeLabel("vertex");if("mouseout"!==e.type){var a=[L.GeoUtil.readableArea(L.GeoUtil.geodesicArea(s)),L.GeoUtil.readableDistance(L.GeoUtil.lineLength(r,s.concat(s[0])))],n=this.options.labelStyle;if(void 0!==s[s.length-1].__vertex)this.layerPoint=r.latLngToLayerPoint(e.latlng),this.layerPoint.newLabel(a,!0,"vertex",null,n);else if(!s[s.length-1].__vertex&&1<s.length)this.layerPoint=r.latLngToLayerPoint(e.latlng),this.layerPoint.newLabel(a,!0,"vertex",null,n);else if(void 0===s[s.length-1].__vertex)return;this.layerPoint.newLabel(a,!0,"vertex",null,n)}else this.layerPoint.removeLabel("vertex")},createEndedLabel:function(e,t){var l,p,d=this,c=e.featuresLayer._layers[Object.keys(e.featuresLayer._layers)[0]]._leaflet_id,r=$(".leaflet-map-pane").css("transform").replace("(",",").replace(")","").split(",");if(l=e.featuresLayer._layers[Object.keys(e.featuresLayer._layers)[0]]._defaultShape(),e.featuresLayer._layers[Object.keys(e.featuresLayer._layers)[0]].labeled=!0,"Polyline"===t)p="Расстояние: "+L.GeoUtil.readableDistance(L.GeoUtil.lineLength(this.map,l)),this.endedPoint=this.map.latLngToContainerPoint(l[l.length-1]);else if("Polygon"===t){for(var o=[],s=0;s<l.length;s++)o.push(l[s]);o.push(l[0]),p=[L.GeoUtil.readableArea(L.GeoUtil.geodesicArea(o)),L.GeoUtil.readableDistance(L.GeoUtil.lineLength(this.map,o))],this.endedPoint=this.map.latLngToContainerPoint(e.featuresLayer._layers[c].getCenter())}this.endedPoint.x=this.endedPoint.x-r[r.length-2],this.endedPoint.y=this.endedPoint.y-r[r.length-1];var i={};for(var a in d.options.labelStyle)i[a]=d.options.labelStyle[a];function h(e){return"Polyline"===t?function(e){var r,o=d.options.labelStyle;if("zoomend"!==e.type){var t=e.layer;if(r=t._leaflet_id,this.endedPoint.removeLabelById(r),"editable:vertex:dragstart"===e.type)return;l=e.layer._defaultShape(),p="Расстояние: "+L.GeoUtil.readableDistance(L.GeoUtil.lineLength(this.map,l));var s=$(".leaflet-map-pane").css("transform").replace("(",",").replace(")","").split(",");this.endedPoint=this.map.latLngToContainerPoint(l[l.length-1]),this.endedPoint.x=this.endedPoint.x-s[s.length-2],this.endedPoint.y=this.endedPoint.y-s[s.length-1],this.endedPoint.newLabel(p,!0,"endedPoint",r,o)}else this.map.eachLayer(function(e){if(!0===e.labeled&&e.toGeoJSON&&"LineString"===e.toGeoJSON().geometry.type){r=e._leaflet_id,d.endedPoint.removeLabelById(r),l=e._defaultShape(),p="Расстояние: "+L.GeoUtil.readableDistance(L.GeoUtil.lineLength(d.map,l));var t=$(".leaflet-map-pane").css("transform").replace("(",",").replace(")","").split(",");d.endedPoint=d.map.latLngToContainerPoint(l[l.length-1]),d.endedPoint.x=d.endedPoint.x-t[t.length-2],d.endedPoint.y=d.endedPoint.y-t[t.length-1],d.endedPoint.newLabel(p,!0,"endedPoint",r,o)}})}.call(this,e):"Polygon"===t?function(e){var s,i={};for(var t in d.options.labelStyle)i[t]=d.options.labelStyle[t];if(i.forPolygon=!0,i.notVertex=!0,"zoomend"!==e.type){var r=e.layer;if(s=r._leaflet_id,this.endedPoint.removeLabelById(s),"editable:vertex:dragstart"===e.type)return;l=r._defaultShape();for(var o=[],a=0;a<l.length;a++)o.push(l[a]);o.push(l[0]),p=[L.GeoUtil.readableArea(L.GeoUtil.geodesicArea(o)),L.GeoUtil.readableDistance(L.GeoUtil.lineLength(this.map,o))];var n=$(".leaflet-map-pane").css("transform").replace("(",",").replace(")","").split(",");setTimeout(function(){d.endedPoint=d.map.latLngToContainerPoint(r.getCenter()),d.endedPoint.x=d.endedPoint.x-n[n.length-2],d.endedPoint.y=d.endedPoint.y-n[n.length-1],d.endedPoint.newLabel(p,!0,"endedPoint",s,i)},0)}else this.map.eachLayer(function(e){if(!0===e.labeled&&e.toGeoJSON&&"Polygon"===e.toGeoJSON().geometry.type){s=e._leaflet_id,d.endedPoint.removeLabelById(s),l=e._defaultShape();for(var t=[],r=0;r<l.length;r++)t.push(l[r]);t.push(l[0]),p=[L.GeoUtil.readableArea(L.GeoUtil.geodesicArea(t)),L.GeoUtil.readableDistance(L.GeoUtil.lineLength(d.map,t))];var o=$(".leaflet-map-pane").css("transform").replace("(",",").replace(")","").split(",");d.endedPoint=d.map.latLngToContainerPoint(e.getCenter()),d.endedPoint.x=d.endedPoint.x-o[o.length-2],d.endedPoint.y=d.endedPoint.y-o[o.length-1],d.endedPoint.newLabel(p,!0,"endedPoint",s,i)}})}.call(this,e):void 0}i.forPolygon=!0,i.notVertex=!0,this.endedPoint.newLabel(p,!0,"endedPoint",c,i),this.map.on("zoomend",h,this),this.map.on("click",function e(t){var r=t.layerPoint.x;var o=t.layerPoint.y;for(var s=0;s<this.endedPoint.rectangleRegion.length;s++){var i=this.endedPoint.rectangleRegion[s]._groups[0][0].width.baseVal.value,a=this.endedPoint.rectangleRegion[s]._groups[0][0].height.baseVal.value,n=this.endedPoint.rectangleRegion[s]._groups[0][0].x.baseVal.value,l=this.endedPoint.rectangleRegion[s]._groups[0][0].y.baseVal.value,p=this._pointIntersectionMath([r,o],[[n,l],[n+i,l],[n+i,l+a],[n,l+a]]);if(!0===p){var d=this;this.endedPoint.removeLabelById(c),this.map.eachLayer(function(e){e._leaflet_id.toString()===c.toString()&&(e.labeled=!1,d.layerPoint.removeLabel("vertex"),e.remove(),delete d.map.editTools.featuresLayer._layers[e._leaflet_id])}),this.map.off("zoomend",h,this),this.map.off("click",e,this),this.off("editable:vertex:dragstart editable:vertex:deleted editable:vertex:dragend",h)}}},this),this.on("editable:vertex:dragstart editable:vertex:deleted editable:vertex:dragend",h)},_pointIntersectionMath:function(e,t){for(var r=e[0],o=e[1],s=!1,i=0,a=t.length-1;i<t.length;a=i++){var n=t[i][0],l=t[i][1],p=t[a][0],d=t[a][1];o<l!=o<d&&r<(p-n)*(o-l)/(d-l)+n&&(s=!s)}return s}}),L.Point.prototype.newLabel=function(e,t,r,o,s){if((0!==this.x||0!==this.y)&&void 0!==e){var p,i,a;e.isArray||(e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),e.isArray?(p=" Площадь: "+e[0]+"/Периметр: "+e[1],s&&s.forPolygon&&!0===s.forPolygon&&void 0!==s.notVertex?a=i=0:(i=80,a=30)):(p=e,s&&s.forPolyline&&!0===s.forPolyline?a=i=0:(i=40,a=15));var n,l=d3.select("svg").append("g").attr("class","leaflet-measure-measurmentLabel"+r);o&&"null"!==o&&l.attr("id","measurmentLabel"+o),!0===t&&(n=l.append("rect"));var d,c=l.append("text").attr("x",this.x+i).attr("y",this.y-a).attr("class","leaflet-measure-label-text").call(function(e,l){e.each(function(){for(var e=d3.select(this),t=p.split("/").reverse(),r=!0,o=[],s=0,i=e.attr("x"),a=e.attr("y"),n=e.text(null).append("tspan").attr("x",i).attr("y",a).attr("dy","0em");r;)r=t.pop(),o.push(r),n.text(o.join(" ")),n.node().getComputedTextLength()>l&&(o.pop(),n.text(o.join("/")),o=[r],n=e.append("tspan").attr("x",i).attr("y",a).attr("dy",1.1*++s+0+"em").text(r))})},180);if(s.text)for(var h in s.text)c.style(h,s.text[h]);if(null!==c.node()){if(d=c.node().getBBox(),!0===t){var u=d.width+12,m=d.height+2;if(n.attr("class","leaflet-measure-label-rectangle").attr("width",u+5).attr("height",m).attr("x",d.x-5).attr("y",d.y-1),s.rec)for(var g in s.rec)n.style(g,s.rec[g])}void 0!==o&&n.attr("id",o);var _=n.node().getBBox(),f=l.append("svg").attr("width","18px").attr("height","18px").attr("viewBox","0 0 26 20").attr("x",_.x+_.width-9).attr("y",_.y-10);f.append("circle").attr("class","leaflet-measure-label-circle").attr("cx",12).attr("cy",12).attr("r",10).style("fill",s.cross.stroke).style("stroke-width",s.cross["stroke-width"]).style("stroke",s.cross.stroke),f.append("path").attr("class","leaflet-measure-label-cross").attr("d","M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z").style("stroke-width","1px").style("stroke","white").style("fill","white").style("fill-rule","evenodd");this.rectangleRegion=[n,f]}}},L.Point.prototype.removeLabel=function(e){var t=$(".leaflet-measure-measurmentLabel"+e);t&&t.remove()},L.Point.prototype.removeLabelById=function(e){var t=$("#measurmentLabel"+e);t&&t.remove()},L.GeoUtil=L.extend(L.GeoUtil||{},{geodesicArea:function(e){var t,r,o=e.length,s=0,i=Math.PI/180;if(2<o){for(var a=0;a<o;a++)t=e[a],s+=((r=e[(a+1)%o]).lng-t.lng)*i*(2+Math.sin(t.lat*i)+Math.sin(r.lat*i));s=s*L.Projection.SphericalMercator.R*L.Projection.SphericalMercator.R/2}return Math.abs(s)},readableArea:function(e){var t;return e<1e4?t=L._("{area} м²",{area:e.toFixed(3)}):(e/=1e6,t=L._("{area} км²",{area:e.toFixed(3)})),t},readableDistance:function(e,t){return 1e4<e?L._("{distance} км",{distance:(e/1e3).toFixed(3)}):L._("{distance} м",{distance:(e/1).toFixed(2)})},lineLength:function(e,t){for(var r,o,s=0,i=0;i<t.length;i++)r=t[i],o&&(s+=e.distance(r,o)),o=r;return s}}),L._=L._||function(e,t){return L.Util.template(e,t)},MapExpress.AreaSelect||(MapExpress.AreaSelect={}),MapExpress.AreaSelect.AreaSelectRectangle=L.Rectangle.extend({options:{className:"leaflet-interactive leaflet-area-select-rectangle",draggable:!0},initialize:function(e,t){L.Rectangle.prototype.initialize.call(this,e,t),this.options.draggable=!0,this.dragging=new L.Handler.PathDrag(this)}}),MapExpress.AreaSelect.AreaSelectVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon leaflet-area-select-edge"},initialize:function(e,t,r,o){L.Editable.VertexMarker.prototype.initialize.call(this,e,t,r,o),this.on("drag",this.onVertexDrag)},onVertexDrag:function(e){e.target.editor.tools.change(e)}}),MapExpress.Controls.AreaSelectEditable=L.Editable.extend({options:{vertexMarkerClass:MapExpress.AreaSelect.AreaSelectVertex,rectangleClass:MapExpress.AreaSelect.AreaSelectRectangle},initialize:function(e,t){L.Editable.prototype.initialize.call(this,e),L.setOptions(this,t),this.map=e,this.map.areaSelectEditable&&this.map.areaSelectEditable.remove(),(this.map.areaSelectEditable=this).startRectangle()},_createBounds:function(){var e=.2*$(this.map.getContainer()).width(),t=.2*$(this.map.getContainer()).height(),r=.8*$(this.map.getContainer()).width(),o=.8*$(this.map.getContainer()).height(),s=this.map.containerPointToLatLng(new L.Point(e,t)),i=this.map.containerPointToLatLng(new L.Point(r,o));return L.latLngBounds(s,i)},startRectangle:function(){return this.area=L.Editable.prototype.createRectangle.call(this,this._createBounds()),this.area.addTo(this.map),this.area.enableEdit(),this.area.on("dragend",this.change,this),this},getBounds:function(){return this.area.getBounds()},getCenter:function(){return this.area.getCenter()},abortSelecting:function(){this.stopDrawing(),this.area.remove()},remove:function(){this.abortSelecting(),delete this.map.areaSelectEditable},change:function(){this.fire("change")}}),MapExpress.Controls.MapExportControl=L.Control.extend({options:{position:"topright"},futureSize:{width:0,height:0,size:0,zoom:0},initialize:function(e,t){this.map=e,L.setOptions(this,t),this.active=!1,this.futureSize.zoom=e.getZoom(),this.printer=MapExpress.Utils.mapExporter()},addTo:function(e){return this.map=e,L.Control.prototype.addTo.call(this,e),this._setUpButtonHandlers(),this._activateAreaSelect(),this},onAdd:function(e){return this._createContent()},remove:function(){L.Control.prototype.remove.call(this),this.areaSelect&&(this.areaSelect.off("change",this._areaSelectChanged,this),this.areaSelect.remove())},_areaSelectChanged:function(e){this.updateFutureSize()},_createContent:function(){return this.controlDiv=L.DomUtil.create("div","map-print-container"),this.controlDiv.setAttribute("id","map-print-container"),MapExpress.Controls.MapControlUtils.stopMousePropagation(this.controlDiv),$(this.controlDiv).append('<button id="mapprint-zoomDown"  class="btn btn-default btn-sm text-center" title="Уменьшить масштабный коэффициент карты">-</button>'),$(this.controlDiv).append('<button id="mapprint-zoomUp" class="btn btn-default btn-sm text-center" title="Увеличить масштабный коэффициент карты">+</button>'),$(this.controlDiv).append('<button id="mapprint-print" class="btn btn-default btn-sm text-center" title="Экспорт" value="Экспорт">Экспорт</button>'),$(this.controlDiv).append('<button id="mapprint-print-activemap" class="btn btn-default btn-sm text-center" title="Экспорт активного вида карты" value="активный вид карты">Активный вид</button>'),$(this.controlDiv).append('<button id="mapprint-remove" class="btn btn-default btn-sm text-center" title="Cбросить выбор территории" value="Отмена">Отмена</button>'),this.controlDiv},_activateAreaSelect:function(){$(this.map.getContainer()).height(),$(this.map.getContainer()).width();this.areaSelect=new MapExpress.Controls.AreaSelectEditable(this.map,{draggable:this.options.draggable||!1}),this.updateFutureSize(),this.areaSelect.on("change",this._areaSelectChanged,this)},_setUpButtonHandlers:function(){var t=this;$("#mapprint-print-activemap").click(function(e){t.map.fire("map-print-control:export-activemap",t),t.exportMap(!0)}),$("#mapprint-remove").click(function(e){t.remove(),t.map.fire("map-print-control:removed",t)}),$("#mapprint-zoomUp").click(function(){t.futureSize.zoom=t.futureSize.zoom+1,20<t.futureSize.zoom&&(t.futureSize.zoom=20),t.updateFutureSize(),t.map.fire("map-print-control:zoomUp",t)}),$("#mapprint-zoomDown").click(function(){t.futureSize.zoom=t.futureSize.zoom-1,t.updateFutureSize(),t.map.fire("map-print-control:zoomDown",t)}),$("#mapprint-print").click(function(){t.map.fire("map-print-control:export-click",t),t.exportMap()})},updateFutureSize:function(){var e=this.futureSize.zoom,t=(this.areaSelect.getCenter(),this.map.getPixelBounds(this.areaSelect.getBounds()._northEast,e)),r=this.map.getPixelBounds(this.areaSelect.getBounds()._southWest,e),o={x:null,y:null},s={x:null,y:null};o.x=t.min.x+this.map.getSize().x/2,o.y=t.min.y+this.map.getSize().y/2,s.x=r.min.x+this.map.getSize().x/2,s.y=r.min.y+this.map.getSize().y/2;var i=s.y-o.y,a=o.x-s.x;this.futureSize.width=a,this.futureSize.height=i,this.futureSize.size=a*i,this.map.fire("map-print-control:futuresize:changed",this)},_getWarningColor:function(){var e,t=this.futureSize.size;return t<=6e5?e="#4CAF50":6e5<t&&t<=9e5?e="#8BC34A":9e5<t&&t<=14e5?e="#CDDC39":14e5<t&&t<=2e6?e="#FDD835":2e6<t&&t<=28e5?e="#FFC107":28e5<t&&t<=39e5?e="#FF9800":39e5<t&&t<=6e6?e="#FF5722":6e6<t&&t<=8e6?e="#F44336":8e6<t&&(e="#D50000"),e},exportMap:function(e){$(".leaflet-control-container, #map-print-container").attr("data-html2canvas-ignore","true"),$(".leaflet-control-container").attr("data-html2canvas-ignore","true"),this.areaSelect.off("change",this._resetChange,this),e&&!0===e?this.printer.exportActiveMapView(this.map):this.printer.export(this.map,this.futureSize.width,this.futureSize.height,this.futureSize.zoom,this.areaSelect.getCenter()),this.remove()}}),MapExpress.Utils.MapExporter=L.Evented.extend({exportActiveMapView:function(e,t){this.export(e,null,null,null,null,!0)},export:function(e,t,r,o,s,i){this.activeView=i,this.mapStyle=""+e.getContainer().style.cssText,this._export(e,t,r,o,s)},_export:function(r,e,t,o,s){this.map=r,this.fire("mapexport:export:start",this);var i=$(r.getContainer()),a=r.getZoom(),n=r.getCenter();this.activeView||($(document).height()>t?i.height(t):i.css("min-height",t+"px"),i.width(e),r.invalidateSize(!0,!0),r.setView(s,o));var l=this;setTimeout(function(){try{l._prepareExport(r,a,n)}catch(e){console.log(e);var t=l._tryCatchExportResult(r,a,n);t.error=e,l.fire("mapexport:export:end",t)}},5e3)},_prepareExport:function(e,t,r){this.fire("mapexport:prepareexport:start",this);var o=$(e.getContainer()).clone(),s=o.find(".leaflet-map-pane")[0].style.transform.split(",");this.mapX=parseFloat(s[0].split("(")[1].replace("px","")),this.mapY=parseFloat(s[1].replace("px","")),this.fire("mapexport:prepareexport:mapPane",this);var i=document.createElement("canvas");i.className="screenShotTempCanvas",i.id="mainCanvas",i.width=e.getSize().x,i.height=e.getSize().y,i.style.left=-this.mapX,i.style.top=-this.mapY;var a=i.getContext("2d");a.fillStyle="#ddd",a.fillRect(0,0,i.width,i.height),this.on("mapexport:prepareexport:canvascreated",function(){this.drawtilesOnCanvas(e,a)},this),this.on("mapexport:prepareexport:alltilesloaded",function(){this.drawImageOverlaysOnCanvas(e,o,a)},this),this.on("mapexport:prepareexport:allmapimageoverlayloaded",function(){this.drawShadowIconsOnCanvas(e,o,a)},this),this.on("mapexport:prepareexport:allmapshadowiconsloaded",function(){this.drawSVGOnCanvas(e,o,a)},this),this.on("mapexport:prepareexport:canvaswithsvgready",function(){this.drawDivIconsOnCAnvas(e,o,a,i)},this),this.on("mapexport:prepareexport:allmapiconsdrawn",function(){this.exportCanvas(e,i,t,r)},this),this.on("mapexport:prepareexport:canvasexported",function(){o.remove(),this.fire("mapexport:prepareexport:end",this)},this),this.fire("mapexport:prepareexport:canvascreated",this)},drawtilesOnCanvas:function(r,t){var e=$(r.getContainer()),o=e.find(".leaflet-map-pane"),s=e.find(".leaflet-tile-container"),i=this;function a(e){e&&(t.drawImage(e.canvas,0,0),$("#tileCanvas").remove()),i.fire("mapexport:prepareexport:alltilesloaded")}if(s||s[0]){o[0].style.transform.split(",");var n=function(){var e=document.createElement("canvas");e.className="tileTempCanvas",e.id="tileCanvas",e.width=r.getSize().x,e.height=r.getSize().y,e.style.left=-i.mapX,e.style.top=-i.mapY;var t=e.getContext("2d");return t.globalAlpha=o.find(".leaflet-tile-pane").children().css("opacity"),t}(),l=(1<s.length?s[1]:s[0]).style.transform.split(","),p=parseFloat(l[0].split("(")[1].replace("px","")),d=parseFloat(l[1].replace("px","")),c=e.find("img.leaflet-tile"),h=[],u=[],m=0,g=0;function _(){return m+g===c.length?a(n):null}for(var f=0;f<c.length;f++){var y=c[f].style.transform.split(",");h[f]=parseFloat(y[0].split("(")[1].replace("px","")),u[f]=parseFloat(y[1].replace("px",""));var x=new Image;x.crossOrigin="anonymous",x.onload=function(e){return function(){n.drawImage(this,h[e]+p+i.mapX,u[e]+d+i.mapY),m+=1,_.call(i)}}(f),x.onerror=function(){g+=1,_.call(i)},x.src=c[f].src}}else a()},drawImageOverlaysOnCanvas:function(e,t,s){var i=t.find("img.leaflet-image-layer"),a=this;if(i&&i[0]){for(var n=[],l=[],r=[],p=[],d=[],o=[],c=0;c<i.length;c++){if(p.push(parseFloat(i[c].style.width.replace("px",""))),d.push(parseFloat(i[c].style.height.replace("px",""))),""!==i[c].style.left)n.push(parseFloat(i[c].style.left.replace("px",""))),l.push(parseFloat(i[c].style.top.replace("px","")));else if(""!==i[c].style.transform){var h=i[c].style.transform.split(",");n[c]=parseFloat(h[0].split("(")[1].replace("px","")),l[c]=parseFloat(h[1].replace("px","")),i[c].style.transform=""}else n[c]=0,r[c]=0;i[c].style.left=n[c]+"px",i[c].style.top=l[c]+"px",o.push(new Promise(function(e,t){var r,o,s=new Image;s.setAttribute("crossOrigin","anonymous"),s.onload=(r=c,function(){e([this,r])}),s.onerror=(o=c,function(){console.log("Ошибка оверлея: "+this.src+"  "+o),e([!1,o])}),s.src=i[c].src}))}Promise.all(o).then(function(e){for(var t=0;t<e.length;t++){var r=e[t][0];if(r){var o=e[t][1];s.drawImage(r,n[o]+a.mapX,l[o]+a.mapY,p[o],d[o])}}a.fire("mapexport:prepareexport:allmapimageoverlayloaded")})}else this.fire("mapexport:prepareexport:allmapimageoverlayloaded")},drawSVGOnCanvas:function(t,e,r){var o=$(t.getPanes().overlayPane).attr("class"),s=e.find("."+o.replace(" ",".")).find("svg"),i=this;if(s&&void 0!==s[0]){var a,n=s[0],l=n.style.transform.split(","),p=parseFloat(l[0].split("(")[1].replace("px","")),d=parseFloat(l[1].replace("px",""));n.style.transform="",n.style.left=p+"px",n.style.top=d+"px",s.each(function(){var e=document.createElement("canvas");e.className="screenShotTempCanvas",e.id="SvgToCanvas",e.width=t.getSize().x,e.height=t.getSize().y;e.getContext("2d");L.DomUtil.getPosition(s),a=(new XMLSerializer).serializeToString(this),canvg(e,a),r.drawImage(e,p+i.mapX,d+i.mapY)}),this.fire("mapexport:prepareexport:canvaswithsvgready")}else this.fire("mapexport:prepareexport:canvaswithsvgready")},drawShadowIconsOnCanvas:function(e,t,r){var o=t.find("img.leaflet-marker-shadow"),s=this;if(o&&o[0]){var i=[],a=[],n=[],l=[],p=[],d=[],c=0,h=0;function u(){var e=o.length;c+h===e&&s.fire("mapexport:prepareexport:allmapshadowiconsloaded")}for(var m=0;m<o.length;m++){var g=o[m].style.transform.split(",");l.push(parseInt(o[m].style.marginTop.replace("px",""))),n.push(parseInt(o[m].style.marginLeft.replace("px",""))),i.push(parseFloat(g[0].split("(")[1].replace("px",""))),a.push(parseFloat(g[1].replace("px",""))),o[m].style.transform="",o[m].style.left=i[m]+"px",o[m].style.top=a[m]+"px",p.push(parseInt(o[m].style.width.replace("px",""))),d.push(parseInt(o[m].style.height.replace("px","")));var _=new Image;_.setAttribute("crossOrigin","anonymous"),_.src=o[m].src,_.onload=function(e){return function(){s.fire("mapexport:prepareexport:mapshadowiconloaded"),r.drawImage(this,i[e]+s.mapX+n[e],a[e]+s.mapY+l[e],p[e],d[e]),c+=1,u.call(s)}}(m),_.onerror=function(){s.fire("mapexport:prepareexport:mapshadowiconserror"),h+=1,u.call(s)}}}else this.fire("mapexport:prepareexport:allmapshadowiconsloaded")},drawDivIconsOnCAnvas:function(e,t,r,o){var s=this,i=t.find(".leaflet-marker-pane"),a={div:"",icons:""};function n(){!0===a.div&&!0===a.icons&&(i.attr("class","tempopane"),document.body.appendChild(i[0]),html2canvas(i[0],{onrendered:function(e){r.drawImage(e,0,0),s.fire("mapexport:prepareexport:allmapiconsdrawn"),$(".tempopane").remove()},canvas:o}),a.div="",a.icons="")}if(i&&i[0].children&&0<i[0].children.length){var l=t.find("div.leaflet-marker-icon");if(l&&l[0]){for(var p,d=[],c=[],h=[],u=[],m=0;m<l.length;m++){var g=(p=l[m].style).transform.split(",");u.push(parseInt(p.marginTop.replace("px",""))),h.push(parseInt(p.marginLeft.replace("px",""))),d.push(parseFloat(g[0].split("(")[1].replace("px",""))),c.push(parseFloat(g[1].replace("px",""))),p.transform="",p.left=d[m]+s.mapX+"px",p.top=c[m]+s.mapY+"px"}a.div=!0,n.call(this)}else a.div=!0,n.call(this);var _=t.find("img.leaflet-marker-icon");if(_&&_[0]){for(var f,y=[],x=[],v=[],L=[],M=0;M<_.length;M++){var b=(f=_[M].style).transform.split(",");L.push(parseInt(f.marginTop.replace("px",""))),v.push(parseInt(f.marginLeft.replace("px",""))),y.push(parseFloat(b[0].split("(")[1].replace("px",""))),x.push(parseFloat(b[1].replace("px",""))),f.transform="",f.left=y[M]+"px",f.top=x[M]+"px"}a.icons=!0,n.call(this)}else a.icons=!0,n.call(this)}else this.fire("mapexport:prepareexport:allmapiconsdrawn")},exportCanvas:function(e,t,r,o){var s=this._tryCatchExportResult(e,t,r,o);try{t.msToBlob?s.image=t.msToBlob():s.image=t.toDataURL("image/jpeg")}catch(e){s.error=e}this.fire("mapexport:export:end",s)},_tryCatchExportResult:function(e,t,r,o){var s=[e.getBounds()._southWest,e.getBounds()._northEast],i=$(e.getContainer()),a={printer:this,image:!1,bbox:s,imageSize:{width:e.getSize().x,height:e.getSize().y},map:e,error:!1,canvasWidth:t.width,canvasHeight:t.height,mapContainerHeight:i.height(),mapContainerWidth:i.width()};return this.fire("mapexport:prepareexport:canvasexported"),this.fire("mapexport:prepareexport:end",this),this.activeView||(i[0].style.cssText=this.mapStyle,e.setView(o,r),e.invalidateSize(!0)),$("#mainCanvas").remove(),$("#SvgToCanvas").remove(),$("[class^='Labels']").remove(),this.fire("mapexport:restorestate:end",this),a}}),MapExpress.Utils.mapExporter=function(e,t,r,o){return new MapExpress.Utils.MapExporter(e,t,r,o)},MapExpress.Layers.GeoJSONServiceLayer=L.GeoJSON.extend({options:{dynamicData:!0,useVectorTile:!1,smoothFactor:2,featureMinPixelSize:8,markerCluster:!1,markerClusterOptions:{showCoverageOnHover:!1,maxClusterRadius:200}},initialize:function(e,t){L.GeoJSON.prototype.initialize.call(this,null,t),L.setOptions(this,t),this.options.pointToLayer=this._pointToLayer,this._dataPovider=e,this._prevMapView={},this._singleDataLoaded=!1,this.options.markerCluster&&(this.markerClusterLayer=L.markerClusterGroup(this.options.markerClusterOptions))},onAdd:function(e){L.GeoJSON.prototype.onAdd.call(this,e),e.on("moveend",this._updateData,this),this.options.markerCluster&&this._map.addLayer(this.markerClusterLayer),this._updateData()},onRemove:function(e){this.clearLayers(),this._removeLabels(),L.GeoJSON.prototype.onRemove.call(this,e),e.off("moveend",this._updateData,this),this._prevMapView={},this._singleDataLoaded=!1},addData:function(e){if(!e)return this;var t,r,o,s=L.Util.isArray(e)?e:e.features;if(s){for(t=0,r=s.length;t<r;t++)((o=s[t]).geometries||o.geometry||o.features||o.coordinates)&&this.addData(o);return this}if(e.type&&"FeatureCollection"===e.type&&!e.features)return this;var i=this.options;if(i.filter&&!i.filter(e))return this;var a=L.GeoJSON.geometryToLayer(e,i);if(!a)return this;if(a.getBounds){var n=a.getBounds();if(n&&i.featureMinPixelSize&&this._map){var l,p,d=n.getSouthWest(),c=n.getNorthEast();if(!d||!c)return this;if(l=this._map.latLngToLayerPoint(d),(p=this._map.latLngToLayerPoint(c)).x-l.x<i.featureMinPixelSize&&p.y-l.y<i.featureMinPixelSize)return this}}if(a.options.smoothFactor&&this.options.smoothFactor&&this._map){var h=this._map.getZoom(),u=this.options.smoothFactor;15<h&&(u=1),h<12&&(u=4),a.options.smoothFactor=u}return a.feature=L.GeoJSON.asFeature(e),a.defaultOptions=a.options,this.options.onEachFeature&&this.options.onEachFeature(e,a),this.options.markerCluster&&a.feature&&a.feature.geometry&&a.feature.geometry.type&&"Point"===a.feature.geometry.type?this.markerClusterLayer.addLayer(a):this.addLayer(a)},_pointToLayer:function(e,t){return new L.CircleMarker(t,{radius:4,fillColor:"gray",color:"black",weight:1,opacity:.8,fillOpacity:.3})},_refreshData:function(){if(this._map)if(MapExpress.Utils.BrowserUtils.detectIE()){var e=this._map.getCenter();this._map.setView(L.latLng([e.lat+1e-5,e.lng+1e-5]),this._map.getZoom())}else this._updateData(!1)},_updateData:function(e){if(this._map){var t=this._map.getBounds(),r=this._map.getZoom();if(r>this.options.maxZoom||r<this.options.minZoom)return this.clearLayers(),this._removeLabels(),this._singleDataLoaded=!1,void this.fire("mapexspress:layer:data:clear",this);"undefined"!==e&&e&&this._prevMapView&&this._prevMapView.bounds&&this._prevMapView.bounds.equals(t)||(this._removeLabels(),this.options.dynamicData?this.options.useVectorTile?this._updateVectorTileData(t,r):this._updateVectorDataInBounds(t,r):this._singleDataLoaded||(this._singleDataLoaded=!0,this._addVectorData())),this._storeMapView()}},_addVectorData:function(){var t=this;this._dataPovider.getDataAsync().then(function(e){t._replaceData(e),t._singleDataLoaded=!0,t.fire("mapexspress:geojsonlayer:singledata:added",e),t.fire("mapexspress:layer:data:added",e)},function(){t.clearLayers(),t._removeLabels()})},_updateVectorDataInBounds:function(e,t){var r=this;this._dataPovider.getDataInBoundsAsync(e,t).then(function(e){r._replaceData(e),r.fire("mapexspress:geojsonlayer:vectordatainbounds:added",e),r.fire("mapexspress:layer:data:added",e)},function(e){r.clearLayers(),r._removeLabels()})},_updateVectorTileData:function(e,t){var r=this._dataPovider._getAddedTileCoordRangeByMapBounds(this._prevMapView.bounds,this._prevMapView.zoom,e,t);if(this._map.getZoom()!==this._prevMapView.zoom)this.clearLayers(),this._removeLabels();else for(var o=this._dataPovider._getRemovedTileCoordRangeByMapBounds(this._prevMapView.bounds,this._prevMapView.zoom,e,t),s=0;s<o.length;s++)this._removeVectorTile(o[s]);for(var i=0;i<r.length;i++)this._addVectorTile(r[i])},_addVectorTile:function(s){var i=this;this._dataPovider.getDataByTileAsync(s).then(function(e){var t=i.addData(e),r=i._dataPovider._tileCoordsToKey(s);for(var o in t._layers)t._layers[o]._tileCoordKey||(t._layers[o]._tileCoordKey=r);i._updateStyleAndLabels()})},_removeVectorTile:function(e){var t=this._dataPovider._tileCoordsToKey(e);for(var r in this._layers){var o=this._layers[r];o._tileCoordKey&&o._tileCoordKey===t&&this.removeLayer(o)}},_replaceData:function(e){this.clearLayers(),this._removeLabels(),this.addData(e),this._updateStyleAndLabels()},clearLayers:function(){this.markerClusterLayer&&this.markerClusterLayer.clearLayers(),L.GeoJSON.prototype.clearLayers.call(this)},_storeMapView:function(){this._prevMapView.zoom=this._map.getZoom(),this._prevMapView.bounds=this._map.getBounds(),this._prevMapView.center=this._map.getCenter()},_updateStyleAndLabels:function(){this.updateStyle(),this._labelLayer()},_getFeaturesAtPoint:function(e,t,r,o,s){var i=this,a=$.Deferred();try{var n=[];for(var l in i._layers){var p=i._layers[l];if(p instanceof L.Marker&&p._latlng)e.distanceTo(p._latlng)<8&&n.push(p.feature);else{var d=p._clickTolerance;d&&(p._clickTolerance=function(){return 8}),p._containsPoint&&p._containsPoint(t)&&n.push(p.feature),d&&(p._clickTolerance=d)}}a.resolve(n)}catch(e){e.layer=i,a.reject(e)}return a.promise()},updateStyle:function(e){var t=!1,r=this._getStyleByZoom();if(r&&this.setStyle&&this.setStyle(r),r||(t=!0),r&&void 0===r.overrideStyle&&(t=!1),r&&void 0!==r.overrideStyle&&!1===r.overrideStyle&&(t=!0),r&&void 0!==r.overrideStyle&&!0===r.overrideStyle&&(t=!1),t)for(var o in this._layers){var s=this._layers[o];if(s.setStyle){var i=this._getStyleByLayerProperties(s);i&&s.setStyle(i)}s instanceof L.Marker&&this._updateMarkerStyle(s,r)}},_updateMarkerStyle:function(e,t){t&&(e instanceof L.Marker&&e.options.icon&&(e.options.icon.options.html=t.markerDivInnerHtml,e.options.icon.options.className=t.markerDivClassName),e.setDivStyle&&e.setDivStyle(t.markerDivStyle))},_getStyleByZoom:function(){if(this._map&&this.styles&&0<this.styles.length){for(var e=this._map.getZoom(),t=!0,r=0;r<this.styles.length;r++){var o=this.styles[r];if(e<=o.maxZoom&&e>=o.minZoom)return o;this.styles[r].minZoom&&this.styles[r].maxZoom&&(t=!1)}if(t)return this.styles[0]}},_getStyleByLayerProperties:function(e){var t=null;if(e&&e.feature&&e.feature.properties&&e.feature.properties.style)if("string"==typeof e.feature.properties.style)try{t=JSON.parse(e.feature.properties.style)}catch(e){return null}else t=e.feature.properties.style;return t},_labelLayer:function(){if(this._removeLabels(),this._map&&this.options.labelEnabled){var e=this._getLabelLayerOptionsByZoom();if(e&&0<e.length){var t=e[0];this.labelOverlay||(this.labelOverlay=new L.LabelOverlay(this,t,!1)),L.Util.setOptions(this.labelOverlay,e[0]),this.labelOverlay._resetLabels()}else this._removeLabels()}else this._removeLabels()},_removeLabels:function(){if(this.labelOverlay){var e=this._leaflet_id;this.labelOverlay._removeLabels(e),delete this.labelOverlay}},_getLabelLayerOptionsByZoom:function(){var e=[];if(this.labels&&0<this.labels.length&&this._map)for(var t=this._map.getZoom(),r=0;r<this.labels.length;r++){var o=this.labels[r];t<=o.maxZoom&&t>=o.minZoom&&e.push(o)}return e}}),MapExpress.Layers.geoJSONServiceLayer=function(e,t){return new MapExpress.Layers.GeoJSONServiceLayer(e,t)},MapExpress.Layers.ImageOverlayLayer=L.ImageOverlay.extend({initialize:function(e,t){if(this._dataPovider=e,L.setOptions(this,t),void 0!==this._dataPovider&&this._dataPovider instanceof MapExpress.Service.SingleImageProvider){var r=this._dataPovider.getDataUrl(),o=this._dataPovider.getImageBounds();L.ImageOverlay.prototype.initialize.call(this,r,o,this.options)}},onAdd:function(){void 0===this._dataPovider||this._dataPovider instanceof MapExpress.Service.SingleImageProvider||(this._bounds=this._map.getBounds(),this._url="",this._map.on("moveend",this._reset,this)),L.ImageOverlay.prototype.onAdd.call(this)},onRemove:function(){L.ImageOverlay.prototype.onRemove.call(this),this._map.off("moveend",this._reset,this)},_reset:function(){void 0===this._dataPovider||this._dataPovider instanceof MapExpress.Service.SingleImageProvider||(this._updateData(),L.ImageOverlay.prototype._reset.call(this))},_updateData:function(){if(this.setUrl(""),this._map){var e=this._map.getZoom();if(e>this.options.maxZoom||e<this.options.minZoom)this.fire("mapexspress:layer:data:clear",this);else{this._bounds=this._map.getBounds();var t=this._dataPovider.getDataUrlByBounds(this._bounds,this._map.getSize());this.setUrl(t),this.fire("mapexspress:layer:data:added",t)}}}}),MapExpress.Layers.imageOverlayLayer=function(e,t){return new MapExpress.Layers.ImageOverlayLayer(e,t)},L.LabelOverlay=L.Class.extend({options:{minZoom:5,maxZoom:23,fieldToLabel:"layer.feature.properties.id",textAnchor:"middle",fontSize:"11px",textColor:"#800000",fontFamily:"Arial, Roboto",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",opacity:1,dy:0,dx:0,markerLabelPlace:"right",halo:!0,haloWidth:"2px",haloColor:"white",haloOpacity:.8,typeOfLabel:"pointedAlong",repeat:!0,repeatOffset:300,simpleAlongPointPosition:"50%",rectangle:!1,ellipse:!1,circle:!1,autorecWidthHeight:!0,recWidth:5,recHeight:0,recFill:"#ccc",recFillOpacity:.2,recStroke:"#666",recStrokeWidth:"1px",recStrokeOpacity:.7,labelTemplate:!1},initialize:function(e,t,r){this.labelingLayer=e,L.Util.setOptions(this,t),this.options.maxZoom||(this.options.maxZoom=this.labelingLayer.options.maxZoom),this.options.minZoom||(this.options.minZoom=this.labelingLayer.options.minZoom),void 0!==r&&!0===r&&this.labelingLayer.on("add",this._onParentLayerAddToMap,this),this.labelingLayer.on("remove",this._onParentLayerRemoveFromMap,this),this.options.repeat=!1,this._correctOptions()},_correctOptions:function(){null===this.options.repeatOffset&&(this.options.repeatOffset=500),this.options.repeatOffset<0&&this.options.repeatOffset,this.options.repeatOffset<20&&console.log("Возможно, выставлено слишком маленькое значение и сильно нагружает систему, т.к. значенеия выставлены в пикселах"),null===this.options.simpleAlongPointPosition&&(this.options.simpleAlongPointPosition="50%")},_onParentLayerAddToMap:function(){this.labelingLayer._mapToAdd&&this.labelingLayer._mapToAdd.on("moveend",this._resetLabels,this),this._resetLabels()},_onParentLayerRemoveFromMap:function(){this.labelingLayer._mapToAdd&&this.labelingLayer._mapToAdd.off("moveend",this._resetLabels,this),this._removeLabels()},_resetLabels:function(){var r=this.labelingLayer._leaflet_id;this._removeLabels(r);var e=this.labelingLayer._map.getZoom();e<this.options.minZoom||e>this.options.maxZoom||this.labelingLayer.eachLayer(function(e){if("Point"===e.feature.geometry.type)this._PointLabel(e,r);else if("LineString"===e.feature.geometry.type)this._LineLabel(e,r);else if("Polygon"===e.feature.geometry.type)this._PolygonLabel(e,r);else if("MultiPoint"===e.feature.geometry.type){var t=e.feature;e.eachLayer(function(e){e.feature=t,this._PointLabel(e,r)},this)}else"MultiLineString"===e.feature.geometry.type?this._LineLabel(e,r):"MultiPolygon"===e.feature.geometry.type?this._PolygonLabel(e,r):alert("Некорректные входящие данные!")},this)},_LineLabel:function(layer,nameForGroups){this._correctOptions();var options=this.options;layer._path.id="layer"+layer._leaflet_id;var group=d3.select("svg").append("g").attr("class","Labels"+nameForGroups).append("g").attr("class","lineLabels"),that=this;options.startLineOffset=-4,d3.selectAll("#layer"+layer._leaflet_id).each(function(d,i){var textEval=function(){if(that.options.labelTemplate)string="function"==typeof that.options.labelTemplate?that.options.labelTemplate(options.fieldToLabel):L.Util.template(that.options.labelTemplate,{label:string});else{var string=eval(options.fieldToLabel);void 0!==string&&"undefined"!==string||(string="")}return string};if("simpleAlong"===options.typeOfLabel){!0===options.halo&&that.haloPrototype.call(this,group,options).append("textPath").attr("xlink:href","#layer"+layer._leaflet_id).attr("startOffset",options.simpleAlongPointPosition).text(textEval);var text=that.textPrototype.call(this,group,options).append("textPath").attr("xlink:href","#layer"+layer._leaflet_id).attr("startOffset",options.simpleAlongPointPosition).text(textEval)}else if(!0===options.repeat){if("pointedAlong"===options.typeOfLabel){var lineLengthPointedAlong=d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getTotalLength(),start,end;switch(!0){case lineLengthPointedAlong<20:return;case lineLengthPointedAlong<50&&20<=lineLengthPointedAlong:start=10,end=10;break;case lineLengthPointedAlong<100&&50<=lineLengthPointedAlong:start=20,end=20;break;case 100<=lineLengthPointedAlong:start=30,end=30}for(var i=start;i<lineLengthPointedAlong-end;i+=options.repeatOffset){var all=layer._parts,arrayOfPointOfParts=[];all.forEach(function(e,t,r){e.forEach(function(e,t,r){arrayOfPointOfParts.push(e)})});var ax=arrayOfPointOfParts[d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPathSegAtLength(i)].x,ay=arrayOfPointOfParts[d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPathSegAtLength(i)].y,bx=arrayOfPointOfParts[d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPathSegAtLength(i)-1].x,by=arrayOfPointOfParts[d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPathSegAtLength(i)-1].y,BC=ax-bx,AC=ay-by,angle;if(angle=ax<bx&&by<ay?270-180*Math.atan(BC/AC)/Math.PI:ax<bx&&ay<by?90-180*Math.atan(BC/AC)/Math.PI:bx<ax&&ay<by?270-180*Math.atan(BC/AC)/Math.PI:bx<ax&&by<ay?90-180*Math.atan(BC/AC)/Math.PI:0,!0===options.circle)var circle=group.append("circle");if(!0===options.ellipse)var ellipse=group.append("ellipse");if(!0===options.rectangle)var rectangle=group.append("rect");!0===options.halo&&that.haloPrototype.call(this,group,options).attr("x",d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).x).attr("y",d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).y).attr("transform","rotate("+angle+", "+d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).x+", "+d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).y+")").text(textEval);var text=that.textPrototype.call(this,group,options).attr("x",d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).x).attr("y",d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).y).attr("transform","rotate("+angle+", "+d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).x+", "+d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).y+")").text(textEval),bbox=text.node().getBBox(),centerX=d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).x,centerY=d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).y,rectangleWidth,rectangleHeight,circleRad,ellipceWidth,ellipceHeight;if(!0===options.rectangle)!0===options.autorecWidthHeight?(rectangleWidth=bbox.width,rectangleHeight=bbox.height):(rectangleWidth=0,rectangleHeight=0),that.rectangleProtype.call(this,rectangle,options).attr("x",bbox.x-2).attr("y",bbox.y).attr("width",rectangleWidth+options.recWidth).attr("height",rectangleHeight+options.recHeight).attr("transform","rotate("+angle+", "+centerX+", "+centerY+")");if(!0===options.circle)circleRad=!0===options.autorecWidthHeight?bbox.width:0,that.circlePrototype.call(this,circle,options).attr("cx",bbox.x+bbox.width/2).attr("cy",bbox.y+bbox.height/2).attr("r",circleRad/2+options.recWidth).attr("transform","rotate("+angle+", "+centerX+", "+centerY+")");if(!0===options.ellipse)!0===options.autorecWidthHeight?(ellipceWidth=bbox.width,ellipceHeight=bbox.height):(ellipceWidth=0,ellipceHeight=0),that.ellipsePrototype.call(this,ellipse,options).attr("cx",bbox.x+bbox.width/2).attr("cy",bbox.y+bbox.height/2).attr("rx",ellipceWidth+options.recWidth).attr("ry",ellipceHeight+options.recHeight).attr("transform","rotate("+angle+", "+centerX+", "+centerY+")")}}else if("pointedAlongGorisontal"===options.typeOfLabel){var lineLengthPointedAlongGorisontal=d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getTotalLength(),start,end;switch(!0){case lineLengthPointedAlongGorisontal<25:return;case lineLengthPointedAlongGorisontal<50&&20<=lineLengthPointedAlongGorisontal:start=10,end=10;break;case lineLengthPointedAlongGorisontal<100&&50<=lineLengthPointedAlongGorisontal:start=20,end=20;break;case 100<=lineLengthPointedAlongGorisontal:start=30,end=30}for(var i=start;i<lineLengthPointedAlongGorisontal-end;i+=options.repeatOffset){if(!0===options.circle)var circle=group.append("circle");if(!0===options.ellipse)var ellipse=group.append("ellipse");if(!0===options.rectangle)var rectangle=group.append("rect");!0===options.halo&&that.haloPrototype.call(this,group,options).attr("x",d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).x).attr("y",d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).y).text(textEval);var text=that.textPrototype.call(this,group,options).attr("x",d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).x).attr("y",d3.selectAll("#layer"+layer._leaflet_id)._groups[0][0].getPointAtLength(i).y).text(textEval),bbox=text.node().getBBox(),rectangleWidth,rectangleHeight,circleRad,ellipceWidth,ellipceHeight;if(!0===options.rectangle)!0===options.autorecWidthHeight?(rectangleWidth=bbox.width,rectangleHeight=bbox.height):(rectangleWidth=0,rectangleHeight=0),that.rectangleProtype.call(this,rectangle,options).attr("x",bbox.x-2).attr("y",bbox.y).attr("width",rectangleWidth+options.recWidth).attr("height",rectangleHeight+options.recHeight);if(!0===options.circle)circleRad=!0===options.autorecWidthHeight?bbox.width:0,that.circlePrototype.call(this,circle,options).attr("cx",bbox.x+bbox.width/2).attr("cy",bbox.y+bbox.height/2).attr("r",circleRad/2+options.recWidth);if(!0===options.ellipse)!0===options.autorecWidthHeight?(ellipceWidth=bbox.width,ellipceHeight=bbox.height):(ellipceWidth=0,ellipceHeight=0),that.ellipsePrototype.call(this,ellipse,options).attr("cx",bbox.x+bbox.width/2).attr("cy",bbox.y+bbox.height/2).attr("rx",ellipceWidth+options.recWidth).attr("ry",ellipceHeight+options.recHeight)}}}else if(!0!==options.repeat){var allParts=layer._parts,length=0;if(1<allParts.length&&(allParts=[allParts[0]]),allParts.forEach(function(e,t,r){length+=Math.sqrt(Math.pow(e[t+1].y-e[t].y,2)+Math.pow(e[t+1].x-e[t].x,2))}),length<25)return;"pointedAlongGorisontal"===options.typeOfLabel?allParts.forEach(function(e,t,r){if(2<e.length){var o=Math.floor(e.length/2),s=(e[o].x+e[o+1].x)/2,i=(e[o].y+e[o+1].y)/2;if(!0===options.circle)var a=group.append("circle");if(!0===options.ellipse)var n=group.append("ellipse");if(!0===options.rectangle)var l=group.append("rect");!0===options.halo&&that.haloPrototype.call(this,group,options).attr("x",s).attr("y",i).text(textEval);var p=that.textPrototype.call(this,group,options).attr("x",s).attr("y",i).text(textEval).node().getBBox();d()}else{s=(e[0].x+e[1].x)/2,i=(e[0].y+e[1].y)/2;if(!0===options.circle)a=group.append("circle");if(!0===options.ellipse)n=group.append("ellipse");if(!0===options.rectangle)l=group.append("rect");!0===options.halo&&that.haloPrototype.call(this,group,options).attr("x",s).attr("y",i).text(textEval);p=that.textPrototype.call(this,group,options).attr("x",s).attr("y",i).attr("fill-opacity",options.opacity).text(textEval).node().getBBox();d()}function d(){var e,t,r,o,s;!0===options.rectangle&&(!0===options.autorecWidthHeight?(e=p.width,t=p.height):t=e=0,that.rectangleProtype.call(this,l,options).attr("x",p.x-2).attr("y",p.y).attr("width",e+options.recWidth).attr("height",t+options.recHeight));!0===options.circle&&(r=!0===options.autorecWidthHeight?p.width:0,that.circlePrototype.call(this,a,options).attr("cx",p.x+p.width/2).attr("cy",p.y+p.height/2).attr("r",r/2+options.recWidth));!0===options.ellipse&&(!0===options.autorecWidthHeight?(o=p.width,s=p.height):s=o=0,that.ellipsePrototype.call(this,n,options).attr("cx",p.x+p.width/2).attr("cy",p.y+p.height/2).attr("rx",o+options.recWidth).attr("ry",s+options.recHeight))}}):"pointedAlong"===options.typeOfLabel&&allParts.forEach(function(e,t,r){if(2<e.length){var o=Math.floor(e.length/2),i=(e[o].x+e[o+1].x)/2,a=(e[o].y+e[o+1].y)/2,s=e[o].x-e[o+1].x,n=e[o].y-e[o+1].y;if(h=e[o].x<e[o+1].x&&e[o].y>e[o+1].y?270-180*Math.atan(s/n)/Math.PI:e[o].x<e[o+1].x&&e[o].y<e[o+1].y?90-180*Math.atan(s/n)/Math.PI:e[o].x>e[o+1].x&&e[o].y<e[o+1].y?270-180*Math.atan(s/n)/Math.PI:e[o].x>e[o+1].x&&e[o].y>e[o+1].y?90-180*Math.atan(s/n)/Math.PI:0,!0===options.circle)var l=group.append("circle");if(!0===options.ellipse)var p=group.append("ellipse");if(!0===options.rectangle)var d=group.append("rect");!0===options.halo&&that.haloPrototype.call(this,group,options).attr("x",i).attr("y",a).attr("transform","rotate("+h+", "+i+", "+a+")").text(textEval);var c=that.textPrototype.call(this,group,options).attr("x",i).attr("y",a).attr("transform","rotate("+h+", "+i+", "+a+")").text(textEval).node().getBBox();u()}else{var h;i=(e[0].x+e[1].x)/2,a=(e[0].y+e[1].y)/2,s=e[0].x-e[1].x,n=e[0].y-e[1].y;if(h=e[0].x<e[1].x&&e[0].y>e[1].y?270-180*Math.atan(s/n)/Math.PI:e[0].x<e[1].x&&e[0].y<e[1].y?90-180*Math.atan(s/n)/Math.PI:e[0].x>e[1].x&&e[0].y<e[1].y?270-180*Math.atan(s/n)/Math.PI:e[0].x>e[1].x&&e[0].y>e[1].y?90-180*Math.atan(s/n)/Math.PI:0,!0===options.circle)l=group.append("circle");if(!0===options.ellipse)p=group.append("ellipse");if(!0===options.rectangle)d=group.append("rect");!0===options.halo&&that.haloPrototype.call(this,group,options).attr("x",i).attr("y",a).attr("transform","rotate("+h+", "+i+", "+a+")").text(textEval);c=that.textPrototype.call(this,group,options).attr("x",i).attr("y",a).attr("transform","rotate("+h+", "+i+", "+a+")").text(textEval).node().getBBox();u()}function u(){var e,t,r,o,s;!0===options.rectangle&&(!0===options.autorecWidthHeight?(e=c.width,t=c.height):t=e=0,that.rectangleProtype.call(this,d,options).attr("x",c.x-3).attr("y",c.y).attr("width",e+options.recWidth).attr("height",t+options.recHeight).attr("transform","rotate("+h+", "+i+", "+a+")"));!0===options.circle&&(r=!0===options.autorecWidthHeight?c.width:0,that.circlePrototype.call(this,l,options).attr("cx",c.x+c.width/2).attr("cy",c.y+c.height/2).attr("r",r/2+options.recWidth).attr("transform","rotate("+h+", "+i+", "+a+")"));!0===options.ellipse&&(!0===options.autorecWidthHeight?(o=c.width,s=c.height):s=o=0,that.ellipsePrototype.call(this,p,options).attr("cx",c.x+c.width/2).attr("cy",c.y+c.height/2).attr("rx",o+options.recWidth).attr("ry",s+options.recHeight).attr("transform","rotate("+h+", "+i+", "+a+")"))}})}})},_PolygonLabel:function(layer,nameForGroups){var options=this.options;layer._path.id="layer"+layer._leaflet_id;var group=d3.select("svg").append("g").attr("class","Labels"+nameForGroups).append("g").attr("class","polygonLabels"),that=this;d3.selectAll("#layer"+layer._leaflet_id).each(function(d,i){var textEval=function(){if(that.options.labelTemplate)string="function"==typeof that.options.labelTemplate?that.options.labelTemplate(options.fieldToLabel):L.Util.template(that.options.labelTemplate,{label:string});else{var string=eval(options.fieldToLabel);void 0!==string&&"undefined"!==string||(string="")}return string},bounds=this.getBBox(),labelPositions;try{var coords=polylabel([layer._parts[0].map(function(e){return[e.x,e.y]})]);labelPositions={x:coords[0],y:coords[1]}}catch(e){labelPositions={x:bounds.x+bounds.width/2,y:bounds.y+bounds.height/2}}if(0!==labelPositions.x||0!==labelPositions.y){if(!0===options.circle)var circle=group.append("circle");if(!0===options.ellipse)var ellipse=group.append("ellipse");if(!0===options.rectangle)var rectangle=group.append("rect");!0===options.halo&&that.haloPrototype.call(this,group,options).attr("x",labelPositions.x).attr("y",labelPositions.y).text(textEval);var text=that.textPrototype.call(this,group,options).attr("x",labelPositions.x).attr("y",labelPositions.y).text(textEval),bbox=text.node().getBBox(),rectangleWidth,rectangleHeight,circleRad,ellipceWidth,ellipceHeight;if(!0===options.rectangle)!0===options.autorecWidthHeight?(rectangleWidth=bbox.width,rectangleHeight=bbox.height):(rectangleWidth=0,rectangleHeight=0),that.rectangleProtype.call(this,rectangle,options).attr("x",bbox.x).attr("y",bbox.y).attr("width",rectangleWidth+options.recWidth).attr("height",rectangleHeight+options.recHeight);if(!0===options.circle)circleRad=!0===options.autorecWidthHeight?bbox.width:0,that.circlePrototype.call(this,circle,options).attr("cx",bbox.x+bbox.width/2).attr("cy",bbox.y+bbox.height/2).attr("r",circleRad/2+options.recWidth);if(!0===options.ellipse)!0===options.autorecWidthHeight?(ellipceWidth=bbox.width,ellipceHeight=bbox.height):(ellipceWidth=0,ellipceHeight=0),that.ellipsePrototype.call(this,ellipse,options).attr("cx",bbox.x+bbox.width/2).attr("cy",bbox.y+bbox.height/2).attr("rx",ellipceWidth+options.recWidth).attr("ry",ellipceHeight+options.recHeight)}})},_PointLabel:function(layer,nameForGroups){var options=this.options,icon=!0,imageWigth,imageHeight,iconX,iconY;if(void 0!==layer._icon?layer._icon.id="marker_"+layer._leaflet_id:(layer._path.id="marker_"+layer._leaflet_id,icon=!1),null!==d3.select("svg")._groups[0][0])var group=d3.select("svg").append("g").attr("class","Labels"+nameForGroups).append("g").attr("class","pointLabels");else var polygon=L.polygon([[0,-.1],[-.1,-.02],[-.02,0]],{color:"red",opacity:0,fillColor:"#f03",fillOpacity:0}).addTo(this.labelingLayer._map),group=d3.select("svg").append("g").attr("class","Labels"+nameForGroups).append("g").attr("class","pointLabels");var that=this;d3.selectAll("#marker_"+layer._leaflet_id).each(function(){var textEval=function(){if(that.options.labelTemplate)string="function"==typeof that.options.labelTemplate?that.options.labelTemplate(options.fieldToLabel):L.Util.template(that.options.labelTemplate,{label:string});else{var string=eval(options.fieldToLabel);void 0!==string&&"undefined"!==string||(string="")}return string};if(!0===icon)iconX=layer._icon._leaflet_pos.x,iconY=layer._icon._leaflet_pos.y;else{var bounds=this.getBBox();if(iconX=bounds.x+bounds.width/2,iconY=bounds.y+bounds.height/2,0===iconX&&0===iconY)return}if(!0===options.circle)var circle=group.append("circle");if(!0===options.ellipse)var ellipse=group.append("ellipse");if(!0===options.rectangle)var rectangle=group.append("rect");!0===icon?(imageWigth=parseInt(this.style.width,10),imageHeight=parseInt(this.style.height,10)):imageWigth=imageHeight=layer._radius;var labelPositions={};if(!0===options.halo)var halo=that.haloPrototype.call(this,group,options).text(textEval);var text=that.textPrototype.call(this,group,options).text(textEval),bbox=text.node().getBBox();if("top"===options.markerLabelPlace?(labelPositions.x=iconX,labelPositions.y=iconY-imageHeight/2):"bottom"===options.markerLabelPlace?(labelPositions.x=iconX,labelPositions.y=iconY+imageHeight/2+bbox.height):"left"===options.markerLabelPlace?(labelPositions.x=iconX-bbox.width/2-3-imageWigth/2,labelPositions.y=iconY+bbox.height/4):"right"===options.markerLabelPlace&&(labelPositions.x=iconX+bbox.width/2+3+imageWigth/2,labelPositions.y=iconY+bbox.height/4),0!==labelPositions.x||0!==labelPositions.y){!0===options.halo&&halo.attr("x",labelPositions.x).attr("y",labelPositions.y),text.attr("x",labelPositions.x).attr("y",labelPositions.y);var newBbox=text.node().getBBox(),rectangleWidth,rectangleHeight,circleRad,ellipceWidth,ellipceHeight;if(!0===options.rectangle)!0===options.autorecWidthHeight?(rectangleWidth=newBbox.width,rectangleHeight=newBbox.height):(rectangleWidth=0,rectangleHeight=0),that.rectangleProtype.call(this,rectangle,options).attr("x",newBbox.x).attr("y",newBbox.y).attr("width",rectangleWidth+options.recWidth).attr("height",rectangleHeight+options.recHeight);if(!0===options.circle)circleRad=!0===options.autorecWidthHeight?newBbox.width:0,that.circlePrototype.call(this,circle,options).attr("cx",newBbox.x+newBbox.width/2).attr("cy",newBbox.y+newBbox.height/2).attr("r",circleRad/2+options.recWidth);if(!0===options.ellipse)!0===options.autorecWidthHeight?(ellipceWidth=newBbox.width,ellipceHeight=newBbox.height):(ellipceWidth=0,ellipceHeight=0),that.ellipsePrototype.call(this,ellipse,options).attr("cx",newBbox.x+newBbox.width/2).attr("cy",newBbox.y+newBbox.height/2).attr("rx",ellipceWidth+options.recWidth).attr("ry",ellipceHeight+options.recHeight)}})},haloPrototype:function(e,t){var r;return r=t.startLineOffset&&void 0!==t.startLineOffset?t.startLineOffset:0,e.append("text").attr("class","halo").attr("dx",t.dx).attr("dy",t.dy+r).style("stroke",t.haloColor).style("opacity",t.haloOpacity).style("stroke-width",t.haloWidth).style("text-anchor",t.textAnchor).style("font-size",t.fontSize).style("font-weight",t.fontWeight).style("font-style",t.fontStyle).style("text-decoration",t.textDecoration).style("font-family",t.fontFamily)},textPrototype:function(e,t){var r;return r=t.startLineOffset&&void 0!==t.startLineOffset?t.startLineOffset:0,e.append("text").attr("class","textpath").attr("dx",t.dx).attr("dy",t.dy+r).style("fill-opacity",t.opacity).style("text-anchor",t.textAnchor).style("font-size",t.fontSize).style("font-weight",t.fontWeight).style("font-style",t.fontStyle).style("text-decoration",t.textDecoration).style("fill",t.textColor).style("font-family",t.fontFamily)},circlePrototype:function(e,t){return e.style("fill",t.recFill).style("fill-opacity",t.recFillOpacity).style("stroke",t.recStroke).style("stroke-width",t.recStrokeWidth).style("stroke-opacity",t.recStrokeOpacity),e},ellipsePrototype:function(e,t){return e.style("fill",t.recFill).style("fill-opacity",t.recFillOpacity).style("stroke",t.recStroke).style("stroke-width",t.recStrokeWidth).style("stroke-opacity",t.recStrokeOpacity),e},rectangleProtype:function(e,t){return e.style("fill",t.recFill).style("fill-opacity",t.recFillOpacity).style("stroke",t.recStroke).style("stroke-width",t.recStrokeWidth).style("stroke-opacity",t.recStrokeOpacity),e},_removeLabels:function(e){var t=$(".Labels"+e);t&&t.remove()}}),TinyQueue.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,r=this.compare,o=t[e];0<e;){var s=e-1>>1,i=t[s];if(0<=r(o,i))break;t[e]=i,e=s}t[e]=o},_down:function(e){for(var t=this.data,r=this.compare,o=this.length>>1,s=t[e];e<o;){var i=1+(e<<1),a=i+1,n=t[i];if(a<this.length&&r(t[a],n)<0&&(n=t[i=a]),0<=r(n,s))break;t[e]=n,e=i}t[e]=s}};var Queue=TinyQueue;function polylabel(e,t,r){var o,s,i,a;t=t||1;for(var n=0;n<e[0].length;n++){var l=e[0][n];(!n||l[0]<o)&&(o=l[0]),(!n||l[1]<s)&&(s=l[1]),(!n||l[0]>i)&&(i=l[0]),(!n||l[1]>a)&&(a=l[1])}var p=i-o,d=a-s,c=Math.min(p,d),h=c/2,u=new Queue(null,compareMax);if(0===c)return[o,s];for(var m=o;m<i;m+=c)for(var g=s;g<a;g+=c)u.push(new Cell(m+h,g+h,h,e));var _=getCentroidCell(e),f=new Cell(o+p/2,s+d/2,0,e);f.d>_.d&&(_=f);for(var y=u.length;u.length;){var x=u.pop();x.d>_.d&&(_=x,r&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,y)),x.max-_.d<=t||(h=x.h/2,u.push(new Cell(x.x-h,x.y-h,h,e)),u.push(new Cell(x.x+h,x.y-h,h,e)),u.push(new Cell(x.x-h,x.y+h,h,e)),u.push(new Cell(x.x+h,x.y+h,h,e)),y+=4)}return r&&(console.log("num probes: "+y),console.log("best distance: "+_.d)),[_.x,_.y]}function compareMax(e,t){return t.max-e.max}function Cell(e,t,r,o){this.x=e,this.y=t,this.h=r,this.d=pointToPolygonDist(e,t,o),this.max=this.d+this.h*Math.SQRT2}function pointToPolygonDist(e,t,r){for(var o=!1,s=1/0,i=0;i<r.length;i++)for(var a=r[i],n=0,l=a.length,p=l-1;n<l;p=n++){var d=a[n],c=a[p];d[1]>t!=c[1]>t&&e<(c[0]-d[0])*(t-d[1])/(c[1]-d[1])+d[0]&&(o=!o),s=Math.min(s,getSegDistSq(e,t,d,c))}return(o?1:-1)*Math.sqrt(s)}function getCentroidCell(e){for(var t=0,r=0,o=0,s=e[0],i=0,a=s.length,n=a-1;i<a;n=i++){var l=s[i],p=s[n],d=l[0]*p[1]-p[0]*l[1];r+=(l[0]+p[0])*d,o+=(l[1]+p[1])*d,t+=3*d}return 0===t?new Cell(s[0][0],s[0][1],0,e):new Cell(r/t,o/t,0,e)}function getSegDistSq(e,t,r,o){var s=r[0],i=r[1],a=o[0]-s,n=o[1]-i;if(0!==a||0!==n){var l=((e-s)*a+(t-i)*n)/(a*a+n*n);1<l?(s=o[0],i=o[1]):0<l&&(s+=a*l,i+=n*l)}return(a=e-s)*a+(n=t-i)*n}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}MapExpress.Layers.TileServiceLayer=L.TileLayer.extend({initialize:function(e,t){L.TileLayer.prototype.initialize.call(this,null,t),t.pane="tilePane",t.minNativeZoom=void 0,t.maxNativeZoom=void 0,t.zoomOffset=0,t.updateWhenIdle=L.Browser.mobile,t.updateWhenZooming=!0,t.updateInterval=200,t.keepBuffer=2,L.setOptions(this,t),this._dataPovider=e,this._dataPovider.options.tileSize=this.options.tileSize},createTile:function(e,t){var r=document.createElement("img");return L.DomEvent.on(r,"load",L.bind(this._tileOnLoad,this,t,r)),L.DomEvent.on(r,"error",L.bind(this._tileOnError,this,t,r)),this.options.crossOrigin&&(r.crossOrigin=""),r.alt="",r.setAttribute("role","presentation"),r.src=this._dataPovider.getDataUrlByTile(e),r}}),MapExpress.Layers.tileServiceLayer=function(e,t){return new MapExpress.Layers.TileServiceLayer(e,t)},MapExpress.Mapping.LayerModel=L.Evented.extend({initialize:function(e,t){this.id=e,this._layers=[],L.setOptions(this,t),null!==this.id&&"undefined"!==this.id||(this.id=L.Util.stamp(this).toString())},addLayer:function(e){this._layers.push(e)},removeLayerById:function(t){if(this.getLayerById(t)){var e=this._findIndex(this._layers,function(e){return e.id===t});this._layers.splice(e,1)}},getLayerById:function(e){var t,r=this.getAllLayers();if(r){var o=(t=e,r.filter(function(e){return e.id===t}));return 0<o.length?o[0]:null}},getAllLayers:function(){return this._layers},hasChildren:function(){return this._layers&&0<this._layers.length},_arraymove:function(e,t,r){var o=e[t];e.splice(t,1),e.splice(r,0,o)},layerModelToJSON:function(){var e={};if(e.id=this.id,e.options=this.options,e.layers=[],0<this._layers.length){e.layerClass=null,e.dataProviderClass=null;for(var t=0;t<this._layers.length;t++)e.layers.push(this._layers[t].layerModelToJSON())}else e.dataProviderClass={},e.dataProviderClass.constructor=this.getProviderClassName(this),e.dataProviderClass.args=this.mapLayer._dataPovider._dataUrl,e.dataProviderClass.options=this.mapLayer._dataPovider.options,e.layerClass={},e.layerClass.constructor=this.getLayerClassName(this),e.layerClass.options=this.mapLayer.options,e.layerClass.styles=this.mapLayer.styles,e.layerClass.labels=this.mapLayer.labels;return e},getProviderClassName:function(e){var t=null,r=MapExpress.Service;if(void 0===e.mapLayer)return t;e.mapLayer._dataPovider;var o=[];for(var s in r)e.mapLayer._dataPovider instanceof r[s]&&o.push({a:s,p:r[s]});var i=o.sort(function(e,t){return e.p instanceof t.p?-1:t.p instanceof e.p?1:0});return 0<i.length&&(t="MapExpress.Service."+i[i.length-1].a),t},getLayerClassName:function(e){var t=MapExpress.Layers,r=null;if(void 0===e.mapLayer)return r;e.mapLayer;for(var o in t)e.mapLayer instanceof t[o]&&(r="MapExpress.Layers."+o);return r},_findIndex:function(e,t){var r;for(r in e)if(t(e[r]))return parseInt(r);return-1}}),MapExpress.Mapping.MapInitializerHelper={initializeFromURL:function(e,t,r,o){this._initialize(MapExpress.Mapping.MapWorkspaseLoader.getMapWorkspaceFromURLAsync(t),e,r,o)},initializeFromFile:function(e,t,r,o){this._initialize(MapExpress.Mapping.MapWorkspaseLoader.getMapWorkspaceFromFileAsync(t),e,r,o)},_initialize:function(e,t,r,o){var s=L.map(t,{zoomControl:!1,editable:!0,attributionControl:!1});window.MapManager=new MapExpress.Mapping.MapManager(s),e.then(function(e){window.MapManager.renderMap(e),r&&"function"==typeof r&&r(s)},function(e){o&&"function"==typeof o?o(e):new MapExpress.Controls.MapControl(window.MapManager._map).showErrorWindow("Не удалось загрузить рабочий набор карты")})}},MapExpress.Mapping.MapManager=L.Evented.extend({initialize:function(e,t,r){this._map=e,L.setOptions(this,r),this._mapModelBuilder=t||new MapExpress.Mapping.MapModelBuilder(e,r),this.selections=[]},usedGeoServer:function(){return-1<window.MapManager.getMapModel().options.description.indexOf("GeoServer")},renderMap:function(e){this._mapModel=this._mapModelBuilder.createMapModel(e),L.setOptions(this._map,this._mapModel.options),this._map.setView(this._mapModel.options.center,this._mapModel.options.zoom);var t=this._mapModel.getBaseLayers();this._mapModel.sortLayersByVisibleIndex(t),this._mapModel._reorderLayersVisibleIndex(t);for(var r=t.length-1;0<=r;r--){var o=t[r];if(o.mapLayer.options.visible){o.mapLayer.addTo(this._map);break}}var s=this._mapModel.getOverlayLayers();this._mapModel.sortLayersByVisibleIndex(s),this._mapModel._reorderLayersVisibleIndex(s),this._mapModel.sortLayersByVisibleIndex(s);for(var i=s.length-1;0<=i;i--){var a=s[i];a.mapLayer&&a.mapLayer.options.visible&&(a.mapLayer.on("mapexspress:layer:data:added",this._reorderOverlays,this),a.mapLayer.addTo(this._map))}return this._map},setActiveBaseMap:function(e){var t=this._mapModel.getLayerById(e);if(t&&t.mapLayer){for(var r=this._mapModel.getBaseLayers(),o=r.length-1;0<=o;o--){var s=r[o];s.mapLayer&&(s.mapLayer.options.visible=!1,this._map.removeLayer(s.mapLayer))}t.mapLayer.options.visible=!0,t.mapLayer.addTo(this._map),t.mapLayer.bringToBack()}},getActiveBaseMap:function(){for(var e,t=window.MapManager.getMapModel().getBaseLayers(),r=0;r<t.length;r++)t[r].mapLayer&&!0===t[r].mapLayer.options.visible&&(e=t[r]);return e},removeLayerById:function(e){var t=this._mapModel.getLayerById(e);t&&t.mapLayer&&(t.mapLayer.off("mapexspress:layer:data:added",this._reorderOverlays,this),this._map.removeLayer(t.mapLayer)),this._mapModel.removeLayerById(e)},setLayerVisible:function(e,t){var r=this._mapModel.getLayerById(e);if(r&&r.mapLayer&&(t?(r.mapLayer.on("mapexspress:layer:data:added",this._reorderOverlays,this),this._map.addLayer(r.mapLayer)):(r.mapLayer.off("mapexspress:layer:data:added",this._reorderOverlays,this),this._map.removeLayer(r.mapLayer)),r.mapLayer.options.visible=t,r.fire("mapexspress:layermodel:visiblechanged",r)),r&&r.hasChildren())for(var o=r._layers.length-1;0<=o;o--){var s=r._layers[o];this.setLayerVisible(s.id,t)}var i={};i.layerId=e,i.layerModel=r,i.visible=t,this.fire("mapexspress:mapmanager:layer:visiblechanged",i)},toogleLayerVisible:function(e){var t=this._mapModel.getLayerById(e);if(t&&t.mapLayer&&("base"===t.options.type?this.setActiveBaseMap(e):this.setLayerVisible(e,!t.mapLayer.options.visible)),t&&t.hasChildren())for(var r=t._layers.length-1;0<=r;r--){var o=t._layers[r];this.toogleLayerVisible(o.id)}},moveOverlay:function(e,t){var r=this._mapModel.getLayerById(e);r&&r.mapLayer&&(this._mapModel.setLayerVisibleIndex(e,t),this._reorderOverlays())},toogleLabelLayer:function(e){if(this.layerLabelingEnabledInZoom(e)){var t=this._mapModel.getLayerById(e);t.mapLayer&&(t.mapLayer.options.labelEnabled=!t.mapLayer.options.labelEnabled,t.mapLayer._labelLayer())}},refreshMap:function(){var e=this._map.getCenter();this._map.setView(L.latLng([e.lat+1e-5,e.lng+1e-5]),this._map.getZoom())},layerEnabled:function(e){var t=this._mapModel.getLayerById(e);return!!(t&&t.mapLayer&&t.mapLayer.options&&t.mapLayer.options.visible&&this.layerVisibleEnableInZoom(e))},layerVisibleEnableInZoom:function(e){var t=this._mapModel.getLayerById(e);if(t&&t.mapLayer&&t.mapLayer.options){var r=this._map.getZoom();if(r<=t.mapLayer.options.maxZoom&&r>=t.mapLayer.options.minZoom)return!0}return!1},layerLabelingEnabledInZoom:function(e){var t=this._mapModel.getLayerById(e);if(t&&t.mapLayer&&t.mapLayer.options&&t.mapLayer instanceof MapExpress.Layers.GeoJSONServiceLayer){var r=t.mapLayer._getLabelLayerOptionsByZoom();return r&&0<r.length}return!1},_reorderOverlays:function(){var e=this._mapModel.getOverlayLayers();this._mapModel.sortLayersByVisibleIndex(e),this._mapModel._reorderLayersVisibleIndex(e),this._mapModel.sortLayersByVisibleIndex(e);for(var t=e.length-1;0<=t;t--){var r=e[t];if(r&&r.mapLayer&&r.mapLayer._map)try{r.mapLayer.bringToFront()}catch(e){}}this.fire("mapexspress:mapmanager:layer:overlaysreordered",this)},getMapModel:function(){return this._mapModel},getSelection:function(t,e){var r=this._findIndex(this.selections,function(e){return e._layerId===t});if(-1<r)return this.selections[r];var o=new MapExpress.Mapping.Selection(t,e);return this.selections.push(o),o},__getSelection:function(t){var e=this._findIndex(this.selections,function(e){return e._layerId===t});return-1<e&&this.selections[e]},clearSelections:function(){if(this.selections){for(var e=this.selections.length-1;0<=e;e--)this.selections[e].destroySelection();this.selections.length=0}},addPulseMarker:function(e,t,r){return this.removePulseMarker(),r||(r={iconSize:[12,12],color:"blue"}),this.pulseMarker=new MapExpress.Styles.PulseMarker(e,r),this._map.addLayer(this.pulseMarker),0<t&&window.setTimeout(this.removePulseMarker.bind(this),t),this.pulseMarker},removePulseMarker:function(){this.pulseMarker&&(this._map.removeLayer(this.pulseMarker),delete this.pulseMarker)},_findIndex:function(e,t){var r;for(r in e)if(t(e[r]))return parseInt(r);return-1},mapModelToJSON:function(){return JSON.stringify(this.getMapModel().mapModelToJSON())},rememberMapStateInLocalStorageBeforeLeave:function(){if(window.localStorage){var o=this;window.addEventListener("beforeunload",function(e){return function(){window.localStorage.setItem("MAPEXPRESS_MAP_STATE_ZOOM",o._map.getZoom()),window.localStorage.setItem("MAPEXPRESS_MAP_STATE_COORDINATES_LAT",o._map.getCenter().lat),window.localStorage.setItem("MAPEXPRESS_MAP_STATE_COORDINATES_LNG",o._map.getCenter().lng),window.localStorage.setItem("MAPEXPRESS_MAP_STATE_ACTIVE_BASEMAP",window.MapManager.getActiveBaseMap().id);var e=window.MapManager.getMapModel().getVisibleLayers(),t=[];if(0<e.length)for(var r=0;r<e.length;r++)e[r].id!==window.MapManager.getActiveBaseMap().id&&t.push(e[r].id);window.localStorage.setItem("MAPEXPRESS_MAP_STATE_VISIBLE_LAYERS",t.toString())}(),null})}else console.warn('Устаревший браузер. Нет поддержки "localStorage"')},recallMapStateFromLocalStorage:function(e,t){if(window.localStorage){var r,o,s,i=window.localStorage.getItem("MAPEXPRESS_MAP_STATE_ZOOM"),a=window.localStorage.getItem("MAPEXPRESS_MAP_STATE_COORDINATES_LAT"),n=window.localStorage.getItem("MAPEXPRESS_MAP_STATE_COORDINATES_LNG");if(null!=i&&(r=Number(i)),null!=a&&null!=n&&(o=Number(a),s=Number(n)),e&&(void 0!==r&&void 0!==o&&void 0!==s?this._map.setView([o,s],r):this._map.setView([window.MapManager.getMapModel().options.center[0],window.MapManager.getMapModel().options.center[1]],window.MapManager.getMapModel().options.zoom)),t){var l=window.localStorage.getItem("MAPEXPRESS_MAP_STATE_ACTIVE_BASEMAP");null!=l&&window.MapManager.setActiveBaseMap(l);var p=window.localStorage.getItem("MAPEXPRESS_MAP_STATE_VISIBLE_LAYERS");if(null!=p)for(var d=p.split(","),c=0;c<d.length;c++)window.MapManager.setLayerVisible(d[c],!0)}}else console.warn('Устаревший браузер. Нет поддержки "localStorage"')},setFeaturePositionAndSelect:function(e,t,r,o){this.setFeaturePosition(e,t,r,o,!0,!1)},selectFeatureByQueryFromUrl:function(e,t,r,o){this.setFeaturePosition(e,t,r,o,!0,!0)},setFeaturePosition:function(e,t,r,o,s,i){window.MapManager.clearSelections(),h();try{var a;a=t&&"string"==typeof t?t+r+o:t.id+r+o;var n=new MapExpress.Service.GeoJSONProvider(e),l=new MapExpress.Layers.GeoJSONServiceLayer(n,{fillOpacity:0,opacity:0,weight:0,stroke:!1,featureMinPixelSize:!1});l.options.dynamicData=!1,l.id=a;var p=new MapExpress.Mapping.LayerModel(a);p.mapLayer=l,p.options.showOnTOC=!1,window.MapManager.getMapModel().addLayer(p),window.MapManager.setLayerVisible(a,!0),i?l.once("mapexspress:layer:data:added",function(){c();var e=new MapExpress.Mapping.Selection.SingleUseSelection(l.id);e.options.featureKeyFieldName=r,e.addSelection(l),window.MapManager.selections.push(e)}):l.once("mapexspress:geojsonlayer:singledata:added",function(){c(),window.MapManager.setLayerVisible(t.id,!0),s?t.once("mapexspress:layer:data:added",d):h()})}catch(e){h()}function d(){h();var e=new MapExpress.Mapping.Selection.SingleUseSelection(t.id);e.options.featureKeyFieldName=r,e.addSelectionByFeaturePropertyValue(r,o),window.MapManager.selections.push(e)}function c(){window.MapManager._map.fitBounds(l.getBounds()),19<window.MapManager._map.getZoom()&&window.MapManager._map.setZoom(19)}function h(){l&&(window.MapManager.getMapModel().removeLayerById(l.id),l._map&&window.MapManager._map.removeLayer(l)),l=!1}}}),MapExpress.Mapping.MapModel=MapExpress.Mapping.LayerModel.extend({initialize:function(e,t){this.id=e,this._layers=[],this._favoriteLayers=[],L.setOptions(this,t)},getAllLayers:function(){var e=[];return this._fillAllLayers(this,e),e},getBaseLayers:function(){return this.getLayersByType("base")},getOverlayLayers:function(){return this.getLayersByType("overlay")},getLayersByType:function(e){return this.getLayersByOptionValue("type",e)},getVisibleLayers:function(){return this.getMapLayersByOptionValue("visible",!0)},getQueryableLayers:function(){return this.getMapLayersByOptionValue("queryable",!0)},getSelectableLayers:function(){return this.getMapLayersByOptionValue("selectable",!0)},getLayersByOptionValue:function(t,r){return this.getAllLayers().filter(function(e){if(e.options.hasOwnProperty(t))return e.options[t]===r})},getFirstLayerByOptionValue:function(e,t){var r=this.getLayersByOptionValue(e,t);return!!(r&&0<r.length)&&r[0]},getFavoriteLayers:function(){return this._favoriteLayers},getMapLayersByOptionValue:function(t,r){return this.getAllLayers().filter(function(e){if(e.mapLayer&&e.mapLayer.options&&e.mapLayer.options.hasOwnProperty(t))return"undefined"!==e.mapLayer.options[t]&&e.mapLayer.options[t]===r})},mapModelToJSON:function(){var e={};e.id=this.id,e.options=this.options,e.layers=[];for(var t=0;t<this._layers.length;t++)e.layers.push(this._layers[t].layerModelToJSON());return e},_fillAllLayers:function(e,t){for(var r=e._layers.length-1;0<=r;r--){var o=e._layers[r];t.push(o),o.hasChildren()&&this._fillAllLayers(o,t)}},setLayerVisibleIndex:function(t,e){var r=this.getLayerById(t);if(r){r.mapLayer.options.visibleIndex=e;var o=this.getOverlayLayers();this.sortLayersByVisibleIndex(o);var s=this._findIndex(o,function(e){return e.id===t});this._arraymove(o,s,e),this.sortLayersByVisibleIndex(o),this._reorderLayersVisibleIndex(o)}},sortLayersByVisibleIndex:function(e){e.sort(function(t,r){try{return t.mapLayer&&r.mapLayer?t.mapLayer.options.visibleIndex-r.mapLayer.options.visibleIndex:-1}catch(e){console.log(t),console.log(r)}})},_reorderLayersVisibleIndex:function(e){for(var t=e.length-1;0<=t;t--){var r=e[t];r.mapLayer&&(r.mapLayer.options.visibleIndex=t)}return e}}),MapExpress.Mapping.MapModelBuilder=L.Class.extend({initialize:function(e,t){this._map=e,L.setOptions(this,t)},createMapModel:function(e){var t=new MapExpress.Mapping.MapModel(e.id,e.options);if((this._jsonMapModel=e).layers&&0<e.layers.length)for(var r=0;r<e.layers.length;r++){var o=e.layers[r];this._processLayerModel(o,t)}return t},_processLayerModel:function(e,t){var r=new MapExpress.Mapping.LayerModel(e.id,e.options);if(r.mapLayer=this._createLayerClass(e),t.addLayer(r),e.layers&&0<e.layers.length)for(var o=0;o<e.layers.length;o++){var s=e.layers[o];this._processLayerModel(s,r)}},_createLayerClass:function(e){var t;if(e.dataProviderClass&&e.layerClass){var r=this._createProvider(e.dataProviderClass.constructor,e.dataProviderClass.args,e.dataProviderClass.options);if(r){switch(e.layerClass.args||(e.layerClass.args=[]),e.layerClass.args.splice(0,0,r),e.layerClass.constructor){case"MapExpress.Layers.GeoJSONServiceLayer":t=this._applyToConstructor(MapExpress.Layers.GeoJSONServiceLayer,e.layerClass.args,e.layerClass.options);break;case"MapExpress.Layers.ImageOverlayLayer":t=this._applyToConstructor(MapExpress.Layers.ImageOverlayLayer,e.layerClass.args,e.layerClass.options);break;case"MapExpress.Layers.TileServiceLayer":t=this._applyToConstructor(MapExpress.Layers.TileServiceLayer,e.layerClass.args,e.layerClass.options)}t&&(t.id=e.id,t.styles=e.layerClass.styles,t.labels=e.layerClass.labels)}}return t},_createProvider:function(e,t,r){var o;switch(e){case"MapExpress.Service.TileProvider":o=this._applyToConstructor(MapExpress.Service.TileProvider,t,r);break;case"MapExpress.Service.GeoJSONProvider":o=this._applyToConstructor(MapExpress.Service.GeoJSONProvider,t,r);break;case"MapExpress.Service.MapServiceAgsProvider":o=this._applyToConstructor(MapExpress.Service.MapServiceAgsProvider,t,r);break;case"MapExpress.Service.FeatureServiceAgsProvider":o=this._applyToConstructor(MapExpress.Service.FeatureServiceAgsProvider,t,r);break;case"MapExpress.Service.WmsProvider":o=this._applyToConstructor(MapExpress.Service.WmsProvider,t,r);break;case"MapExpress.Service.SingleImageProvider":o=this._applyToConstructor(MapExpress.Service.SingleImageProvider,t,r);break;case"MapExpress.Service.WFSProvider":o=this._applyToConstructor(MapExpress.Service.WFSProvider,t,r)}return o},_applyToConstructor:function(e,t,r){var o=[null].concat(t,r);return new(e.bind.apply(e,o))}}),MapExpress.Mapping.Selection=L.Class.extend({options:{featureKeyFieldName:"id",selectionStyle:{weight:3,color:"red",fillColor:"red",radius:5,fillOpacity:.4,stroke:!0,opacity:1},singleSelect:!1},initialize:function(e,t){this._layerId=e,this._selection=[],L.setOptions(this,t),this._layerModel=window.MapManager._mapModel.getLayerById(this._layerId),this._subscribeLayerEvents(!0),this._restoreSelection()},getSelections:function(){return this._selection},addSelection:function(e,t){e&&(this._layerModel.fire("mapexpress:selection:before:selected",this),t?this._layerModel.fire("mapexpress:selection:manual:before:selected",this):this._layerModel.fire("mapexpress:selection:map:before:selected",this),this.options.singleSelect&&this.clearSelection(),e.oldStyle=$.extend({},e.options),e.setStyle(this.options.selectionStyle),this.isLayerSelected(e)||(this._selection.push(e),this._layerModel.fire("mapexpress:selection:after:selected",e),t?this._layerModel.fire("mapexpress:selection:manual:after:selected",e):this._layerModel.fire("mapexpress:selection:map:after:selected",e)))},addSelectionByFeaturePropertyValue:function(e,t){var r=MapExpress.Utils.GeoJSONUtils.getLayerByPropertyValueFromLayerGroup(this._layerModel.mapLayer,e,t);r&&this.addSelection(r)},invertSelection:function(e){e&&(this.isLayerSelected(e)?this.removeSelection(e,!0):this.addSelection(e,!0))},removeSelection:function(e,t){if(e){this._layerModel.fire("mapexpress:selection:before:deselected",this),t?this._layerModel.fire("mapexpress:selection:manual:before:deselected",this):this._layerModel.fire("mapexpress:selection:map:before:deselected",this);var r=this._getLayerIndex(e);-1<r&&(this._resetLayerStyle(e),this._selection.splice(r,1),this._layerModel.fire("mapexpress:selection:after:deselected",e),t?this._layerModel.fire("mapexpress:selection:manual:after:deselected",e):this._layerModel.fire("mapexpress:selection:map:after:deselected",e))}},clearSelection:function(){for(var e=this._selection.length-1;0<=e;e--)this.removeSelection(this._selection[e],!1);this._selection.length=0},destroySelection:function(){this._selectFeatureOnClick(!1),this._subscribeLayerEvents(!1),this.clearSelection()},isLayerSelected:function(e){return-1<this._getLayerIndex(e)},_subscribeLayerEvents:function(e){function t(e){this._layerModel.mapLayer.options.visible||this.clearSelection()}this._layerModel&&e&&(this._layerModel.on("mapexspress:layermodel:visiblechanged",t.bind(this),this),this._layerModel.mapLayer.on("mapexspress:layer:data:added",this._onDataAdded,this)),this._layerModel&&!e&&(this._selectFeatureOnClick(!1),this._layerModel.off("mapexspress:layermodel:visiblechanged",t.bind(this),this),this._layerModel.mapLayer.off("mapexspress:layer:data:added",this._onDataAdded,this))},_onDataAdded:function(e){this._restoreSelection()},_getLayerIndex:function(t){return this._findIndex(this._selection,function(e){return e._leaflet_id===t._leaflet_id})},_resetLayerStyle:function(t){if(t&&t instanceof MapExpress.Layers.GeoJSONServiceLayer&&t.updateStyle(),t&&t.feature&&t.feature.properties&&t.feature.properties.style)try{var e=JSON.parse(t.feature.properties.style);if(e)return void t.setStyle(e)}catch(e){return void t.setStyle(t.oldStyle)}t.setStyle(t.oldStyle)},_restoreSelection:function(){var e=this._selection.slice(0);if(this.clearSelection(),this._layerModel&&this._layerModel.mapLayer)for(var t=e.length-1;0<=t;t--){var r=e[t];if(r&&r.feature){var o=MapExpress.Utils.GeoJSONUtils.getLayerByPropertyValueFromLayerGroup(this._layerModel.mapLayer,this.options.featureKeyFieldName,r.feature.properties[this.options.featureKeyFieldName]);o&&this.addSelection(o,!1)}}this._selectFeatureOnClick(!0)},featureOnClick:function(e){this.invertSelection(e.target)},_selectFeatureOnClick:function(t){var r=this;this._layerModel&&this._layerModel.mapLayer&&this._layerModel.mapLayer.eachLayer(function(e){t?(e.off("click",r.featureOnClick,r),e.on("click",r.featureOnClick,r)):e.off("click",r.featureOnClick,r)})},_findIndex:function(e,t){var r;for(r in e)if(t(e[r]))return parseInt(r);return-1}}),MapExpress.Mapping.Selection.SingleUseSelection=MapExpress.Mapping.Selection.extend({featureOnClick:function(e){this.destroySelection()}}),MapExpress.Mapping.MapWorkspaseLoader={getMapWorkspaceFromURLAsync:function(e){return MapExpress.Utils.Promise.GetJSON(e)},getMapWorkspaceFromFileAsync:function(e){var o=$.Deferred();if(window.File&&window.FileReader&&window.FileList&&window.Blob){if("undefined"===e)return void o.reject("file === undefined");var t=new FileReader;t.readAsText(e),t.onload=function(e){var t=e.target.result,r=JSON.parse(t);o.resolve(r)},t.onerror=function(e){o.reject(e.target.error)}}return o.promise()}},function(){"use strict";var t={projections:{"Местная Нижегородская":"+proj=tmerc +lat_0=0 +lon_0=43.9678807083333 +k=1 +x_0=-1169.898 +y_0=-6242460.881 +ellps=krass +towgs84=-35.344,-35.841,-82.937,2.49759,1.4563,-1.85984,-2.046708 +units=m +no_defs","МСК 01, зона 1":"+title= МСК-01 зона 1 Республика Адыгея    +proj=tmerc +lat_0=0 +lon_0=37.98333333333 +k=1 +x_0=1300000 +y_0=-4511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 01, зона 2":"+title= МСК-01 зона 2 Республика Адыгея    +proj=tmerc +lat_0=0 +lon_0=40.98333333333 +k=1 +x_0=2300000 +y_0=-4511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 02, зона 1":"+title= МСК-02 зона 1 Республика Башкортостан    +proj=tmerc +lat_0=0 +lon_0=55.03333333333 +k=1 +x_0=1300000 +y_0=-5409414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 02, зона 2":"+title= МСК-02 зона 2 Республика Башкортостан    +proj=tmerc +lat_0=0 +lon_0=58.03333333333 +k=1 +x_0=2300000 +y_0=-5409414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 03, зона 1":"+title= МСК-03 зона 1 Республика Бурятия    +proj=tmerc +lat_0=0 +lon_0=100.03333333333 +k=1 +x_0=1250000 +y_0=-5211057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 03, зона 2":"+title= МСК-03 зона 2 Республика Бурятия    +proj=tmerc +lat_0=0 +lon_0=103.03333333333 +k=1 +x_0=2250000 +y_0=-5211057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 03, зона 3":"+title= МСК-03 зона 3 Республика Бурятия    +proj=tmerc +lat_0=0 +lon_0=106.03333333333 +k=1 +x_0=3250000 +y_0=-5211057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 03, зона 4":"+title= МСК-03 зона 4 Республика Бурятия    +proj=tmerc +lat_0=0 +lon_0=109.03333333333 +k=1 +x_0=4250000 +y_0=-5211057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 03, зона 5":"+title= МСК-03 зона 5 Республика Бурятия    +proj=tmerc +lat_0=0 +lon_0=112.03333333333 +k=1 +x_0=5250000 +y_0=-5211057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 03, зона 6":"+title= МСК-03 зона 6 Республика Бурятия    +proj=tmerc +lat_0=0 +lon_0=115.03333333333 +k=1 +x_0=6250000 +y_0=-5211057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 03, зона 7":"+title= МСК-03 зона 7 Республика Бурятия    +proj=tmerc +lat_0=0 +lon_0=118.03333333333 +k=1 +x_0=7250000 +y_0=-5211057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 04, зона 1":"+title= МСК-04 зона 1 Республика Алтай    +proj=tmerc +lat_0=0 +lon_0=85.46666666666 +k=1 +x_0=1300000 +y_0=-5112900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 04, зона 2":"+title= МСК-04 зона 2 Республика Алтай    +proj=tmerc +lat_0=0 +lon_0=88.46666666666 +k=1 +x_0=2300000 +y_0=-5112900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 05, зона 1":"+title= МСК-05 зона 1 Республика Дагестан    +proj=tmerc +lat_0=0 +lon_0=46.98333333333 +k=1 +x_0=4300000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 06, зона 1":"+title= МСК-06 зона 1 Республика Ингушетия    +proj=tmerc +lat_0=0 +lon_0=43.98333333333 +k=1 +x_0=1300000 +y_0=-4311057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 07, зона 1":"+title= МСК-07 зона 1 Кабардино-Балкарская Республика    +proj=tmerc +lat_0=0 +lon_0=43.98333333333 +k=1 +x_0=1300000 +y_0=-4311057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 08, зона 1":"+title= МСК-08 зона 1 Республика Калмыкия    +proj=tmerc +lat_0=0 +lon_0=40.98333333333 +k=1 +x_0=1300000 +y_0=-4711057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 08, зона 2":"+title= МСК-08 зона 2 Республика Калмыкия    +proj=tmerc +lat_0=0 +lon_0=43.98333333333 +k=1 +x_0=2300000 +y_0=-4711057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 08, зона 3":"+title= МСК-08 зона 3 Республика Калмыкия    +proj=tmerc +lat_0=0 +lon_0=46.98333333333 +k=1 +x_0=3300000 +y_0=-4711057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 09, зона 1":"+title= МСК-09 зона 1 Республика Карачаево-Черкесия    +proj=tmerc +lat_0=0 +lon_0=40.98333333333 +k=1 +x_0=1300000 +y_0=-4311057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 10, зона 1":"+title= МСК-10 зона 1 (6 градусная) Республика Карелия    +proj=tmerc +lat_0=0 +lon_0=32.03333333333 +k=1 +x_0=1400000 +y_0=-6511057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 10, зона 2":"+title= МСК-10 зона 2 (6 градусная) Республика Карелия    +proj=tmerc +lat_0=0 +lon_0=38.03333333333 +k=1 +x_0=2400000 +y_0=-6511057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 11, зона 1":"+title= МСК-11 зона 1 Республика Коми    +proj=tmerc +lat_0=0 +lon_0=41.03333333333 +k=1 +x_0=1400000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 11, зона 2":"+title= МСК-11 зона 2 Республика Коми    +proj=tmerc +lat_0=0 +lon_0=44.03333333333 +k=1 +x_0=2400000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 11, зона 3":"+title= МСК-11 зона 3 Республика Коми    +proj=tmerc +lat_0=0 +lon_0=47.03333333333 +k=1 +x_0=3400000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 11, зона 4":"+title= МСК-11 зона 4 Республика Коми    +proj=tmerc +lat_0=0 +lon_0=50.03333333333 +k=1 +x_0=4400000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 11, зона 5":"+title= МСК-11 зона 5 Республика Коми    +proj=tmerc +lat_0=0 +lon_0=53.03333333333 +k=1 +x_0=5400000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 11, зона 6":"+title= МСК-11 зона 6 Республика Коми    +proj=tmerc +lat_0=0 +lon_0=56.03333333333 +k=1 +x_0=6400000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 11, зона 7":"+title= МСК-11 зона 7 Республика Коми    +proj=tmerc +lat_0=0 +lon_0=59.03333333333 +k=1 +x_0=7400000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 11, зона 8":"+title= МСК-11 зона 8 Республика Коми    +proj=tmerc +lat_0=0 +lon_0=62.03333333333 +k=1 +x_0=8400000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 11, зона 9":"+title= МСК-11 зона 9 Республика Коми    +proj=tmerc +lat_0=0 +lon_0=65.03333333333 +k=1 +x_0=9400000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 12, зона 1":"+title= МСК-12 зона 1 Республика Марий Эл    +proj=tmerc +lat_0=0 +lon_0=47.55 +k=1 +x_0=1250000 +y_0=-5914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 12, зона 2":"+title= МСК-12 зона 2 Республика Марий Эл    +proj=tmerc +lat_0=0 +lon_0=50.55 +k=1 +x_0=2250000 +y_0=-5914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 13, зона 1":"+title= МСК-13 зона 1 Республика Мордовия    +proj=tmerc +lat_0=0 +lon_0=44.55 +k=1 +x_0=1250000 +y_0=-5614743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 13, зона 2":"+title= МСК-13 зона 2 Республика Мордовия    +proj=tmerc +lat_0=0 +lon_0=47.55 +k=1 +x_0=2250000 +y_0=-5614743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 14, зона 1":"+title= МСК-14 зона 1 (6 градусная) Республика Саха (Якутия)    +proj=tmerc +lat_0=0 +lon_0=108.45 +k=1 +x_0=1400000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 14, зона 2":"+title= МСК-14 зона 2 (6 градусная) Республика Саха (Якутия)    +proj=tmerc +lat_0=0 +lon_0=114.45 +k=1 +x_0=2400000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 14, зона 3":"+title= МСК-14 зона 3 (6 градусная) Республика Саха (Якутия)    +proj=tmerc +lat_0=0 +lon_0=120.45 +k=1 +x_0=3400000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 14, зона 4":"+title= МСК-14 зона 4 (6 градусная) Республика Саха (Якутия)    +proj=tmerc +lat_0=0 +lon_0=126.45 +k=1 +x_0=4400000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 14, зона 5":"+title= МСК-14 зона 5 (6 градусная) Республика Саха (Якутия)    +proj=tmerc +lat_0=0 +lon_0=132.45 +k=1 +x_0=5400000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 14, зона 6":"+title= МСК-14 зона 6 (6 градусная) Республика Саха (Якутия)    +proj=tmerc +lat_0=0 +lon_0=138.45 +k=1 +x_0=6400000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 14, зона 7":"+title= МСК-14 зона 7 (6 градусная) Республика Саха (Якутия)    +proj=tmerc +lat_0=0 +lon_0=144.45 +k=1 +x_0=7400000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 14, зона 8":"+title= МСК-14 зона 8 (6 градусная) Республика Саха (Якутия)    +proj=tmerc +lat_0=0 +lon_0=150.45 +k=1 +x_0=8400000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 14, зона 9":"+title= МСК-14 зона 9 (6 градусная) Республика Саха (Якутия)    +proj=tmerc +lat_0=0 +lon_0=156.45 +k=1 +x_0=9400000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 15, зона 1":"+title= МСК-15 зона 1 Северная Осетия - Алания    +proj=tmerc +lat_0=0 +lon_0=43.98333333333 +k=1 +x_0=1300000 +y_0=-4311057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 16, зона 1":"+title= МСК-16 зона 1 Республика Татарстан    +proj=tmerc +lat_0=0 +lon_0=49.033333333333 +k=1 +x_0=1300000 +y_0=-5709414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 16, зона 2":"+title= МСК-16 зона 2 Республика Татарстан    +proj=tmerc +lat_0=0 +lon_0=52.033333333333 +k=1 +x_0=2300000 +y_0=-5709414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 16, зона 3":"+title= МСК-16 зона 3 Республика Татарстан    +proj=tmerc +lat_0=0 +lon_0=55.033333333333 +k=1 +x_0=3300000 +y_0=-5709414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 18, зона 1":"+title= МСК-18 зона 1 Удмуртская Республика    +proj=tmerc +lat_0=0 +lon_0=50.55 +k=1 +x_0=1250000 +y_0=-5914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 18, зона 2":"+title= МСК-18 зона 2 Удмуртская Республика    +proj=tmerc +lat_0=0 +lon_0=53.55 +k=1 +x_0=2250000 +y_0=-5914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 20, зона 1":"+title= МСК-20 зона 1 Чеченская Республика    +proj=tmerc +lat_0=0 +lon_0=43.98333333333 +k=1 +x_0=1300000 +y_0=-4311057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 20, зона 2":"+title= МСК-20 зона 2 Чеченская Республика    +proj=tmerc +lat_0=0 +lon_0=46.98333333333 +k=1 +x_0=2300000 +y_0=-4311057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 21, зона 1":"+title= МСК-21 зона 1 Чувашская Республика    +proj=tmerc +lat_0=0 +lon_0=47.55 +k=1 +x_0=1250000 +y_0=-5814743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 21, зона 2":"+title= МСК-21 зона 2 Чувашская Республика    +proj=tmerc +lat_0=0 +lon_0=50.55 +k=1 +x_0=2250000 +y_0=-5814743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 22, зона 1":"+title= МСК-22 зона 1 Алтайский край    +proj=tmerc +lat_0=0 +lon_0=79.46666666666 +k=1 +x_0=1300000 +y_0=-5312900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 22, зона 2":"+title= МСК-22 зона 2 Алтайский край    +proj=tmerc +lat_0=0 +lon_0=82.46666666666 +k=1 +x_0=2300000 +y_0=-5312900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 22, зона 3":"+title= МСК-22 зона 3 Алтайский край    +proj=tmerc +lat_0=0 +lon_0=85.46666666666 +k=1 +x_0=3300000 +y_0=-5312900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 23, зона 1":"+title= МСК-23 зона 1 Краснодарский край    +proj=tmerc +lat_0=0 +lon_0=37.98333333333 +k=1 +x_0=1300000 +y_0=-4511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 23, зона 2":"+title= МСК-23 зона 2 Краснодарский край    +proj=tmerc +lat_0=0 +lon_0=40.98333333333 +k=1 +x_0=2300000 +y_0=-4511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 24, зона 1":"+title= МСК-24 зона 1 (6 градусная) Красноярский край    +proj=tmerc +lat_0=0 +lon_0=81.51666666666 +k=1 +x_0=1500000 +y_0=-5416586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 24, зона 2":"+title= МСК-24 зона 2 (6 градусная) Красноярский край    +proj=tmerc +lat_0=0 +lon_0=87.51666666666 +k=1 +x_0=2500000 +y_0=-5416586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 24, зона 3":"+title= МСК-24 зона 3 (6 градусная) Красноярский край    +proj=tmerc +lat_0=0 +lon_0=93.51666666666 +k=1 +x_0=3500000 +y_0=-5416586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 24, зона 4":"+title= МСК-24 зона 4 (6 градусная) Красноярский край    +proj=tmerc +lat_0=0 +lon_0=99.51666666666 +k=1 +x_0=4500000 +y_0=-5416586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 24, зона 5":"+title= МСК-24 зона 5 (6 градусная) Красноярский край    +proj=tmerc +lat_0=0 +lon_0=105.51666666666 +k=1 +x_0=5500000 +y_0=-5416586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 24, зона 6":"+title= МСК-24 зона 6 (6 градусная) Красноярский край    +proj=tmerc +lat_0=0 +lon_0=111.51666666666 +k=1 +x_0=6500000 +y_0=-5416586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК г. Красноярск":"+title= МСК г. Красноярск    +proj=tmerc +lat_0=0 +lon_0=93 +k=1 +x_0=54304.47 +y_0=-6196680.59 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 164":"+title= МСК-164 Красноярский край    +proj=tmerc +lat_0=0 +lon_0=84 +k=1 +x_0=86209.80 +y_0=-6542783.50 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 165":"+title= МСК-165 Красноярский край    +proj=tmerc +lat_0=0 +lon_0=87 +k=1 +x_0=105295.80 +y_0=-5652185.00 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 166":"+title= МСК-166 Красноярский край    +proj=tmerc +lat_0=0 +lon_0=90 +k=1 +x_0=107543.30 +y_0=-5540944.50 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 167":"+title= МСК-167 Красноярский край    +proj=tmerc +lat_0=0 +lon_0=93 +k=1 +x_0=106797.80 +y_0=-5578022.50 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 168":"+title= МСК-168 Красноярский край    +proj=tmerc +lat_0=0 +lon_0=96 +k=1 +x_0=108285.20 +y_0=-5503868.60 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 169":"+title= МСК-169 Красноярский край    +proj=tmerc +lat_0=0 +lon_0=99 +k=1 +x_0=117308.60 +y_0=-5503868.60 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 25, зона 1":"+title= МСК-25 зона 1 Приморский край    +proj=tmerc +lat_0=0 +lon_0=130.71666666666 +k=1 +x_0=1300000 +y_0=-4416586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 25, зона 2":"+title= МСК-25 зона 2 Приморский край    +proj=tmerc +lat_0=0 +lon_0=133.71666666666 +k=1 +x_0=2300000 +y_0=-4416586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 25, зона 3":"+title= МСК-25 зона 3 Приморский край    +proj=tmerc +lat_0=0 +lon_0=136.71666666666 +k=1 +x_0=3300000 +y_0=-4416586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 25, зона 4":"+title= МСК-25 зона 4 Приморский край    +proj=tmerc +lat_0=0 +lon_0=139.71666666666 +k=1 +x_0=4300000 +y_0=-4416586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 26, зона 1":"+title= МСК-26 зона 1 Ставропольский край    +proj=tmerc +lat_0=0 +lon_0=40.98333333333 +k=1 +x_0=1300000 +y_0=-4511057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 26, зона 2":"+title= МСК-26 зона 2 Ставропольский край    +proj=tmerc +lat_0=0 +lon_0=43.98333333333 +k=1 +x_0=2300000 +y_0=-4511057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 27, зона 1":"+title= МСК-27 зона 1 Хабаровский край    +proj=tmerc +lat_0=0 +lon_0=130.71666666666 +k=1 +x_0=1300000 +y_0=-4916586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 27, зона 2":"+title= МСК-27 зона 2 Хабаровский край    +proj=tmerc +lat_0=0 +lon_0=133.71666666666 +k=1 +x_0=2300000 +y_0=-4916586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 27, зона 3":"+title= МСК-27 зона 3 Хабаровский край    +proj=tmerc +lat_0=0 +lon_0=136.71666666666 +k=1 +x_0=3300000 +y_0=-4916586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 27, зона 4":"+title= МСК-27 зона 4 Хабаровский край    +proj=tmerc +lat_0=0 +lon_0=139.71666666666 +k=1 +x_0=4300000 +y_0=-4916586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 27, зона 5":"+title= МСК-27 зона 5 Хабаровский край    +proj=tmerc +lat_0=0 +lon_0=142.71666666666 +k=1 +x_0=5300000 +y_0=-4916586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 27, зона 6":"+title= МСК-27 зона 6 Хабаровский край    +proj=tmerc +lat_0=0 +lon_0=145.71666666666 +k=1 +x_0=6300000 +y_0=-4916586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 28, зона 1":"+title= МСК-28 зона 1 Амурская область    +proj=tmerc +lat_0=0 +lon_0=121.71666666666 +k=1 +x_0=1300000 +y_0=-5116586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 28, зона 2":"+title= МСК-28 зона 2 Амурская область    +proj=tmerc +lat_0=0 +lon_0=124.71666666666 +k=1 +x_0=2300000 +y_0=-5116586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 28, зона 3":"+title= МСК-28 зона 3 Амурская область    +proj=tmerc +lat_0=0 +lon_0=127.71666666666 +k=1 +x_0=3300000 +y_0=-5116586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 28, зона 4":"+title= МСК-28 зона 4 Амурская область    +proj=tmerc +lat_0=0 +lon_0=130.71666666666 +k=1 +x_0=4300000 +y_0=-5116586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 28, зона 5":"+title= МСК-28 зона 5 Амурская область    +proj=tmerc +lat_0=0 +lon_0=133.71666666666 +k=1 +x_0=5300000 +y_0=-5116586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 29, зона 1":"+title= МСК-29 зона 1 (6 градусная) Архангельская область    +proj=tmerc +lat_0=0 +lon_0=32.03333333333 +k=1 +x_0=1400000 +y_0=-6511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 29, зона 2":"+title= МСК-29 зона 2 (6 градусная) Архангельская область    +proj=tmerc +lat_0=0 +lon_0=38.03333333333 +k=1 +x_0=2400000 +y_0=-6511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 29, зона 3":"+title= МСК-29 зона 3 (6 градусная) Архангельская область    +proj=tmerc +lat_0=0 +lon_0=44.03333333333 +k=1 +x_0=3400000 +y_0=-6511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 29, зона 4":"+title= МСК-29 зона 4 (6 градусная) Архангельская область    +proj=tmerc +lat_0=0 +lon_0=50.03333333333 +k=1 +x_0=4400000 +y_0=-6511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 30, зона 1":"+title= МСК-30 зона 1 Астраханская область    +proj=tmerc +lat_0=0 +lon_0=46.05 +k=1 +x_0=1300000 +y_0=-4714743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 30, зона 2":"+title= МСК-30 зона 2 Астраханская область    +proj=tmerc +lat_0=0 +lon_0=49.05 +k=1 +x_0=2300000 +y_0=-4714743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 31, зона 1":"+title= МСК-31 зона 1 Белгородская область    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=1250000 +y_0=-5212900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 31, зона 2":"+title= МСК-31 зона 2 Белгородская область    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=2250000 +y_0=-5212900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 32, зона 1":"+title= МСК-32 зона 1 Брянская область    +proj=tmerc +lat_0=0 +lon_0=32.48333333333 +k=1 +x_0=1250000 +y_0=-5412900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 32, зона 2":"+title= МСК-32 зона 2 Брянская область    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=2250000 +y_0=-5412900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 33, от СК-63 зона 1":"+title= МСК-33 от СК-63 зона 1 Владимирская область    +proj=tmerc +lat_0=0 +lon_0=38.55 +k=1 +x_0=1250000 +y_0=-5814743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 33, от СК-63 зона 2":"+title= МСК-33 от СК-63 зона 2 Владимирская область    +proj=tmerc +lat_0=0 +lon_0=41.55 +k=1 +x_0=2250000 +y_0=-5814743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 33, от СК-63 зона 3":"+title= МСК-33 от СК-63 зона 3 Владимирская область    +proj=tmerc +lat_0=0 +lon_0=44.55 +k=1 +x_0=3250000 +y_0=-5814743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 33, от СК-95":"+title= МСК-33 от СК-95 Владимирская область    +proj=tmerc +lat_0=0 +lon_0=39 +k=1 +x_0=134156.988 +y_0=-6032524.376 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 34, зона 1":"+title= МСК-34 зона 1 Волгоградская область    +proj=tmerc +lat_0=0 +lon_0=43.05 +k=1 +x_0=1300000 +y_0=-4914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 34, зона 2":"+title= МСК-34 зона 2 Волгоградская область    +proj=tmerc +lat_0=0 +lon_0=46.05 +k=1 +x_0=2300000 +y_0=-4914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 35, зона 1":"+title= МСК-35 зона 1 Вологодская область    +proj=tmerc +lat_0=0 +lon_0=35.55 +k=1 +x_0=1250000 +y_0=-6214743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 35, зона 2":"+title= МСК-35 зона 2 Вологодская область    +proj=tmerc +lat_0=0 +lon_0=38.55 +k=1 +x_0=2250000 +y_0=-6214743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 35, зона 3":"+title= МСК-35 зона 3 Вологодская область    +proj=tmerc +lat_0=0 +lon_0=41.55 +k=1 +x_0=3250000 +y_0=-6214743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 35, зона 4":"+title= МСК-35 зона 4 Вологодская область    +proj=tmerc +lat_0=0 +lon_0=44.55 +k=1 +x_0=4250000 +y_0=-6214743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 36, зона 1":"+title= МСК-36 зона 1 Воронежская область    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=1250000 +y_0=-5212900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 36, зона 2":"+title= МСК-36 зона 2 Воронежская область    +proj=tmerc +lat_0=0 +lon_0=41.48333333333 +k=1 +x_0=2250000 +y_0=-5212900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 37, зона 1":"+title= МСК-37 зона 1 Ивановская область    +proj=tmerc +lat_0=0 +lon_0=38.55 +k=1 +x_0=1250000 +y_0=-6014743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 37, зона 2":"+title= МСК-37 зона 2 Ивановская область    +proj=tmerc +lat_0=0 +lon_0=41.55 +k=1 +x_0=2250000 +y_0=-6014743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 38, зона 1":"+title= МСК-38 зона 1 Иркутская область    +proj=tmerc +lat_0=0 +lon_0=97.03333333333 +k=1 +x_0=1250000 +y_0=-5411057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 38, зона 2":"+title= МСК-38 зона 2 Иркутская область    +proj=tmerc +lat_0=0 +lon_0=100.03333333333 +k=1 +x_0=2250000 +y_0=-5411057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 38, зона 3":"+title= МСК-38 зона 3 Иркутская область    +proj=tmerc +lat_0=0 +lon_0=103.03333333333 +k=1 +x_0=3250000 +y_0=-5411057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 38, зона 4":"+title= МСК-38 зона 4 Иркутская область    +proj=tmerc +lat_0=0 +lon_0=106.03333333333 +k=1 +x_0=4250000 +y_0=-5411057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 38, зона 5":"+title= МСК-38 зона 5 Иркутская область    +proj=tmerc +lat_0=0 +lon_0=109.03333333333 +k=1 +x_0=5250000 +y_0=-5411057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 38, зона 6":"+title= МСК-38 зона 6 Иркутская область    +proj=tmerc +lat_0=0 +lon_0=112.03333333333 +k=1 +x_0=6250000 +y_0=-5411057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 38, зона 7":"+title= МСК-38 зона 7 Иркутская область    +proj=tmerc +lat_0=0 +lon_0=115.03333333333 +k=1 +x_0=7250000 +y_0=-5411057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 38, зона 8":"+title= МСК-38 зона 8 Иркутская область    +proj=tmerc +lat_0=0 +lon_0=118.03333333333 +k=1 +x_0=8250000 +y_0=-5411057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 39, зона 1":"+title= МСК-39 зона 1 Калининградская область    +proj=tmerc +lat_0=0 +lon_0=21.45 +k=1 +x_0=1250000 +y_0=-5711057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 40, зона 1":"+title= МСК-40 зона 1 Калужская область    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=1250000 +y_0=-5612900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 41, зона 1":"+title= МСК-41 зона 1 (6 градусная) Камчатский край    +proj=tmerc +lat_0=0 +lon_0=158.46666666667 +k=1 +x_0=1400000 +y_0=-5316586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 41, зона 2":"+title= МСК-41 зона 2 (6 градусная) Камчатский край    +proj=tmerc +lat_0=0 +lon_0=164.46666666667 +k=1 +x_0=2400000 +y_0=-5316586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 41, зона 3":"+title= МСК-41 зона 3 (6 градусная) Камчатский край    +proj=tmerc +lat_0=0 +lon_0=170.46666666667 +k=1 +x_0=3400000 +y_0=-5316586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 42, зона 1":"+title= МСК-42 зона 1 Кемеровская область    +proj=tmerc +lat_0=0 +lon_0=85.46666666666 +k=1 +x_0=1300000 +y_0=-5512900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 42, зона 2":"+title= МСК-42 зона 2 Кемеровская область    +proj=tmerc +lat_0=0 +lon_0=88.46666666666 +k=1 +x_0=2300000 +y_0=-5512900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 43, зона 1":"+title= МСК-43 зона 1 Кировская область    +proj=tmerc +lat_0=0 +lon_0=47.55 +k=1 +x_0=1250000 +y_0=-5914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 43, зона 2":"+title= МСК-43 зона 2 Кировская область    +proj=tmerc +lat_0=0 +lon_0=50.55 +k=1 +x_0=2250000 +y_0=-5914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 43, зона 3":"+title= МСК-43 зона 3 Кировская область    +proj=tmerc +lat_0=0 +lon_0=53.55 +k=1 +x_0=3250000 +y_0=-5914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 44, зона 1":"+title= МСК-44 зона 1 Костромская область    +proj=tmerc +lat_0=0 +lon_0=41.55 +k=1 +x_0=1250000 +y_0=-6114743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 44, зона 2":"+title= МСК-44 зона 2 Костромская область    +proj=tmerc +lat_0=0 +lon_0=44.55 +k=1 +x_0=2250000 +y_0=-6114743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 44, зона 3":"+title= МСК-44 зона 3 Костромская область    +proj=tmerc +lat_0=0 +lon_0=47.55 +k=1 +x_0=3250000 +y_0=-6114743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 45, зона 1":"+title= МСК-45 зона 1 Курганская область    +proj=tmerc +lat_0=0 +lon_0=61.03333333333 +k=1 +x_0=1300000 +y_0=-5709414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 45, зона 2":"+title= МСК-45 зона 2 Курганская область    +proj=tmerc +lat_0=0 +lon_0=64.03333333333 +k=1 +x_0=2300000 +y_0=-5709414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 45, зона 3":"+title= МСК-45 зона 3 Курганская область    +proj=tmerc +lat_0=0 +lon_0=67.03333333333 +k=1 +x_0=3300000 +y_0=-5709414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 46, зона 1":"+title= МСК-46 зона 1 Курская область    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=1250000 +y_0=-5312900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 46, зона 2":"+title= МСК-46 зона 2 Курская область    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=2250000 +y_0=-5312900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 47, зона 1":"+title= МСК-47 зона 1 Ленинградская область    +proj=tmerc +lat_0=0 +lon_0=27.95 +k=1 +x_0=1250000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 47, зона 2":"+title= МСК-47 зона 2 Ленинградская область    +proj=tmerc +lat_0=0 +lon_0=30.95 +k=1 +x_0=2250000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 47, зона 3":"+title= МСК-47 зона 3 Ленинградская область    +proj=tmerc +lat_0=0 +lon_0=33.95 +k=1 +x_0=3250000 +y_0=-6211057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 1964 Санкт-Петербург":"+title= МСК-1964 Санкт-Петербург    +proj=tmerc +lat_0=0 +lon_0=30 +k=1 +x_0=95942.17 +y_0=-6552810.0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 48, зона 1":"+title= МСК-48 зона 1 Липецкая область    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=1250000 +y_0=-5412900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 48, зона 2":"+title= МСК-48 зона 2 Липецкая область    +proj=tmerc +lat_0=0 +lon_0=41.48333333333 +k=1 +x_0=2250000 +y_0=-5412900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 49, зона 1":"+title= МСК-49 зона 1 (6 градусная) Магаданская область    +proj=tmerc +lat_0=0 +lon_0=144.45 +k=1 +x_0=1400000 +y_0=-6212900.566  +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 49, зона 2":"+title= МСК-49 зона 2 (6 градусная) Магаданская область    +proj=tmerc +lat_0=0 +lon_0=150.45 +k=1 +x_0=2400000 +y_0=-6212900.566  +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 49, зона 3":"+title= МСК-49 зона 3 (6 градусная) Магаданская область    +proj=tmerc +lat_0=0 +lon_0=156.45 +k=1 +x_0=3400000 +y_0=-6212900.566  +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 49, зона 4":"+title= МСК-49 зона 4 (6 градусная) Магаданская область    +proj=tmerc +lat_0=0 +lon_0=162.45 +k=1 +x_0=4400000 +y_0=-6212900.566  +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Московская СК (МГГТ)":"+title= Московская СК (МГГТ)    +proj=tmerc +lat_0=55.66666666667 +lon_0=37.5 +k=1 +x_0=16.098 +y_0=14.512 +ellps=bessel +towgs84=316.151,78.924,589.650,-1.57273,2.69209,2.34693,8.4507 +units=m +no_defs","МСК 50, зона 1":"+title= МСК-50 зона 1 Московская область    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=1250000 +y_0=-5712900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 50, зона 2":"+title= МСК-50 зона 2 Московская область    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=2250000 +y_0=-5712900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 51, зона 1":"+title= МСК-51 зона 1 (6 градусная) Мурманская область    +proj=tmerc +lat_0=0 +lon_0=32.03333333333 +k=1 +x_0=1400000 +y_0=-7011057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 51, зона 2":"+title= МСК-51 зона 2 (6 градусная) Мурманская область    +proj=tmerc +lat_0=0 +lon_0=38.03333333333 +k=1 +x_0=2400000 +y_0=-7011057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 52, зона 1":"+title= МСК-52 зона 1 Нижегородская область    +proj=tmerc +lat_0=0 +lon_0=41.55 +k=1 +x_0=1250000 +y_0=-5714743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 52, зона 2":"+title= МСК-52 зона 2 Нижегородская область    +proj=tmerc +lat_0=0 +lon_0=44.55 +k=1 +x_0=2250000 +y_0=-5714743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 52, зона 3":"+title= МСК-52 зона 3 Нижегородская область    +proj=tmerc +lat_0=0 +lon_0=47.55 +k=1 +x_0=3250000 +y_0=-5714743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 53, зона 1":"+title= МСК-53 зона 1 Новгородская область    +proj=tmerc +lat_0=0 +lon_0=29.48333333333 +k=1 +x_0=1250000 +y_0=-5912900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 53, зона 2":"+title= МСК-53 зона 2 Новгородская область    +proj=tmerc +lat_0=0 +lon_0=32.48333333333 +k=1 +x_0=2250000 +y_0=-5912900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 53, зона 3":"+title= МСК-53 зона 3 Новгородская область    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=3250000 +y_0=-5912900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 54, зона 1":"+title= МСК-54 зона 1 Новосибирская область    +proj=tmerc +lat_0=0 +lon_0=74.73333333333 +k=1 +x_0=1250000 +y_0=-5612900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 54, зона 2":"+title= МСК-54 зона 2 Новосибирская область    +proj=tmerc +lat_0=0 +lon_0=77.73333333333 +k=1 +x_0=2250000 +y_0=-5612900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 54, зона 3":"+title= МСК-54 зона 3 Новосибирская область    +proj=tmerc +lat_0=0 +lon_0=80.73333333333 +k=1 +x_0=3250000 +y_0=-5612900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 54, зона 4":"+title= МСК-54 зона 4 Новосибирская область    +proj=tmerc +lat_0=0 +lon_0=83.73333333333 +k=1 +x_0=4250000 +y_0=-5612900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 55, зона 1":"+title= МСК-55 зона 1 Омская область    +proj=tmerc +lat_0=0 +lon_0=71.73333333333 +k=1 +x_0=1250000 +y_0=-5612900.563 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 55, зона 2":"+title= МСК-55 зона 2 Омская область    +proj=tmerc +lat_0=0 +lon_0=74.73333333333 +k=1 +x_0=2250000 +y_0=-5612900.563 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 56, зона 1":"+title= МСК-56 зона 1 Оренбургская область    +proj=tmerc +lat_0=0 +lon_0=52.03333333333 +k=1 +x_0=1300000 +y_0=-5309414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 56, зона 2":"+title= МСК-56 зона 2 Оренбургская область    +proj=tmerc +lat_0=0 +lon_0=55.03333333333 +k=1 +x_0=2300000 +y_0=-5309414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 56, зона 3":"+title= МСК-56 зона 3 Оренбургская область    +proj=tmerc +lat_0=0 +lon_0=58.03333333333 +k=1 +x_0=3300000 +y_0=-5309414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 56, зона 4":"+title= МСК-56 зона 4 Оренбургская область    +proj=tmerc +lat_0=0 +lon_0=61.03333333333 +k=1 +x_0=4300000 +y_0=-5309414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 57, зона 1":"+title= МСК-57 зона 1 Орловская область    +proj=tmerc +lat_0=0 +lon_0=32.48333333333 +k=1 +x_0=1250000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 57, зона 2":"+title= МСК-57 зона 2 Орловская область    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=2250000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 57, зона 3":"+title= МСК-57 зона 3 Орловская область    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=3250000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 58, зона 1":"+title= МСК-58 зона 1 Пензенская область    +proj=tmerc +lat_0=0 +lon_0=43.05 +k=1 +x_0=1300000 +y_0=-5514743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 58, зона 2":"+title= МСК-58 зона 2 Пензенская область    +proj=tmerc +lat_0=0 +lon_0=46.05 +k=1 +x_0=2300000 +y_0=-5514743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 59, зона 1":"+title= МСК-59 зона 1 Пермский край    +proj=tmerc +lat_0=0 +lon_0=53.55 +k=1 +x_0=1250000 +y_0=-5914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 59, зона 2":"+title= МСК-59 зона 2 Пермский край    +proj=tmerc +lat_0=0 +lon_0=56.55 +k=1 +x_0=2250000 +y_0=-5914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 59, зона 3":"+title= МСК-59 зона 3 Пермский край    +proj=tmerc +lat_0=0 +lon_0=59.55 +k=1 +x_0=3250000 +y_0=-5914743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 60, зона 1":"+title= МСК-60 зона 1 Псковская область    +proj=tmerc +lat_0=0 +lon_0=27.95 +k=1 +x_0=1250000 +y_0=-5911057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 60, зона 2":"+title= МСК-60 зона 2 Псковская область    +proj=tmerc +lat_0=0 +lon_0=30.95 +k=1 +x_0=2250000 +y_0=-5911057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 60, зона 3":"+title= МСК-60 зона 3 Псковская область    +proj=tmerc +lat_0=0 +lon_0=33.95 +k=1 +x_0=3250000 +y_0=-5911057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 61, зона 1":"+title= МСК-61 зона 1 Ростовская область    +proj=tmerc +lat_0=0 +lon_0=37.98333333333 +k=1 +x_0=1300000 +y_0=-4811057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 61, зона 2":"+title= МСК-61 зона 2 Ростовская область    +proj=tmerc +lat_0=0 +lon_0=40.98333333333 +k=1 +x_0=2300000 +y_0=-4811057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 61, зона 3":"+title= МСК-61 зона 3 Ростовская область    +proj=tmerc +lat_0=0 +lon_0=43.98333333333 +k=1 +x_0=3300000 +y_0=-4811057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 62, зона 1":"+title= МСК-62 зона 1 Рязанская область    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=1250000 +y_0=-5612900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 62, зона 2":"+title= МСК-62 зона 2 Рязанская область    +proj=tmerc +lat_0=0 +lon_0=41.48333333333 +k=1 +x_0=2250000 +y_0=-5612900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 62, зона 3":"+title= МСК-62 зона 3 Рязанская область    +proj=tmerc +lat_0=0 +lon_0=44.48333333333 +k=1 +x_0=3250000 +y_0=-5612900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 63, зона 1":"+title= МСК-63 зона 1 Самарская область    +proj=tmerc +lat_0=0 +lon_0=49.03333333333 +k=1 +x_0=1300000 +y_0=-5509414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 63, зона 2":"+title= МСК-63 зона 2 Самарская область    +proj=tmerc +lat_0=0 +lon_0=52.03333333333 +k=1 +x_0=2300000 +y_0=-5509414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 64, зона 1":"+title= МСК-64 зона 1 Саратовская область    +proj=tmerc +lat_0=0 +lon_0=43.05 +k=1 +x_0=1300000 +y_0=-5214743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 64, зона 2":"+title= МСК-64 зона 2 Саратовская область    +proj=tmerc +lat_0=0 +lon_0=46.05 +k=1 +x_0=2300000 +y_0=-5214743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 64, зона 3":"+title= МСК-64 зона 3 Саратовская область    +proj=tmerc +lat_0=0 +lon_0=49.05 +k=1 +x_0=3300000 +y_0=-5214743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 65, зона 1":"+title= МСК-65 зона 1 Сахалинская область    +proj=tmerc +lat_0=0 +lon_0=142.71666666667 +k=1 +x_0=1300000 +y_0=-4516586.439 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 66, зона 1":"+title= МСК-66 зона 1 Свердловская область    +proj=tmerc +lat_0=0 +lon_0=60.05 +k=1 +x_0=1500000 +y_0=-5911057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 66, зона 2":"+title= МСК-66 зона 2 Свердловская область    +proj=tmerc +lat_0=0 +lon_0=63.05 +k=1 +x_0=2500000 +y_0=-5911057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 66, зона 3":"+title= МСК-66 зона 3 Свердловская область    +proj=tmerc +lat_0=0 +lon_0=66.05 +k=1 +x_0=3500000 +y_0=-5911057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 66, зона 1 (6 градусная)":"+title= МСК-66 зона 1 (6 градусная) Свердловская область    +proj=tmerc +lat_0=0 +lon_0=60.05 +k=1 +x_0=1500000 +y_0=-5911057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 66, зона 2 (6 градусная)":"+title= МСК-66 зона 2 (6 градусная) Свердловская область    +proj=tmerc +lat_0=0 +lon_0=66.05 +k=1 +x_0=2500000 +y_0=-5911057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 67, зона 1":"+title= МСК-67 зона 1 Смоленская область    +proj=tmerc +lat_0=0 +lon_0=32.48333333333 +k=1 +x_0=1250000 +y_0=-5612900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 67, зона 2":"+title= МСК-67 зона 2 Смоленская область    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=2250000 +y_0=-5612900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 67, зона 3":"+title= МСК-67 зона 3 Смоленская область    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=3250000 +y_0=-5612900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 68, зона 1":"+title= МСК-68 зона 1 Тамбовская область    +proj=tmerc +lat_0=0 +lon_0=41.48333333333 +k=1 +x_0=1250000 +y_0=-5412900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 68, зона 2":"+title= МСК-68 зона 2 Тамбовская область    +proj=tmerc +lat_0=0 +lon_0=44.48333333333 +k=1 +x_0=2250000 +y_0=-5412900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 68, зона 3":"+title= МСК-68 зона 3 Тамбовская область    +proj=tmerc +lat_0=0 +lon_0=47.48333333333 +k=1 +x_0=3250000 +y_0=-5412900.56 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 69, зона 1":"+title= МСК-69 зона 1 Тверская область    +proj=tmerc +lat_0=0 +lon_0=32.48333333333 +k=1 +x_0=1250000 +y_0=-6012900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 69, зона 2":"+title= МСК-69 зона 2 Тверская область    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=2250000 +y_0=-6012900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 69, зона 3":"+title= МСК-69 зона 3 Тверская область    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=3250000 +y_0=-6012900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 70, зона 1":"+title= МСК-70 зона 1 Томская область    +proj=tmerc +lat_0=0 +lon_0=74.73333333333 +k=1 +x_0=1250000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 70, зона 2":"+title= МСК-70 зона 2 Томская область    +proj=tmerc +lat_0=0 +lon_0=77.73333333333 +k=1 +x_0=2250000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 70, зона 3":"+title= МСК-70 зона 3 Томская область    +proj=tmerc +lat_0=0 +lon_0=80.73333333333 +k=1 +x_0=3250000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 70, зона 4":"+title= МСК-70 зона 4 Томская область    +proj=tmerc +lat_0=0 +lon_0=83.73333333333 +k=1 +x_0=4250000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 70, зона 5":"+title= МСК-70 зона 5 Томская область    +proj=tmerc +lat_0=0 +lon_0=86.73333333333 +k=1 +x_0=5250000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 70, зона 6":"+title= МСК-70 зона 6 Томская область    +proj=tmerc +lat_0=0 +lon_0=89.73333333333 +k=1 +x_0=6250000 +y_0=-5912900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 71 от СК-63, зона 1":"+title= МСК-71 от СК-63 зона 1 Тульская область    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=1250000 +y_0=-5612900.563 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 71 от СК-63, зона 2":"+title= МСК-71 от СК-63 зона 2 Тульская область    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=2250000 +y_0=-5612900.563 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 71.1 от СК-95, зона 1":"+title= МСК-71.1 от СК-95 зона 1 Тульская область    +proj=tmerc +lat_0=0 +lon_0=37.427222222222 +k=1 +x_0=250000 +y_0=-5263444.764 +ellps=krass +towgs84=24.83,-130.97,-81.74,0,0,0.13,-0.22 +units=m +no_defs","МСК 72, зона 1 (1.5 градусная)":"+title= МСК-72 зона 1 (1.5 градусная) Тюменская область    +proj=tmerc +lat_0=0 +lon_0=66.08333333 +k=1 +x_0=1500000 +y_0=-6000000 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 2 (1.5 градусная)":"+title= МСК-72 зона 2 (1.5 градусная) Тюменская область    +proj=tmerc +lat_0=0 +lon_0=67.58333333 +k=1 +x_0=2500000 +y_0=-6000000 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 3 (1.5 градусная)":"+title= МСК-72 зона 3 (1.5 градусная) Тюменская область    +proj=tmerc +lat_0=0 +lon_0=69.08333333 +k=1 +x_0=3500000 +y_0=-6000000 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 4 (1.5 градусная)":"+title= МСК-72 зона 4 (1.5 градусная) Тюменская область    +proj=tmerc +lat_0=0 +lon_0=70.58333333 +k=1 +x_0=4500000 +y_0=-6000000 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 5 (1.5 градусная)":"+title= МСК-72 зона 5 (1.5 градусная) Тюменская область    +proj=tmerc +lat_0=0 +lon_0=72.08333333 +k=1 +x_0=5500000 +y_0=-6000000 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 6 (1.5 градусная)":"+title= МСК-72 зона 6 (1.5 градусная) Тюменская область    +proj=tmerc +lat_0=0 +lon_0=73.58333333 +k=1 +x_0=6500000 +y_0=-6000000 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 1":"+title= МСК-72 зона 1 Тюменская область    +proj=tmerc +lat_0=0 +lon_0=63.05 +k=1 +x_0=1500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 2":"+title= МСК-72 зона 2 Тюменская область    +proj=tmerc +lat_0=0 +lon_0=66.05 +k=1 +x_0=2500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 3":"+title= МСК-72 зона 3 Тюменская область    +proj=tmerc +lat_0=0 +lon_0=69.05 +k=1 +x_0=3500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 4":"+title= МСК-72 зона 4 Тюменская область    +proj=tmerc +lat_0=0 +lon_0=72.05 +k=1 +x_0=4500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 5":"+title= МСК-72 зона 5 Тюменская область    +proj=tmerc +lat_0=0 +lon_0=75.05 +k=1 +x_0=5500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 1 (6 градусная)":"+title= МСК-72 зона 1 (6 градусная) Тюменская область    +proj=tmerc +lat_0=0 +lon_0=63.05 +k=1 +x_0=1500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 2 (6 градусная)":"+title= МСК-72 зона 2 (6 градусная) Тюменская область    +proj=tmerc +lat_0=0 +lon_0=69.05 +k=1 +x_0=2500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 72, зона 3 (6 градусная)":"+title= МСК-72 зона 3 (6 градусная) Тюменская область    +proj=tmerc +lat_0=0 +lon_0=75.05 +k=1 +x_0=3500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 73, зона 1":"+title= МСК-73 зона 1 Ульяновская область    +proj=tmerc +lat_0=0 +lon_0=46.05 +k=1 +x_0=1300000 +y_0=-5514743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 73, зона 2":"+title= МСК-73 зона 2 Ульяновская область    +proj=tmerc +lat_0=0 +lon_0=49.05 +k=1 +x_0=2300000 +y_0=-5514743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 74, зона 1":"+title= МСК-74 зона 1 Челябинская область    +proj=tmerc +lat_0=0 +lon_0=58.03333333333 +k=1 +x_0=1300000 +y_0=-5509414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 74, зона 2":"+title= МСК-74 зона 2 Челябинская область    +proj=tmerc +lat_0=0 +lon_0=61.03333333333 +k=1 +x_0=2300000 +y_0=-5509414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 74, зона 3":"+title= МСК-74 зона 3 Челябинская область    +proj=tmerc +lat_0=0 +lon_0=64.03333333333 +k=1 +x_0=3300000 +y_0=-5509414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 75, зона 1":"+title= МСК-75 зона 1 Забайкальский край    +proj=tmerc +lat_0=0 +lon_0=109.03333333333 +k=1 +x_0=1250000 +y_0=-5111057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 75, зона 2":"+title= МСК-75 зона 2 Забайкальский край    +proj=tmerc +lat_0=0 +lon_0=112.03333333333 +k=1 +x_0=2250000 +y_0=-5111057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 75, зона 3":"+title= МСК-75 зона 3 Забайкальский край    +proj=tmerc +lat_0=0 +lon_0=115.03333333333 +k=1 +x_0=3250000 +y_0=-5111057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 75, зона 4":"+title= МСК-75 зона 4 Забайкальский край    +proj=tmerc +lat_0=0 +lon_0=118.03333333333 +k=1 +x_0=4250000 +y_0=-5111057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 75, зона 5":"+title= МСК-75 зона 5 Забайкальский край    +proj=tmerc +lat_0=0 +lon_0=121.03333333333 +k=1 +x_0=5250000 +y_0=-5111057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 76, зона 1":"+title= МСК-76 зона 1 Ярославская область    +proj=tmerc +lat_0=0 +lon_0=38.55 +k=1 +x_0=1250000 +y_0=-6014743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 76, зона 2":"+title= МСК-76 зона 2 Ярославская область    +proj=tmerc +lat_0=0 +lon_0=41.55 +k=1 +x_0=2250000 +y_0=-6014743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 83, зона 3":"+title= МСК-83 зона 3 (6 градусная) Ненецкий автономный округ    +proj=tmerc +lat_0=0 +lon_0=44.03333333333 +k=1 +x_0=3400000 +y_0=-6511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 83, зона 4":"+title= МСК-83 зона 4 (6 градусная) Ненецкий автономный округ    +proj=tmerc +lat_0=0 +lon_0=50.03333333333 +k=1 +x_0=4400000 +y_0=-6511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 83, зона 5":"+title= МСК-83 зона 5 (6 градусная) Ненецкий автономный округ    +proj=tmerc +lat_0=0 +lon_0=56.03333333333 +k=1 +x_0=5400000 +y_0=-6511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 83, зона 6":"+title= МСК-83 зона 6 (6 градусная) Ненецкий автономный округ    +proj=tmerc +lat_0=0 +lon_0=62.03333333333 +k=1 +x_0=6400000 +y_0=-6511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 83, зона 7":"+title= МСК-83 зона 7 (6 градусная) Ненецкий автономный округ    +proj=tmerc +lat_0=0 +lon_0=68.03333333333 +k=1 +x_0=7400000 +y_0=-6511057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 86, зона 1":"+title= МСК-86 зона 1 (6 градусная) Ханты-Мансийский автономный округ — Югра    +proj=tmerc +lat_0=0 +lon_0=60.05 +k=1 +x_0=1500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 86, зона 2":"+title= МСК-86 зона 2 (6 градусная) Ханты-Мансийский автономный округ — Югра    +proj=tmerc +lat_0=0 +lon_0=66.05 +k=1 +x_0=2500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 86, зона 3":"+title= МСК-86 зона 3 (6 градусная) Ханты-Мансийский автономный округ — Югра    +proj=tmerc +lat_0=0 +lon_0=72.05 +k=1 +x_0=3500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 86, зона 4":"+title= МСК-86 зона 4 (6 градусная) Ханты-Мансийский автономный округ — Югра    +proj=tmerc +lat_0=0 +lon_0=78.05 +k=1 +x_0=4500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 86, зона 5":"+title= МСК-86 зона 5 (6 градусная) Ханты-Мансийский автономный округ — Югра    +proj=tmerc +lat_0=0 +lon_0=84.05 +k=1 +x_0=5500000 +y_0=-5811057.63 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 87, зона 3":"+title= МСК-87 зона 3 (6 градусная) Чукотский автономный округ    +proj=tmerc +lat_0=0 +lon_0=156.45 +k=1 +x_0=3400000 +y_0=-6212900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 87, зона 4":"+title= МСК-87 зона 4 (6 градусная) Чукотский автономный округ    +proj=tmerc +lat_0=0 +lon_0=162.45 +k=1 +x_0=4400000 +y_0=-6212900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 87, зона 5":"+title= МСК-87 зона 5 (6 градусная) Чукотский автономный округ    +proj=tmerc +lat_0=0 +lon_0=168.45 +k=1 +x_0=5400000 +y_0=-6212900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 87, зона 6":"+title= МСК-87 зона 6 (6 градусная) Чукотский автономный округ    +proj=tmerc +lat_0=0 +lon_0=174.45 +k=1 +x_0=6400000 +y_0=-6212900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 87, зона 7":"+title= МСК-87 зона 7 (6 градусная) Чукотский автономный округ    +proj=tmerc +lat_0=0 +lon_0=180.45 +k=1 +x_0=7400000 +y_0=-6212900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","МСК 87, зона 8":"+title= МСК-87 зона 8 (6 градусная) Чукотский автономный округ    +proj=tmerc +lat_0=0 +lon_0=186.45 +k=1 +x_0=8400000 +y_0=-6212900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район C, зона 1":"+title= СК-1963 район C зона 1    +proj=tmerc +lat_0=0 +lon_0=24.95 +k=1 +x_0=1250000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район C, зона 2":"+title= СК-1963 район C зона 2    +proj=tmerc +lat_0=0 +lon_0=27.95 +k=1 +x_0=2250000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район C, зона 3":"+title= СК-1963 район C зона 3    +proj=tmerc +lat_0=0 +lon_0=30.95 +k=1 +x_0=3250000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район C, зона 4":"+title= СК-1963 район C зона 4    +proj=tmerc +lat_0=0 +lon_0=33.95 +k=1 +x_0=4250000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район C, зона 5":"+title= СК-1963 район C зона 5    +proj=tmerc +lat_0=0 +lon_0=36.95 +k=1 +x_0=5250000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район C, зона 6":"+title= СК-1963 район C зона 6    +proj=tmerc +lat_0=0 +lon_0=39.95 +k=1 +x_0=6250000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район D, зона 1":"+title= СК-1963 район D зона 1    +proj=tmerc +lat_0=0 +lon_0=38.55 +k=1 +x_0=1250000 +y_0=-14743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район D, зона 2":"+title= СК-1963 район D зона 2    +proj=tmerc +lat_0=0 +lon_0=41.55 +k=1 +x_0=2250000 +y_0=-14743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район D, зона 3":"+title= СК-1963 район D зона 3    +proj=tmerc +lat_0=0 +lon_0=44.55 +k=1 +x_0=3250000 +y_0=-14743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район D, зона 4":"+title= СК-1963 район D зона 4    +proj=tmerc +lat_0=0 +lon_0=47.55 +k=1 +x_0=4250000 +y_0=-14743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район D, зона 5":"+title= СК-1963 район D зона 5    +proj=tmerc +lat_0=0 +lon_0=50.55 +k=1 +x_0=5250000 +y_0=-14743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район D, зона 6":"+title= СК-1963 район D зона 6    +proj=tmerc +lat_0=0 +lon_0=53.55 +k=1 +x_0=6250000 +y_0=-14743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район D, зона 7":"+title= СК-1963 район D зона 7    +proj=tmerc +lat_0=0 +lon_0=56.55 +k=1 +x_0=7250000 +y_0=-14743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район D, зона 8":"+title= СК-1963 район D зона 8    +proj=tmerc +lat_0=0 +lon_0=59.55 +k=1 +x_0=8250000 +y_0=-14743.504 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район F, зона 1":"+title= СК-1963 район F зона 1    +proj=tmerc +lat_0=0 +lon_0=97.033333333333 +k=1 +x_0=1250000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район F, зона 2":"+title= СК-1963 район F зона 2    +proj=tmerc +lat_0=0 +lon_0=100.033333333333 +k=1 +x_0=2250000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район F, зона 3":"+title= СК-1963 район F зона 3    +proj=tmerc +lat_0=0 +lon_0=103.033333333333 +k=1 +x_0=3250000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район G, зона 1":"+title= СК-1963 район G зона 1    +proj=tmerc +lat_0=0 +lon_0=121.71666666667 +k=1 +x_0=1300000 +y_0=-16586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район G, зона 2":"+title= СК-1963 район G зона 2    +proj=tmerc +lat_0=0 +lon_0=124.71666666667 +k=1 +x_0=2300000 +y_0=-16586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район G, зона 3":"+title= СК-1963 район G зона 3    +proj=tmerc +lat_0=0 +lon_0=127.71666666667 +k=1 +x_0=3300000 +y_0=-16586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район G, зона 4":"+title= СК-1963 район G зона 4    +proj=tmerc +lat_0=0 +lon_0=130.71666666667 +k=1 +x_0=4300000 +y_0=-16586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район G, зона 5":"+title= СК-1963 район G зона 5    +proj=tmerc +lat_0=0 +lon_0=133.71666666667 +k=1 +x_0=5300000 +y_0=-16586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район G, зона 6":"+title= СК-1963 район G зона 6    +proj=tmerc +lat_0=0 +lon_0=136.71666666667 +k=1 +x_0=6300000 +y_0=-16586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район G, зона 7":"+title= СК-1963 район G зона 7    +proj=tmerc +lat_0=0 +lon_0=139.71666666667 +k=1 +x_0=7300000 +y_0=-16586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район G, зона 8":"+title= СК-1963 район G зона 8    +proj=tmerc +lat_0=0 +lon_0=142.71666666667 +k=1 +x_0=8300000 +y_0=-16586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район G, зона 9":"+title= СК-1963 район G зона 9    +proj=tmerc +lat_0=0 +lon_0=145.71666666667 +k=1 +x_0=9300000 +y_0=-16586.44 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район I, зона 1":"+title= СК-1963 район I зона 1    +proj=tmerc +lat_0=0 +lon_0=71.73333333333 +k=1 +x_0=1250000 +y_0=-12900.60 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район I, зона 2":"+title= СК-1963 район I зона 2    +proj=tmerc +lat_0=0 +lon_0=74.73333333333 +k=1 +x_0=2250000 +y_0=-12900.60 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район I, зона 3":"+title= СК-1963 район I зона 3    +proj=tmerc +lat_0=0 +lon_0=77.73333333333 +k=1 +x_0=3250000 +y_0=-12900.60 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район I, зона 4":"+title= СК-1963 район I зона 4    +proj=tmerc +lat_0=0 +lon_0=80.73333333333 +k=1 +x_0=4250000 +y_0=-12900.60 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район I, зона 5":"+title= СК-1963 район I зона 5    +proj=tmerc +lat_0=0 +lon_0=83.73333333333 +k=1 +x_0=5250000 +y_0=-12900.60 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район I, зона 6":"+title= СК-1963 район I зона 6    +proj=tmerc +lat_0=0 +lon_0=86.73333333333 +k=1 +x_0=6250000 +y_0=-12900.60 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район L, зона 1":"+title= СК-1963 район L зона 1 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=81.51666666667 +k=1 +x_0=1500000 +y_0=-16586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район L, зона 2":"+title= СК-1963 район L зона 2 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=87.51666666667 +k=1 +x_0=2500000 +y_0=-16586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район L, зона 3":"+title= СК-1963 район L зона 3 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=93.51666666667 +k=1 +x_0=3500000 +y_0=-16586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район L, зона 4":"+title= СК-1963 район L зона 4 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=99.51666666667 +k=1 +x_0=4500000 +y_0=-16586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район L, зона 5":"+title= СК-1963 район L зона 5 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=105.51666666667 +k=1 +x_0=5500000 +y_0=-16586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район L, зона 6":"+title= СК-1963 район L зона 6 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=111.51666666667 +k=1 +x_0=6500000 +y_0=-16586.442 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район M, зона 1":"+title= СК-1963 район M зона 1    +proj=tmerc +lat_0=0 +lon_0=79.466666666677 +k=1 +x_0=1300000 +y_0=-12900.57 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район M, зона 2":"+title= СК-1963 район M зона 2    +proj=tmerc +lat_0=0 +lon_0=82.466666666677 +k=1 +x_0=2300000 +y_0=-12900.57 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район M, зона 3":"+title= СК-1963 район M зона 3    +proj=tmerc +lat_0=0 +lon_0=85.466666666677 +k=1 +x_0=3300000 +y_0=-12900.57 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район M, зона 4":"+title= СК-1963 район M зона 4    +proj=tmerc +lat_0=0 +lon_0=88.466666666677 +k=1 +x_0=4300000 +y_0=-12900.57 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район P, зона 1":"+title= СК-1963 район P зона 1    +proj=tmerc +lat_0=0 +lon_0=32.48333333333 +k=1 +x_0=1250000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район P, зона 2":"+title= СК-1963 район P зона 2    +proj=tmerc +lat_0=0 +lon_0=35.48333333333 +k=1 +x_0=2250000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район P, зона 3":"+title= СК-1963 район P зона 3    +proj=tmerc +lat_0=0 +lon_0=38.48333333333 +k=1 +x_0=3250000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район P, зона 4":"+title= СК-1963 район P зона 4    +proj=tmerc +lat_0=0 +lon_0=41.48333333333 +k=1 +x_0=4250000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район Q, зона 1":"+title= СК-1963 район Q зона 1 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=32.03333333333 +k=1 +x_0=1400000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район Q, зона 2":"+title= СК-1963 район Q зона 2 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=38.03333333333 +k=1 +x_0=2400000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район Q, зона 3":"+title= СК-1963 район Q зона 3 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=44.03333333333 +k=1 +x_0=3400000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район Q, зона 4":"+title= СК-1963 район Q зона 4 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=50.03333333333 +k=1 +x_0=4400000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район Q, зона 5":"+title= СК-1963 район Q зона 5 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=56.03333333333 +k=1 +x_0=5400000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район R, зона 1":"+title= СК-1963 район R зона 1    +proj=tmerc +lat_0=0 +lon_0=43.05 +k=1 +x_0=1300000 +y_0=-14743.501 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район R, зона 2":"+title= СК-1963 район R зона 2    +proj=tmerc +lat_0=0 +lon_0=46.05 +k=1 +x_0=2300000 +y_0=-14743.501 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район R, зона 3":"+title= СК-1963 район R зона 3    +proj=tmerc +lat_0=0 +lon_0=49.05 +k=1 +x_0=3300000 +y_0=-14743.501 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 1":"+title= СК-1963 район S зона 1 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=108.45 +k=1 +x_0=1400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 2":"+title= СК-1963 район S зона 2 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=114.45 +k=1 +x_0=2400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 3":"+title= СК-1963 район S зона 3 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=120.45 +k=1 +x_0=3400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 4":"+title= СК-1963 район S зона 4 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=126.45 +k=1 +x_0=4400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 5":"+title= СК-1963 район S зона 5 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=132.45 +k=1 +x_0=5400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 6":"+title= СК-1963 район S зона 6 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=138.45 +k=1 +x_0=6400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 7":"+title= СК-1963 район S зона 7 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=144.45 +k=1 +x_0=7400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 8":"+title= СК-1963 район S зона 8 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=150.45 +k=1 +x_0=8400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 9":"+title= СК-1963 район S зона 9 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=156.45 +k=1 +x_0=9400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 10":"+title= СК-1963 район S зона 10 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=162.45 +k=1 +x_0=10400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 11":"+title= СК-1963 район S зона 11 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=168.45 +k=1 +x_0=11400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 12":"+title= СК-1963 район S зона 12 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=174.45 +k=1 +x_0=12400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район S, зона 13":"+title= СК-1963 район S зона 13 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=180.45 +k=1 +x_0=13400000 +y_0=-12900.566 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район T, зона 1":"+title= СК-1963 район T зона 1    +proj=tmerc +lat_0=0 +lon_0=37.98333333333 +k=1 +x_0=1300000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район T, зона 2":"+title= СК-1963 район T зона 2    +proj=tmerc +lat_0=0 +lon_0=40.98333333333 +k=1 +x_0=2300000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район T, зона 3":"+title= СК-1963 район T зона 3    +proj=tmerc +lat_0=0 +lon_0=43.98333333333 +k=1 +x_0=3300000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район T, зона 4":"+title= СК-1963 район T зона 4    +proj=tmerc +lat_0=0 +lon_0=46.98333333333 +k=1 +x_0=4300000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район V, зона 1":"+title= СК-1963 район V зона 1    +proj=tmerc +lat_0=0 +lon_0=49.03333333333 +k=1 +x_0=1300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район V, зона 2":"+title= СК-1963 район V зона 2    +proj=tmerc +lat_0=0 +lon_0=52.03333333333 +k=1 +x_0=2300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район V, зона 3":"+title= СК-1963 район V зона 3    +proj=tmerc +lat_0=0 +lon_0=55.03333333333 +k=1 +x_0=3300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район V, зона 4":"+title= СК-1963 район V зона 4    +proj=tmerc +lat_0=0 +lon_0=58.03333333333 +k=1 +x_0=4300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район V, зона 5":"+title= СК-1963 район V зона 5    +proj=tmerc +lat_0=0 +lon_0=61.03333333333 +k=1 +x_0=5300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район V, зона 6":"+title= СК-1963 район V зона 6    +proj=tmerc +lat_0=0 +lon_0=64.03333333333 +k=1 +x_0=6300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район W, зона 1":"+title= СК-1963 район W зона 1 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=60.05 +k=1 +x_0=1500000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район W, зона 2":"+title= СК-1963 район W зона 2 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=66.05 +k=1 +x_0=2500000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район W, зона 3":"+title= СК-1963 район W зона 3 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=72.05 +k=1 +x_0=3500000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район W, зона 4":"+title= СК-1963 район W зона 4 (6-ти градусная)    +proj=tmerc +lat_0=0 +lon_0=78.05 +k=1 +x_0=4500000 +y_0=-11057.628 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район X, зона 1":"+title= СК-1963 район X зона 1    +proj=tmerc +lat_0=0 +lon_0=23.05 +k=1 +x_0=1300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район X, зона 2":"+title= СК-1963 район X зона 2    +proj=tmerc +lat_0=0 +lon_0=26.05 +k=1 +x_0=2300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район X, зона 3":"+title= СК-1963 район X зона 3    +proj=tmerc +lat_0=0 +lon_0=29.05 +k=1 +x_0=3300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район X, зона 4":"+title= СК-1963 район X зона 4    +proj=tmerc +lat_0=0 +lon_0=32.05 +k=1 +x_0=4300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район X, зона 5":"+title= СК-1963 район X зона 5    +proj=tmerc +lat_0=0 +lon_0=35.05 +k=1 +x_0=5300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","СК-1963 район X, зона 6":"+title= СК-1963 район X зона 6    +proj=tmerc +lat_0=0 +lon_0=38.05 +k=1 +x_0=6300000 +y_0=-9414.70 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 2":"+title= Пулково 1942 зона 2 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=9 +k=1 +x_0=2500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 3":"+title= Пулково 1942 зона 3 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=15 +k=1 +x_0=3500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 4":"+title= Пулково 1942 зона 4 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=21 +k=1 +x_0=4500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 5":"+title= Пулково 1942 зона 5 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=27 +k=1 +x_0=5500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 6":"+title= Пулково 1942 зона 6 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=33 +k=1 +x_0=6500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 7":"+title= Пулково 1942 зона 7 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=39 +k=1 +x_0=7500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 8":"+title= Пулково 1942 зона 8 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=45 +k=1 +x_0=8500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 9":"+title= Пулково 1942 зона 9 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=51 +k=1 +x_0=9500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 10":"+title= Пулково 1942 зона 10 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=57 +k=1 +x_0=10500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 11":"+title= Пулково 1942 зона 11 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=63 +k=1 +x_0=11500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 12":"+title= Пулково 1942 зона 12 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=69 +k=1 +x_0=12500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 13":"+title= Пулково 1942 зона 13 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=75 +k=1 +x_0=13500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 14":"+title= Пулково 1942 зона 14 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=81 +k=1 +x_0=14500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 15":"+title= Пулково 1942 зона 15 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=87 +k=1 +x_0=15500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 16":"+title= Пулково 1942 зона 16 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=93 +k=1 +x_0=16500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 17":"+title= Пулково 1942 зона 17 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=99 +k=1 +x_0=17500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 18":"+title= Пулково 1942 зона 18 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=105 +k=1 +x_0=18500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 19":"+title= Пулково 1942 зона 19 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=111 +k=1 +x_0=19500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 20":"+title= Пулково 1942 зона 20 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=117 +k=1 +x_0=20500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 21":"+title= Пулково 1942 зона 21 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=123 +k=1 +x_0=21500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 22":"+title= Пулково 1942 зона 22 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=129 +k=1 +x_0=22500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 23":"+title= Пулково 1942 зона 23 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=135 +k=1 +x_0=23500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 24":"+title= Пулково 1942 зона 24 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=141 +k=1 +x_0=24500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 25":"+title= Пулково 1942 зона 25 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=147 +k=1 +x_0=25500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 26":"+title= Пулково 1942 зона 26 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=153 +k=1 +x_0=26500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 27":"+title= Пулково 1942 зона 27 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=159 +k=1 +x_0=27500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 28":"+title= Пулково 1942 зона 28 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=165 +k=1 +x_0=28500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 29":"+title= Пулково 1942 зона 29 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=171 +k=1 +x_0=29500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Пулково 1942, зона 30":"+title= Пулково 1942 зона 30 ГОСТ 51794-2008   +proj=tmerc +lat_0=0 +lon_0=177 +k=1 +x_0=30500000 +y_0=0 +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +units=m +no_defs","Pulkovo 1942":"+title= Pulkovo 1942    +proj=longlat +ellps=krass +towgs84=23.92,-141.27,-80.9,-0,0.35,0.82,-0.12 +no_defs","Pulkovo 1942 ГОСТ 51794-2008":"+title= Pulkovo 1942 ГОСТ 51794-2008    +proj=longlat +ellps=krass +towgs84=23.57,-140.95,-79.8,0,0.35,0.79,-0.22 +no_defs","ПЗ-90":"+title= ПЗ-90    +proj=longlat +a=6378136 +b=6356751.361745712 +towgs84=0,0,1.5,-0,-0,0.076,0 +no_defs"},childKeys:["OMSPoints","ObjectsRealty","Parcels","Zones"],skipKeys:{EntitySpatial:!0,CoordSystems:!0,SpatialData:!0}};t.childKeys.forEach(function(e){t.skipKeys[e]=!0}),window.CAD=window.CAD||{},window.CAD.DEFAULTS=t}(),MapExpress.Mapping.RasterUtils={generateWldFileHref:function(e,t,r){var o;o=r?[r.project(e[0]),r.project(e[1])]:[L.CRS.EPSG3857.project(e[0]),L.CRS.EPSG3857.project(e[1])];var s=this.getPixelSizeXY(o,t),i=this.getOPointXY(o);if(s&&i){var a=[s.x,0,0,s.y,i.x,i.y].toString();return"data:text/plain;charset=utf-8,"+encodeURIComponent(a.replace(new RegExp(",","g"),"\r\n"))}},getPixelSizeXY:function(e,t){var r={};return r.x=(e[1].x-e[0].x)/t.width,r.y=-(e[1].y-e[0].y)/t.height,r},getOPointXY:function(e){var t={};return t.x=e[0].x,t.y=e[1].y,t},generateMapInfoWldFileHref:function(e,t,r,o,s){var i,a,n,l,p="!Table  !version 300  !charset Neutral    Definition Table___".replace(new RegExp("  ","g"),"\r\n");if(void 0===r&&(r="Export.jpg"),o){var d=L.latLng(e[1].lat,e[0].lng),c=L.latLng(e[0].lat,e[1].lng),h=L.latLng(e[0].lat,e[0].lng),u=L.latLng(e[1].lat,e[1].lng);l=[o.project(d),o.project(c),o.project(h),o.project(u)]}else l=[{x:(n=[L.CRS.EPSG3857.project(e[0]),L.CRS.EPSG3857.project(e[1])])[0].x,y:n[1].y},{x:n[1].x,y:n[0].y},n[0],n[1]];var m=(';;File;"'+r+'",.,;;Type;"RASTER",.,;;('+l[0].x+",;"+l[0].y+');(0,0);Label;"Point;1",,.,;;('+l[1].x+",;"+l[1].y+");("+t.width+",;"+t.height+');Label;"Point;2",,.,;;('+l[2].x+",;"+l[2].y+");(0,;"+t.height+');Label;"Point;3",,.,;;('+l[3].x+",;"+l[3].y+");("+t.width+',;0);Label;"Point;4"___').replace(new RegExp(",.,","g"),"\r\n").replace(new RegExp(";","g")," ");if(o)if("EPSG:3857"===o.code)i='CoordSys Earth Projection 10, 157, "m", 0___',a='Units "m"___';else if("EPSG:3395"===o.code)i='CoordSys Earth Projection 1, 157, "m", 0___',a='Units "m"___';else if("EPSG:4326"===o.code)i="CoordSys Earth Projection 1, 104___",a='Units "degree"___';else{for(var g,_=o.projection._proj.defData.split("+"),f=0;f<_.length;f++)-1!==_[f].indexOf("towgs84")&&(g=_[f].split(","));var y="3";o.projection._proj.ellps&&"bessel"===o.projection._proj.ellps&&(y="10"),a='Units "m"___';try{i="CoordSys Earth Projection 8, 9999, "+y+", "+v(g[0].split("=")[1])+", "+v(g[1])+", "+v(g[2])+", "+v(g[3])+", "+v(-g[4])+", "+v(-g[5])+", "+v(g[6])+", 0, 7,"+57.29577951308231*o.projection._proj.long0+", "+o.projection._proj.lat0+", "+o.projection._proj.k0+", "+o.projection._proj.x0+", "+o.projection._proj.y0+"___"}catch(e){i='CoordSys Earth Projection 10, 157, "m", 0___',a='Units "m"___'}}else i='CoordSys Earth Projection 10, 157, "m", 0___',a='Units "m"___';if(void 0!==m){var x="";return x=s?p+m+'CoordSys Nonearth Units "m" Bounds ( -100000000, -100000000) ( 100000000, 100000000)___':p+m+i+a,"data:text/plain;charset=utf-8,"+encodeURIComponent(x.replace(new RegExp("___","g"),"\r\n"))}function v(e){return e.toString().replace(" ","")}}},MapExpress.Mapping.GeoUtil={lineStringLength:function(e){for(var t=0,r=e._latlngs.length,o=1;o<r;o++)t+=e._latlngs[o].distanceTo(e._latlngs[o-1]);return t},lineStringContainsPoint:function(e,t){var r,o,s,i,a,n,l=window.MapManager._map.containerPointToLayerPoint(window.MapManager._map.latLngToContainerPoint(t));if(!e._parts)return!1;for(r=0,i=e._parts.length;r<i;r++)for(o=0,s=(a=(n=e._parts[r]).length)-1;o<a;s=o++)if(L.LineUtil.pointToSegmentDistance(l,n[s],n[o])<=5)return!0;return!1},circleMarkerContainsPoint:function(e,t){var r=window.MapManager._map.containerPointToLayerPoint(window.MapManager._map.latLngToContainerPoint(t));return e._containsPoint(r)},belongsSegment:function(e,t,r,o){o=void 0===o?.2:o;var s=t.distanceTo(r);return(t.distanceTo(e)+e.distanceTo(r)-s)/s<o},findIntersectedLayersByBBox:function(e,r,t){this.map=t;var o=[],s=this;return e.eachLayer(function(e){var t=s._findIntersectedEachLayerByBBox(e,r);"within"!==t&&"overlaps"!==t||o.push(e)}),o},_findIntersectedEachLayerByBBox:function(e,t){var r,o,s;s=this._reFormBboxCords(t),"Point"===(o=e.feature.geometry).type?r=this._isSinglePointInsideBBox(o.coordinates,s):"LineString"===o.type?r=this._isMultiPointInsideBBox(o.coordinates,s):"Polygon"===o.type?r=this._isMultiPointInsideBBox(o.coordinates[0],s):"MultiPoint"===o.type?r=this._isMultiPointInsideBBox(o.coordinates,s):"MultiLineString"===o.type?r=this._isMultiPointInsideBBox(o.coordinates,s):"MultiPolygon"===o.type&&(r=this._isMultiPointInsideBBox(o.coordinates[0],s));var i=this._intersectionByBBoxParseResult(r);if("no intersects"===i&&"Point"!==o.type&&"MultiPoint"!==o.type){var a={type:"Polygon",coordinates:[s]};0<this._crossCheck(a,e).length&&(i="overlaps")}return("no intersects"===i&&"Polygon"===o.type||"no intersects"===i&&"MultiPoint"===o.type)&&(i=this._intersectionByBBoxParseResult(this._isMultiPointInsideBBox(s,o.coordinates[0]))),i},_reFormBboxCords:function(e){var t=[];return e._southWest&&(t[0]=[e._southWest.lng,e._northEast.lat],t[1]=[e._northEast.lng,e._northEast.lat],t[2]=[e._northEast.lng,e._southWest.lat],t[3]=[e._southWest.lng,e._southWest.lat]),t},_isSinglePointInsideBBox:function(e,t){return this._pointIntersectionMath(e,t)},_isMultiPointInsideBBox:function(e,t){for(var r=[],o=0;o<e.length;o++)r.push(this._pointIntersectionMath(e[o],t));return r},_pointIntersectionMath:function(e,t){for(var r=e[0],o=e[1],s=!1,i=0,a=t.length-1;i<t.length;a=i++){var n=t[i][0],l=t[i][1],p=t[a][0],d=t[a][1];o<l!=o<d&&r<(p-n)*(o-l)/(d-l)+n&&(s=!s)}return s},_intersectionByBBoxParseResult:function(e){return!0===e&&"boolean"==typeof e?"within":!1===e&&"boolean"==typeof e?"no intersects":e.constructor===Array?(e.sort(),e[0]===e[e.length-1]&&!0===e[0]?"within":e[0]===e[e.length-1]&&!1===e[0]?"no intersects":"overlaps"):void 0},_crossCheck:function(e,t){var r=t.toGeoJSON(),o=this._lineify(e),s=this._lineify(r),i=[];if(o&&s)for(var a in s.geometries)for(var n in o.geometries){var l=this._lineStringsIntersect(s.geometries[a],o.geometries[n]);if(l)for(var p in l)i.push(l[p])}return i},_lineify:function(e){var t,r={type:"GeometryCollection",geometries:[]};switch(e.type){case"GeometryCollection":for(var o in e.geometries)if(t=this._lineify(e.geometries[o]))for(var s in t.geometries)r.geometries.push(t.geometries[s]);else r=!1;break;case"Feature":if(t=this._lineify(e.geometry))for(var i in t.geometries)r.geometries.push(t.geometries[i]);else r=!1;break;case"FeatureCollection":for(var a in e.features)if(t=this._lineify(e.features[a].geometry))for(var n in t.geometries)r.geometries.push(t.geometries[n]);else r=!1;break;case"LineString":r.geometries.push(e);break;case"MultiLineString":case"Polygon":for(var l in e.coordinates)r.geometries.push({type:"LineString",coordinates:e.coordinates[l]});break;case"MultiPolygon":for(var p in e.coordinates)for(var d in e.coordinates[p])r.geometries.push({type:"LineString",coordinates:e.coordinates[p][d]});break;default:r=!1}return r},_lineStringsIntersect:function(e,t){for(var r=[],o=0;o<=e.coordinates.length-2;++o)for(var s=0;s<=t.coordinates.length-2;++s){var i=L.latLng(e.coordinates[o][1],e.coordinates[o][0]),a=L.latLng(e.coordinates[o+1][1],e.coordinates[o+1][0]),n=L.latLng(t.coordinates[s][1],t.coordinates[s][0]),l=L.latLng(t.coordinates[s+1][1],t.coordinates[s+1][0]),p=L.Projection.SphericalMercator.project(i),d=L.Projection.SphericalMercator.project(a),c=L.Projection.SphericalMercator.project(n),h=L.Projection.SphericalMercator.project(l),u=(h.x-c.x)*(p.y-c.y)-(h.y-c.y)*(p.x-c.x),m=(d.x-p.x)*(p.y-c.y)-(d.y-p.y)*(p.x-c.x),g=(h.y-c.y)*(d.x-p.x)-(h.x-c.x)*(d.y-p.y);if(0!==g){var _=u/g,f=m/g;if(0<=_&&_<=1&&0<=f&&f<=1){var y={x:p.x+_*(d.x-p.x),y:p.y+_*(d.y-p.y)},x=L.Projection.SphericalMercator.unproject(y);r.push({intersection:new L.LatLng(x.lat,x.lng)})}}}return 0===r.length&&(r=!1),r},findIntersectedLayerByCircle:function(e,r,o,t){this.map=t;var s=[],i=this;return e.eachLayer(function(e){var t=i.findIntersectedEachLayerByCircle(r,o,e);"within"!==t&&"overlaps"!==t||s.push(e)}),s},_findIntersectedEachLayerByCircle:function(e,t,r){var o,s,i;if("Point"===(s=r.feature.geometry).type?o=this._isSinglePointInsideCircle(s.coordinates,e,t):"LineString"===s.type?o=this._isMultiPointInsideCircle(s.coordinates,e,t):"Polygon"===s.type?o=this._isMultiPointInsideCircle(s.coordinates[0],e,t):"MultiPoint"===s.type?o=this._isMultiPointInsideCircle(s.coordinates,e,t):"MultiLineString"===s.type?o=this._isMultiPointInsideCircle(s.coordinates,e,t):"MultiPolygon"===s.type&&(o=this._isMultiPointInsideCircle(s.coordinates[0],e,t)),"no intersects"===(i=this.parseResult(o))&&"Point"!==s.type){var a=this._circleCrossCheck(e,t,r);i=this._intersectionByCircleParseResult(a)}return i},_isSinglePointInsideCircle:function(e,t,r){return new L.LatLng(t[0],t[1]).distanceTo(new L.LatLng(e[1],e[0]))<r},_isMultiPointInsideCircle:function(e,t,r){for(var o=[],s=0;s<e.length;s++)o.push(this._isSinglePointInsideCircle(e[s],t,r));return o},_circleCrossCheck:function(e,t,r){var o=r.toGeoJSON(),s=this._lineify(o),i=[];if(e&&t&&s)for(var a=0;a<=s.geometries[0].coordinates.length-2;a++){var n=L.latLng(s.geometries[0].coordinates[a][1],s.geometries[0].coordinates[a][0]),l=L.latLng(s.geometries[0].coordinates[a+1][1],s.geometries[0].coordinates[a+1][0]),p=L.latLng(e[0],e[1]);i.push(this._getIntersectionsMathABCR(n,l,p,t).intersects)}return i},_getIntersectionsMathABCR:function(e,t,r,o){var s=this.map.getMaxZoom();s===1/0&&(s=this.map.getZoom());var i=this.map.project(r,s),a=this.map.project(e,s),n=this.map.project(t,s),l=L.LineUtil.closestPointOnSegment(i,a,n),p=this.map.unproject(i,s).distanceTo(this.map.unproject(l,s));if(p<o){var d=a.distanceTo(n,s),c=i.distanceTo(l,s),h=[(n.x-a.x)/d,(n.y-a.y)/d],u=h[0]*(i.x-a.x)+h[1]*(i.y-a.y),m=Math.sqrt(Math.pow(c/p*o,2)-Math.pow(c,2)),g={},_={};return g.x=(u-m)*h[0]+a.x,g.y=(u-m)*h[1]+a.y,_.x=(u+m)*h[0]+a.x,_.y=(u+m)*h[1]+a.y,{intersects:!0,nearestPoint:this.map.unproject(l,s),intersection1:this.map.unproject(new L.Point(g.x,g.y),s),intersection2:this.map.unproject(new L.Point(_.x,_.y),s)}}return p===o?{intersects:!0,nearestPoint:this.map.unproject(l,s),intersection1:this.map.unproject(l,s)}:{intersects:!1}},_intersectionByCircleParseResult:function(e){return!0===e&&"boolean"==typeof e?"within":!1===e&&"boolean"==typeof e?"no intersects":e.constructor===Array?(e.sort(),e[0]===e[e.length-1]&&!0===e[0]?"overlaps":e[0]===e[e.length-1]&&!1===e[0]?"no intersects":"overlaps"):void 0},getGeoJSONFeatureSelfIntersects:function(e){var t,r,v=[];if("LineString"===(r="Feature"===e.type?e.geometry:e).type)t=[r.coordinates];else if("MultiLineString"===r.type)t=r.coordinates;else if("MultiPolygon"===r.type)t=[].concat.apply([],r.coordinates);else{if("Polygon"!==r.type)throw new Error("Не допустимый тип геометрии");t=r.coordinates}return t.forEach(function(x){t.forEach(function(e){for(var t=0;t<x.length-1;t++)for(var r=0;r<e.length-1;r++)if(x!==e||1!==Math.abs(t-r)&&Math.abs(t-r)!==x.length-2){var o=(a=x[t][0],n=x[t][1],l=x[t+1][0],p=x[t+1][1],d=e[r][0],c=e[r][1],h=e[r+1][0],u=e[r+1][1],y=f=_=g=m=void 0,y={x:null,y:null,onLine1:!1,onLine2:!1},0==(m=(u-c)*(l-a)-(h-d)*(p-n))?null!==y.x&&null!==y.y&&y:(f=(l-a)*(g=n-c)-(p-n)*(_=a-d),g=((h-d)*g-(u-c)*_)/m,_=f/m,y.x=a+g*(l-a),y.y=n+g*(p-n),0<=g&&g<=1&&(y.onLine1=!0),0<=_&&_<=1&&(y.onLine2=!0),!(!y.onLine1||!y.onLine2)&&[y.x,y.y]));if(o){for(var s=!1,i=v.length-1;0<=i;i--)v[i][0]===o[0]&&v[i][1]===o[1]&&(s=!0);s||v.push([o[0],o[1]])}}var a,n,l,p,d,c,h,u,m,g,_,f,y})}),v},isGeoJSONFeatureSelfIntersects:function(e){return!!this.getGeoJSONFeatureSelfIntersects(e).length}},MapExpress.Search.BaseSearchProvider=L.Class.extend({initialize:function(e,t){this.map=e,this.name=t},getName:function(e){return this.name},getDataByMask:function(e){},getDataByMaskAsynch:function(e){},processResult:function(e,t){if(s.call(this),"Point"===(e.geojson||e.geometry).type){t={iconSize:[12,12],color:"blue"};var r=[];r[0]=(e.geojson||e.geometry).coordinates[1],r[1]=(e.geojson||e.geometry).coordinates[0],this.map.setView(r,17),this.resultLayer=MapManager.addPulseMarker(r,5e3,t)}else{var o=t.drawStyleOptions;this.resultLayer=L.geoJson(e.geojson||e.geometry,{style:o}).addTo(this.map),this.map.fitBounds(this.resultLayer.getBounds())}function s(){this.resultLayer&&(MapManager._map.removeLayer(this.resultLayer),delete this.resultLayer)}20<this.map.getZoom()&&this.map.setZoom(19),window.setTimeout(s.bind(this),5e3)}}),MapExpress.Search.GeojsonSearchProvider=MapExpress.Search.BaseSearchProvider.extend({initialize:function(e,t,r){MapExpress.Search.BaseSearchProvider.prototype.initialize.call(this,e,t),this.geojsonLayer=r.layer,this.attributeKey=r.attributeKey},getDataByMaskAsynch:function(o){var e=$.Deferred(),s=[],i=this;function a(e,t){if(-1<e.feature.properties[t].toString().toLowerCase().indexOf(o.toString().toLowerCase())){e.feature.display_name=e.feature.properties[t],e.feature.geojson=e.feature.geometry,e.feature.leafletId=e._leaflet_id;for(var r=s.length-1;0<=r;r--)if(s[r].leafletId===e._leaflet_id)return;s.push(e.feature)}}return setTimeout(function(){i.geojsonLayer.eachLayer(function(e){if("[object Array]"===Object.prototype.toString.call(i.attributeKey))for(var t=0;t<i.attributeKey.length;t++)e.feature.properties[i.attributeKey[t]]&&a.call(i,e,i.attributeKey[t]);else if(void 0===i.attributeKey)for(var r in e.feature.properties)e.feature.properties[r]&&a.call(i,e,r);else a.call(i,e,i.attributeKey)}),e.resolve(s)},0),e.promise()}}),MapExpress.Search.GoogleSearchProvider=MapExpress.Search.BaseSearchProvider.extend({initialize:function(e,t){MapExpress.Search.BaseSearchProvider.prototype.initialize.call(this,e,t)},getDataByMaskAsynch:function(t){var s=$.Deferred();return function(){var e={address:t+"%",language:"ru",region:"ru",limit:24},r=[];function o(t){return Object.keys(t.geometry.location).map(function(e){return t.geometry.location[e]}).reverse()}$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?",type:"GET",data:e,async:!1,dataType:"json",success:function(e){if(0<e.results.length){for(var t=0;t<e.results.length;t++)r.push({id:e.results[t].index,display_name:e.results[t].formatted_address,type:"Feature",geojson:{type:"Point",coordinates:o(e.results[t])},properties:{addresscomponents:e.results[t].addresscomponents,bounds:e.results[t].geometry.bounds,viewport:e.results[t].geometry.viewport,types:e.results[t].types,place_id:e.results[t].place_id}});s.resolve(r)}else s.resolve([])},error:function(e){s.reject(" Failed: "+e)}})}(),s.promise()}}),MapExpress.Search.OsmSearchProvider=MapExpress.Search.BaseSearchProvider.extend({initialize:function(e,t){MapExpress.Search.BaseSearchProvider.prototype.initialize.call(this,e,t)},getDataByMaskAsynch:function(e){var t,r=$.Deferred();return t={q:e+"%",format:"json",limit:15,addressdetails:1,polygon_geojson:1},$.ajax({url:"http://nominatim.openstreetmap.org/search.php?",type:"GET",data:t,dataType:"json",success:function(e){r.resolve(e)},error:function(e){r.reject(" Failed: "+e)}}),r.promise()}}),MapExpress.Search.YandexSearchProvider=MapExpress.Search.BaseSearchProvider.extend({initialize:function(e,t){MapExpress.Search.BaseSearchProvider.prototype.initialize.call(this,e,t)},getDataByMaskAsynch:function(e){var t,r,o=$.Deferred();return t={geocode:e+"%",format:"json",results:24},r=[],$.ajax({url:"https://geocode-maps.yandex.ru/1.x/?",type:"GET",data:t,async:!1,dataType:"json",success:function(e){if(0<e.response.GeoObjectCollection.featureMember.length){for(var t=0;t<e.response.GeoObjectCollection.featureMember.length;t++)r.push({id:e.response.GeoObjectCollection.featureMember[t].index,display_name:e.response.GeoObjectCollection.featureMember[t].GeoObject.metaDataProperty.GeocoderMetaData.text,type:"Feature",geojson:{type:"Point",coordinates:e.response.GeoObjectCollection.featureMember[t].GeoObject.Point.pos.split(" ")},properties:{bounds:e.response.GeoObjectCollection.featureMember[t].GeoObject.boundedBy.Envelope,descr:e.response.GeoObjectCollection.featureMember[t].GeoObject.description,metaData:e.response.GeoObjectCollection.featureMember[t].GeoObject.metaDataProperty.GeocoderMetaData,names:e.response.GeoObjectCollection.featureMember[t].GeoObject.name}});o.resolve(r)}else o.resolve([])},error:function(e){o.reject(" Failed: "+e)}}),o.promise()}}),MapExpress.Utils.CadastreDictionary={dStates:{"01":"Ранее учтенный","03":"Условный","05":"Временный","04":"Внесенный","06":"Учтенный","07":"Снят с учета","08":"Аннулированный"},dParcels:{"01":"Землепользование","02":"Единое землепользование","03":"Обособленный участок","04":"Условный участок","05":"Многоконтурный участок","06":"Значение отсутствует"},dCategories:{"003001000000":"Земли сельскохозяйственного назначения","003002000000":"Земли населённых пунктов","003003000000":"Земли промышленности, энергетики, транспорта, связи, радиовещания, телевидения, информатики, земли для обеспечения космической деятельности, земли обороны, безопасности и земли иного специального назначения","003004000000":"Земли особо охраняемых территорий и объектов","003005000000":"Земли лесного фонда","003006000000":"Земли водного фонда","003007000000":"Земли запаса","003008000000":"Категория не установлена"},dEncumbrances:{"022001000000":"Сервитут","022001001000":"Публичный сервитут","022001002000":"Частный сервитут","022002000000":"Арест","022003000000":"Запрещение","022004000000":"Ограничения прав на земельный участок, предусмотренные статьями 56, 56.1 Земельного кодекса Российской Федерации","022005000000":"Решение об изъятии земельного участка, жилого помещения","022006000000":"Аренда (в том числе, субаренда)","022007000000":"Ипотека","022008000000":"Ипотека в силу закона","022009000000":"Безвозмездное (срочное) пользование земельным/лесным участком","022010000000":"Доверительное управление","022011000000":"Рента","022012000000":"Запрет на совершение действий в сфере ГКУ в отношении ОН","022099000000":"Иные ограничения (обременения) прав"},dUnits:{"003":"Миллиметр","004":"Сантиметр","005":"Дециметр","006":"Метр","008":"Километр","009":"Мегаметр","047":"Морская миля","050":"Квадратный миллиметр","051":"Квадратный сантиметр","053":"Квадратный дециметр","055":"Квадратный метр","058":"Тысяча квадратных метров","059":"Гектар","061":"Квадратный километр",109:"Ар (100 м2)",359:"Сутки",360:"Неделя",361:"Декада",362:"Месяц",364:"Квартал",365:"Полугодие",356:"Час",355:"Минута ",366:"Год",383:"Рубль",384:"Тысяча рублей",385:"Миллион рублей",386:"Миллиард рублей",1e3:"Неопределено",1001:"Значение отсутствует",1002:"Рублей за кв. метр",1003:"Рублей за ар",1004:"Рублей  за гектар",1005:"Иные",1006:"Рублей за кв. км",1007:"Рабочий день"},dUtilizations:{141e9:"Для размещения объектов сельскохозяйственного назначения и сельскохозяйственных угодий",141001e6:"Для сельскохозяйственного производства",14100101e4:"Для использования в качестве сельскохозяйственных угодий",14100102e4:"Для размещения зданий, строений, сооружений, используемых для производства, хранения и первичной переработки сельскохозяйственной продукции",14100103e4:"Для размещения внутрихозяйственных дорог и коммуникаций",14100104e4:"Для размещения водных объектов",141002e6:"Для ведения крестьянского (фермерского) хозяйства",141003e6:"Для ведения личного подсобного хозяйства",141004e6:"Для ведения гражданами садоводства и огородничества",141005e6:"Для ведения гражданами животноводства",141006e6:"Для дачного строительства",141007e6:"Для размещения древесно-кустарниковой растительности, предназначенной для защиты земель от воздействия негативных (вредных) природных, антропогенных и техногенных явлений",141008e6:"Для научно-исследовательских целей",141009e6:"Для учебных целей",14101e7:"Для сенокошения и выпаса скота гражданами",141011e6:"Фонд перераспределения",141012e6:"Для размещения объектов охотничьего хозяйства",141013e6:"Для размещения объектов рыбного хозяйства",141014e6:"Для иных видов сельскохозяйственного использования",142e9:"Для размещения объектов, характерных для населённых пунктов",142001e6:"Для объектов жилой застройки",14200101e4:"Для индивидуальной жилой застройки",14200102e4:"Для многоквартирной застройки",142001020100:"Для малоэтажной застройки",142001020200:"Для среднеэтажной застройки",142001020300:"Для многоэтажной застройки",142001020400:"Для иных видов жилой застройки",14200103e4:"Для размещения объектов дошкольного, начального, общего и среднего (полного) общего образования",14200104e4:"Для размещения иных объектов, допустимых в жилых зонах и не перечисленных в классификаторе",142002e6:"Для объектов общественно-делового значения",14200201e4:"Для размещения объектов социального и коммунально-бытового назначения",14200202e4:"Для размещения объектов здравоохранения",14200203e4:"Для размещения объектов культуры",14200204e4:"Для размещения объектов торговли",142002040100:"Для размещения объектов розничной торговли",142002040200:"Для размещения объектов оптовой торговли",14200205e4:"Для размещения объектов общественного питания",14200206e4:"Для размещения объектов предпринимательской деятельности",14200207e4:"Для размещения объектов среднего профессионального и высшего профессионального образования",14200208e4:"Для размещения административных зданий",14200209e4:"Для размещения научно-исследовательских учреждений",1420021e5:"Для размещения культовых зданий",14200211e4:"Для стоянок автомобильного транспорта",14200212e4:"Для размещения объектов делового назначения, в том числе офисных центров",14200213e4:"Для размещения объектов финансового назначения",14200214e4:"Для размещения гостиниц",14200215e4:"Для размещения подземных или многоэтажных гаражей",14200216e4:"Для размещения индивидуальных гаражей",14200217e4:"Для размещения иных объектов общественно-делового значения, обеспечивающих жизнь граждан",142003e6:"Для общего пользования (уличная сеть)",142004e6:"Для размещения объектов специального назначения",14200401e4:"Для размещения кладбищ",14200402e4:"Для размещения крематориев",14200403e4:"Для размещения скотомогильников",14200404e4:"Под объектами размещения отходов потребления",14200405e4:"Под иными объектами специального назначения",142005e6:"Для размещения коммунальных, складских объектов",142006e6:"Для размещения объектов жилищно-коммунального хозяйства",142007e6:"Для иных видов использования, характерных для населённых пунктов",143e9:"Для размещения объектов промышленности, энергетики, транспорта, связи, радиовещания, телевидения, информатики, обеспечения космической деятельности, обороны, безопасности и иного специального назначения",143001e6:"Для размещения промышленных объектов",14300101e4:"Для размещения производственных и административных зданий, строений, сооружений и обслуживающих их объектов",143001010100:"Для размещения производственных зданий",143001010200:"Для размещения коммуникаций",143001010300:"Для размещения подъездных путей",143001010400:"Для размещения складских помещений",143001010500:"Для размещения административных зданий",143001010600:"Для размещения культурно-бытовых зданий",143001010700:"Для размещения иных сооружений промышленности",14300102e4:"Для добычи и разработки полезных ископаемых",14300103e4:"Для размещения иных объектов промышленности",143002e6:"Для размещения объектов энергетики",14300201e4:"Для размещения электростанций и обслуживающих сооружений и объектов",143002010100:"Для размещения гидроэлектростанций",143002010200:"Для размещения атомных станций",143002010300:"Для размещения ядерных установок",143002010400:"Для размещения пунктов хранения ядерных материалов и радиоактивных веществ энергетики",143002010500:"Для размещения хранилищ радиоактивных отходов",143002010600:"Для размещения тепловых станций",143002010700:"Для размещения иных типов электростанций",143002010800:"Для размещения иных обслуживающих сооружений и объектов",14300202e4:"Для размещения объектов электросетевого хозяйства",143002020100:"Для размещения воздушных линий электропередачи",143002020200:"Для размещения наземных сооружений кабельных линий электропередачи",143002020300:"Для размещения подстанций",143002020400:"Для размещения распределительных пунктов",143002020500:"Для размещения других сооружений и объектов электросетевого хозяйства",14300203e4:"Для размещения иных объектов энергетики",143003e6:"Для размещения объектов транспорта",14300301e4:"Для размещения и эксплуатации объектов железнодорожного транспорта",143003010100:"Для размещения железнодорожных путей и их конструктивных элементов",143003010200:"Для размещения полос отвода железнодорожных путей",143003010300:"Для размещения, эксплуатации, расширения и реконструкции строений, зданий, сооружений, в том числе железнодорожных вокзалов, железнодорожных станций, а также устройств и других объектов, необходимых для эксплуатации, содержания, строительства, реконструкции, ремонта, развития наземных и подземных зданий, строений, сооружений, устройств и других объектов железнодорожного транспорта",143003010301:"Для размещения железнодорожных вокзалов",143003010302:"Для размещения железнодорожных станций",143003010303:"Для размещения устройств и других объектов, необходимых для эксплуатации, содержания, строительства, реконструкции, ремонта, развития наземных и подземных зданий, строений, сооружений, устройств и других объектов железнодорожного транспорта",14300302e4:"Для размещения и эксплуатации объектов автомобильного транспорта и объектов дорожного хозяйства",143003020100:"Для размещения автомобильных дорог и их конструктивных элементов",143003020200:"Для размещения полос отвода",143003020300:"Для размещения объектов дорожного сервиса в полосах отвода автомобильных дорог",143003020400:"Для размещения дорожных сооружений",143003020500:"Для размещения автовокзалов и автостанций",143003020600:"Для размещения иных объектов автомобильного транспорта и дорожного хозяйства",14300303e4:"Для размещения и эксплуатации объектов морского, внутреннего водного транспорта",143003030100:"Для размещения искусственно созданных внутренних водных путей",143003030200:"Для размещения морских и речных портов, причалов, пристаней",143003030300:"Для размещения иных объектов морского, внутреннего водного транспорта",143003030400:"Для выделения береговой полосы",14300304e4:"Для размещения и эксплуатации объектов воздушного транспорта",143003040100:"Для размещения аэропортов и аэродромов",143003040200:"Для размещения аэровокзалов",143003040300:"Для размещения взлетно-посадочных полос",143003040400:"Для размещения иных наземных объектов воздушного транспорта",14300305e4:"Для размещения и эксплуатации объектов трубопроводного транспорта",143003050100:"Для размещения нефтепроводов",143003050200:"Для размещения газопроводов",143003050300:"Для размещения иных трубопроводов",143003050400:"Для размещения иных объектов трубопроводного транспорта",14300306e4:"Для размещения и эксплуатации иных объектов транспорта",143004e6:"Для размещения объектов связи, радиовещания, телевидения, информатики",14300401e4:"Для размещения эксплуатационных предприятий связи и обслуживания линий связи",14300402e4:"Для размещения кабельных, радиорелейных и воздушных линий связи и линий радиофикации на трассах кабельных и воздушных линий связи и радиофикации и их охранные зоны",14300403e4:"Для размещения подземных кабельных и воздушных линий связи и радиофикации и их охранные зоны",14300404e4:"Для размещения наземных и подземных необслуживаемых усилительных пунктов на кабельных линиях связи и их охранные зоны",14300405e4:"Для размещения наземных сооружений и инфраструктур спутниковой связи",14300406e4:"Для размещения иных объектов связи, радиовещания, телевидения, информатики",143005e6:"Для размещения объектов, предназначенных для обеспечения космической деятельности",14300501e4:"Для размещения космодромов, стартовых комплексов и пусковых установок",14300502e4:"Для размещения командно-измерительных комплексов, центров и пунктов управления полетами космических объектов, приема, хранения и переработки информации",14300503e4:"Для размещения баз хранения космической техники",14300504e4:"Для размещения полигонов приземления космических объектов и взлетно-посадочных полос",14300505e4:"Для размещения объектов экспериментальной базы для отработки космической техники",14300506e4:"Для размещения центров и оборудования для подготовки космонавтов",14300507e4:"Для размещения других наземных сооружений и техники, используемых при осуществлении космической деятельности",143006e6:"Для размещения объектов, предназначенных для обеспечения обороны и безопасности",14300601e4:"Для обеспечения задач обороны",143006010100:"Для размещения военных организаций, учреждений и других объектов",143006010200:"Для дислокации войск и сил флота",143006010300:"Для проведения учений и иных мероприятий",143006010400:"Для испытательных полигонов",143006010500:"Для мест уничтожения оружия и захоронения отходов",143006010600:"Для создания запасов материальных ценностей в государственном и мобилизационном резервах (хранилища, склады и другие)",143006010700:"Для размещения иных объектов обороны",14300602e4:"Для размещения объектов (территорий), обеспечивающих защиту и охрану Государственной границы Российской Федерации",143006020100:"Для обустройства и содержания инженерно-технических сооружений и заграждений",143006020200:"Для обустройства и содержания пограничных знаков",143006020300:"Для обустройства и содержания пограничных просек",143006020400:"Для обустройства и содержания коммуникаций",143006020500:"Для обустройства и содержания пунктов пропуска через Государственную границу Российской Федерации",143006020600:"Для размещения иных объектов для защиты и охраны Государственной границы Российской Федерации",14300603e4:"Для размещения иных объектов обороны и безопасности",143007e6:"Для размещения иных объектов промышленности, энергетики, транспорта, связи, радиовещания, телевидения, информатики, обеспечения космической деятельности, обороны, безопасности и иного специального назначения",144e9:"Для размещения особо охраняемых историко-культурных и природных объектов (территорий)",144001e6:"Для размещения особо охраняемых природных объектов (территорий)",14400101e4:"Для размещения государственных природных заповедников (в том числе биосферных)",14400102e4:"Для размещения государственных природных заказников",14400103e4:"Для размещения национальных парков",14400104e4:"Для размещения природных парков",14400105e4:"Для размещения дендрологических парков",14400106e4:"Для размещения ботанических садов",14400107e4:"Для размещения объектов санаторного и курортного назначения",14400108e4:"Территории месторождений минеральных вод, лечебных грязей, рапы лиманов и озер",14400109e4:"Для традиционного природопользования",1440011e5:"Для размещения иных особо охраняемых природных территорий (объектов)",144002e6:"Для размещения объектов (территорий) природоохранного назначения",144003e6:"Для размещения объектов (территорий) рекреационного назначения",14400301e4:"Для размещения домов отдыха, пансионатов, кемпингов",14400302e4:"Для размещения объектов физической культуры и спорта",14400303e4:"Для размещения туристических баз, стационарных и палаточных туристско-оздоровительных лагерей, домов рыболова и охотника, детских туристических станций",14400304e4:"Для размещения туристических парков",14400305e4:"Для размещения лесопарков",14400306e4:"Для размещения учебно-туристических троп и трасс",14400307e4:"Для размещения детских и спортивных лагерей",14400308e4:"Для размещения скверов, парков, городских садов",14400309e4:"Для размещения пляжей",1440031e5:"Для размещения иных объектов (территорий) рекреационного назначения",144004e6:"Для размещения объектов историко-культурного назначения",14400401e4:"Для размещения объектов культурного наследия народов Российской Федерации (памятников истории и культуры), в том числе объектов археологического наследия",14400402e4:"Для размещения военных и гражданских захоронений",144005e6:"Для размещения иных особо охраняемых историко-культурных и природных объектов (территорий)",145e9:"Для размещения объектов лесного фонда",145001e6:"Для размещения лесной растительности",145002e6:"Для восстановления лесной растительности",145003e6:"Для прочих объектов лесного хозяйства",146e9:"Для размещения объектов водного фонда",146001e6:"Под водными объектами",146002e6:"Для размещения гидротехнических сооружений",146003e6:"Для размещения иных сооружений, расположенных на водных объектах",147e9:"Земли запаса (неиспользуемые)"},dAssBuilding:{204001e6:"Нежилое здание",204002e6:"Жилой дом",204003e6:"Многоквартирный дом",204001e7:"Нежилое здание",204002e7:"Жилой дом",204003e7:"Многоквартирный дом"},rootItems:{Quartal:"Квартал",Bounds:"Границы",Zones:"Зоны",Parcels:"Земельные участки",ObjectsRealty:"Строения"},cad_okrug:{"01":"Адыгейский","02":"Башкирский","03":"Бурятский","04":"Алтайский республиканский","05":"Дагестанский","06":"Ингушский","07":"Кабардино-Балкарский","08":"Калмыцкий","09":"Карачаево-Черкесский",10:"Карельский",11:"Коми",12:"Марийский",13:"Мордовский",14:"Якутский",15:"Северо-Осетинский",16:"Татарский",17:"Тувинский",18:"Удмуртский",19:"Хакасский",20:"Чеченский",21:"Чувашский",22:"Алтайский краевой",23:"Краснодарский",24:"Красноярский",25:"Приморский",26:"Ставропольский",27:"Хабаровский",28:"Амурский",29:"Архангельский",30:"Астраханский",31:"Белгородский",32:"Брянский",33:"Владимирский",34:"Волгоградский",35:"Вологодский",36:"Воронежский",37:"Ивановский",38:"Иркутский",39:"Калининградский",40:"Калужский",41:"Камчатский",42:"Кемеровский",43:"Кировский",44:"Костромской",45:"Курганский",46:"Курский",47:"Ленинградский",48:"Липецкий",49:"Магаданский",50:"Московский областной",51:"Мурманский",52:"Нижегородский",53:"Новгородский",54:"Новосибирский",55:"Омский",56:"Оренбургский",57:"Орловский",58:"Пензенский",59:"Пермский",60:"Псковский",61:"Ростовский",62:"Рязанский",63:"Самарский",64:"Саратовский",65:"Сахалинский",66:"Свердловский",67:"Смоленский",68:"Тамбовский",69:"Тверской",70:"Томский",71:"Тульский",72:"Тюменский",73:"Ульяновский",74:"Челябинский",75:"Читинский",76:"Ярославский",77:"Московский городской",78:"Петербургский",79:"Еврейский",80:"Агинский",81:"Коми-Пермяцкий",82:"Корякский",83:"Ненецкий",84:"Таймырский",85:"Усть-Ордынский",86:"Ханты-Мансийский",87:"Чукотский",88:"Эвенкийский",89:"Ямало-Ненецкий",90:"Крымский",91:"Севастопольский"},cad_fp:{100:"Частная собственность",200:"Собственность публично-правовых образований"},oks_type:{building:"Здание",construction:"Сооружение",incomplete:"Объект незавершенного строительства"},oks_wall:{"061001999000":"Иные","061001009000":"Стены металлические","061001008000":"Стены шлакобетонные","061001007006":"Стены железобетонные из железобетонных сегментов","061001007005":"Стены железобетонные из унифицированных железобетонных элементов","061001007004":"Стены железобетонные крупноблочные","061001007003":"Стены железобетонные монолитные","061001007002":"Стены железобетонные каркасно-панельные","061001007001":"Стены железобетонные крупнопанельные","061001007000":"Стены железобетонные","061001006003":"Стены бетонные из легкобетонных панелей","061001006002":"Стены бетонные из мелких бетонных блоков","061001006001":"Стены бетонные монолитные","061001006000":"Стены бетонные","061001005000":"Стены из прочих материалов","061001004000":"Стены легкие из местных материалов","061001003002":"Стены каменные и бетонные","061001003001":"Стены каменные и деревянные","061001003000":"Стены смешанные","061001002005":"Стены деревянные дощатые","061001002004":"Стены деревянные сборно-щитовые","061001002003":"Стены деревянные каркасно-обшивные","061001002002":"Стены деревянные каркасно-засыпные","061001002001":"Стены деревянные рубленые","061001002000":"Стены деревянные","061001001003":"Стены каменные из природного камня","061001001002":"Стены каменные кирпичные облегченные","061001001001":"Стены каменные кирпичные","061001001000":"Стены каменные","061001002006":"Деревянный каркас без обшивки","061001000000":"Стены"},getValue:function(e,t){for(var r in this)if(this.hasOwnProperty(r)&&r===e)for(var o in this[r])if(this[r].hasOwnProperty(o)&&o===t)return this[r][o]}},MapExpress.Utils.CadastreObjectConverter={parcelToGeoJSON:function(e){var t={type:"Feature",geometry:{type:"Polygon",coordinates:[]}},r={};r.id=e.feature.attrs.id,r["Кадастровый номер"]=e.feature.attrs.cn,r["Кадастровый округ"]=MapExpress.Utils.CadastreDictionary.getValue("cad_okrug",e.feature.attrs.okrug_cn),r["Адрес"]=e.feature.attrs.address,r["Категория земель"]=MapExpress.Utils.CadastreDictionary.getValue("dCategories",e.feature.attrs.category_type),r["Разрешенное использование"]=MapExpress.Utils.CadastreDictionary.getValue("dUtilizations",e.feature.attrs.util_code),r["Разрешенное использование (по документу)"]=e.feature.attrs.util_by_doc,r["Форма собственности"]=MapExpress.Utils.CadastreDictionary.getValue("cad_fp",e.feature.attrs.fp),r["Регистрация права"]=1===e.feature.attrs.rights_reg?"Да":"Нет",r["Кадастровая стоимость"]=this._tryFormatNumberAsCurrency(e.feature.attrs.cad_cost),r["Кадастровая стоимость, 0.6%"]=this._tryFormatNumberAsCurrency(Math.round(.006*e.feature.attrs.cad_cost)),r["Кадастровая стоимость, 1.5%"]=this._tryFormatNumberAsCurrency(Math.round(.015*e.feature.attrs.cad_cost)),r["Кадастровая стоимость, 3%"]=this._tryFormatNumberAsCurrency(Math.round(.03*e.feature.attrs.cad_cost)),r["Дата определения стоимости"]=e.feature.attrs.date_cost,r["Площадь"]=this._tryFormatNumberAsDecimal(e.feature.attrs.area_value),r["Статус"]=MapExpress.Utils.CadastreDictionary.getValue("dStates",e.feature.attrs.statecd),r["Дата постановки на кадастровый учет"]=e.feature.attrs.date_create,r["Дата выгрузки сведений из ГКН"]=e.feature.attrs.adate,r["Дата изменения сведений в ГКН"]=e.feature.attrs.cad_record_date;var o="";e.feature.attrs.cad_eng_data&&(o=(e.feature.attrs.cad_eng_data.ci_surname?e.feature.attrs.cad_eng_data.ci_surname:"")+" "+(e.feature.attrs.cad_eng_data.ci_first?e.feature.attrs.cad_eng_data.ci_first:"")+" "+(e.feature.attrs.cad_eng_data.ci_patronymic?e.feature.attrs.cad_eng_data.ci_patronymic:"")+" ( сертификат № "+(e.feature.attrs.cad_eng_data.ci_n_certificate?e.feature.attrs.cad_eng_data.ci_n_certificate:"-")+") ");r["Кадастровый инженер"]=o,r["Справочная информация на портале РР"]="https://rosreestr.ru/wps/portal/cc_information_online?KN="+e.feature.attrs.cn,r["Открыть на ПКК РФ"]="https://pkk5.rosreestr.ru/#x=&y=&z=&type=1&zoomTo=1&app=search&opened=1&text="+e.feature.attrs.cn;var s=new L.Point(e.feature.center.x,e.feature.center.y),i=L.CRS.EPSG3857.unproject(s);return r["Яндекс.Карты"]="https://yandex.ru/maps/?whatshere[point]="+i.lng+","+i.lat+"&whatshere[zoom]=17",t.properties=r,t},oksToGeoJSON:function(e){var t={type:"Feature",geometry:{type:"Polygon",coordinates:[]}},r={};r.id=e.feature.attrs.id,r["Кадастровый номер"]=e.feature.attrs.cn,r["Кадастровый округ"]=MapExpress.Utils.CadastreDictionary.getValue("cad_okrug",e.feature.attrs.okrug_cn),r["Адрес"]=e.feature.attrs.address,r["Тип"]=MapExpress.Utils.CadastreDictionary.getValue("oks_type",e.feature.attrs.oks_type),"building"===e.feature.attrs.oks_type?r["Назначение"]=MapExpress.Utils.CadastreDictionary.getValue("dAssBuilding",e.feature.attrs.purpose):r["Назначение"]=e.feature.attrs.purpose,r["Наименование"]=e.feature.attrs.name,r["Площадь"]=this._tryFormatNumberAsDecimal(e.feature.attrs.area_value),r["Статус"]=MapExpress.Utils.CadastreDictionary.getValue("dStates",e.feature.attrs.statecd),r["Форма собственности"]=MapExpress.Utils.CadastreDictionary.getValue("cad_fp",e.feature.attrs.fp),r["Регистрация права"]=1===e.feature.attrs.rights_reg?"Да":"Нет",r["Кадастровая стоимость"]=this._tryFormatNumberAsCurrency(e.feature.attrs.cad_cost),r["Дата определения стоимости"]=e.feature.attrs.date_cost,"building"===e.feature.attrs.oks_type&&(r["Общая этажность"]=e.feature.attrs.floors,r["Подземная этажность"]=e.feature.attrs.underground_floors,e.feature.attrs.elements_constuct&&0<e.feature.attrs.elements_constuct.length&&(r["Материал стен"]=MapExpress.Utils.CadastreDictionary.getValue("oks_wall",e.feature.attrs.elements_constuct[0].wall))),r["Завершение строительства"]=e.feature.attrs.year_built,r["Ввод в эксплуатацию"]=e.feature.attrs.year_used,e.feature.attrs.cad_eng_data&&e.feature.attrs.cad_eng_data.ci_surname&&(r["Кадастровый инженер"]=e.feature.attrs.cad_eng_data.ci_surname+" "+e.feature.attrs.cad_eng_data.ci_first+" "+e.feature.attrs.cad_eng_data.ci_patronymic+", серт. №"+e.feature.attrs.cad_eng_data.ci_n_certificate),r["Дата постановки на кадастровый учет"]=e.feature.attrs.date_create,r["Дата выгрузки сведений из ГКН"]=e.feature.attrs.adate,r["Дата изменения сведений в ГКН"]=e.feature.attrs.cad_record_date,r["Дата изменения сведений в ГКН"]=e.feature.attrs.cad_record_date;var o="";e.feature.attrs.cad_eng_data&&(o=(e.feature.attrs.cad_eng_data.ci_surname?e.feature.attrs.cad_eng_data.ci_surname:"")+" "+(e.feature.attrs.cad_eng_data.ci_first?e.feature.attrs.cad_eng_data.ci_first:"")+" "+(e.feature.attrs.cad_eng_data.ci_patronymic?e.feature.attrs.cad_eng_data.ci_patronymic:"")+" ( сертификат № "+(e.feature.attrs.cad_eng_data.ci_n_certificate?e.feature.attrs.cad_eng_data.ci_n_certificate:"-")+") ");r["Кадастровый инженер"]=o,r["Справочная информация на портале РР"]="https://rosreestr.ru/wps/portal/cc_information_online?KN="+e.feature.attrs.cn;var s=new L.Point(e.feature.center.x,e.feature.center.y),i=L.CRS.EPSG3857.unproject(s);return r["Яндекс.Карты"]="https://yandex.ru/maps/?whatshere[point]="+i.lng+","+i.lat+"&whatshere[zoom]=17",t.properties=r,t},zouitToGeoJSON:function(e){var t={type:"Feature",geometry:{type:"Polygon",coordinates:[]}},r={};if(r.id=e.feature.attrs.id,r["Номер"]=e.feature.attrs.acnum,r["Индекс"]=e.feature.attrs.zone_index,r["Кадастровый округ"]=MapExpress.Utils.CadastreDictionary.getValue("cad_okrug",e.feature.attrs.okrug_cn),r["Статус"]=MapExpress.Utils.CadastreDictionary.getValue("dStates",e.feature.attrs.statecd),r["Наименование"]=e.feature.attrs.name_zone,e.feature.attrs.json_documents&&0<e.feature.attrs.json_documents.length){r["Основание"]="";for(var o=0;o<e.feature.attrs.json_documents.length;o++){var s="";e.feature.attrs.json_documents[o].issueOrgan&&(s=e.feature.attrs.json_documents[o].issueOrgan+": ");var i="";e.feature.attrs.json_documents[o].date&&(i=" от "+e.feature.attrs.json_documents[o].date),r["Основание"]+=s+e.feature.attrs.json_documents[o].name+" №"+e.feature.attrs.json_documents[o].number+i+". \n"}}return r["Описание"]=e.feature.attrs.desc,"System.Data.DataRow"===e.feature.attrs.content_restrictions?r["Ограничение"]="-":r["Ограничение"]=e.feature.attrs.content_restrictions,r["Дата постановки на ГКУ"]=e.feature.attrs.date_create,r["Дата выгрузки сведений из ГКН"]=e.feature.attrs.adate,r["Дата изменения сведений в ГКН"]=e.feature.attrs.cad_record_date,r["Сертифицированный эксперт"]=e.feature.attrs.cad_record_expert_certified?e.feature.attrs.cad_record_expert_certified:" - ",t.properties=r,t},kvartalToGeoJSON:function(e){var t={type:"Feature",geometry:{type:"Polygon",coordinates:[]}},r={};return r.id=e.feature.attrs.id,r["Кадастровый номер"]=e.feature.attrs.cn,r["Кадастровый округ"]=MapExpress.Utils.CadastreDictionary.getValue("cad_okrug",e.feature.attrs.okrug_cn),r["Здания. Всего"]=e.feature.stat.oks.total?e.feature.stat.oks.total:"-",r["Здания. С границами"]=e.feature.stat.oks.geo?e.feature.stat.oks.geo:"-",r["Участки. Всего"]=e.feature.stat.parcel.total?e.feature.stat.parcel.total:"-",r["Участки. С границами"]=e.feature.stat.parcel.geo?e.feature.stat.parcel.geo:"-",t.properties=r,t},raionToGeoJSON:function(e){var t={type:"Feature",geometry:{type:"Polygon",coordinates:[]}},r={};return r.id=e.feature.attrs.id,r["Кадастровый номер"]=e.feature.attrs.cn,r["Кадастровый округ"]=MapExpress.Utils.CadastreDictionary.getValue("cad_okrug",e.feature.attrs.okrug),r["Кадастровый район"]=e.feature.attrs.name?e.feature.attrs.name:"-",r["Здания. Всего"]=e.feature.stat.oks?e.feature.stat.oks.total:"-",r["Здания. С границами"]=e.feature.stat.oks?e.feature.stat.oks.geo:"-",r["Участки. Всего"]=e.feature.stat.parcel?e.feature.stat.parcel.total:"-",r["Участки. С границами"]=e.feature.stat.parcel?e.feature.stat.parcel.geo:"-",r["Кварталы. Всего"]=e.feature.stat.kvartal?e.feature.stat.kvartal.total:"-",r["Кварталы. С границами"]=e.feature.stat.kvartal?e.feature.stat.kvartal.geo:"-",t.properties=r,t},okrugToGeoJSON:function(e){var t={type:"Feature",geometry:{type:"Polygon",coordinates:[]}},r={};return r.id=e.feature.attrs.id,r["Кадастровый номер"]=e.feature.attrs.cn,r["Кадастровый округ"]=e.feature.attrs.name,r["Здания. Всего"]=e.feature.stat.oks?e.feature.stat.oks.total:"-",r["Здания. С границами"]=e.feature.stat.oks?e.feature.stat.oks.geo:"-",r["Участки. Всего"]=e.feature.stat.parcel?e.feature.stat.parcel.total:"-",r["Участки. С границами"]=e.feature.stat.parcel?e.feature.stat.parcel.geo:"-",r["Районы. Всего"]=e.feature.stat.rayon?e.feature.stat.rayon.total:"-",r["Районы. С границами"]=e.feature.stat.rayon?e.feature.stat.rayon.geo:"-",r["Кварталы. Всего"]=e.feature.stat.kvartal?e.feature.stat.kvartal.total:"-",r["Кварталы. С границами"]=e.feature.stat.kvartal?e.feature.stat.kvartal.geo:"-",t.properties=r,t},_tryFormatNumberAsCurrency:function(t){try{return t.toLocaleString("ru-RU",{style:"currency",currency:"RUB"})}catch(e){return t}},_tryFormatNumberAsDecimal:function(t){try{return t.toLocaleString({style:"decimal"})}catch(e){return t}}},MapExpress.Search.CadastrSearchProviderPPK5=MapExpress.Search.BaseSearchProvider.extend({initialize:function(e,t){MapExpress.Search.BaseSearchProvider.prototype.initialize.call(this,e,t),this._url="https://pkk5.rosreestr.ru/api/typeahead?",this._urlOptions={skip:0,type:1}},getDataByMaskAsynch:function(e){var t,r,o,s=$.Deferred();return this._urlOptions.text=e,t=this._url,r=this._urlOptions,o=[],$.ajax({url:t,type:"GET",data:r,success:function(e){if(e.results&&0<e.results.length){for(var t=0;t<e.results.length;t++)o.push({display_name:(r=e.results[t]).value,type:"Feature",geojson:{type:"Polygon"},properties:{cn:r.value}});s.resolve(o)}else s.resolve(o);var r},error:function(e){s.reject(" Failed: "+e)}}),s.promise()},processResult:function(e,r){var o=this,t=this._urlOptions.type;MapExpress.Utils.CadastreUtils.getSimpleFeatureByCadNumAsyn(e.properties.cn,t).done(function(e){var t=function(e){if(e.center){var t=L.Projection.SphericalMercator.unproject(L.point(e.center.x,e.center.y)),r={display_name:e.attrs.cn,type:"Feature",geojson:{type:"Point",coordinates:[t[Object.keys(t)[1]],t[Object.keys(t)[0]]]},properties:{cn:e.attrs.cn}};return r}return null}(e);t&&MapExpress.Search.BaseSearchProvider.prototype.processResult.call(o,t,r)})}}),MapExpress.Search.OksCadastrSearchProviderPPK5=MapExpress.Search.CadastrSearchProviderPPK5.extend({initialize:function(e,t){MapExpress.Search.CadastrSearchProviderPPK5.prototype.initialize.call(this,e,t),this._urlOptions.type=5}}),MapExpress.Utils.CadastreUtils={cadastreObjectType:{PARCEL:1,OKS:5,ZOUT:10,KVARTAL:2,RAION:3,OKRUG:4},queryIdAtPointTempalte:"https://pkk5.rosreestr.ru/api/features/{objectType}?text={latlng}&tolerance=16&limit=11",queryByIdTempalte:"https://pkk5.rosreestr.ru/api/features/{objectType}/{objectId}",queryByCadNumTempalte:"https://pkk5.rosreestr.ru/api/features/{objectType}?text={objectCadNum}&tolerance=16&limit=11",queryOKSApartmentByCadNumTemplate:"https://apirosreestr.ru/api/cadaster/reestr",getObjectListGeoJSONByLatLngAsyn:function(e,t){return this._getObjectListGeoJSONByLatLng(e,t).then(function(e){return e})},_getObjectListGeoJSONByLatLng:function(e,s){var i=this,a=$.Deferred();return this._getCadastreObjectIdListByLatLngAsyn(e,s).then(function(e){var r=[];if(e){for(var t=[],o=e.length-1;0<=o;o--)t.push(i.getObjectGeoJSONByIdAsyn(e[o],s));$.when.apply($,t).done(function(){if(arguments&&0<arguments.length){for(var e=0;e<arguments.length;e++){var t=arguments[e];t&&r.push(t)}a.resolve(r)}})}else a.resolve(r)},function(e){a.reject(e)}),a.promise()},getObjectGeoJSONByIdAsyn:function(e,r){var o=this;if(e){var t=L.Util.template(o.queryByIdTempalte,{objectType:r,objectId:e});return MapExpress.Utils.Promise.GetJSONP(t,{},"callback").then(function(e){if(e.feature){var t={};return r===o.cadastreObjectType.PARCEL&&(t=MapExpress.Utils.CadastreObjectConverter.parcelToGeoJSON(e)),r===o.cadastreObjectType.OKS&&(t=MapExpress.Utils.CadastreObjectConverter.oksToGeoJSON(e)),r===o.cadastreObjectType.ZOUT&&(t=MapExpress.Utils.CadastreObjectConverter.zouitToGeoJSON(e)),r===o.cadastreObjectType.KVARTAL&&(t=MapExpress.Utils.CadastreObjectConverter.kvartalToGeoJSON(e)),r===o.cadastreObjectType.RAION&&(t=MapExpress.Utils.CadastreObjectConverter.raionToGeoJSON(e)),r===o.cadastreObjectType.OKRUG&&(t=MapExpress.Utils.CadastreObjectConverter.okrugToGeoJSON(e)),t}return null},function(e){return console.log("Error getObjectGeoJSONByIdAsyn: "+e),null})}},getObjecIdListByCadNumAsyn:function(e,t){var r=this;if(e){var o=L.Util.template(r.queryByCadNumTempalte,{objectType:t,objectCadNum:e});return MapExpress.Utils.Promise.GetJSONP(o,{},"callback").then(function(e){return r._getObjectIdListByPkkResponse(e)},function(e){return console.log("Error getObjecIdListByCadNumAsyn: "+e),null})}},getSimpleFeatureByCadNumAsyn:function(e,t){if(e){var r=L.Util.template(this.queryByCadNumTempalte,{objectType:t,objectCadNum:e});return MapExpress.Utils.Promise.GetJSONP(r,{},"callback").then(function(e){if(e&&e.features&&0<e.features.length)return e.features[0]},function(e){return null})}},_getOKSApartmentObjectIdListByOKSIdAsync:function(e,t){t||console.warn("Не задан Токен, данные не будут получены.");var r=L.Util.template(this.queryOKSApartmentByCadNumTemplate),o=$.Deferred();return $.ajax({url:r,type:"POST",data:JSON.stringify({query:e}),dataType:"json",success:function(e){o.resolve(e)},error:function(e){o.reject(null)},beforeSend:function(e){e.setRequestHeader("Token",t),e.setRequestHeader("Content-Type","application/json")}}),o.promise()},_getOKSObjectListGeoJSONByLatLngAsyn:function(e,t,s){var i=this,a=$.Deferred();return this._getObjectListGeoJSONByLatLng(e,t).then(function(r){var o=[];if(r.length){var t=[];r.forEach(function(e){t.push(i._getOKSApartmentObjectIdListByOKSIdAsync(e.properties["Кадастровый номер"],s))}),$.when.apply($,t).then(function(){$.makeArray(arguments).forEach(function(e,t){e&&(r[t].apartmentPromisesDataItem=e,o.push(r[t]))}),a.resolve(o)})}else a.resolve(r)}),a.promise()},getOKSObjectListGeoJSONByLatLngAsyn:function(e,t,r){return this._getOKSObjectListGeoJSONByLatLngAsyn(e,t,r).then(function(e){return e})},_getCadastreObjectIdListByLatLngAsyn:function(e,r){var o=this,t=L.Util.template(this.queryIdAtPointTempalte,{objectType:r,latlng:e.lat+" "+e.lng});return MapExpress.Utils.Promise.GetJSONP(t,{},"callback").then(function(e){if(e&&e.features&&0<e.features.length){var t=o._clearFeaturesByObjectType(e,r);return o._getObjectIdListByPkkResponse(t)}return null},function(e){return null})},_getCadastreFeaturesByLatLngAsyn:function(e,t){var r=this,o=L.Util.template(this.queryIdAtPointTempalte,{objectType:t,latlng:e.lat+" "+e.lng});return MapExpress.Utils.Promise.GetJSONP(o,{},"callback").then(function(e){return e&&e.features&&0<e.features.length?r._clearFeaturesByObjectType(e,t).features:null},function(e){return null})},_clearFeaturesByObjectType:function(e,t){if(t===this.cadastreObjectType.RAION||t===this.cadastreObjectType.KVARTAL)for(var r=e.features.length-1;0<=r;r--){var o=e.features[r].attrs.id.split(":");0===Number(o[o.length-1])&&e.features.splice(r,1)}return e},_getObjectIdListByPkkResponse:function(e){var t=[];if(e&&e.features&&0<e.features.length){for(var r=e.features.length-1;0<=r;r--)t.push(e.features[r].attrs.id);return t}},getObjectPrintNameByType:function(e){var t="Объект";return e===MapExpress.Utils.CadastreUtils.cadastreObjectType.PARCEL&&(t="Земельный участок"),e===MapExpress.Utils.CadastreUtils.cadastreObjectType.OKS&&(t="Здание.Строение"),e===MapExpress.Utils.CadastreUtils.cadastreObjectType.ZOUT&&(t="ЗОУИТ"),e===MapExpress.Utils.CadastreUtils.cadastreObjectType.KVARTAL&&(t="Кадастровый квартал"),e===MapExpress.Utils.CadastreUtils.cadastreObjectType.RAION&&(t="Кадастровый район"),e===MapExpress.Utils.CadastreUtils.cadastreObjectType.OKRUG&&(t="Кадастровый округ"),t},replaceRosreestrIdentifyFunc:function(e){var t=window.MapManager.getMapModel().getLayersByOptionValue("displayName","Публичная кадастровая карта");if(t&&0<t.length){var r=[];window.MapManager.getMapModel()._fillAllLayers(t[0],r);for(var o=0;o<r.length;o++){var s=r[o];if(s.mapLayer&&s.mapLayer._dataPovider){if("Земельные участки"===s.options.displayName){s.mapLayer._dataPovider.getFeatureInfoAsync=a,s.mapLayer._dataPovider.options.tileSize=1024,s.mapLayer.options.tileSize=1024,window.MapManager._mapModel._favoriteLayers.push(s),e&&this.addPkkParcelLegend(s.mapLayer);continue}if("ОКС"===s.options.displayName){s.mapLayer._dataPovider.getFeatureInfoAsync=n,s.mapLayer.options.tileSize=1024,s.mapLayer._dataPovider.options.tileSize=1024,window.MapManager._mapModel._favoriteLayers.push(s),e&&this.addPkkOksLegend(s.mapLayer);continue}if("ЗОУИТ"===s.options.displayName){s.mapLayer._dataPovider.getFeatureInfoAsync=l,s.mapLayer._dataPovider.options.tileSize=1024,s.mapLayer.options.tileSize=1024,window.MapManager._mapModel._favoriteLayers.push(s),e&&this.addPkkZouitLegend(s.mapLayer);continue}if("Кадастровые кварталы"===s.options.displayName){s.mapLayer._dataPovider.getFeatureInfoAsync=p,s.mapLayer.options.tileSize=1024,s.mapLayer._dataPovider.options.tileSize=1024;continue}if("Кадастровые районы"===s.options.displayName){s.mapLayer.options.tileSize=1024,s.mapLayer._dataPovider.getFeatureInfoAsync=d,s.mapLayer._dataPovider.options.tileSize=1024;continue}if("Кадастровые округа"===s.options.displayName){s.mapLayer._dataPovider.getFeatureInfoAsync=c,s.mapLayer.options.tileSize=1024,s.mapLayer._dataPovider.options.tileSize=1024;continue}s.mapLayer.options.tileSize=1024,s.mapLayer._dataPovider.options.tileSize=1024,s.mapLayer._dataPovider.getFeatureInfoAsync=i}}}function i(e,t,r,o,s){return null}function a(e,t,r,o,s){return MapExpress.Utils.CadastreUtils.getObjectListGeoJSONByLatLngAsyn(e,MapExpress.Utils.CadastreUtils.cadastreObjectType.PARCEL)}function n(e,t,r,o,s){return MapExpress.Utils.CadastreUtils.getObjectListGeoJSONByLatLngAsyn(e,MapExpress.Utils.CadastreUtils.cadastreObjectType.OKS)}function l(e,t,r,o,s){return MapExpress.Utils.CadastreUtils.getObjectListGeoJSONByLatLngAsyn(e,MapExpress.Utils.CadastreUtils.cadastreObjectType.ZOUT)}function p(e,t,r,o,s){return MapExpress.Utils.CadastreUtils.getObjectListGeoJSONByLatLngAsyn(e,MapExpress.Utils.CadastreUtils.cadastreObjectType.KVARTAL)}function d(e,t,r,o,s){return MapExpress.Utils.CadastreUtils.getObjectListGeoJSONByLatLngAsyn(e,MapExpress.Utils.CadastreUtils.cadastreObjectType.RAION)}function c(e,t,r,o,s){return MapExpress.Utils.CadastreUtils.getObjectListGeoJSONByLatLngAsyn(e,MapExpress.Utils.CadastreUtils.cadastreObjectType.OKRUG)}},addPkkParcelLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 24"><rect fill="#ffffff" stroke-width="3" x="0" y="0" width="48" height="24" stroke-dasharray="none" stroke="#f28383" opacity="1" fill-opacity="1" stroke-opacity="1"></rect></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addPkkOksLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 24"><rect fill="#ffbebe" stroke-width="3" x="0" y="0" width="48" height="24" stroke="#ffbebe"  opacity="1" fill-opacity="1" stroke-opacity="1"></rect></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addPkkZouitLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 24"><rect fill="#92d17b" stroke-width="3" x="0" y="0" width="48" height="24" stroke="#92d17b"  opacity="1" fill-opacity="0.5" stroke-opacity="1"></rect></svg>',templateType:"svg",maxZoom:24,minZoom:0})}},MapExpress.Search.CadastrAddressSearchProvider=MapExpress.Search.BaseSearchProvider.extend({initialize:function(e,t){MapExpress.Search.BaseSearchProvider.prototype.initialize.call(this,e,t)},getDataByMaskAsynch:function(t){var o=$.Deferred();return function(){var e=this.getUrlOptions(t),r=[];$.ajax({url:"https://pkk5.rosreestr.ru/arcgis/rest/services/Address/gkn/GeocodeServer/findAddressCandidates?",type:"GET",data:e,dataType:"json",success:function(e){0<e.candidates.length?($.each(e.candidates,function(e,t){r.push({display_name:t.address,type:"Feature",geojson:{type:"Point",coordinates:[t.location.x,t.location.y]},properties:{attributes:t.attributes,extent:t.extent}})}),o.resolve(r)):o.resolve([])},error:function(){}})}(),o.promise()},getUrlOptions:function(e){return{Address:"",Postal:"",City:"",Province:"",Region:"",SingleLine:e,category:"",outFields:"*",maxLocations:100,outSR:"",searchExtent:"",location:"",distance:"",magicKey:"",f:"pjson"}}}),MapExpress.Service.BaseDataProvider=L.Class.extend({statics:{},options:{tileSize:256,subdomains:"abc",useQuadkey:!1,maxZoom:23,uppercase:!1,crs:L.CRS.EPSG3857,proj4:!1,crsCode:!1,identifyFormat:"json",identifyLayersId:""},initialize:function(e){"string"==typeof this.options.subdomains&&(this.options.subdomains=this.options.subdomains.split("")),L.setOptions(this,e),!1!==this.options.proj4&&!1!==this.options.crsCode&&"string"==typeof this.options.proj4&&"string"==typeof this.options.crsCode&&0<this.options.proj4.length&&0<this.options.crsCode.length&&(this.options.crs=new L.Proj.CRS(this.options.crsCode,this.options.proj4))},setOptions:function(e){L.setOptions(this,e)},getDataAsync:function(){},getDataUrl:function(){},getDataInBoundsAsync:function(e,t){},getDataUrlByBounds:function(e,t){if(this._dataUrl&&e){var r=e.getNorthWest(),o=e.getSouthEast();return L.Util.template(this._dataUrl,{xMin:r.lng,yMin:o.lat,xMax:o.lng,yMax:r.lat})}},getDataUrlByTile:function(e){if(this._dataUrl)return this.options.useQuadkey?L.Util.template(this._dataUrl,L.extend({r:this.options.tileCoord&&L.Browser.retina&&0<this.options.maxZoom?"@2x":"",s:this._getSubdomain(e),q:this._tileCoordsToQuadkey(e)},this.options)):L.Util.template(this._dataUrl,L.extend({r:this.options.tileCoord&&L.Browser.retina&&0<this.options.maxZoom?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:e.z},this.options))},getFeatureInfoAsync:function(e,t,r,o,s){var i=this.getFeatureInfoUrl(e,t,r,o,s);if(i)return"json"===this.options.identifyFormat||"pjson"===this.options.identifyFormat?MapExpress.Utils.Promise.GetJSON(i):MapExpress.Utils.Promise.Ajax(i)},getFeatureInfoUrl:function(e,t,r,o,s){},_tileCoordToBounds:function(e){var t=this.options.tileSize,r=L.CRS.EPSG3857,o=new L.Point(e.x*t,e.y*t),s=new L.Point(o.x+t,o.y+t),i=r.pointToLatLng(o,e.z),a=r.pointToLatLng(s,e.z),n=r.wrapLatLng(i),l=r.wrapLatLng(a);return new L.LatLngBounds(n,l)},_getTileCoordRangeByMapBounds:function(e,t){var r=[];if(void 0===e)return r;for(var o=e.getNorthWest(),s=e.getSouthEast(),i=this._getTileCoordByLatLng(o,t),a=this._getTileCoordByLatLng(s,t),n=i.y;n<=a.y;n++)for(var l=i.x;l<=a.x;l++){var p=new L.Point(l,n);p.z=t,r.push(p)}return r},_getAddedTileCoordRangeByMapBounds:function(e,t,r,o){return this._getAddedAndRemovedTileCoordRangeByMapBounds(e,t,r,o).Added},_getRemovedTileCoordRangeByMapBounds:function(e,t,r,o){return this._getAddedAndRemovedTileCoordRangeByMapBounds(e,t,r,o).Removed},_getAddedAndRemovedTileCoordRangeByMapBounds:function(e,t,r,o){var s={},i=function(e,t){for(var r=0;r<e.length;r++)if(e[r].x===t.x&&e[r].y===t.y&&e[r].z===t.z)return!0;return!1},a=this._getTileCoordRangeByMapBounds(r,o),n=this._getTileCoordRangeByMapBounds(e,t);if(t!==o)return s.Added=a,s.Removed=n,s;var l=a.filter(function(e){return!i(n,e)}),p=n.filter(function(e){return!i(a,e)});return s.Added=l,s.Removed=p,s},_getTileCoordByLatLng:function(e,t){var r=L.CRS.EPSG3857.latLngToPoint(e,t);return this._pixelPointToTileCoord(r,t)},_pixelPointToTileCoord:function(e,t){var r=this.options.tileSize,o=Math.ceil(e.x/r)-1,s=Math.ceil(e.y/r)-1,i=new L.Point(o,s);return i.z=t,i},_tileCoordsToQuadkey:function(e){for(var t="",r=e.z;0<r;r--){var o=0,s=1<<r-1;0!=(e.x&s)&&o++,0!=(e.y&s)&&(o++,o++),t+=o}return t},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_getSubdomain:function(){if(this._hasSubdomain()){var e=Math.floor(Math.random()*this.options.subdomains.length);return this.options.subdomains[e]}return!1},_hasSubdomain:function(){return this.options.subdomains&&0<this.options.subdomains.length},_boundsEquals:function(e,t,r){var o=t.getNorthEast(),s=e.getNorthEast(),i=e.getSouthWest(),a=t.getSouthWest(),n=Math.max(Math.abs(s.lat-o.lat),Math.abs(s.lng-o.lng)),l=Math.max(Math.abs(i.lat-a.lat),Math.abs(i.lng-a.lng));return n<=(void 0===r?0:r)&&l<=(void 0===r?0:r)},identifyTemplate:function(){if(this.options.templateId&&this.options.templateUrl&&"string"==typeof this.options.templateId&&"string"==typeof this.options.templateUrl){return MapExpress.Utils.Promise.Ajax(this.options.templateUrl,{id:this.options.templateId})}return null}}),MapExpress.Service.baseDataProvider=function(e){return new MapExpress.Service.BaseDataProvider(e)},MapExpress.Service.EsriBaseProvider=MapExpress.Service.BaseDataProvider.extend({options:{tileSize:256,crs:L.CRS.EPSG3857,identifyUrl:"",identifyFormat:"json",identifyTolerance:3,layersId:""},initialize:function(e){MapExpress.Service.BaseDataProvider.prototype.initialize.call(this,e),L.setOptions(this,e),this.esriConvertor=MapExpress.Utils.GeoFormatConvertor.esri},getDataByTileAsync:function(e){var t=this._tileCoordToBounds(e),r=new L.Point(this.options.tileSize,this.options.tileSize);return this.getDataInBoundsAsync(t,r)},getDataUrlByTile:function(e){var t=this._tileCoordToBounds(e),r=new L.Point(this.options.tileSize,this.options.tileSize);return this.getDataUrlByBounds(t,r)},getFeatureInfoAsync:function(e,t,r,o,s){var i=this.getFeatureInfoUrl(e,t,r,o,s),a=this;if(i)return"json"===this.options.identifyFormat||"pjson"===this.options.identifyFormat?MapExpress.Utils.Promise.GetJSON(i).then(function(e){return a.esriConvertor.toGeoJSON(e)}):MapExpress.Utils.Promise.Ajax(i)},getFeatureInfoUrl:function(e,t,r,o,s){var i=null;this.options.identifyLayersId&&(i="visible:"+this.options.identifyLayersId),i||this.options.layersId&&(i="visible:"+this.options.layersId),i||(i="top");var a={geometryType:"esriGeometryPoint",sr:"4326",layers:i,tolerance:this.options.identifyTolerance,imageDisplay:[o.x,o.y,"96"].join(","),returnGeometry:!1,f:this.options.identifyFormat,geometry:[e.lng,e.lat].join(","),mapExtent:[r._northEast.lng,r._northEast.lat,r._southWest.lng,r._southWest.lat].join(",")},n=this.options.uppercase||!1,l=this.options.identifyUrl?this.options.identifyUrl:this._dataUrl;return l+"/identify"+L.Util.getParamString(a,l,n)}}),MapExpress.Service.esriBaseProvider=function(e,t){return new MapExpress.Service.EsriBaseProvider(e,t)},MapExpress.Service.FeatureServiceAgsProvider=MapExpress.Service.EsriBaseProvider.extend({defaultFeatureServiceParams:{where:"",text:"",objectIds:"",time:"",geometryType:"esriGeometryEnvelope",inSR:"",spatialRel:"esriSpatialRelIntersects",relationParam:"",outFields:"*",returnGeometry:!0,maxAllowableOffset:"",geometryPrecision:"",returnIdsOnly:!1,orderByFields:"",groupByFieldsForStatistics:"",outStatistics:"",returnZ:!1,returnM:!1,gdbVersion:"",returnDistinctValues:!1,f:"json"},options:{layerId:""},initialize:function(e,t){MapExpress.Service.EsriBaseProvider.prototype.initialize.call(this,t),this._dataUrl=e,this.esriConverter=MapExpress.Utils.GeoFormatConvertor.esri;var r=L.extend({},this.defaultFeatureServiceParams);for(var o in t)o in this.options||(r[o]=t[o]);L.setOptions(this,t),this.defaultFeatureServiceParams=r},getDataInBoundsAsync:function(e,t){var r=this,o=this.getDataUrlByBounds(e,t);return MapExpress.Utils.Promise.GetJSON(o).then(function(e){if(e)return r.esriConverter.toGeoJSON(e)})},getDataUrlByBounds:function(e,t){var r=this.options.crs,o=r.project(e.getNorthWest()),s=r.project(e.getSouthEast()),i={};i.inSR=r.code,i.outSR="4326",i.geometry=L.Util.template("{xmin: {0}, ymin: {1}, xmax: {2}, ymax: {3}}",{0:o.x,1:s.y,2:s.x,3:o.y}),L.extend(this.defaultFeatureServiceParams,i);var a=this.options.uppercase||!1,n=L.Util.getParamString(this.defaultFeatureServiceParams,this._dataUrl,a),l=this._dataUrl+"/"+this.options.layerId+"/query"+n;return this._hasSubdomain()&&-1<this._dataUrl.indexOf("{s}")&&(l=L.Util.template(l,{s:this._getSubdomain()})),l}}),MapExpress.Service.featureServiceAgsProvider=function(e,t){return new MapExpress.Service.FeatureServiceAgsProvider(e,t)},MapExpress.Service.GeoJSONProvider=MapExpress.Service.BaseDataProvider.extend({options:{identifyFormat:"json"},initialize:function(e,t){MapExpress.Service.BaseDataProvider.prototype.initialize.call(this,t),L.setOptions(this,t),this._dataUrl=e},getDataAsync:function(){return MapExpress.Utils.Promise.GetJSON(this._dataUrl)},getDataInBoundsAsync:function(e,t){var r=this.getDataUrlByBounds(e,t);return MapExpress.Utils.Promise.GetJSON(r)},getDataByTileAsync:function(e){var t=this.getDataUrlByTile(e);return MapExpress.Utils.Promise.GetJSON(t)},getDataUrlByTile:function(e){var t=this._tileCoordToBounds(e),r=new L.Point(this.options.tileSize,this.options.tileSize);return this.getDataUrlByBounds(t,r)}}),MapExpress.Service.geoJSONProvider=function(e,t){return new MapExpress.Service.GeoJSONProvider(e,t)},MapExpress.Service.MapServiceAgsProvider=MapExpress.Service.EsriBaseProvider.extend({defaultParams:{bboxSR:3857,imageSR:3857,dpi:96,f:"image",format:"png32",transparent:!0},initialize:function(e,t){MapExpress.Service.EsriBaseProvider.prototype.initialize.call(this,t),this._dataUrl=e;var r=L.extend({},this.defaultParams);for(var o in t)o in this.options||(r[o]=t[o]);L.setOptions(this,t),this.mapServiceParams=r},getDataUrlByBounds:function(e,t){var r=this.options.crs,o=r.project(e.getNorthWest()),s=r.project(e.getSouthEast()),i={};i.bbox=[o.x,s.y,s.x,o.y].join(","),i.size=[t.x,t.y].join(","),this.options.layersId&&(i.layers="show:"+this.options.layersId),L.extend(this.mapServiceParams,i);var a=this.options.uppercase||!1,n=L.Util.getParamString(this.mapServiceParams,this._url,a),l=this._dataUrl+"/export"+n;return this._hasSubdomain()&&-1<this._dataUrl.indexOf("{s}")&&(l=L.Util.template(l,{s:this._getSubdomain()})),l}}),MapExpress.Service.mapServiceAgsProvider=function(e,t){return new MapExpress.Service.MapServiceAgsProvider(e,t)},MapExpress.Service.SingleImageProvider=MapExpress.Service.BaseDataProvider.extend({initialize:function(e,t){MapExpress.Service.BaseDataProvider.prototype.initialize.call(this,t),L.setOptions(this,t),this._dataUrl=e},getDataUrl:function(){return this._dataUrl},getImageBounds:function(){return this.options.imageBounds}}),MapExpress.Service.singleImageProvider=function(e,t){return new MapExpress.Service.SingleImageProvider(e,t)},MapExpress.Service.TileProvider=MapExpress.Service.BaseDataProvider.extend({initialize:function(e,t){MapExpress.Service.BaseDataProvider.prototype.initialize.call(this,t),L.setOptions(this,t),this._dataUrl=e}}),MapExpress.Service.tileProvider=function(e,t){return new MapExpress.Service.TileProvider(e,t)},MapExpress.Service.WFSProvider=MapExpress.Service.BaseDataProvider.extend({defaultWFSProviderParams:{service:"WFS",version:"1.1.0",typeNS:"gml",request:"GetFeature",outputFormat:"gml3",crs:L.CRS.EPSG4326},options:{},initialize:function(e,t){MapExpress.Service.BaseDataProvider.prototype.initialize.call(this,t),this._dataUrl=e,this.gmlConverter=MapExpress.Utils.GeoFormatConvertor.gml();var r=this.defaultWFSProviderParams;for(var o in t)r[o]=t[o];switch(r.srsName=r.crs.code,r.typeName=r.typeNS+":"+r.typeName,r.gml){case"gml2":r.outputFormat="outputFormat:text/xml; subtype=gml/2.1.2";break;case"gml3":r.outputFormat="gml3";break;case"gml3.2":r.outputFormat="application/gml+xml; version=3.2";break;default:r.outputFormat="gml3"}this.unionWFSProviderParams=r,delete this.unionWFSProviderParams.crs,delete this.unionWFSProviderParams.typeNS},getDataAsync:function(){var t=this;return MapExpress.Utils.Promise.Ajax(this.getDataUrl()).then(function(e){return t.gmlConverter.toGeoJSON(e,t.unionWFSProviderParams.gml)})},getDataUrl:function(){var e=L.Util.getParamString(this.unionWFSProviderParams,this._dataUrl);return this._dataUrl+e},getDataInBoundsAsync:function(e,t){var r=this;return MapExpress.Utils.Promise.Ajax(this.getDataUrlByBounds(e,t)).then(function(e){return r.gmlConverter.toGeoJSON(e,r.unionWFSProviderParams.gml)})},getDataUrlByBounds:function(e,t){var r=e.getNorthEast(),o=e.getSouthWest(),s=e.getNorthWest(),i=e.getSouthEast(),a={};"1.0.0"!==this.unionWFSProviderParams.version?a.bbox=[o.lat,o.lng,r.lat,r.lng].toString():a.bbox=[s.lng,i.lat,i.lng,s.lat].toString(),L.extend(this.unionWFSProviderParams,a);var n=this.options.uppercase||!1,l=L.Util.getParamString(this.unionWFSProviderParams,this._dataUrl,n),p=this._dataUrl+l;return this._hasSubdomain()&&-1<this._dataUrl.indexOf("{s}")&&(p=L.Util.template(p,{s:this._getSubdomain()})),p},getDataByTileAsync:function(e){var t=this._tileCoordToBounds(e),r=new L.Point(this.options.tileSize,this.options.tileSize);return this.getDataInBoundsAsync(t,r)},_getDataAsync:function(){var t=this;return MapExpress.Utils.Promise.WFSAjax(this._dataUrl,this._queryXMLString()).then(function(e){return t.gmlConverter.toGeoJSON(e,t.unionWFSProviderParams.gml)})},_getDataInBoundsAsync:function(e){var t=this;return console.log(t),MapExpress.Utils.Promise.WFSAjax(this._dataUrl,this._queryXMLString(this._bboxXMLFilter(e,t.unionWFSProviderParams.geometryAttributeName))).then(function(e){return t.gmlConverter.toGeoJSON(e,t.unionWFSProviderParams.gml)})},_bboxXMLFilter:function(e,t){console.log(t);var r=this.gmlConverter.createElementNS("ogc:Filter"),o=this.gmlConverter.createElementNS("ogc:BBOX");return o.appendChild(this.gmlConverter.createElementNS("ogc:PropertyName",{value:t})),o.appendChild(this._latLngBoundsToGML(e,this.unionWFSProviderParams.srsName)),r.appendChild(o),r},_latLngBoundsToGML:function(e,t){var r=e.getSouthWest(),o=e.getNorthEast(),s=this.gmlConverter.createElementNS("gml:Envelope",{srsName:t});return s.appendChild(this.gmlConverter.createElementNS("gml:lowerCorner",{},{value:r.lat+" "+r.lng})),s.appendChild(this.gmlConverter.createElementNS("gml:upperCorner",{},{value:o.lat+" "+o.lng})),s},_queryXMLString:function(e){var t=this.gmlConverter.createElementNS("wfs:GetFeature",{service:"WFS",version:this.unionWFSProviderParams.version,maxFeatures:this.unionWFSProviderParams.maxFeatures,outputFormat:"text/xml"}),r=t.appendChild(this.gmlConverter.createElementNS("wfs:Query",{typeName:this.unionWFSProviderParams.typeName,srsName:this.unionWFSProviderParams.srsName}));return e&&r.appendChild(e),t}}),MapExpress.Service.wfsProvider=function(e,t){return new MapExpress.Service.WFSProvider(e,t)},MapExpress.Service.WmsProvider=MapExpress.Service.BaseDataProvider.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.3.0",layers:"",styles:"",format:"image/png",transparent:!0,dpi:96,f:"image"},initialize:function(e,t){MapExpress.Service.BaseDataProvider.prototype.initialize.call(this,t),this._dataUrl=e;var r=L.extend({},this.defaultWmsParams);for(var o in t)o in r&&(r[o]=t[o]);t=L.setOptions(this,t),r.width=r.height=t.tileSize*(t.detectRetina&&L.Browser.retina?2:1),this.wmsParams=r},getDataByTileAsync:function(e){var t=this._tileCoordToBounds(e),r=new L.Point(this.options.tileSize,this.options.tileSize);return this.getDataInBoundsAsync(t,r)},getDataUrlByBounds:function(e,t){var r=parseFloat(this.wmsParams.version),o=this.options.crs,s=1.3<=r?"crs":"srs",i=o.project(e.getNorthWest()),a=o.project(e.getSouthEast()),n={width:t.x,height:t.y};n.size=t.x+","+t.y,n[s]=o.code,n.bbox=(1.3<=r&&o===L.CRS.EPSG4326?[a.y,i.x,i.y,a.x]:[i.x,a.y,a.x,i.y]).join(","),L.extend(this.wmsParams,n);var l=this.options.uppercase||!1,p=L.Util.getParamString(this.wmsParams,this._dataUrl,l),d=this._dataUrl+p;return this._hasSubdomain()&&-1<this._dataUrl.indexOf("{s}")&&(d=L.Util.template(d,{s:this._getSubdomain()})),d},getDataUrlByTile:function(e){var t=this._tileCoordToBounds(e),r=new L.Point(this.options.tileSize,this.options.tileSize);return this.getDataUrlByBounds(t,r)},getFeatureInfoUrl:function(e,t,r,o,s){var i=parseFloat(this.wmsParams.version),a=this.options.crs,n=this.options.identifyLayersId?this.options.identifyLayersId:this.wmsParams.layers,l=(this.options.featureCount,a.project(r.getNorthWest())),p=a.project(r.getSouthEast()),d={request:"GetFeatureInfo",service:"WMS",version:this.wmsParams.version,height:o.y,width:o.x,layers:n,query_layers:n,info_format:this.options.identifyFormat,feature_count:10};d[1.3<=i?"crs":"srs"]=a.code,d.bbox=(1.3<=i&&a===L.CRS.EPSG4326?[p.y,l.x,l.y,p.x]:[l.x,p.y,p.x,l.y]).join(","),d[1.3<=i?"i":"x"]=Math.ceil(t.x),d[1.3<=i?"j":"y"]=Math.ceil(t.y);var c=this.options.uppercase||!1;return this._dataUrl+L.Util.getParamString(d,this._url,c)}}),MapExpress.Service.wmsProvider=function(e,t){return new MapExpress.Service.WmsProvider(e,t)},MapExpress.Styles.PulseIcon=L.DivIcon.extend({options:{className:"",iconSize:[12,12],color:"red"},initialize:function(e){L.setOptions(this,e),L.DivIcon.prototype.initialize.call(this,e)},setStyle:function(e){L.setOptions(this,e);var t="lpi-"+(new Date).getTime()+"-"+Math.round(1e5*Math.random());this.options.className=this.options.className+" leaflet-pulsing-icon "+t;var r="."+t+"{background-color:"+this.options.color+";}";r+="."+t+":after{box-shadow: 0 0 6px 2px "+this.options.color+";}";var o=document.createElement("style");o.styleSheet?o.styleSheet.cssText=r:o.appendChild(document.createTextNode(r)),document.getElementsByTagName("head")[0].appendChild(o)}}),MapExpress.Styles.PulseMarker=L.Marker.extend({statics:{PULSE_ICON:new MapExpress.Styles.PulseIcon},initialize:function(e,t){t||(t={}),MapExpress.Styles.PulseMarker.PULSE_ICON.setStyle(t),t.icon=MapExpress.Styles.PulseMarker.PULSE_ICON,L.Marker.prototype.initialize.call(this,e,t)}}),MapExpress.Styles.StyleDivIcon=L.DivIcon.extend({options:{style:"width:8px;height:8px;border-radius:50%;border-width:1px;border-style: solid;border-color:black;margin-left:-4px;margin-top:-4px;",className:"mapexpress-empty-marker-style"},createIcon:function(e){var t=L.DivIcon.prototype.createIcon.call(this,e);return this._styleDivIcon=t,this.options.id&&(t.id=this.options.id),this.options.style&&this.setStyle(this.options.style),t},setStyle:function(e){this.options.style=e,MapExpress.Controls.MapControlUtils.setStyle(this._styleDivIcon,this.options.style)}}),MapExpress.Styles.StyleMarker=L.Marker.extend({initialize:function(e,t){t||(t={}),t.icon=new MapExpress.Styles.StyleDivIcon(t),L.Marker.prototype.initialize.call(this,e,t)},setDivStyle:function(e){e&&this.options.icon&&this.options.icon instanceof MapExpress.Styles.StyleDivIcon&&this.options.icon.setStyle(e)}}),MapExpress.Tools.BaseMapCommand=L.Class.extend({_active:!1,options:{},initialize:function(e,t){this._mapManager=e,L.setOptions(this,t)},createContent:function(e){},activate:function(){},deactivate:function(){}}),MapExpress.Tools.ButtonBaseMapCommand=MapExpress.Tools.BaseMapCommand.extend({options:{buttonClassName:"map-toolbar-button",imageSrc:"",buttonText:"",title:"",id:""},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},createContent:function(e){if(this.button=L.DomUtil.create("button",this.options.buttonClassName,e),this.button.setAttribute("id",this.options.id),this.options.imageSrc&&0<this.options.imageSrc.length&&(this.image=L.DomUtil.create("img",!1,this.button),this.setButtonImage(this.options.imageSrc)),this.options.buttonText&&0<this.options.buttonText.length){var t=L.DomUtil.create("span",!1,this.button);$(t).html(this.options.buttonText)}return this.setButtonTitle(this.options.title),this.button},setButtonTitle:function(e){this.options.title=e,this.button&&this.button.setAttribute("title",this.options.title)},setButtonImage:function(e){this.options.imageSrc=e,this.image&&this.image.setAttribute("src",this.options.imageSrc)}}),MapExpress.Tools.MapClickBaseMapCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({initialize:function(e,t){MapExpress.Tools.ButtonBaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},activate:function(){this.prevCursor=window.MapManager._map._container.style.cursor,this._active||(this._mapManager._map.on("click",this._beforClick,this),this._mapManager._map.doubleClickZoom.disable(),this._mapManager._map.on("dblclick",L.DomEvent.stop)),window.MapManager._map._container.style.cursor="crosshair"},deactivate:function(){this._mapManager._map.off("click",this._beforClick,this),this._mapManager._map.doubleClickZoom.enable(),this._mapManager._map.off("dblclick",L.DomEvent.stop),window.MapManager._map._container.style.cursor=this.prevCursor},_beforClick:function(e){L.DomEvent.stopPropagation(e),this._checkClickOnMapObject(e)&&this.onClick(e)},onClick:function(e){},_checkClickOnMapObject:function(e){return!(!e.originalEvent.target.nodeName||"path"!==e.originalEvent.target.nodeName)||!!(e.originalEvent.target.className&&e.originalEvent.target.className.indexOf&&-1<e.originalEvent.target.className.indexOf("leaflet-container"))}}),MapExpress.Tools.BufferLineStringCommand=MapExpress.Tools.BaseMapCommand.extend({options:{buttonClassName:"map-toolbar-button",title:"Создание буфферной зоны линиии",bufferZoneStart:50,bufferZoneRange:{min:.5,max:500},bufferZoneStep:.5},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},createContent:function(e){var t=L.DomUtil.create("button",this.options.buttonClassName,e);return L.DomUtil.create("img",!1,t).setAttribute("src","images/rulers.png"),t.setAttribute("title","Создание буфферной зоны линии"),t.setAttribute("id","BufferLineStringCommand"),t},activate:function(){this.bufferable&&(this.bufferable.abortDrawing(),delete this.bufferable),this.bufferable=new MapExpress.Utils.BufferEditor(this._mapManager._map).startPolyline();var s=this;$(document).keydown(function(e){27===e.keyCode&&s.bufferable&&(s.bufferable.removeDrawing(),delete s.bufferable)}),this.form&&(this.form.hide(),delete this.form),this.form=new MapExpress.Controls.MapControl(this._mapManager._map,{titleText:"Буфферная зона",position:"bottomRight"});this.form.setContent('<div style="min-width:240px;">\t<div id="mapexpress-slider-plate">\t\t<a>Буферная зона (м)</a>\t<div id="mapexpress-slider-connect"></div>  \t<input type="number" id="mapexpress-buffer-distance-input" class="mapexpress-buffer-distance" placeholder="Дистанция буферной зоны (м)"> </input>\t</div></div>'),this.form.show();var i=document.getElementById("mapexpress-slider-connect");window.noUiSlider.create(i,{start:s.options.bufferZoneStart||50,connect:"lower",range:{min:s.options.bufferZoneRange.min||.5,max:s.options.bufferZoneRange.max||500},step:s.options.bufferZoneStep||.5}),s.bufferable.setDistance(i.noUiSlider.get(),!1),$("#mapexpress-buffer-distance-input").val(s.options.bufferZoneStart||50),i.noUiSlider.on("slide",function(e){s.bufferable.setDistance(Number(e[0]),!0),$("#mapexpress-buffer-distance-input").val(Number(e[0]))}),$("#mapexpress-buffer-distance-input").on("input",function(e){var t,r,o;t=$(e.target),r=t.val(),o=!0,isNaN(Number(r))&&(console.warn("Значение должно быть числовое"),t.val(1),o=!1),(Number(r)>i.noUiSlider.options.range.max||Number(r)<i.noUiSlider.options.range.min)&&(console.warn("Значение должно быть в заданном диапазоне слайдера"),Number(r)>i.noUiSlider.options.range.max&&t.val(i.noUiSlider.options.range.max),Number(r)<i.noUiSlider.options.range.min&&t.val(i.noUiSlider.options.range.min)),(o||(t.val(1),0))&&(i.noUiSlider.set(Number($(e.target).val())),s.bufferable.setDistance(i.noUiSlider.get(),!0))}),$(this.form._controlContent).css("overflow-y","auto"),$(this.form._controlContent).css("max-height",Number($(this.form._controlContent).parent().css("max-height").replace("px",""))-32+"px"),L.DomEvent.on(this.form._closeButton,"click",function(){s.bufferable&&(s.bufferable.removeDrawing(),delete s.bufferable)})},clearCommandAndControl:function(){this.bufferable&&(this.bufferable.removeDrawing(),delete this.bufferable,this._mapManager._map.bufferTools&&delete this._mapManager._map.bufferTools),this.form&&(this.form.hide(),delete this.form)}}),MapExpress.Controls.OkCancelDialogCustomNotHide=MapExpress.Controls.OkCancelDialog.extend({initialize:function(e,t){this._map=e,L.setOptions(this,t),this._initLayout(),this._initButtonGroup(),MapExpress.Controls.MapControlUtils.addClassName(this._controlContent,"mapexpress-control-content_notify")},_initButtonGroup:function(){var e=L.DomUtil.create("div","mapexpress-control-footerbar__buttongroup",this._controlFooterBar);this.okButton=L.DomUtil.create("button","mapexpress-control-footerbar__buttongroup__button",e),this.okButton.setAttribute("id","okbutton"),L.DomUtil.create("span","mapexpress-control-footerbar__buttongroup__button__text",this.okButton).textContent=this.options.okButtonText,MapExpress.Controls.MapControlUtils.stopMousePropagation(this.okButton),this.cancelButton=L.DomUtil.create("button","mapexpress-control-footerbar__buttongroup__button cancel",e),this.cancelButton.setAttribute("id","cancelbutton"),L.DomUtil.create("span","mapexpress-control-footerbar__buttongroup__button__text",this.cancelButton).textContent=this.options.cancelButtonText,MapExpress.Controls.MapControlUtils.stopMousePropagation(this.cancelButton)}}),MapExpress.Tools.CoordinatesRunnerCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({options:{buttonClassName:"map-toolbar-button",id:"GeomCoordsEditCommand",title:"Переход к координатам",buttonText:"<b>XY</b>"},initialize:function(e,t){MapExpress.Tools.ButtonBaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},activate:function(e){this.activeCoordsType="ddmmss",this._initOkCancelDialog()},deactivate:function(){this.OkCancelDialog&&this.OkCancelDialog.hide()},_initOkCancelDialog:function(){var t=this;this.OkCancelDialog=new MapExpress.Controls.OkCancelDialogCustomNotHide(window.MapManager._map,{closeButtonEnabled:!0,modal:!1,footerEnabled:!0,headerEnabled:!0,position:"bottomRight",okButtonText:"Перейти",cancelButtonText:"Отмена"}).setTitle(this.options.title).setContent('<div style="min-width:372px;">    <div class="mapexpress-coordinates-runner-wrapper">        <div class="mapexpress-coordinates-runner__coordinates-types">            <label class="mapexpress-coordinates-runner__radio-wrapper">\t\t\t\t<input id="ddmmss" class="mapexpress-coordinates-runner__radio" name="coordinatestype" type="radio" value="ddmmss" checked></input>\t\t\t\t<span></span>\t\t\t\tГрадусы, минуты, секунды\t\t\t</label>            <label class="mapexpress-coordinates-runner__radio-wrapper">\t\t\t\t<input id="dec" class="mapexpress-coordinates-runner__radio" name="coordinatestype" type="radio" value="dec"></input>\t\t\t\t<span></span>\t\t\t\tДесятичные градусы\t\t\t\t</label>        <div>    </div>    <div class="mapexpress-coordinates-runner__coordinates">        <div class="mapexpress-coordinates-runner_wrapper">            <label class="mapexpress-coordinates-runner-latlng__label">Широта</label>            <div class="mapexpress-coordinates-runner__latlng">                <div class="coordinates-runner__wrapper_degrees"><input class="coordinates-runner__inputs lat-inputs__degrees"></input></div>                <div class="coordinates-runner__wrapper_minutes"><input class="coordinates-runner__inputs lat-inputs__minutes"></input></div>                <div class="coordinates-runner__wrapper_seconds"><input class="coordinates-runner__inputs lat-inputs__seconds"></input></div>            </div>        </div>        <div class="mapexpress-coordinates-runner_wrapper">            <label class="mapexpress-coordinates-runner-latlng__label">Долгота</label>            <div class="mapexpress-coordinates-runner__latlng">                <div class="coordinates-runner__wrapper_degrees"><input class="coordinates-runner__inputs lng-inputs__degrees"></input></div>                <div class="coordinates-runner__wrapper_minutes"><input class="coordinates-runner__inputs lng-inputs__minutes"></input></div>                <div class="coordinates-runner__wrapper_seconds"><input class="coordinates-runner__inputs lng-inputs__seconds"></input></div>            </div>        </div>    </div></div>').show(),$(".mapexpress-coordinates-runner__radio").on("change",function(e){t.changeCoords(),t.activeCoordsType=e.target.id,$(".coordinates-runner__wrapper_seconds").toggle(),$(".coordinates-runner__wrapper_minutes").toggle(),$(".coordinates-runner__inputs").toggleClass("dec_hidden")}),this.OkCancelDialog.onOK(this.onOK,this),this.OkCancelDialog.onCancel(this.onCancel,this),this._onOKDialogShow(),this._validateInputs()},_validateInputs:function(){function r(e){var t=Number($(e.target).val());90<=t&&($(e.target).val(90),$(".lat-inputs__minutes").val(0),$(".lat-inputs__seconds").val(0)),t<=-90&&($(e.target).val(-90),$(".lat-inputs__minutes").val(0),$(".lat-inputs__seconds").val(0))}function o(e){if("-"!==$(e.target).val()){var t=Number($(e.target).val());180<=t&&($(e.target).val(180),$(".lng-inputs__minutes").val(0),$(".lng-inputs__seconds").val(0)),t<=-180&&($(e.target).val(-180),$(".lng-inputs__minutes").val(0),$(".lng-inputs__seconds").val(0))}}function e(e){var t=Number($(e.target).val());59<t&&$(e.target).val(59),t<0&&$(e.target).val(0),o({target:$(".lng-inputs__degrees")[0]}),r({target:$(".lat-inputs__degrees")[0]})}$(".coordinates-runner__inputs").on("input",function(e){var t=$(e.target).val();isNaN(Number(t))&&"-"!==t&&$(e.target).val(0)}),$(".lat-inputs__degrees").on("input",r),$(".lng-inputs__degrees").on("input",o),$(".lat-inputs__minutes").on("input",e),$(".lng-inputs__minutes").on("input",e),$(".lat-inputs__seconds").on("input",e),$(".lng-inputs__seconds").on("input",e)},_onOKDialogShow:function(){var e=this._mapManager._map.getCenter(),t=this._toDMS(e.lat),r=this._toDMS(e.lng);t.negative?($(".lat-inputs__degrees").val(t.d),$(".lat-inputs__degrees").val("-"+$(".lat-inputs__degrees").val())):$(".lat-inputs__degrees").val(t.d),r.negative?($(".lng-inputs__degrees").val(r.d),$(".lng-inputs__degrees").val("-"+$(".lng-inputs__degrees").val())):$(".lng-inputs__degrees").val(r.d),$(".lat-inputs__minutes").val(t.m),$(".lat-inputs__seconds").val(t.s),$(".lng-inputs__degrees").val(r.d),$(".lng-inputs__minutes").val(r.m),$(".lng-inputs__seconds").val(r.s)},_toDMS:function(e){var t=!1;Number(e)<0&&(t=!0);var r=Math.floor(Math.abs(e)),o=60*(Math.abs(e)-r),s=Math.floor(o),i=60*(o-s),a=Math.round(i);return 60===a&&(s++,a=0),60===s&&(r++,s=0),{d:r,m:s,s:a,negative:t}},_dmsToDec:function(e,t,r){var o;return o="-0"===e?-1:1,(Number(e)+t/60+r/3600).toFixed(10)*o},_collectData:function(){if("ddmmss"===this.activeCoordsType){var e=$(".lat-inputs__degrees").val(),t=$(".lng-inputs__degrees").val();return"-"===e&&(e=0,$(".lat-inputs__degrees").val(e)),"-"===t&&(t=0,$(".lng-inputs__degrees").val(t)),{latd:e,latm:$(".lat-inputs__minutes").val(),lats:$(".lat-inputs__seconds").val(),lngd:t,lngm:$(".lng-inputs__minutes").val(),lngs:$(".lng-inputs__seconds").val()}}if("dec"===this.activeCoordsType)return{latd:$(".lat-inputs__degrees").val(),lngd:$(".lng-inputs__degrees").val()}},_convertData:function(e){return"ddmmss"===this.activeCoordsType?{lat:this._dmsToDec(e.latd,Number(e.latm),Number(e.lats)),lng:this._dmsToDec(e.lngd,Number(e.lngm),Number(e.lngs))}:"dec"===this.activeCoordsType?{lat:this._toDMS(Number(e.latd)),lng:this._toDMS(Number(e.lngd))}:void 0},changeCoords:function(){var e=this._collectData(),t=this._convertData(e);"ddmmss"===this.activeCoordsType?($(".lat-inputs__degrees").val(t.lat),$(".lat-inputs__minutes").val(""),$(".lat-inputs__seconds").val(""),$(".lng-inputs__degrees").val(t.lng),$(".lng-inputs__minutes").val(""),$(".lng-inputs__seconds").val("")):"dec"===this.activeCoordsType&&(t.lng.negative?($(".lng-inputs__degrees").val(t.lng.d),$(".lng-inputs__degrees").val("-"+$(".lng-inputs__degrees").val())):$(".lng-inputs__degrees").val(t.lng.d),t.lat.negative?($(".lat-inputs__degrees").val(t.lat.d),$(".lat-inputs__degrees").val("-"+$(".lat-inputs__degrees").val())):$(".lat-inputs__degrees").val(t.lat.d),$(".lat-inputs__minutes").val(t.lat.m),$(".lat-inputs__seconds").val(t.lat.s),$(".lng-inputs__minutes").val(t.lng.m),$(".lng-inputs__seconds").val(t.lng.s))},onOK:function(e){var t,r,o=this._collectData();"ddmmss"===this.activeCoordsType?(t=Number(this._dmsToDec(o.latd,Number(o.latm),Number(o.lats))),r=Number(this._dmsToDec(o.lngd,Number(o.lngm),Number(o.lngs)))):"dec"===this.activeCoordsType&&(t=Number(o.latd),r=Number(o.lngd)),this._mapManager._map.setView([t,r],this._mapManager._map.getZoom()),this._mapManager.addPulseMarker(new L.latLng(t,r),3e3)},onCancel:function(){this.OkCancelDialog.hide()}}),MapExpress.Tools.FileLoaderAndShowAsLayerCommand=MapExpress.Tools.BaseMapCommand.extend({options:{buttonClassName:"map-toolbar-button",title:"Загрузка файла"},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},createContent:function(e){var t=L.DomUtil.create("button",this.options.buttonClassName,e);return L.DomUtil.create("img",!1,t).setAttribute("src","images/addlayer.png"),t.setAttribute("title","Загрузка файла"),t.setAttribute("id","FileLoaderAndShowAsLayerCommand"),t},activate:function(){this.form&&(this.form.hide(),delete this.form),this.form=new MapExpress.Controls.MapControl(this._mapManager._map,{headerEnabled:!0,closeButtonEnabled:!0,position:"center"}),this.form.setTitle("Загрузка файлов"),this.createFormElements(),this.form.show()},createFormElements:function(){var o=this,e=$(this.form._controlContent),t=$('<div id="mapexpress-drag-and-drop-zone">Для загрузки, перетащите файл сюда.<br />Форматы:  geoJSON, WKT, CSV, GML, KML, GPX</div>'),r=$('<div id="mapexpress-file-uploader-form"><button type="button" class="mapexpress-primary-button">Выбрать файл и отобразить на карте</button></div>'),s=$('<input type="file" id="mapexpress-file-uploader" style="display:none;"></input>'),i=$('<label class="mapexpress-drag-and-drop-error-label"></label>');function a(e){function r(e){$(".mapexpress-drag-and-drop-error-label").text(""),$(".mapexpress-drag-and-drop-error-label").text(e),setTimeout(function(){$(".mapexpress-drag-and-drop-error-label").text("")},5e3)}o.readAllFileAsync.apply(o,_toConsumableArray(e)).then(function(e){var t;try{t=o.convertReadedFileData.apply(o,_toConsumableArray(e))}catch(e){s.val(""),r("Не удалось преобразовать формат")}if(t)try{o.processConvertedGeoJSON(t,e[2])}catch(e){s.val(""),r("Не удалось добавить слой на карту")}else r("Не удалось преобразовать формат");s.val("")},function(e){r(e),s.val("")})}e.append(t).append(r).append(s).append(i),r.on("click",function(e){e.stopPropagation(),$("#mapexpress-file-uploader").trigger("click")}),$("#mapexpress-file-uploader").bind({change:function(){a(this.files)}}),t.bind({dragover:function(){return!1},dragenter:function(){return!1},dragleave:function(){return!1},drop:function(e){return a(e.originalEvent.dataTransfer.files),!1}})},processConvertedGeoJSON:function(e,t){this.createGeoJsonLayer(e,t)},readAllFileAsync:function(i){return new Promise(function(t,r){if(i){var e=new FileReader,o=i.name.split("."),s=o.pop().toLowerCase();-1!==["csv","wkt","geojson","kml","gml","gpx","xml"].indexOf(s)?(e.onload=function(e){t([e.target.result,s,o.toString()])},e.onerror=function(e){r("Не удалось прочитать файл")},e.readAsText(i)):setTimeout(function(){r("Формат файла не поддерживается")},10)}else setTimeout(function(){r("Не выбран файл")},10)})},convertReadedFileData:function(e,t){var r=void 0,o={csv:MapExpress.Utils.GeoFormatConvertor.csv,csvopts:{latfield:"lat",lonfield:"lon",delimiter:"auto"},esri:MapExpress.Utils.GeoFormatConvertor.esri,wkt:MapExpress.Utils.GeoFormatConvertor.wkt,gml:new MapExpress.Utils.GeoFormatConvertor.GML,gmlopts:"gml2",gpx:new MapExpress.Utils.GeoFormatConvertor.GPX,kml:new MapExpress.Utils.GeoFormatConvertor.KML,xml:new MapExpress.Utils.GeoFormatConvertor.XML};if("geojson"===t){if(null===(r=o.esri.toGeoJSON(e)))return JSON.parse(e)}else try{var s=o[t],i=o[t+"opts"];r=s.toGeoJSON(e,i)}catch(e){return!1}return r},createGeoJsonLayer:function(e,t){var r=new MapExpress.Layers.GeoJSONServiceLayer(new MapExpress.Service.GeoJSONProvider(""));r.options.queryable=!0,r.options.visibleIndex=1,r.options.maxZoom=24,r.options.minZoom=0,r.id=t+"-"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),r.options.dynamicData=!1,r._singleDataLoaded=!0;var o=new MapExpress.Mapping.LayerModel(r.id);return o.options.displayName=t,o.options.type="overlay",o.mapLayer=r,window.MapManager.getMapModel().addLayer(o),r._replaceData(e),window.MapManager.setLayerVisible(r.id,!0),window.MapManager._map.fitBounds(r.getBounds()),r}}),MapExpress.Tools.GeomCoordsEditCommand=MapExpress.Tools.BaseMapCommand.extend({options:{buttonClassName:"map-toolbar-button",templateUrl:"/templates/GeometryCoordinatesControl.html",templateId:"GeometryCoordinatesControl"},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},createContent:function(e){var t=L.DomUtil.create("button",this.options.buttonClassName,e),r=L.DomUtil.create("img",!1,t);return r.setAttribute("src","images/legend.png"),r.style.width="24px",r.style.height="24px",t.setAttribute("title","Редактирование"),t.setAttribute("id","GeomCoordsEditCommand"),t},activate:function(e){console.log(e),this.GeometryCoordinatesEditControl&&(this.GeometryCoordinatesEditControl.clearControl(),delete this.GeometryCoordinatesEditControl),this.GeometryCoordinatesEditControl=new MapExpress.Controls.GeometryCoordinatesEdit(this._mapManager._map,{titleText:"Координаты и геометрия",headerEnabled:!0,footerEnabled:!1,closeButtonEnabled:!0,position:"right"},new MapExpress.GeomCoordsEditController(this._mapManager._map)),this.GeometryCoordinatesEditControl.show()},deactivate:function(){console.log(this)}}),MapExpress.Tools.IdentifyMapCommand=MapExpress.Tools.MapClickBaseMapCommand.extend({statics:{maxHeightMinus:.1,maxWidthMinus:.5,showFloatWindow:!0},options:{buttonClassName:"map-toolbar-button",templateUrl:"templates/layerInfo.html",templateId:"layerInfoTemplateId",templateHelpers:"layerInfoTemplateIdAfterRender",title:"Информация",id:"identiftMapCommand",imageSrc:"images/info.png"},initialize:function(e,t){MapExpress.Tools.MapClickBaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},deactivate:function(){MapExpress.Tools.MapClickBaseMapCommand.prototype.deactivate.call(this),this._deletePrevWindow()},_deletePrevWindow:function(){this.popupWindow&&(this.popupWindow.options.destroyOnClose=!0,this.popupWindow.destroy(),delete this.popupWindow),this._mapManager.identifyWindow&&delete this._mapManager.identifyWindow},onClick:function(e){this._deletePrevWindow();var t=this._getQueryableLayers();t.sort(function(e,t){return e.mapLayer instanceof MapExpress.Layers.GeoJSONServiceLayer&&!(t.mapLayer instanceof MapExpress.Layers.GeoJSONServiceLayer)?-1:t.mapLayer instanceof MapExpress.Layers.GeoJSONServiceLayer&&!(e.mapLayer instanceof MapExpress.Layers.GeoJSONServiceLayer)?1:0});var r=this._mapManager._map,o=e.latlng,s=e.containerPoint,i=r.getZoom(),a=r.getBounds(),n=r.getSize(),l=0,p={};p.latlng=o,p.identifiedResults=[];for(var d=0;d<t.length;d++){var c=t[d],h=c.mapLayer._dataPovider;if(h){var u=h.getFeatureInfoAsync(o,s,a,n,i);if(!u&&c.mapLayer instanceof MapExpress.Layers.GeoJSONServiceLayer&&(u=c.mapLayer._getFeaturesAtPoint(o,e.layerPoint,a,n,i)),u){var m={};m.dataPromise=u,m.layerName=c.options.displayName,m.numberInList=l,m.afterRenderFeatureInfoContentCallback=h.afterRenderFeatureInfoContentCallback,h.identifyTemplate&&(m.templatePromise=h.identifyTemplate(),m.templateId=h.options.templateId,m.templateUrl=h.options.templateUrl),p.identifiedResults.push(m),l++}}}this._showInfo(p)},_getQueryableLayers:function(){for(var e=[],t=this._mapManager.getMapModel().getQueryableLayers(),r=0;r<t.length;r++)this._mapManager.layerEnabled(t[r].id)&&e.push(t[r]);return e},_showInfo:function(r){if(this._deletePrevWindow(),r&&0!==r.identifiedResults.length){this._mapManager.addPulseMarker(r.latlng,3e3);var o=this;void 0!==this.options.templateUrl&&void 0!==this.options.templateId?MapExpress.Controls.MapControlUtils.generateTemplate(this.options.templateUrl,this.options.templateId,r,function(e){var t={headerEnabled:!0,closeButtonEnabled:!0,className:"mapexpress-layer-info-control",resizeable:!0,controlId:"mapexpress-identify-control"};t.maxHeightMinus=MapExpress.Tools.IdentifyMapCommand.maxHeightMinus,t.maxWidthMinus=MapExpress.Tools.IdentifyMapCommand.maxWidthMinus,t.position=MapExpress.Tools.IdentifyMapCommand.showFloatWindow?"center":"left",o.popupWindow=MapExpress.Tools.IdentifyMapCommand.showFloatWindow?new MapExpress.Controls.MapPopupControl(o._mapManager._map,t):new MapExpress.Controls.MapControl(o._mapManager._map,t),o.popupWindow.setTitle("Информация в точке: "+r.latlng.toString()).setContent(e).setContentStyle({overflow:"hidden"}),o.popupWindow.show().bringToFront(),o.popupWindow instanceof MapExpress.Controls.MapPopupControl&&o.popupWindow.setLatLngPosition(r.latlng);o._mapManager.identifyWindow=o.popupWindow,(o.options.templateHelpers&&void 0!==o.options.templateHelpers||o.options.templateHelpers&&null!==o.options.templateHelpers)&&$.views.helpers[o.options.templateHelpers](r,o.options.templateUrl);window.MapManager.fire("mapexpress:identifytool:windowopened",o.popupWindow),o.popupWindow.on("mapcontrol:remove:before",function(){window.MapManager.fire("mapexpress:identifytool:beforewindowclose",o.popupWindow),window.MapManager.removeEventListener("mapexpress:identifytool:beforewindowclose")},o)}):new MapExpress.Controls.MapControl(window.MapManager._map,{removalDelay:3e3}).setContent("<b>Не задано представление</b>").show()}}}),MapExpress.Service.identifyMapCommand=function(e,t){return new MapExpress.Tools.IdentifyMapCommand(e,t)},MapExpress.Tools.ActiveViewMapExportCommand=MapExpress.Tools.BaseMapCommand.extend({options:{buttonClassName:"map-toolbar-button",title:"Экспорт карты",showProjList:!0},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t),this.options.showProjList&&(this.options.projListUrl?this.projsListViaAjax():this.standartProjList())},createContent:function(e){var t=L.DomUtil.create("button",this.options.buttonClassName,e);return L.DomUtil.create("img",!1,t).setAttribute("src","images/print.png"),t.setAttribute("title","Экспорт активного вида карты"),t.setAttribute("id","exportMapImage"),t},activate:function(){this.printer=new MapExpress.Utils.MapExporter,this.printer.on(this._getEvents(),this),this.printer.exportActiveMapView(this._mapManager._map)},deactivate:function(){this.printer&&this.printer.off(this._getEvents(),this),this.waitWindow&&this.waitWindow.hide(),delete this.waitWindow,delete this.printer},onRemoved:function(){this.waitWindow&&this.waitWindow.hide(),this.printWindow&&this.printWindow.hide(),this.deactivate()},_getEvents:function(){return{"mapexport:export:start":this._onExportStart,"mapexport:html2canvas":this._onStartHtml2Canvas,"mapexport:export:end":this._onExportEnd}},_onExportStart:function(e){this.printWindow&&this.printWindow.hide(),this._showWait("Подготовка карты ")},_onStartHtml2Canvas:function(e){this._showWait("Формирование растра ")},standartProjList:function(){var e=[],t=9e5;for(var r in window.CAD.DEFAULTS.projections)e.push(new L.Proj.CRS("EPSG:"+t,window.CAD.DEFAULTS.projections[r])),t++;this.options.coordinatesSystems=[L.CRS.EPSG3395,L.CRS.EPSG3857,L.CRS.EPSG4326].concat(e),this.activeCoordinatesSystems=null},projsListViaAjax:function(){var s=this;MapExpress.Utils.Promise.Ajax(this.options.projListUrl).then(function(e){s.options.coordinatesSystems=[],s.activeCoordinatesSystems=null;for(var t=0;t<e.length;t++)s.options.coordinatesSystems.push(new L.Proj.CRS("EPSG:"+e[t].srid,e[t].proj4text)),s.options.coordinatesSystems[t].title=e[t].name;for(var r=$("#mapexpress-export-avaliable-coordinates-system").children(),o=r.length-1;0<=o;o--)$(r[o]).remove()},function(e){s.standartProjList(),console.warn("Не удалось получить список систем координат.")})},_createCoordinatesSystems:function(e){e.find("#mapexpress-export-avaliable-coordinates-system").parent().hide();for(var t=0;t<this.options.coordinatesSystems.length;t++){var r=$("<li/>");r.attr("id",this.options.coordinatesSystems[t].code),"EPSG:3395"!==this.options.coordinatesSystems[t].code||this.options.coordinatesSystems[t].title?"EPSG:3857"!==this.options.coordinatesSystems[t].code||this.options.coordinatesSystems[t].title?"EPSG:4326"!==this.options.coordinatesSystems[t].code||this.options.coordinatesSystems[t].title||(this.options.coordinatesSystems[t].title="WGS 84"):this.options.coordinatesSystems[t].title="Pseudo-Mercator Сферический Меркатор":this.options.coordinatesSystems[t].title="World Mercator на сфероиде",r.html(this.options.coordinatesSystems[t].title||this.options.coordinatesSystems[t].projection._proj.title),$("#mapexpress-export-avaliable-coordinates-system").append(r)}},setActiveCRS:function(e,t){for(var r,o=this.options.coordinatesSystems.length-1;0<=o;o--)this.options.coordinatesSystems[o].code===e&&(r=o);r?(this.activeCoordinatesSystem=this.options.coordinatesSystems[r],$("#mapexpress-export-active-coordinates-system").val(this.options.coordinatesSystems[r].title||this.options.coordinatesSystems[r].projection._proj.title)):(this.activeCoordinatesSystem=this.options.coordinatesSystems[0],$("#mapexpress-export-active-coordinates-system").val(this.options.coordinatesSystems[0].title||this.options.coordinatesSystems[0].projection._proj.title)),this._updateBBOXResultViaCoordsSystem(t)},_updateBBOXResultViaCoordsSystem:function(e){$(".mapexpress-export-proj-files").remove();for(var t=$('<div class="mapexpress-export-proj-files">'),r=MapExpress.Mapping.RasterUtils.generateWldFileHref(this.result.bbox,this.result.imageSize,this.activeCoordinatesSystem),o=this._createLink("export.wld",r,"Файл привязки (export.wld)","mapexpress-export-wld"),s=MapExpress.Mapping.RasterUtils.generateMapInfoWldFileHref(this.result.bbox,this.result.imageSize,"export.jpg",this.activeCoordinatesSystem),i=this._createLink("export.tab",s,"Файл привязки MapInfo (export.tab)","mapexpress-export-tab"),a=MapExpress.Mapping.RasterUtils.generateMapInfoWldFileHref(this.result.bbox,this.result.imageSize,"export.jpg",this.activeCoordinatesSystem,!0),n=this._createLink("export.tab",a,"Файл привязки MapInfo (export.tab план-схема)","mapexpress-export-tab"),l=$(".mapexpress-export-coordinates-systems").parent().find("a"),p=0;p<l.length;p++)"export.wld"===$(l[p]).attr("download")&&($(l[p]).next().remove(),$(l[p]).remove()),"export.tab"===$(l[p]).attr("download")&&$(l[p]).remove();t.append($(o)).append($("</br>")).append($(i)).append($("</br>")).append($(n)),e.append(t),this.crutchIE(r,"export.wld").crutchIE(s,"export.tab").crutchIE(n,"export.tab")},_initCRSContol:function(t){var r=this,e=this._mapManager._map.options.crs.code;if(this.options.showProjList?this.setActiveCRS(e,t):(this.activeCoordinatesSystem=L.CRS.EPSG4326,this._updateBBOXResultViaCoordsSystem(t)),this.options.showProjList){for(var o=$("#mapexpress-export-avaliable-coordinates-system").find("li"),s=o.length-1;0<=s;s--)$(o[s]).attr("id")===e&&$(o[s]).addClass("active");$("#mapexpress-export-active-coordinates-system").on("click",function(){$("#mapexpress-export-avaliable-coordinates-system").parent().show()}),$("#mapexpress-export-avaliable-coordinates-system").find("li").on("click",function(e){$("#mapexpress-export-avaliable-coordinates-system").find("li").removeClass("active"),r.setActiveCRS($(e.currentTarget).attr("id"),t),$(e.currentTarget).addClass("active"),$("#mapexpress-export-avaliable-coordinates-system").parent().hide()}),$(".mapexpress-export-hide-coordinates-system").on("click",function(){$("#mapexpress-export-avaliable-coordinates-system").parent().hide()}),$("#mapexpress-export-avaliable-coordinates-system_autocomplete").on("input",function(e){var t=$(e.currentTarget).val();if($(o).show(),""!==t&&null!=t)for(var r=0;r<$(o).length;r++)-1===$(o[r]).html().toLowerCase().indexOf(t.toLowerCase())&&$(o[r]).hide()})}},_onExportEnd:function(e){if(this.onRemoved(),e.error)new MapExpress.Controls.MapControl(window.MapManager._map).showErrorWindow("Ошибка экспорта карты");else{this.result=e,this.resultControl=new MapExpress.Controls.MapControl(this._mapManager._map,{headerEnabled:!0,closeButtonEnabled:!0}),this.resultControl.setControlStyle({"min-width":"250px"});var t=this._createLink("export.jpg",this.result.image,"Растр (export.jpg)","mapexpress-export-raster");if(this.resultControl.setContent(t),this.options.showProjList){var r=$('<div class="mapexpress-export-coordinates-systems">'),o=$('<i class="mapexpress-export-change-active-coordinates-system"></i>'),s=$('<input id="mapexpress-export-active-coordinates-system" readonly placeholder="Система координат"></input>'),i=$('<div><i class="mapexpress-export-hide-coordinates-system"></i><input id="mapexpress-export-avaliable-coordinates-system_autocomplete" placeholder="Поиск..."></input><ul id="mapexpress-export-avaliable-coordinates-system"></ul></div>');r.append(o).append(s).append(i),r.prependTo($(this.resultControl._controlContent)),this._createCoordinatesSystems($(this.resultControl._controlContent))}this._initCRSContol($(this.resultControl._controlContent)),this.resultControl.setTitle("Результат экспорта карты в графический формат"),this.resultControl.show(),this.crutchIE(this.result.image,"export.jpg")}},_createLink:function(e,t,r,o){var s,i,a;return"download"in document.createElement("a")?(i=document.createElement("div"),(a=document.createElement("a")).download=e,a.href=t,a.id=o,$(a).html(r)):(i=document.createElement("div"),a=document.createElement("a"),$(a).html(r),$(a).attr("class","export-map"+e.split(".")[1]),a.id=o),i.appendChild(a),s=$(i).html(),$(i).remove(),s},crutchIE:function(e,t){var r,o;return"export.jpg"!==t?(e=e.replace("data:text/plain;charset=utf-8,",""),r=decodeURIComponent(e),o=new Blob([r],{type:"text/plain",endings:"native"})):o=e,$(".export-map"+t.split(".")[1]).click(function(){window.navigator.msSaveOrOpenBlob(o,t)}),this},_showWait:function(e){this.waitWindow||(this.waitWindow=new MapExpress.Controls.MapControl(this._mapManager._map)),this.waitWindow.showWaitControl(e)}}),MapExpress.Tools.MapExportCommand=MapExpress.Tools.ActiveViewMapExportCommand.extend({options:{buttonClassName:"map-toolbar-button",draggable:!0},initialize:function(e,t){MapExpress.Tools.ActiveViewMapExportCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},createContent:function(e){var t=L.DomUtil.create("button",this.options.buttonClassName,e);return L.DomUtil.create("img",!1,t).setAttribute("src","images/print.png"),t.setAttribute("title","Экспорт карты"),t.setAttribute("id","exportMapImage"),t},activate:function(){this.waitWindow=new MapExpress.Controls.MapControl;this.printControl=new MapExpress.Controls.MapExportControl(this._mapManager._map,{draggable:this.options.draggable||!1}),this.printer=this.printControl.printer,this.printWindow=new MapExpress.Controls.MapControl(this._mapManager._map,{position:"top",headerEnabled:!0,footerEnabled:!0,closeButtonEnabled:!0}),this.printWindow.setContent(this.printControl._createContent()),this.printWindow.setTitle("Экспорт карты "),this.printWindow.setFooterContent("Выберите область и укажите масштабный уровень карты"),this.printControl._setUpButtonHandlers(),this.printControl._activateAreaSelect(),this.printWindow.show(),this._updateFooterOnZoomChange(this.printControl),this._mapManager._map.on("map-print-control:removed",this.onRemoved,this),this.printWindow.on("mapcontrol:remove:after",function(){this.printControl.remove()},this),this.printer.on("mapexport:export:start",this._onExportStart,this),this.printer.on("mapexport:html2canvas:start",this._onStartHtml2Canvas,this),this.printer.on("mapexport:export:end",this._onExportEnd,this),this._mapManager._map.on("map-print-control:zoomUp",this._updateFooterOnZoomChange,this),this._mapManager._map.on("map-print-control:zoomDown",this._updateFooterOnZoomChange,this),this._mapManager._map.on("map-print-control:futuresize:changed",this._updateFooterOnZoomChange,this)},deactivate:function(){this.printer&&(this.printer.off("mapexport:export:start",this._onExportStart,this),this.printer.off("mapexport:html2canvas:start",this._onStartHtml2Canvas,this),this.printer.off("mapexport:export:end",this._onExportEnd,this)),this._mapManager._map.off("map-print-control:zoomUp",this._updateFooterOnZoomChange,this),this._mapManager._map.off("map-print-control:zoomDown",this._updateFooterOnZoomChange,this),this._mapManager._map.off("map-print-control:futuresize:changed",this._updateFooterOnZoomChange,this),this.printWindow&&this.printWindow.destroy(),this.waitWindow&&this.waitWindow.destroy(),delete this.printWindow,delete this.waitWindow,delete this.printControl,delete this.printer},_updateFooterOnZoomChange:function(e){var t="Размер изображения: "+e.futureSize.size+" px, W="+e.futureSize.width+" px , H="+e.futureSize.height+" px";this.printWindow.setFooterContent(t),this.printWindow.setFooterBarStyle("color:"+this.printControl._getWarningColor())}}),MapExpress.Tools.MapModelLoaderCommand=MapExpress.Tools.BaseMapCommand.extend({options:{buttonClassName:"map-toolbar-button",title:"Загрузка файла карты"},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},createContent:function(e){var t=L.DomUtil.create("button",this.options.buttonClassName,e);return L.DomUtil.create("img",!1,t).setAttribute("src","images/addlayer.png"),t.setAttribute("title","Загрузка файла карты"),t.setAttribute("id","MapModelLoaderCommand"),t},activate:function(){this.form&&(this.form.hide(),delete this.form),this.form=new MapExpress.Controls.MapControl(this._mapManager._map,{headerEnabled:!0,closeButtonEnabled:!0,position:"center"}),this.form.setTitle("Загрузка файла карты"),this.createFormElements(),this.form.show()},createFormElements:function(){var r=this,e=$(this.form._controlContent),t=$('<div id="mapexpress-drag-and-drop-zone">Для загрузки, перетащите файл сюда.</div>'),o=$('<div id="mapexpress-file-uploader-form"><button type="button" class="mapexpress-primary-button">Выбрать файл</button></div>'),s=$('<input type="file" id="mapexpress-map-model-file-uploader" style="display:none;"></input>'),i=$('<label class="mapexpress-drag-and-drop-error-label"></label>');function a(e){function t(e){$(".mapexpress-drag-and-drop-error-label").text(""),$(".mapexpress-drag-and-drop-error-label").text(e),setTimeout(function(){$(".mapexpress-drag-and-drop-error-label").text("")},5e3)}r.readAllFileAsync(e[0]).then(function(e){r.convertReadedFileDataToMapModel(e).then(function(e){r.processMapModel(e)},function(e){t("Не удалось прочитать файл")}),s.val("")},function(e){t(e),s.val("")})}e.append(t).append(o).append(s).append(i),o.on("click",function(e){e.stopPropagation(),$("#mapexpress-map-model-file-uploader").trigger("click")}),$("#mapexpress-map-model-file-uploader").bind({change:function(){a(this.files)}}),t.bind({dragover:function(){return!1},dragenter:function(){return!1},dragleave:function(){return!1},drop:function(e){return a(e.originalEvent.dataTransfer.files),!1}})},readAllFileAsync:function(o){return new Promise(function(t,r){if(o){var e=new FileReader;e.onload=function(e){t([e.target.result])},e.onerror=function(e){r("Не удалось прочитать файл")},e.readAsText(o)}else setTimeout(function(){r("Не выбран файл")},5)})},convertReadedFileDataToMapModel:function(o){var s=this;return new Promise(function(e,t){var r;try{r=JSON.parse(o)}catch(e){t(e)}e(new MapExpress.Mapping.MapModelBuilder(s._mapManager._map).createMapModel(r))})},processMapModel:function(e){return e}}),MapExpress.Tools.MapToolbar=L.Control.extend({options:{position:"topleft",containerClassName:"map-toolbar"},divider:{createContent:function(e){return L.DomUtil.create("span","divider1",e)}},initialize:function(e,t){this._mapManager=e,L.setOptions(this,t),this._commands=[],window.MapManager._map.tempCommands||(window.MapManager._map.tempCommands=[])},onAdd:function(){return this._createContainer()},addTo:function(){L.Control.prototype.addTo.call(this,this._mapManager._map)},addCommand:function(e){return this._commands.push(e),this},addDivider:function(){},_createContainer:function(){this._container=L.DomUtil.create("div",this.options.containerClassName),this._container.style.padding="3px",this.panelBody=L.DomUtil.create("div","panel-body",this._container),this.panelBody.style.padding="3px";for(var e=0;e<this._commands.length;e++)this._createCommandContent(this._commands[e],this.panelBody),window.MapManager._map.tempCommands.push(this._commands[e]);return MapExpress.Controls.MapControlUtils.stopMousePropagation(this._container),this.options.style&&MapExpress.Controls.MapControlUtils.setStyle(this._container,this.options.style),this._container},_createCommandContent:function(e){var t=this,r=e.createContent(this.panelBody);return r.command=e,MapExpress.Controls.MapControlUtils.stopMousePropagation(r),L.DomEvent.addListener(r,"click",function(){t._activeCommand&&(t._activeCommand.deactivate(),t._activeCommand._active=!1),t._tempDeactivateAllCommands(),t._activeCommand=r.command,r.command.activate(),window.MapManager.fire("mapexpress:maptoolbar:command:activated",r.command),r.command._active=!0}),r},addControlFromTemplate:function(e,t,r,o){var s=this;MapExpress.Controls.MapControlUtils.generateTemplate(e,t,r,function(e){$(s.panelBody).append(e),o&&"function"==typeof o&&o()})},_tempDeactivateAllCommands:function(){if(window.MapManager._map.tempCommands)for(var e=0;e<window.MapManager._map.tempCommands.length;e++)window.MapManager._map.tempCommands[e].deactivate()}}),MapExpress.Tools.LineMeasureCommand=MapExpress.Tools.BaseMapCommand.extend({options:{buttonClassName:"map-toolbar-button",title:"Измерение расстояний"},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},createContent:function(e){var t=L.DomUtil.create("button",this.options.buttonClassName,e);return L.DomUtil.create("img",!1,t).setAttribute("src","images/rulers.png"),t.setAttribute("title","Измерение расстояний"),t.setAttribute("id","measureLenghtCommand"),t},activate:function(){this.measurable&&delete this.measurable,this.measurable=new L.Measurable(this._mapManager._map).startPolyline();var t=this;$(this._mapManager._map.getContainer()).keydown(function(e){27===e.keyCode&&t.measurable&&(t.measurable.removeDrawing(),delete t.measurable)})},deactivate:function(){this.measurable&&(this.measurable.abortDrawing(),delete this.measurable)}}),MapExpress.Tools.SqrtMeasureCommand=MapExpress.Tools.BaseMapCommand.extend({options:{buttonClassName:"map-toolbar-button",title:"Измерение площади"},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},createContent:function(e){var t=L.DomUtil.create("button",this.options.buttonClassName,e);return L.DomUtil.create("img",!1,t).setAttribute("src","images/Polygon.png"),t.setAttribute("title","Измерение площади"),t.setAttribute("id","measureSqrtCommand"),t},activate:function(){this.measurable&&delete this.measurable,this.measurable=new L.Measurable(this._mapManager._map).startPolygon();var t=this;$(this._mapManager._map.getContainer()).keydown(function(e){27===e.keyCode&&t.measurable&&(t.measurable.removeDrawing(),delete t.measurable)})},deactivate:function(){this.measurable&&(this.measurable.abortDrawing(),delete this.measurable)}}),MapExpress.Tools.OpenSideBarCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},activate:function(){var e=this;this.sideBar&&(this.sideBar.hide(),delete this.sideBar),this.sideBar=new MapExpress.Controls.MapControl(this._mapManager._map,{closeOnLeave:!0}).showSidebar(this.options.template,this.options.templateId,this.options.data,function(){(e.options.templateHelpers&&void 0!==e.options.templateHelpers||e.options.templateHelpers&&null!==e.options.templateHelpers)&&$.views.helpers[e.options.templateHelpers]()})}}),MapExpress.Tools.QuickInfoCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({options:{imageSrc:"images/label_y.gif",title:"Показать подсказку",id:"quickInfoCommand",minZoom:14,minZoomForPermanent:!1,offset:L.point(3,3),permanent:!0,sticky:!0,className:"mapexpress-leaflet-tooltip",layers:[]},_activated:!1,initialize:function(e,t){MapExpress.Tools.ButtonBaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},activate:function(){this.initLayers(),this._activated=!this._activated,this._process(this._activated),this._activated?this.setButtonTitle("Скрыть подсказку"):this.setButtonTitle("Показать подсказку")},getTooltipByFeatureLayer:function(e){return e.feature.properties["Кадастровый номер"]},_process:function(e){if(this.options.layers){window.MapManager._map.getZoom()<this.options.minZoom&&(e=!1);for(var t=this.options.layers.length-1;0<=t;t--){var r=this.options.layers[t].mapLayer;if(r)for(var o in this._activated?r.on("mapexspress:layer:data:added",this._bindTooltipOnAddData,this):r.off("mapexspress:layer:data:added",this._bindTooltipOnAddData,this),r._layers){var s=r._layers[o];this._onEachFeature(s,e)}}}},_bindTooltipOnAddData:function(e){var t=!0;for(var r in window.MapManager._map.getZoom()<this.options.minZoom&&(t=!1),e.target._layers){var o=e.target._layers[r];this._onEachFeature(o,t)}},_onEachFeature:function(e,t){if(t){var r=!!(this.options.minZoomForPermanent&&this.options.minZoomForPermanent<window.MapManager._map.getZoom())||this.options.permanent;e.bindTooltip(this.getTooltipByFeatureLayer(e),{offset:this.options.offset,permanent:r,sticky:this.options.sticky,className:this.options.className})}else e.unbindTooltip()}}),MapExpress.Tools.SelectionCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({options:{imageSrc:"images/check_@2X.png",title:"Выбор объектов",id:"selectioncommand",destroySelectionsOnDeactivate:!1,layerDescriptions:[],selectionStyle:{weight:2,color:"red",fillColor:"red",radius:5,fillOpacity:.9}},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t),this.onEscapeKeyPressHandler=this.onEscapeKeyPressHandler.bind(this)},activate:function(){if(this.options.layerDescriptions&&0<this.options.layerDescriptions.length)for(var e=this.options.layerDescriptions.length-1;0<=e;e--)if(this.options.layerDescriptions[e].layerId&&this.options.layerDescriptions[e].featureKeyFieldName){var t=this._mapManager.getSelection(this.options.layerDescriptions[e].layerId,this.options);t&&(t.options.featureKeyFieldName=this.options.layerDescriptions[e].featureKeyFieldName,t.options.selectionStyle=this.options.selectionStyle)}this.onEscapeKeyPress&&this.onEscapeKeyPress()},deactivate:function(){this.options.destroySelectionsOnDeactivate&&(this._mapManager.clearSelections(),this.onEscapeKeyPressHandler&&document.removeEventListener("keydown",this.onEscapeKeyPressHandler))},onEscapeKeyPress:function(){document.addEventListener("keydown",this.onEscapeKeyPressHandler)},onEscapeKeyPressHandler:function(e){27===e.keyCode&&this.deactivate()}}),MapExpress.Tools.SelectorBaseMapsCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({options:{templateUrl:"templates/baseLayersPreview.html",templateId:"baseLayersPreviewPalleteMenu",templateHelpers:"baseLayersPreviewPalleteMenu",imageSrc:"images/baseMap.png",title:"Выбор базовой карты",id:"SelectorBaseMapsCommand",closeButtonEnabled:!0},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},activate:function(){this.doCommand()},doCommand:function(){for(var e=window.MapManager.getMapModel().getBaseLayers(),t={layers:[]},r=0;r<e.length;r++){var o=e[r].mapLayer._dataPovider._getTileCoordByLatLng(window.MapManager._map.getCenter(),window.MapManager._map.getZoom()),s={};s.singleBase=e[r],s.tileUrl=e[r].mapLayer._dataPovider.getDataUrlByTile(o),t.layers.push(s)}this._showInfo(t)},_showInfo:function(e){var t=this;this.form&&(this.form.hide(),delete this.form),void 0!==t.options.templateUrl&&void 0!==t.options.templateId?(this.form=new MapExpress.Controls.MapControl(this._mapManager._map,{titleText:"Базовые карты",position:"right",maxHeightMinus:.2}),this.form.setContentFromTemplate(t.options.templateUrl,t.options.templateId,e,function(e){t.form.setContent(e),(t.options.templateHelpers&&void 0!==t.options.templateHelpers||t.options.templateHelpers&&null!==t.options.templateHelpers)&&$.views.helpers[t.options.templateHelpers]();t.form.show(),$(t.form._controlContent).css("overflow-y","auto"),$(t.form._controlContent).css("max-height",Number($(t.form._controlContent).parent().css("max-height").replace("px",""))-32+"px")})):new MapExpress.Controls.MapControl(window.MapManager._map,{removalDelay:3e3}).setContent("<b>Не задано представление</b>").show()}}),MapExpress.Tools.ShowFavoriteLayersCommand=MapExpress.Tools.BaseMapCommand.extend({options:{buttonClassName:"map-toolbar-button",templateUrl:"templates/FavoriteLayers.html",templateId:"favoriteLayers",title:"Избранные слои"},initialize:function(e,t){MapExpress.Tools.BaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},createContent:function(e){var t=L.DomUtil.create("button",this.options.buttonClassName,e);return L.DomUtil.create("img",!1,t).setAttribute("src","images/layers.png"),t.setAttribute("title","Избранные слои"),t.setAttribute("id","ShowFavoriteLayersCommand"),t},activate:function(){var t=this;this.form&&(this.form.hide(),this._mapManager.off("mapexspress:mapmanager:layer:visiblechanged",this.renderTemplate,this),this._mapManager._map.off("zoomend",this.renderTemplate,this),delete this.form);var e=this._mapManager.getMapModel().getFavoriteLayers();e&&0!==e.length?(this.form=new MapExpress.Controls.MapControl(this._mapManager._map,{headerEnabled:!0,closeButtonEnabled:!0,position:"right",maxHeightMinus:.2}),this.form.setTitle("Быстрый доступ к слоям"),this.form.on("mapcontrol:remove:before",function(e){t._mapManager.off("mapexspress:mapmanager:layer:visiblechanged",t.renderTemplate,t),t._mapManager._map.off("zoomend",t.renderTemplate,t)}),this.renderTemplate(),this._mapManager.on("mapexspress:mapmanager:layer:visiblechanged",this.renderTemplate,this),this._mapManager._map.on("zoomend",this.renderTemplate,this)):new MapExpress.Controls.MapControl(window.MapManager._map).showWarnWindow("Избранные слои не определены !")},renderTemplate:function(){var e=this;this.form.setContentFromTemplate(e.options.templateUrl,e.options.templateId,{favoriteLayers:e._mapManager.getMapModel().getFavoriteLayers()},function(){window.refreshAllFavoriteLayersDivStyle(),e.form.show(),$(e.form._controlContent).css("overflow-y","auto"),$(e.form._controlContent).css("max-height",Number($(e.form._controlContent).parent().css("max-height").replace("px",""))-32+"px")})}}),MapExpress.Tools.ShowLayerControlMapCommand=MapExpress.Tools.OpenSideBarCommand.extend({options:{imageSrc:"images/menu.png",title:"Управление картой",id:"showLayerControlMapCommand",template:"templates/mapSidebar.html",templateId:"mapSidebarTemplateId",templateHelpers:"layerTreeMapSidebarAfterRendering"},initialize:function(e,t){MapExpress.Tools.OpenSideBarCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)}}),MapExpress.Tools.ShowLegendCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({options:{imageSrc:"images/legend.png",title:"Легенда...",id:"showlegendcommand",closeButtonEnabled:!0},initialize:function(e,t){MapExpress.Tools.ButtonBaseMapCommand.prototype.initialize.call(this,e,t),L.setOptions(this,t)},activate:function(){this.form&&(this.form.hide(),delete this.form),this.form=new MapExpress.Controls.MapControl(this._mapManager._map,{headerEnabled:!0,closeButtonEnabled:this.options.closeButtonEnabled,position:"bottomRight",maxHeightMinus:.2,closeOnEsc:!1,destroyOnClose:!0}),this.form.setTitle("Легенда карты"),this.form.setControlStyle({opacity:"0.9"}),this.form.setContentStyle({"overflow-y":"auto",padding:"0px"}),this.form.show(),new MapExpress.Controls.LegendControl(this._mapManager).render(this.form._controlContent)}}),MapExpress.Utils.BrowserUtils={detectIE:function(){return"Microsoft Internet Explorer"===window.navigator.appName||!(!window.navigator.userAgent.match(/Trident/)&&!window.navigator.userAgent.match(/rv:11/))||void 0!==$.browser&&1===$.browser.msie}},MapExpress.Utils.ColorUtils={hexToRgbA:function(e,t){var r;return/^#([A-Fa-f0-9]{3}){1,2}$/.test(e)?(3===(r=e.substring(1).split("")).length&&(r=[r[0],r[0],r[1],r[1],r[2],r[2]]),t||(t=1),"rgba("+[(r="0x"+r.join(""))>>16&255,r>>8&255,255&r].join(",")+","+t+")"):null},colorBg:function(e,t){for(var r=this.namedColorsAndHexInterpretation(),o=r.length-1;0<=o;o--)if(e.toLowerCase()===r[o].colorName.toLowerCase())return e=this.hexToRgbA(r[o].hex,t);if(-1!==e.indexOf("#"))e=this.hexToRgbA(e,t);else if(-1!==e.indexOf("rgba"))e=e;else if(-1!==e.indexOf("rgb")){var s=e.replace(" ","").replace("rgb(","").replace(")","").split(",");t||(t=1),e="rgba("+s[0]+","+s[1]+","+s[2]+","+t+")"}return e},namedColorsAndHexInterpretation:function(){return[{colorName:"aliceBlue",hex:"#F0F8FF"},{colorName:"antiqueWhite",hex:"#FAEBD7"},{colorName:"aqua",hex:"#00FFFF"},{colorName:"aquamarine",hex:"#7FFFD4"},{colorName:"azure",hex:"#F0FFFF"},{colorName:"beige",hex:"#F5F5DC"},{colorName:"bisque",hex:"#FFE4C4"},{colorName:"black",hex:"#000000"},{colorName:"blanchedAlmond",hex:"#FFEBCD"},{colorName:"blue",hex:"#0000FF"},{colorName:"blueViolet",hex:"#8A2BE2"},{colorName:"brown",hex:"#A52A2A"},{colorName:"burlyWood",hex:"#DEB887"},{colorName:"cadetBlue",hex:"#5F9EA0"},{colorName:"chartreuse",hex:"#7FFF00"},{colorName:"chocolate",hex:"#D2691E"},{colorName:"coral",hex:"#FF7F50"},{colorName:"cornflowerBlue",hex:"#6495ED"},{colorName:"cornsilk",hex:"#FFF8DC"},{colorName:"crimson",hex:"#DC143C"},{colorName:"cyan",hex:"#00FFFF"},{colorName:"darkBlue",hex:"#00008B"},{colorName:"darkCyan",hex:"#008B8B"},{colorName:"darkGoldenRod",hex:"#B8860B"},{colorName:"darkGray",hex:"#A9A9A9"},{colorName:"darkGrey",hex:"#A9A9A9"},{colorName:"darkGreen",hex:"#006400"},{colorName:"darkKhaki",hex:"#BDB76B"},{colorName:"darkMagenta",hex:"#8B008B"},{colorName:"darkOliveGreen",hex:"#556B2F"},{colorName:"darkOrange",hex:"#FF8C00"},{colorName:"darkOrchid",hex:"#9932CC"},{colorName:"darkRed",hex:"#8B0000"},{colorName:"darkSalmon",hex:"#E9967A"},{colorName:"darkSeaGreen",hex:"#8FBC8F"},{colorName:"darkSlateBlue",hex:"#483D8B"},{colorName:"darkSlateGray",hex:"#2F4F4F"},{colorName:"darkSlateGrey",hex:"#2F4F4F"},{colorName:"darkTurquoise",hex:"#00CED1"},{colorName:"darkViolet",hex:"#9400D3"},{colorName:"deepPink",hex:"#FF1493"},{colorName:"deepSkyBlue",hex:"#00BFFF"},{colorName:"dimGray",hex:"#696969"},{colorName:"dimGrey",hex:"#696969"},{colorName:"dodgerBlue",hex:"#1E90FF"},{colorName:"fireBrick",hex:"#B22222"},{colorName:"floralWhite",hex:"#FFFAF0"},{colorName:"forestGreen",hex:"#228B22"},{colorName:"fuchsia",hex:"#FF00FF"},{colorName:"gainsboro",hex:"#DCDCDC"},{colorName:"ghostWhite",hex:"#F8F8FF"},{colorName:"gold",hex:"#FFD700"},{colorName:"goldenRod",hex:"#DAA520"},{colorName:"gray",hex:"#808080"},{colorName:"grey",hex:"#808080"},{colorName:"green",hex:"#008000"},{colorName:"greenYellow",hex:"#ADFF2F"},{colorName:"HoneyDew",hex:"#F0FFF0"},{colorName:"HotPink",hex:"#FF69B4"},{colorName:"indianRed",hex:"#CD5C5C"},{colorName:"indigo",hex:"#4B0082"},{colorName:"ivory",hex:"#FFFFF0"},{colorName:"khaki",hex:"#F0E68C"},{colorName:"lavender",hex:"#E6E6FA"},{colorName:"lavenderBlush",hex:"#FFF0F5"},{colorName:"lawnGreen",hex:"#7CFC00"},{colorName:"lemonChiffon",hex:"#FFFACD"},{colorName:"lightBlue",hex:"#ADD8E6"},{colorName:"lightCoral",hex:"#F08080"},{colorName:"lightCyan",hex:"#E0FFFF"},{colorName:"lightGoldenRodYellow",hex:"#FAFAD2"},{colorName:"lightGray",hex:"#D3D3D3"},{colorName:"lightGrey",hex:"#D3D3D3"},{colorName:"lightGreen",hex:"#90EE90"},{colorName:"lightPink",hex:"#FFB6C1"},{colorName:"lightSalmon",hex:"#FFA07A"},{colorName:"lightSeaGreen",hex:"#20B2AA"},{colorName:"lightSkyBlue",hex:"#87CEFA"},{colorName:"lightSlateGray",hex:"#778899"},{colorName:"lightSlateGrey",hex:"#778899"},{colorName:"lightSteelBlue",hex:"#B0C4DE"},{colorName:"lightYellow",hex:"#FFFFE0"},{colorName:"lime",hex:"#00FF00"},{colorName:"limeGreen",hex:"#32CD32"},{colorName:"linen",hex:"#FAF0E6"},{colorName:"magenta",hex:"#FF00FF"},{colorName:"maroon",hex:"#800000"},{colorName:"mediumAquaMarine",hex:"#66CDAA"},{colorName:"mediumBlue",hex:"#0000CD"},{colorName:"mediumOrchid",hex:"#BA55D3"},{colorName:"mediumPurple",hex:"#9370DB"},{colorName:"mediumSeaGreen",hex:"#3CB371"},{colorName:"mediumSlateBlue",hex:"#7B68EE"},{colorName:"mediumSpringGreen",hex:"#00FA9A"},{colorName:"mediumTurquoise",hex:"#48D1CC"},{colorName:"mediumVioletRed",hex:"#C71585"},{colorName:"midnightBlue",hex:"#191970"},{colorName:"mintCream",hex:"#F5FFFA"},{colorName:"mistyRose",hex:"#FFE4E1"},{colorName:"moccasin",hex:"#FFE4B5"},{colorName:"navajoWhite",hex:"#FFDEAD"},{colorName:"navy",hex:"#000080"},{colorName:"oldLace",hex:"#FDF5E6"},{colorName:"olive",hex:"#808000"},{colorName:"oliveDrab",hex:"#6B8E23"},{colorName:"orange",hex:"#FFA500"},{colorName:"orangeRed",hex:"#FF4500"},{colorName:"orchid",hex:"#DA70D6"},{colorName:"paleGoldenRod",hex:"#EEE8AA"},{colorName:"paleGreen",hex:"#98FB98"},{colorName:"paleTurquoise",hex:"#AFEEEE"},{colorName:"paleVioletRed",hex:"#DB7093"},{colorName:"papayaWhip",hex:"#FFEFD5"},{colorName:"peachPuff",hex:"#FFDAB9"},{colorName:"peru",hex:"#CD853F"},{colorName:"pink",hex:"#FFC0CB"},{colorName:"plum",hex:"#DDA0DD"},{colorName:"powderBlue",hex:"#B0E0E6"},{colorName:"purple",hex:"#800080"},{colorName:"rebeccaPurple",hex:"#663399"},{colorName:"red",hex:"#FF0000"},{colorName:"rosyBrown",hex:"#BC8F8F"},{colorName:"royalBlue",hex:"#4169E1"},{colorName:"saddleBrown",hex:"#8B4513"},{colorName:"salmon",hex:"#FA8072"},{colorName:"sandyBrown",hex:"#F4A460"},{colorName:"seaGreen",hex:"#2E8B57"},{colorName:"seaShell",hex:"#FFF5EE"},{colorName:"sienna",hex:"#A0522D"},{colorName:"silver",hex:"#C0C0C0"},{colorName:"skyBlue",hex:"#87CEEB"},{colorName:"slateBlue",hex:"#6A5ACD"},{colorName:"slateGray",hex:"#708090"},{colorName:"slateGrey",hex:"#708090"},{colorName:"snow",hex:"#FFFAFA"},{colorName:"springGreen",hex:"#00FF7F"},{colorName:"steelBlue",hex:"#4682B4"},{colorName:"tan",hex:"#D2B48C"},{colorName:"teal",hex:"#008080"},{colorName:"thistle",hex:"#D8BFD8"},{colorName:"tomato",hex:"#FF6347"},{colorName:"turquoise",hex:"#40E0D0"},{colorName:"violet",hex:"#EE82EE"},{colorName:"wheat",hex:"#F5DEB3"},{colorName:"white",hex:"#FFFFFF"},{colorName:"whiteSmoke",hex:"#F5F5F5"},{colorName:"yellow",hex:"#FFFF00"},{colorName:"yellowGreen",hex:"#9ACD32"}]}},MapExpress.Utils.GeoFormatConvertor=function(){var e={WKT:function(){this.numberRegexp=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,this.tuples=new RegExp("^"+this.numberRegexp.source+"\\s"+this.numberRegexp.source+"(\\s"+this.numberRegexp.source+")?")}};return e.WKT.prototype.toGeoJSON=function(e){var t,r=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,i=new RegExp("^"+r.source+"(\\s"+r.source+"){1,}"),o=e.split(";"),s=o.pop(),a=(o.shift()||"").split("=").pop(),n=0;function l(e){var t=s.substring(n).match(e);return t?(n+=t[0].length,t[0]):null}function p(){l(/^\s*/)}function d(){p();for(var e,t=0,r=[],o=[r],s=r;e=l(/^(\()/)||l(/^(\))/)||l(/^(,)/)||l(i);){if("("===e)o.push(s),s=[],o[o.length-1].push(s),t++;else if(")"===e){if(0===s.length)return null;if(!(s=o.pop()))return null;if(0===--t)break}else if(","===e)s=[],o[o.length-1].push(s);else{if(e.split(/\s/g).some(isNaN))return null;Array.prototype.push.apply(s,e.split(/\s/g).map(parseFloat))}p()}return 0!==t?null:r}function c(){for(var e,t,r=[];t=l(i)||l(/^(,)/);)","===t?(r.push(e),e=[]):t.split(/\s/g).some(isNaN)||(e||(e=[]),Array.prototype.push.apply(e,t.split(/\s/g).map(parseFloat))),p();return e?(r.push(e),r.length?r:null):null}function h(){return function(){if(!l(/^(point(\sz)?)/i))return null;if(p(),!l(/^(\()/))return null;var e=c();return e?(p(),l(/^(\))/)?{type:"Point",coordinates:e[0]}:null):null}()||function(){if(!l(/^(linestring(\sz)?)/i))return null;if(p(),!l(/^(\()/))return null;var e=c();return e&&l(/^(\))/)?{type:"LineString",coordinates:e}:null}()||function(){if(!l(/^(polygon(\sz)?)/i))return null;p();var e=d();return e?{type:"Polygon",coordinates:e}:null}()||function(){if(!l(/^(multipoint)/i))return null;p(),s="MULTIPOINT ("+s.substring(s.indexOf("(")+1,s.length-1).replace(/\(/g,"").replace(/\)/g,"")+")";var e=d();return e?(p(),{type:"MultiPoint",coordinates:e}):null}()||function(){if(!l(/^(multilinestring)/i))return null;p();var e=d();return e?(p(),{type:"MultiLineString",coordinates:e}):null}()||function(){if(!l(/^(multipolygon)/i))return null;p();var e=d();return e?{type:"MultiPolygon",coordinates:e}:null}()||function(){var e,t=[];if(!l(/^(geometrycollection)/i))return null;if(p(),!l(/^(\()/))return null;for(;e=h();)t.push(e),p(),l(/^(,)/),p();return l(/^(\))/)?{type:"GeometryCollection",geometries:t}:null}()}return(t=h())&&a.match(/\d+/)&&(t.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+a}}),t},e.WKT.prototype.fromGeoJSON=function(e){function t(e){return 2===e.length?e[0]+" "+e[1]:3===e.length?e[0]+" "+e[1]+" "+e[2]:void 0}function r(e){return e.map(t).join(", ")}function o(e){return e.map(r).map(s).join(", ")}function s(e){return"("+e+")"}switch("Feature"===e.type&&(e=e.geometry),e.type){case"Point":return"POINT ("+t(e.coordinates)+")";case"LineString":return"LINESTRING ("+r(e.coordinates)+")";case"Polygon":return"POLYGON ("+o(e.coordinates)+")";case"MultiPoint":return"MULTIPOINT ("+r(e.coordinates)+")";case"MultiPolygon":return"MULTIPOLYGON ("+e.coordinates.map(o).map(s).join(", ")+")";case"MultiLineString":return"MULTILINESTRING ("+o(e.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+e.geometries.map(this.stringify).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}},e.CSV=function(){var s=this;this.dsv=new Function('dsv.version = "0.0.3";\n\ndsv.tsv = dsv("\\t");\ndsv.csv = dsv(",");\n\nfunction dsv(delimiter) {\n  var dsv = {},\n      reFormat = new RegExp("[\\"" + delimiter + "\\n]"),\n      delimiterCode = delimiter.charCodeAt(0);\n\n  dsv.parse = function(text, f) {\n    var o;\n    return dsv.parseRows(text, function(row, i) {\n      if (o) return o(row, i - 1);\n      var a = new Function("d", "return {" + row.map(function(name, i) {\n        return JSON.stringify(name) + ": d[" + i + "]";\n      }).join(",") + "}");\n      o = f ? function(row, i) { return f(a(row), i); } : a;\n    });\n  };\n\n  dsv.parseRows = function(text, f) {\n    var EOL = {}, // sentinel value for end-of-line\n        EOF = {}, // sentinel value for end-of-file\n        rows = [], // output rows\n        N = text.length,\n        I = 0, // current character index\n        n = 0, // the current line number\n        t, // the current token\n        eol; // is the current token followed by EOL?\n\n    function token() {\n      if (I >= N) return EOF; // special case: end of file\n      if (eol) return eol = false, EOL; // special case: end of line\n\n      // special case: quotes\n      var j = I;\n      if (text.charCodeAt(j) === 34) {\n        var i = j;\n        while (i++ < N) {\n          if (text.charCodeAt(i) === 34) {\n            if (text.charCodeAt(i + 1) !== 34) break;\n            ++i;\n          }\n        }\n        I = i + 2;\n        var c = text.charCodeAt(i + 1);\n        if (c === 13) {\n          eol = true;\n          if (text.charCodeAt(i + 2) === 10) ++I;\n        } else if (c === 10) {\n          eol = true;\n        }\n        return text.substring(j + 1, i).replace(/""/g, "\\"");\n      }\n\n      // common case: find next delimiter or newline\n      while (I < N) {\n        var c = text.charCodeAt(I++), k = 1;\n        if (c === 10) eol = true; // \\n\n        else if (c === 13) { eol = true; if (text.charCodeAt(I) === 10) ++I, ++k; } // \\r|\\r\\n\n        else if (c !== delimiterCode) continue;\n        return text.substring(j, I - k);\n      }\n\n      // special case: last token before EOF\n      return text.substring(j);\n    }\n\n    while ((t = token()) !== EOF) {\n      var a = [];\n      while (t !== EOL && t !== EOF) {\n        a.push(t);\n        t = token();\n      }\n      if (f && !(a = f(a, n++))) continue;\n      rows.push(a);\n    }\n\n    return rows;\n  };\n\n  dsv.format = function(rows) {\n    if (Array.isArray(rows[0])) return dsv.formatRows(rows); // deprecated; use formatRows\n    var fieldSet = {}, fields = [];\n\n    // Compute unique fields in order of discovery.\n    rows.forEach(function(row) {\n      for (var field in row) {\n        if (!(field in fieldSet)) {\n          fields.push(fieldSet[field] = field);\n        }\n      }\n    });\n\n    return [fields.map(formatValue).join(delimiter)].concat(rows.map(function(row) {\n      return fields.map(function(field) {\n        return formatValue(row[field]);\n      }).join(delimiter);\n    })).join("\\n");\n  };\n\n  dsv.formatRows = function(rows) {\n    return rows.map(formatRow).join("\\n");\n  };\n\n  function formatRow(row) {\n    return row.map(formatValue).join(delimiter);\n  }\n\n  function formatValue(text) {\n    return reFormat.test(text) ? "\\"" + text.replace(/\\"/g, "\\"\\"") + "\\"" : text;\n  }\n\n  return dsv;\n}\n;return dsv')(),this.element=function(e,t){return s.search(e,t).val},this.formatPair=function(e){return this.format(e.lat,"lat")+" "+this.format(e.lon,"lon")},this.format=function(e,t){var r=({lat:["N","S"],lon:["E","W"]}[t]||"")[0<=e?0:1],o=Math.abs(e),s=Math.floor(o),i=60*(o-s),a=Math.floor(i),n=Math.floor(60*(i-a));return s+"° "+(a?a+"' ":"")+(n?n+'" ':"")+r},this.search=function(e,t,r){if(t||(t="NSEW"),"string"!=typeof e)return{val:null,regex:r};var o=(r=r||/[\s\,]*([\-|\—|\―]?[0-9.]+)°? *(?:([0-9.]+)['’′‘] *)?(?:([0-9.]+)(?:''|"|”|″) *)?([NSEW])?/gi).exec(e);return o?o[4]&&-1===t.indexOf(o[4])?{val:null,regex:r}:{val:((o[1]?parseFloat(o[1]):0)+(o[2]?parseFloat(o[2])/60:0)+(o[3]?parseFloat(o[3])/3600:0))*(o[4]&&"S"===o[4]||"W"===o[4]?-1:1),regex:r,raw:o[0],dim:o[4]}:{val:null,regex:r}},this.pair=function(e,t){e=e.trim();var r=s.search(e,t);if(null===r.val)return null;var o=s.search(e,t,r.regex);return null===o.val?null:r.raw+o.raw!==e?null:r.dim?s.swapdim(r.val,o.val,r.dim):[r.val,o.val]},this.swapdim=function(e,t,r){return"N"===r||"S"===r?[e,t]:"W"===r||"E"===r?[t,e]:void 0}},e.CSV.prototype.toGeoJSON=function(e,t){var a=this,r=function(e,t){return e||t};function n(e){return"object"==typeof e?Object.keys(e).length:0}function o(s){var i=[];return[",",";","\t","|"].forEach(function(e){var t=a.dsv(e).parse(s);if(1<=t.length){for(var r=n(t[0]),o=0;o<t.length;o++)if(n(t[o])!==r)return;i.push({delimiter:e,arity:Object.keys(t[0]).length})}}),i.length?i.sort(function(e,t){return t.arity-e.arity})[0].delimiter:null}void 0===t&&(t={}),r||(r=t,t={}),t.delimiter=t.delimiter||",";var s=t.latfield||"",i=t.lonfield||"",l=t.crs||"",p=[],d={type:"FeatureCollection",features:p};if(""!==l&&(d.crs={type:"name",properties:{name:l}}),"auto"===t.delimiter&&"string"==typeof e&&(t.delimiter=o(e),!t.delimiter))return r({type:"Error",message:"Could not autodetect delimiter"});var c="string"==typeof e?a.dsv(t.delimiter).parse(e):e;if(!c.length)return r(null,d);if(!s||!i){for(var h in c[0])!s&&h.match(/(Lat)(itude)?/gi)&&(s=h),!i&&h.match(/(L)(on|ng)(gitude)?/i)&&(i=h);if(!s||!i){var u=[];for(var m in c[0])u.push(m);return r({type:"Error",message:"Latitude and longitude fields not present",data:c,fields:u})}}for(var g=[],_=0;_<c.length;_++)if(void 0!==c[_][i]&&void 0!==c[_][i]){var f,y,x,v=c[_][i],L=c[_][s];(x=a.element(v,"EW"))&&(v=x),(x=a.element(L,"NS"))&&(L=x),f=parseFloat(v),y=parseFloat(L),isNaN(f)||isNaN(y)?g.push({message:"A row contained an invalid value for latitude or longitude",row:c[_]}):(t.includeLatLon||(delete c[_][i],delete c[_][s]),p.push({type:"Feature",properties:c[_],geometry:{type:"Point",coordinates:[parseFloat(f),parseFloat(y)]}}))}return d},e.CSV.prototype.toLine=function(e){for(var t=e.features,r={type:"Feature",geometry:{type:"LineString",coordinates:[]}},o=0;o<t.length;o++)r.geometry.coordinates.push(t[o].geometry.coordinates);return r.properties=t[0].properties,{type:"FeatureCollection",features:[r]}},e.CSV.prototype.toPolygon=function(e){for(var t=e.features,r={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]}},o=0;o<t.length;o++)r.geometry.coordinates[0].push(t[o].geometry.coordinates);return r.properties=t[0].properties,{type:"FeatureCollection",features:[r]}},e.ESRI=function(){},e.ESRI.prototype.toGeoJSON=function(e){function l(e){for(var t,r=0,o=0,s=e.length,i=e[o];o<s-1;o++)r+=((t=e[o+1])[0]-i[0])*(t[1]+i[1]),i=t;return 0<=r}function s(e){var t,r,o,s,i,a,n;if(e){if((e.x&&"NaN"!==e.x||0===e.x)&&(e.y&&"NaN"!==e.y||0===e.y))s="Point",o=[e.x,e.y];else if(e.points&&e.points.length)s="MultiPoint",o=e.points;else if(e.paths&&e.paths.length)1===(i=e.paths).length?(s="LineString",o=i[0]):(s="MultiLineString",o=i);else if(e.rings&&e.rings.length){for(a=[],i=e.rings,r=0;r<i.length;r++)l(n=i[r])?a.push([n]):0<a.length&&a[a.length-1].push(n);1<a.length?(o=a,s="MultiPolygon"):(o=a.pop(),s="Polygon")}return t=o&&s?{type:s,coordinates:o}:null}return t}function t(e){var t,r,o=null;if(e&&(o={type:"Feature"},e.geometry&&(o.geometry=s(e.geometry)),e.attributes)){for(t in r={},e.attributes,e.attributes)r[t]=e.attributes[t];o.properties=r}return o}var r,o,i,a;if(e)if(e.features||e.results)for(r={type:"FeatureCollection",features:[]},e.features?i=e.features:e.results?i=e.results:console.log("обратить внимание на входящий JSON"),o=0;o<i.length;o++)(a=t(i[o]))&&r.features.push(a);else r=e.geometry?t(e):s(e);return r},e.ESRI.prototype.fromGeoJSON=function(e){function i(e){for(var t,r=0,o=0,s=e.length,i=e[o];o<s-1;o++)r+=((t=e[o+1])[0]-i[0])*(t[1]+i[1]),i=t;return 0<=r}function d(e){var t,r;return"Point"===e?t="esriGeometryPoint":"MultiPoint"===e?(t="esriGeometryMultipoint",r="points"):"LineString"===e||"MultiLineString"===e?(t="esriGeometryPolyline",r="paths"):"Polygon"!==e&&"MultiPolygon"!==e||(t="esriGeometryPolygon",r="rings"),{type:t,geomHolder:r}}function s(e){var t,r,o,s=[];for(t=0,r=e.length;t<r;t++)0===t!==i(o=e[t])&&(o=o.reverse()),s.push(o);return s}function c(e){var t,r,o;if("MultiPoint"===e.type||"MultiLineString"===e.type)o=e.coordinates||[];else if("Point"===e.type||"LineString"===e.type)o=e.coordinates?[e.coordinates]:[];else if("Polygon"===e.type)o=[],e.coordinates&&(o=s(e.coordinates));else if("MultiPolygon"===e.type&&(o=[],e.coordinates))for(t=0,r=e.coordinates.length;t<r;t++)o.push(s(e.coordinates[t]));return o}function a(e){var t,r,o,s,i,a,n,l,p;if("GeometryCollection"===e.type)for(o=[],r=d(e.geometries[0].type),s=0;s<e.geometries.length;s++)n=r.type,l=e.geometries[s].type,p=void 0,p=!1,("esriGeometryPoint"!==n&&"esriGeometryMultipoint"!==n||"Point"!==l&&"MultiPoint"!==l)&&("esriGeometryPolyline"!==n||"LineString"!==l&&"MultiLineString"!==l)&&("esriGeometryPolygon"!==n||"Polygon"!==l&&"MultiPolygon"!==l)||(p=!0),p&&o.push(e.geometries[s]);else r=d(e.type),o=[e];if("esriGeometryPoint"===r.type&&1<o.length&&(r=d("MultiPoint")),t={spatialReference:{wkid:4326}},"esriGeometryPoint"===r.type)o[0]&&o[0].coordinates&&0!==o[0].coordinates.length?(t.x=o[0].coordinates[0],t.y=o[0].coordinates[1]):t.x=null;else for(t[r.geomHolder]=[],s=0;s<o.length;s++)for(a=c(o[s]),i=0;i<a.length;i++)t[r.geomHolder].push(a[i]);return t}function t(e){var t,r,o;if(e&&(t={},e.geometry&&(t.geometry=a(e.geometry)),e.properties)){for(r in o={},e.properties)o[r]=e.properties[r];t.attributes=o}return t}var r,o,n,l;if(e)if("FeatureCollection"===e.type)for(r={features:[]},n=e.features,o=0;o<n.length;o++)(l=t(n[o]))&&r.features.push(l);else r="Feature"===e.type?t(e):a(e);return r},{esri:new e.ESRI,wkt:new e.WKT,csv:new e.CSV}}(),MapExpress.Utils.GeoFormatConvertor.XML=L.Class.extend({initialize:function(){},okhash:function(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return r},get:function(e,t){return e.getElementsByTagName(t)},attr:function(e,t){return e.getAttribute(t)},attrf:function(e,t){return parseFloat(this.attr(e,t))},get1:function(e,t){var r=this.get(e,t);return r.length?r[0]:null},norm:function(e){return e.normalize&&e.normalize(),e},numarray:function(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r},clean:function(e){var t={};for(var r in e)e[r]&&(t[r]=e[r]);return t},nodeVal:function(e){return e&&this.norm(e),e&&e.firstChild&&e.firstChild.nodeValue||""},coordOne:function(e){return this.numarray(e.replace(/\s*/g,"").split(","))},coord:function(e){for(var t=e.replace(/^\s*|\s*$/g,"").split(/\s+/),r=[],o=0;o<t.length;o++)r.push(this.coordOne(t[o]));return r},coordPair:function(e){var t=[this.attrf(e,"lon"),this.attrf(e,"lat")],r=this.get1(e,"ele"),o=this.get1(e,"time");return r&&t.push(parseFloat(this.nodeVal(r))),{coordinates:t,time:o?this.nodeVal(o):null}},fc:function(){return{type:"FeatureCollection",features:[]}},serializer:function(){var e;return"undefined"!=typeof XMLSerializer&&(e=new XMLSerializer),e},xml2str:function(e){return void 0!==e.xml?e.xml:this.serializer().serializeToString(e)},parseXML:function(e){var t;try{if(window.DOMParser)t=(new DOMParser).parseFromString(e,"text/xml");else(t=new ActiveXObject("MSXML2.DOMDocument.3.0")).validateOnParse=!1,t.async=!1,t.loadXML(e)}catch(e){console.log(e)}return t},strip:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},toGeoJSON:function(){}}),MapExpress.Utils.GeoFormatConvertor.xml=function(){return new MapExpress.Utils.GeoFormatConvertor.XML},MapExpress.Utils.GeoFormatConvertor.GPX=MapExpress.Utils.GeoFormatConvertor.XML.extend({initialize:function(){},toGeoJSON:function(e){var t,r,l=this,o=l.parseXML(e),s=l.get(o,"trk"),i=l.get(o,"rte"),a=l.get(o,"wpt"),n=l.fc();for(t=0;t<s.length;t++)(r=d(s[t]))&&n.features.push(r);for(t=0;t<i.length;t++)(r=c(i[t]))&&n.features.push(r);for(t=0;t<a.length;t++)n.features.push(h(a[t]));function p(e,t){var r=l.get(e,t),o=[],s=[],i=r.length;if(!(i<2)){for(var a=0;a<i;a++){var n=l.coordPair(r[a]);o.push(n.coordinates),n.time&&s.push(n.time)}return{line:o,times:s}}}function d(e){for(var t,r=l.get(e,"trkseg"),o=[],s=[],i=0;i<r.length;i++)(t=p(r[i],"trkpt")).line&&o.push(t.line),t.times.length&&s.push(t.times);if(0!==o.length){var a=u(e);return s.length&&(a.coordTimes=1===o.length?s[0]:s),{type:"Feature",properties:a,geometry:{type:1===o.length?"LineString":"MultiLineString",coordinates:1===o.length?o[0]:o}}}}function c(e){var t=p(e,"rtept");if(t){for(var r=[],o=0;o<t.line.length;o++)3===t.line.length?r.push([t.line[o][0],t.line[o][1]]):r.push(t.line[o]);var s={type:"Feature",properties:u(e),geometry:{type:"LineString",coordinates:r}};return t.times.length&&(s.geometry.times=t.times),s}}function h(e){var t=u(e);return t.sym=l.nodeVal(l.get1(e,"sym")),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:l.coordPair(e).coordinates}}}function u(e){var t,r=["name","desc","author","copyright","link","time","keywords"],o={};for(t=0;t<r.length;t++)o[r[t]]=l.nodeVal(l.get1(e,r[t]));return l.clean(o)}return n}}),MapExpress.Utils.GeoFormatConvertor.gpx=function(){return new MapExpress.Utils.GeoFormatConvertor.GPX},MapExpress.Utils.GeoFormatConvertor.KML=MapExpress.Utils.GeoFormatConvertor.XML.extend({initialize:function(){},toGeoJSON:function(e){for(var C=this,t=C.fc(),r=C.parseXML(e),S={},k=["Polygon","LineString","Point","Track","gx:Track"],o=C.get(r,"Placemark"),s=C.get(r,"Style"),i=0;i<s.length;i++)S["#"+this.attr(s[i],"id")]=C.okhash(C.xml2str(s[i])).toString(16);for(var a=0;a<o.length;a++)t.features=t.features.concat(n(o[a]));function E(e){var t,r;return"#"===(e=e||"").substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t=e.substr(2)),[t,isNaN(r)?void 0:r]}function P(e){var t,r=C.get(e,"coord","gx"),o=[],s=[];0===r.length&&(r=C.get(e,"gx:coord"));for(var i=0;i<r.length;i++)o.push((t=C.nodeVal(r[i]),C.numarray(t.split(" "))));for(var a=C.get(e,"when"),n=0;n<a.length;n++)s.push(C.nodeVal(a[n]));return{coords:o,times:s}}function n(e){var t,r=function e(t){var r,o,s,i,a,n=[],l=[];if(C.get1(t,"MultiGeometry"))return e(C.get1(t,"MultiGeometry"));if(C.get1(t,"MultiTrack"))return e(C.get1(t,"MultiTrack"));if(C.get1(t,"gx:MultiTrack"))return e(C.get1(t,"gx:MultiTrack"));for(s=0;s<k.length;s++)if(o=C.get(t,k[s]))for(i=0;i<o.length;i++)if(r=o[i],"Point"===k[s])n.push({type:"Point",coordinates:C.coordOne(C.nodeVal(C.get1(r,"coordinates")))});else if("LineString"===k[s])n.push({type:"LineString",coordinates:C.coord(C.nodeVal(C.get1(r,"coordinates")))});else if("Polygon"===k[s]){var p=C.get(r,"LinearRing"),d=[];for(a=0;a<p.length;a++)d.push(C.coord(C.nodeVal(C.get1(p[a],"coordinates"))));n.push({type:"Polygon",coordinates:d})}else if("Track"===k[s]||"gx:Track"===k[s]){var c=P(r);n.push({type:"LineString",coordinates:c.coords}),c.times.length&&l.push(c.times)}return{geoms:n,coordTimes:l}}(e),o={},s=C.nodeVal(C.get1(e,"name")),i=C.nodeVal(C.get1(e,"styleUrl")),a=C.nodeVal(C.get1(e,"description")),n=C.get1(e,"TimeSpan"),l=C.get1(e,"ExtendedData"),p=C.get1(e,"LineStyle"),d=C.get1(e,"PolyStyle");if(!r.geoms.length)return[];if(s&&(o.name=s),i&&S[i]&&(o.styleUrl=i,o.styleHash=S[i]),a&&(o.description=a),n){var c=C.nodeVal(C.get1(n,"begin")),h=C.nodeVal(C.get1(n,"end"));o.timespan={begin:c,end:h}}if(p){var u=E(C.nodeVal(C.get1(p,"color"))),m=u[0],g=u[1],_=parseFloat(C.nodeVal(C.get1(p,"width")));m&&(o.stroke=m),isNaN(g)||(o["stroke-opacity"]=g),isNaN(_)||(o["stroke-width"]=_)}if(d){var f=E(C.nodeVal(C.get1(d,"color"))),y=f[0],x=f[1],v=C.nodeVal(C.get1(d,"fill")),L=C.nodeVal(C.get1(d,"outline"));y&&(o.fill=y),isNaN(x)||(o["fill-opacity"]=x),v&&(o["fill-opacity"]="1"===v?1:0),L&&(o["stroke-opacity"]="1"===L?1:0)}if(l){var M=C.get(l,"Data"),b=C.get(l,"SimpleData");for(t=0;t<M.length;t++)o[M[t].getAttribute("name")]=C.nodeVal(C.get1(M[t],"value"));for(t=0;t<b.length;t++)o[b[t].getAttribute("name")]=C.nodeVal(b[t])}r.coordTimes.length&&(o.coordTimes=1===r.coordTimes.length?r.coordTimes[0]:r.coordTimes);var w={type:"Feature",geometry:1===r.geoms.length?r.geoms[0]:{type:"GeometryCollection",geometries:r.geoms},properties:o};return C.attr(e,"id")&&(w.id=C.attr(e,"id")),[w]}return t}}),MapExpress.Utils.GeoFormatConvertor.kml=function(){return new MapExpress.Utils.GeoFormatConvertor.KML},MapExpress.Utils.GeoFormatConvertor.GML=MapExpress.Utils.GeoFormatConvertor.XML.extend({namespaces:{gml:"http://www.opengis.net/gml",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},initialize:function(){this.srs=null},swapCoordinates:function(e){return"EPSG:4326"===this.srs?[e[0],e[1]]:"EPSG:3857"===this.srs?L.Projection.SphericalMercator.unproject(new L.Point(e[0],e[1])):"EPSG:3395"===this.srs?L.Projection.Mercator.unproject(new L.Point(e[0],e[1])):[e[0],e[1]]},elementsNS:function(e,t,r){var o=[];if(e.getElementsByTagNameNS)o=e.getElementsByTagNameNS(t,r);else for(var s,i,a=e.getElementsByTagName("*"),n=0,l=a.length;n<l;++n)i=(s=a[n]).prefix?s.prefix+":"+r:r,"*"!==r&&i!==s.nodeName||"*"!==t&&t!==s.namespaceURI||o.push(s);return o},checkIfGeomNode:function(e){return-1!==["Point","LineString","Polygon","Curve","MultiPoint","MultiLineString","MultiPolygon","MultiSurface","MultiCurve"].indexOf(e)},nodePropsAsObj:function(e){var t={},r=e.childNodes;if(0<e.children.length){if(0<e.attributes.length)for(var o=0;o<e.attributes.length;o++)t[e.attributes[o].localName]=e.attributes[o].textContent;for(var s=0;s<r.length;s++)null!==r[s].firstChild&&(this.checkIfGeomNode(r[s].firstChild.localName)?t.geometry=this.parceGeomnNode(r[s]):t[r[s].localName]=this.nodePropsAsObj(r[s]))}else if(0<e.attributes.length){for(var i=0;i<e.attributes.length;i++)t[e.attributes[i]]=e.attributes[i].textContent;t[e.localName]=e.innerHTML}else t=e.innerHTML;return t},parceGeomnNode:function(e){var t=this;switch(e.firstChild.localName){case"Polygon":return{type:"Polygon",coordinates:t.parcePolygon(e.firstChild)};case"MultiSurface":case"MultiPolygon":return{type:"MultiPolygon",coordinates:t.parceMultiPolygon(e.firstChild)};case"Curve":case"LineString":return{type:"LineString",coordinates:t.parceLineString(e.firstChild)};case"Point":return{type:"Point",coordinates:t.parcePoint(e.firstChild)};case"MultiPoint":return{type:"MultiPoint",coordinates:t.parceMultiPoint(e.firstChild)};case"MultiCurve":case"MultiLineString":return{type:"MultiLineString",coordinates:t.parceMultiLineString(e.firstChild)};default:throw new Error("Ошибка парсинга геометрии!")}},parceCoordsPosList:function(e,t){for(var r=[],o=e.textContent.split(" "),s=0;s<o.length;s+=Number(t)){var i=s+1;r.push([Number(o[s]),Number(o[i])])}return r},parceCoordsPos:function(e){return e.textContent.split(" ").map(function(e){return parseFloat(e)})},parceCoordsCoordinates:function(e){var t={ds:".",cs:",",ts:" "};e.attributes.decimal&&(t.ds=e.attributes.decimal.value),e.attributes.cs&&(t.cs=e.attributes.cs.value),e.attributes.ts&&(t.ts=e.attributes.ts.value);for(var r=[],o=e.textContent.split(t.ts),s=function(e){return"."!==t.ds&&(e=e.replace(t.ds,".")),parseFloat(e)},i=0;i<o.length;i++)r.push(o[i].split(t.cs).map(s));return 1===r.length?r[0]:r},_parceLineString:function(e){var t,r=e.firstChild,o=[];e.attributes&&0<e.attributes.length&&e.attributes.srsDimension&&(t=e.attributes.srsDimension.value),r.attributes&&0<r.attributes.length&&r.attributes.srsDimension&&(t=r.attributes.srsDimension.value),null==t&&(t=2);var s=r.tagName;if("gml:pos"===s||"gml:Point"===s)for(var i=e.getElementsByTagNameNS(this.namespaces.gml,s.split(":").pop()),a=0;a<i.length;a++)o.push(this.parcePoint(i[a]));else"gml:posList"===s?o=this.parceCoordsPosList(r,t):"gml:coordinates"===s&&(o=this.parceCoordsCoordinates(r,t));return o},parcePoint:function(e,t){var r;if("gml:pos"===e.firstChild.tagName)r=this.parceCoordsPos(e.firstChild,t);else{if("gml:coordinates"!==e.firstChild.tagName)throw new Error("Не известный тип координат для точки");r=this.parceCoordsCoordinates(e.firstChild,t)}return r},parceMultiPoint:function(e,t){for(var r=[],o=e.childNodes,s=0;s<o.length;s++)r.push(this.parcePoint(o[s].firstChild));return r},parceLineString:function(e){return this._parceLineString(e)},parceMultiLineString:function(e){for(var t=[],r=e.childNodes,o=0;o<r.length;o++)t.push(this.parceLineString(r[o].firstChild));return t},parceLinearRing:function(e){return this._parceLineString(e)},parcePolygon:function(e){for(var t=[],r=0;r<e.childNodes.length;r++)e.childNodes[0].nodeType===document.ELEMENT_NODE&&(0===r?t.push(this.parceLinearRing(e.childNodes[0].firstChild)):t.push(this.parceLinearRing(e.childNodes[r].firstChild)));return t},parceMultiPolygon:function(e){for(var t=[],r=e.childNodes,o=0;o<r.length;o++)t.push(this.parcePolygon(r[o].firstChild));return t},toGeoJSON:function(e,t){var r,o=("string"==typeof e?e:(new XMLSerializer).serializeToString(e)).replace(/[\t\n\r]/g," ").replace(/\s+/g," "),s=this.parseXML(o),i=this.namespaces.gml,a=this.namespaces.wfs,n=[],l=t;if("gml2"===l?r=this.elementsNS(s.documentElement,i,"featureMember"):"gml3.1"===l?r=this.elementsNS(s.documentElement,i,"featureMembers"):"gml3.2"===l?r=this.elementsNS(s.documentElement,a,"member"):console.warn("Не задана версия gml при конвертации"),0<r.length)if("gml2"!==l)for(var p=r[0].childNodes,d=0;d<p.length;d++)p[d].nodeType===document.ELEMENT_NODE&&n.push(this.nodePropsAsObj(p[d]));else for(var c=0;c<r.length;c++)for(var h=r[c],u=0;u<h.childNodes.length;u++)h.childNodes[u].firstChild&&n.push(this.nodePropsAsObj(h.childNodes[u]));for(var m={type:"FeatureCollection",features:[]},g=0;g<n.length;g++)if(null!==n[g]||void 0!==n[g]){var _={type:"Feature",geometry:n[g].geometry,properties:{}};for(var f in n[g])"geometry"!==f&&(_.properties[f]=n[g][f]);m.features.push(_)}return m},fromGeoJSON:function(e,t,r,o,s,i){var a;switch(i){case"gml2":a=this._createXMLdoc();break;case"gml3.1":a=this._createXMLElement("gml:featureMembers",this.namespaces.gml,{});break;case"gml3.2":a=this._createXMLElement("gml:member",this.namespaces.gml,{})}switch(i){case"gml2":for(var n=this._createXMLElement("gml:featureMember",this.namespaces.gml,{}),l=0;l<e.features.length;l++)n.appendChild(this.createNodeFromGeoJSONFeature(e.features[l],t,r,o,s,i)),a.appendChild(n);break;case"gml3.1":case"gml3.2":for(var p=0;p<e.features.length;p++)a.appendChild(this.createNodeFromGeoJSONFeature(e.features[p],t,r,o,s,i))}return a},createNodeFromGeoJSONFeature:function(e,t,r,o,s,i,a){var n=this._createXMLElement(t+":"+r,s),l=this._createXMLElement(t+":"+o,s,{});for(var p in e.properties){var d=this._createXMLElement(t+":"+p,s,{});d.textContent=e.properties[p],n.appendChild(d)}return l.appendChild(this.createGeometryNodeFromGeoJSONFeature(e.geometry,i,a)),n.appendChild(l),n},createGeometryNodeFromGeoJSONFeature:function(e,t,r){var o;switch(e.type){case"Point":o=this.createGMLPoint(e.coordinates,t,r);break;case"MultiPoint":o=this.createGMLMultiPoint(e.coordinates,t,r);break;case"LineString":o=this.createGMLLineString(e.coordinates,t,r);break;case"MultiLineString":o=this.createGMLMultiLineString(e.coordinates,t,r);break;case"Polygon":o=this.createGMLPolygon(e.coordinates,t,r);break;case"MultiPolygon":o=this.createGMLMultiPolygon(e.coordinates,t,r)}return o},createGMLPoint:function(e,t,r){var o,s=this._createXMLElement("gml:Point",this.namespaces.gml,{srsName:r,srsDimension:"2"});switch(t){case"2":o=this._createXMLElement("gml:coordinates",this.namespaces.gml,{decimal:".",cs:",",ts:" "});break;case"3.1":case"3.2":o=this._createXMLElement("gml:pos",this.namespaces.gml)}return o.textContent=e.join(" "),s.appendChild(o),s},createGMLMultiPoint:function(e,t,r){for(var o=this._createXMLElement("gml:MultiPoint",this.namespaces.gml,{srsName:r,srsDimension:"2"}),s=0;s<e.length;s++){var i=this._createXMLElement("gml:pointMember",this.namespaces.gml),a=this.createGMLPoint(e[s],t);i.appendChild(a),o.appendChild(i)}return o},createGMLLineString:function(e,t,r){var o,s=[],i=this._createXMLElement("gml:LineString",this.namespaces.gml,{srsName:r,srsDimension:"2"});switch(t){case"gml2":o=this._createXMLElement("gml:coordinates",this.namespaces.gml,{decimal:".",cs:",",ts:" "});break;case"gml3.1":case"gml3.2":o=this._createXMLElement("gml:posList",this.namespaces.gml)}for(var a=0;a<e.length;a++)s=s.concat(e[a]);return o.textContent=s.join(" "),i.appendChild(o),i},createGMLMultiLineString:function(e,t,r){for(var o=this._createXMLElement("gml:MultiLineString",this.namespaces.gml,{srsName:r,srsDimension:"2"}),s=0;s<e.length;s++){var i=this._createXMLElement("gml:lineStringMember",this.namespaces.gml),a=this.createGMLLineString(e[s],t);i.appendChild(a),o.appendChild(i)}return o},createGMLPolygon:function(e,t,r){var o,s,i=this._createXMLElement("gml:Polygon",this.namespaces.gml,{srsName:r,srsDimension:"2"}),a=[];switch(t){case"gml2":s=i.appendChild(this._createXMLElement("gml:outerBoundaryIs",this.namespaces.gml)).appendChild(this._createXMLElement("gml:LinearRing",this.namespaces.gml,{srsDimension:"2"})),o=this._createXMLElement("gml:coordinates",this.namespaces.gml,{decimal:".",cs:",",ts:" "});break;case"gml3.1":case"gml3.2":s=i.appendChild(this._createXMLElement("gml:exterior",this.namespaces.gml)).appendChild(this._createXMLElement("gml:LinearRing",this.namespaces.gml,{srsDimension:"2"})),o=this._createXMLElement("gml:posList",this.namespaces.gml)}for(var n=0;n<e[0].length;n++)a=a.concat(e[0][n]);if(o.textContent=a.join(" "),s.appendChild(o),e[1])for(var l,p,d=0;d<e[1][d].length;d++){switch(t){case"gml2":l=i.appendChild(this._createXMLElement("gml:innerBoundaryIs",this.namespaces.gml)).appendChild(this._createXMLElement("gml:LinearRing",this.namespaces.gml,{srsDimension:"2"})),p=this._createXMLElement("gml:coordinates",this.namespaces.gml,{decimal:".",cs:",",ts:" "});break;case"gml3.1":case"gml3.2":l=i.appendChild(this._createXMLElement("gml:interior",this.namespaces.gml)).appendChild(this._createXMLElement("gml:LinearRing",this.namespaces.gml,{srsDimension:"2"})),p=this._createXMLElement("gml:posList",this.namespaces.gml)}p.textContent=e[1][d].join(" "),l.appendChild(p)}return i},createGMLMultiPolygon:function(e,t,r){for(var o=this._createXMLElement("gml:MultiPolygon",this.namespaces.gml,{srsName:r,srsDimension:"2"}),s=0;s<e[0].length;s++){var i=this._createXMLElement("gml:polygonMember",this.namespaces.gml),a=this.createGMLPolygon(e[0][s],t);i.appendChild(a),o.appendChild(i)}return o},_createXMLdoc:function(){return(new DOMParser).parseFromString("<root />","text/xml")},_createXMLElement:function(e,t,r){var o=this._createXMLdoc().createElementNS(t,e);if(void 0!==r)for(var s in r)o.setAttribute(s,r[s]);return o},latLngBoundsToGML:function(e,t){var r=e.getSouthWest(),o=e.getNorthEast(),s=this.createElementNS("gml:Envelope",{srsName:t});return s.appendChild(this.createElementNS("gml:lowerCorner",{},{value:r.lng+" "+r.lat})),s.appendChild(this.createElementNS("gml:upperCorner",{},{value:o.lng+" "+o.lat})),s},createElementNS:function(e,t,r){(i=(r=r||{}).uri)||(i=this.namespaces[e.substring(0,e.indexOf(":"))]),i||(i=this.namespaces[r.prefix]);var o=i?this._createXMLdoc().createElementNS(i,e):this._createXMLdoc().createElement(e);if(t)for(var e in t)if(null!=t[e]&&t[e].toString){var s=t[e].toString(),i=this.namespaces[e.substring(0,e.indexOf(":"))]||null;o.setAttributeNS(i,e,s)}return null!=r.value&&o.appendChild(this._createXMLdoc().createTextNode(r.value)),o}}),MapExpress.Utils.GeoFormatConvertor.gml=function(){return new MapExpress.Utils.GeoFormatConvertor.GML},MapExpress.Utils.GeoJSONUtils={convertFeatureCollectionToMultiPolygon:function(e){var o={type:"Feature",geometry:{coordinates:[],type:"MultiPolygon"},properties:{}};function s(e,t){var r=[];if(0<t.length){for(var o=0;o<t.length;o++)3<t[o].length&&r.push(t[o]);0<r.length&&e.push(r)}}return e&&e.features.forEach(function(e){var t=e.geometry;if("MultiPolygon"===t.type)for(var r=0;r<t.coordinates.length;r++)s(o.geometry.coordinates,t.coordinates[r]);else s(o.geometry.coordinates,t.coordinates)}),o},featureHasCoordinates:function(e){var t=this;return"FeatureCollection"!==e.type?t._featureHasCoordinates(e):!!e.features&&((!e.features||0!==e.features.length)&&(e.features.forEach(function(e){if(!t._featureHasCoordinates(e))return!1}),!0))},_featureHasCoordinates:function(e){try{var t=L.GeoJSON.geometryToLayer(e);if(t&&t.isEmpty&&!t.isEmpty())return!0;if(t&&!t.isEmpty)return!0}catch(e){return console.log(e),!1}return!1},getLayerByPropertyValueFromLayerGroup:function(e,t,r){var o=!1;return e.eachLayer(function(e){e instanceof L.FeatureGroup?e.eachLayer(function(e){s(e)&&(o=e)}):s(e)&&(o=e)}),o;function s(e){return!!(e&&e.feature&&e.feature.properties&&e.feature.properties.hasOwnProperty(t)&&e.feature.properties[t]===r)&&e}}},MapExpress.Utils.LegendUtils=L.Class.extend({options:{width:"24",height:"24",r:"4"},initialize:function(e){L.setOptions(this,e)},emptyLegend:function(){return{id:"",name:"",minZoom:0,maxZoom:24,imageUrl:!1,imageFormat:null,imageData:!0,imageDataFormat:"",legendTemplate:!1,templateType:"html"}},getLayerLegendItems:function(e){return!!(e&&e.mapLayer&&window.MapManager.layerEnabled(e.id)&&e.mapLayer.legends&&0<e.mapLayer.legends.length)&&e.mapLayer.legends},getLayerLegendItemInZoom:function(e){if(e.mapLayer.legends&&0<e.mapLayer.legends.length){for(var t=window.MapManager._map.getZoom(),r=0;r<e.mapLayer.legends.length;r++)if(t<=e.mapLayer.legends[r].maxZoom&&t>=e.mapLayer.legends[r].minZoom)return e.mapLayer.legends[r];for(var o=[],s=0;s>e.mapLayer.legends.length;s++)e.mapLayer.legends[s].maxZoom||e.mapLayer.legends[s].minZoom?o.push(!0):(o.push(!1),console.warn("Необходимо установить масштаб для легенды"));if(-1===o.indexOf(!0))return e.mapLayer.legends[0]}return!1},getLayerLegendInZoom:function(e){return!!this.getLayerLegendItems(e)&&this.getLayerLegendItemInZoom(e)},getLayersWithLegends:function(){for(var e=window.MapManager.getMapModel().getAllLayers(),t=[],r=e.length-1;0<=r;r--)this.getLayerLegendItems(e[r].id)&&t.push(e[r]);return t},addLegendItemToLayer:function(e,t){e&&(e.legends||(e.legends=[]),e.legends.push(t))},removeLegend:function(e,t,r){if(e.legends)if(t)for(var o=e.legends.length-1;0<=o;o--)e.legends[o].id===t&&e.legends.splice(o,1);else!t&&r&&e.legends.splice(r,1)},getAllLegends:function(){for(var e=window.MapManager.getMapModel().getAllLayers(),t=[],r=0;r<e.length;r++){var o=this.createLegendItem(e[r]);o&&t.push({id:e[r].id,displayName:e[r].options.displayName,legendItems:o})}return t},createLegendItem:function(e){var t=this.getProcessStyle(e);if(t){var r=this.getLayerTypesByZoom(e);return this.processLayerToLegendItem(e,r,t)}return null},getProcessStyle:function(e){return this.getLayerLegendItems(e)?this.getLayerLegendInZoom(e):null},getLayerTypesByZoom:function(e){if(e&&e.mapLayer&&e.mapLayer.toGeoJSON){var t=[],r=e.mapLayer.toGeoJSON();if(r.features&&0<r.features.length)for(var o=r.features.length-1;0<=o;o--){var s=r.features[o].geometry.type;"Polygon"===s||"MultiPolygon"===s?-1===t.indexOf("Polygon")&&t.push("Polygon"):"LineString"===s||"MultiLineString"===s?-1===t.indexOf("LineString")&&t.push("LineString"):"Point"!==s&&"MultiPoint"!==s||-1===t.indexOf("Point")&&t.push("Point")}else-1===t.indexOf("noGeometryTypes")&&t.push("noGeometryTypes");return t}return null},_listOfavaliableStyleOptions:function(e){return{stroke:e.stroke||null,weight:e.weight||e["stroke-width"]||null,color:e.color||null,opacity:e.opacity||e["stroke-opacity"]||1,lineCap:e.lineCap||e["stroke-linecap"]||"round",lineJoin:e.lineJoin||e["stroke-linejoin"]||"round",fillColor:e.fillColor||e.color,fillOpacity:e.fillOpacity||.1,fillRule:e.fillRule||"evenodd",dashArray:e.dashArray||null}},_styleExtract:function(e,t){if(void 0!==t.minZoom&&void 0!==t.maxZoom){var r=e.mapLayer.styles;if(r&&0<r.length){for(var o=[],s=0;s<r.length;s++)t.minZoom<=r[s].minZoom&&t.maxZoom>=r[s].maxZoom&&o.push(r[s]);if(!(1<o.length))return 1===o.length?o[0]:r[0];for(var i=e.mapLayer._map.getZoom(),a=0;a<r.length;a++)if(i>=r[a].minZoom&&i<=r[a].maxZoom)return r[a]}else for(var n in e.mapLayer._layers)return this._listOfavaliableStyleOptions(e.mapLayer._layers[n].options)}},stylingElemWithOptions:function(e,t,r){var o=this._styleExtract(r,t);for(var s in o)o[s]&&("color"===s?(o.fillColor||!1===o.fill||e.setAttributeNS(null,"fill",o[s]),e.setAttributeNS(null,"stroke",o[s])):"fillColor"===s?!1!==o.fill&&e.setAttributeNS(null,"fill",o[s]):"weight"===s?e.setAttributeNS(null,"stroke-width",o[s]):"width"===s?e.getAttributeNS(null,"width")||e.setAttributeNS(null,"width",o[s]):"dashArray"===s?e.getAttributeNS(null,"stroke-dasharray")||e.setAttributeNS(null,"stroke-dasharray",o[s]):e.setAttributeNS(null,s.replace(/([A-Z])/g,"-$1").toLowerCase(),o[s])),!1===o.fill&&e.setAttributeNS(null,"fill","#fff"),o.fillOpacity||e.setAttributeNS(null,"fill-opacity",.1),o.opacity||o.strokeOpacity||e.setAttributeNS(null,"stroke-opacity",1)},processLayerToLegendItem:function(e,t,r){var o=[];if(r.imageUrl)o.push(this._processImageItem(r));else if(r.legendTemplate)if(Array.isArray(r.legendTemplate))for(var s=0;s<r.legendTemplate.length;s++)o.push(this._processTemplateItem(r,r.legendTemplate[s].legendTemplate,r.legendTemplate[s].label));else o.push(this._processTemplateItem(r,r.legendTemplate));else o.push(this._processSVGItem(t,r,e));return o},_processImageItem:function(e){var t=document.createElement("img");return e.imageData?t.setAttribute("src","data:"+e.imageFormat+";"+e.imageDataFormat+","+e.imageUrl):t.setAttribute("src",e.imageUrl),t.setAttribute("class","mapexpress-legend-item__img"),{element:t,label:null}},_processTemplateItem:function(e,t,r){var o,s=new DOMParser;o="svg"===e.templateType?"image/svg+xml":"xml"===e.templateType?"application/xml":"text/html";var i=s.parseFromString(t,o);return{element:$(i).find("svg")[0],label:r||null}},_processSVGItem:function(e,t,r){var o,s="http://www.w3.org/2000/svg",i=document.createElementNS(s,"svg");return i.setAttribute("class","mapexpress-legend-item__svg"),i.setAttributeNS(null,"width",this.options.width),i.setAttributeNS(null,"height",this.options.height),i.setAttributeNS(null,"viewBox","0 0 "+this.options.width+" "+this.options.height),-1!==e.indexOf("Polygon")||-1!==e.indexOf("noGeometryTypes")?((o=document.createElementNS(s,"rect")).setAttributeNS(null,"x",0),o.setAttributeNS(null,"y",0),o.setAttributeNS(null,"width",this.options.width),o.setAttributeNS(null,"height",this.options.height)):-1!==e.indexOf("LineString")?((o=document.createElementNS(s,"line")).setAttributeNS(null,"x1",0),o.setAttributeNS(null,"y1",this.options.height/2),o.setAttributeNS(null,"x2",this.options.width),o.setAttributeNS(null,"y2",this.options.height/2)):-1!==e.indexOf("Point")&&((o=document.createElementNS(s,"circle")).setAttributeNS(null,"cx",this.options.width/2),o.setAttributeNS(null,"cy",this.options.height/2),o.setAttributeNS(null,"r",t.radius||this.options.r||this.options.width/2)),this.stylingElemWithOptions(o,t,r),i.appendChild(o),{element:i,label:null}}}),MapExpress.Utils.legendUtils=new MapExpress.Utils.LegendUtils({width:"48",height:"24",r:"4"}),function(){"use strict";MapExpress.Utils.Promise.GetJSON=function(e){var o=$.Deferred();return $.getJSON(e).done(function(e){o.resolve(e)}).fail(function(e,t,r){o.reject(r)}),o.promise()}}(),function(){"use strict";MapExpress.Utils.Promise.Ajax=function(e,t){var r=$.Deferred();return $.ajax({url:e,success:function(e){r.resolve(e,t)},error:function(e){r.reject(e)}}),r.promise()}}(),function(){"use strict";MapExpress.Utils.Promise.AjaxSync=function(e,t){var r=$.Deferred();return setTimeout(function(){$.ajax({url:e,success:function(e){r.resolve(e,t)},error:function(e){r.reject(e)},async:!1})},0),r.promise()}}(),function(){"use strict";MapExpress.Utils.Promise.GetJSONP=function(e,t,r){var o=$.Deferred();return $.ajax({url:e,type:"GET",data:t,dataType:"jsonp",success:function(e){o.resolve(e)},error:function(e){o.reject(e)}}),o.promise()}}(),function(){"use strict";MapExpress.Utils.Promise.Image=function(e,t){t=t||{};var r=new Image;t.crossOrigin&&(r.crossOrigin=t.crossOrigin,r.alt="");var o=$.Deferred();return r.onload=function(){o.resolve(r)},r.onabort=function(e){o.reject(r)},r.onerror=function(e){o.reject(r)},r.src=e,o.promise()}}(),void 0===jQuery.when.all&&(jQuery.when.all=function(e){var t=new jQuery.Deferred;return $.when.apply(jQuery,e).then(function(){t.resolve(Array.prototype.slice.call(arguments))},function(){t.fail(Array.prototype.slice.call(arguments))}),t}),function(){"use strict";MapExpress.Utils.Promise.OverFunction=function(e){var t=$.Deferred();try{var r=e();t.resolve(r)}catch(e){t.reject(e)}return t.promise()}}(),function(){"use strict";MapExpress.Utils.Promise.WFSAjax=function(e,t,r){var o=$.Deferred();return $.ajax({url:e,type:"post",contentType:"text/xml",dataType:"text",data:(new XMLSerializer).serializeToString(t),success:function(e){o.resolve(e,r)},error:function(e){o.reject(e)}}),o.promise()}}();