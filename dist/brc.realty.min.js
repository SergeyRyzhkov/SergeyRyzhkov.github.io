BaltrosPkk={Controls:{},Service:{},Geo:{},Layers:{},Utils:{Promise:{}},Mapping:{},Tools:{},Styles:{},Search:{},Edit:{}},window.BaltrosPkk=BaltrosPkk,BaltrosPkk.Mapping.MapInitializer={initialize:function(a){MapExpress.Mapping.MapInitializerHelper.initializeFromURL(a,"map_model.json",function(){var a=window.MapManager,o=window.MapManager._map;(function(){var a=window.MapManager.getMapModel().getFavoriteLayers(),o=window.MapManager.getMapModel().getFirstLayerByOptionValue("displayName","Здания");o&&o.mapLayer&&(BaltrosPkk.Mapping.LegendManager.add_antonLayer(o.mapLayer),a.push(o))})(),o.addControl(function(){var a=window.MapManager,o=new MapExpress.Tools.MapToolbar(a,{position:"topleft"});return o.addCommand(new MapExpress.Tools.ShowLayerControlMapCommandExt(a)),o.addControlFromTemplate("templates/tula_tbo_search.html","searchId"),o}()),o.addControl(function(){var a=window.MapManager,o=new MapExpress.Tools.MapToolbar(a,{position:"topright"});o.addCommand(new MapExpress.Tools.IdentifyMapCommand(a)),o.addCommand(new MapExpress.Tools.LineMeasureCommand(a)),o.addCommand(new MapExpress.Tools.SqrtMeasureCommand(a)),o.addCommand(new MapExpress.Tools.CoordinatesRunnerCommand(a)),o.addCommand(new MapExpress.Tools.MapExportCommand(a,{showProjList:!1})),o.addCommand(new MapExpress.Tools.ShowFavoriteLayersCommand(a)),o.addCommand(new MapExpress.Tools.SelectorBaseMapsCommand(a));var e=new MapExpress.Tools.ShowLegendCommand(a);return o.addCommand(e),e.activate(),o}()),o.addControl(function(){var a=new MapExpress.Controls.MapStatusbarControl(window.MapManager);a.addSection(new MapExpress.Controls.ZoomStandartStatusbarSection(window.MapManager)),a.addSection(new MapExpress.Controls.CoordinatesStandartStatusbarSection(window.MapManager)),a.addSection(new MapExpress.Controls.CurrentToolStatusbarSection(window.MapManager));var o=new MapExpress.Controls.AttibutionStandartStatusbarSection(window.MapManager);return o.options.attibution.push({href:"http://leafletjs.com",prefix:"Leaflet"}),o.options.attibution.push({href:"https://openstreetmap.org",prefix:"© OpenStreetMap"}),o.options.attibution.push({href:"https: //www.google.ru",prefix:"© Google"}),o.options.attibution.push({href:"https://pkk5.rosreestr.ru",prefix:"Публичная кадастрвоая карта"}),a.addSection(o),window.MapManager.mapStatusBar=a}()),MapExpress.Utils.CadastreUtils.replaceRosreestrIdentifyFunc(),L.control.zoom({position:"topleft"}).addTo(o),MapExpress.Tools.IdentifyMapCommand.maxHeightMinus=.35,MapExpress.Tools.IdentifyMapCommand.maxWidthMinus=.6,MapExpress.Tools.IdentifyMapCommand.showFloatWindow=!1,a.refreshMap()}),MapExpress.Tools.ShowLayerControlMapCommandExt=MapExpress.Tools.ShowLayerControlMapCommand.extend({createContent:function(a){var o=MapExpress.Tools.ShowLayerControlMapCommand.prototype.createContent.call(this,a);MapExpress.Controls.MapControlUtils.setStyle(o,"float:left");var e=L.DomUtil.create("span","divider1",a);return MapExpress.Controls.MapControlUtils.setStyle(e,"float:left"),o}})}},BaltrosPkk.Mapping.LegendManager={add_antonLayer:function(){var a=window.MapManager.getMapModel().getLayerById("a6de0054-fe37-4737-9887-9f55744d04c1");a&&MapExpress.Utils.legendUtils.addLegendItemToLayer(a.mapLayer,{minZoom:0,maxZoom:24,imageUrl:"images/selebit_zhil_view.png",imageDataFormat:"png"})}},MapExpress.Edit.ParcelEditor=MapExpress.Edit.BaseLayerEditor.extend({initialize:function(a,o){MapExpress.Edit.BaseLayerEditor.prototype.initialize.call(this,a,o),this.options.featureKeyFieldName="objectid",this.options.draggable=!0,window.REALTY_MAP_SITE_ROOT="http://realty.npobaltros.ru"},onSaveAsFeatureCollection:function(a){if(a){var o=this,e=MapExpress.Utils.GeoJSONUtils.convertFeatureCollectionToMultiPolygon(a);if(!MapExpress.Utils.GeoJSONUtils.featureHasCoordinates(e))return void o._showEror("У геометрии нет координат !");var t=window.REALTY_MAP_SITE_ROOT+"/MapApi/CreateOrUpdateRealtyGeometry",r={schema:"rsn_sokolov",table:"border_project",keyColumn:"objectid",geomColumn:"geom",itemId:1};r.geoJSON=JSON.stringify(e),$.post(t,r).done(function(a){a?(new MapExpress.Controls.MapControl(window.MapManager._map).showNotifyWindow("Контур объекта сохранен в БД"),window.MapManager.refreshMap(),o.clearEditLayer(),window.MapManager.clearSelections()):o._showEror("Не удалось сохранить контур !")}).fail(function(){o._showEror("Не удалось сохранить контур !"),window.MapManager.refreshMap(),o.clearEditLayer(),window.MapManager.clearSelections()})}this.clearEditLayer()},save:function(){this.saveChanges()},_showEror:function(a){new MapExpress.Controls.MapControl(window.MapManager._map).showErrorWindow(a)}}),MapExpress.Tools.EditParcelToolbar=MapExpress.Tools.MapToolbar.extend({initialize:function(a,o){MapExpress.Tools.MapToolbar.prototype.initialize.call(this,a,o),a._map.parcelEditControl&&a._map.removeControl(a._map.parcelEditControl),(a._map.parcelEditControl=this)._addComands()},_addComands:function(){this.parcelEditor=new MapExpress.Edit.ParcelEditor("75a75472-4cc3-4fcf-a312-69e51462bd6a"),this.addCommand(new MapExpress.Tools.EditParcelCommand(window.MapManager,!1,this.parcelEditor)),this.addCommand(new MapExpress.Tools.SaveParcelCommand(window.MapManager,!1,this.parcelEditor))}}),MapExpress.Tools.EditParcelCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({options:{imageSrc:"images/inputParams.png",title:"Редактирование контура",id:"editParcelCommand"},initialize:function(a,o,e){MapExpress.Tools.ButtonBaseMapCommand.prototype.initialize.call(this,a,o),L.setOptions(this,o),this.layerEditor=e},activate:function(){this.layerEditor.startEdit()}}),MapExpress.Tools.SaveParcelCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({options:{imageSrc:"images/start_@2X.png",title:"Сохранить",id:"saveParcelCommand"},initialize:function(a,o,e){MapExpress.Tools.ButtonBaseMapCommand.prototype.initialize.call(this,a,o),L.setOptions(this,o),this.layerEditor=e},activate:function(){this.layerEditor.save()}});