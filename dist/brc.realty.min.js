BaltrosPkk={Controls:{},Service:{},Geo:{},Layers:{},Utils:{Promise:{}},Mapping:{},Tools:{},Styles:{},Search:{},Edit:{}},window.BaltrosPkk=BaltrosPkk,BaltrosPkk.Mapping.MapInitializer={initialize:function(e){MapExpress.Mapping.MapInitializerHelper.initializeFromURL(e,"map_model.json",function(){var e=window.MapManager,a=window.MapManager._map;(function(){var e=window.MapManager.getMapModel().getFavoriteLayers(),a=window.MapManager.getMapModel().getFirstLayerByOptionValue("displayName","Сохраняемые строения"),o=window.MapManager.getMapModel().getFirstLayerByOptionValue("displayName","Сносимые строения"),t=window.MapManager.getMapModel().getFirstLayerByOptionValue("displayName","Объекты культурного наследия"),i=window.MapManager.getMapModel().getFirstLayerByOptionValue("displayName","Канализация ливневая"),n=window.MapManager.getMapModel().getFirstLayerByOptionValue("displayName","Канализация напорная"),r=window.MapManager.getMapModel().getFirstLayerByOptionValue("displayName","Коллектор общесплавной"),s=window.MapManager.getMapModel().getFirstLayerByOptionValue("displayName","Теплоснабжение");o&&o.mapLayer&&(BaltrosPkk.Mapping.LegendManager.addBuildingTrashLegend(o.mapLayer),e.push(o));a&&a.mapLayer&&(BaltrosPkk.Mapping.LegendManager.addBuildingSaveLegend(a.mapLayer),e.push(a));t&&t.mapLayer&&(BaltrosPkk.Mapping.LegendManager.addOknLegend(t.mapLayer),e.push(t));i&&i.mapLayer&&(BaltrosPkk.Mapping.LegendManager.addSewerLivnevLegend(i.mapLayer),e.push(i));n&&n.mapLayer&&(BaltrosPkk.Mapping.LegendManager.addSewerNapornayLegend(n.mapLayer),e.push(n));r&&r.mapLayer&&(BaltrosPkk.Mapping.LegendManager.addMisCollectorLegend(r.mapLayer),e.push(r));s&&s.mapLayer&&(BaltrosPkk.Mapping.LegendManager.addTeploLegend(s.mapLayer),e.push(s));BaltrosPkk.Mapping.LegendManager.add_selebit_office_view_Legend(),BaltrosPkk.Mapping.LegendManager.add_selebit_otel_view_Legend(),BaltrosPkk.Mapping.LegendManager.add_selebit_tk_view_Legend(),BaltrosPkk.Mapping.LegendManager.add_selebit_zhil_view_Legend()})(),a.addControl((o=window.MapManager,t=new MapExpress.Tools.MapToolbar(o,{position:"topleft"}),t.addCommand(new MapExpress.Tools.ShowLayerControlMapCommandExt(o)),t.addControlFromTemplate("templates/tula_tbo_search.html","searchId"),t)),a.addControl(function(){var e=window.MapManager,a=new MapExpress.Tools.MapToolbar(e,{position:"topright"});a.addCommand(new MapExpress.Tools.IdentifyMapCommand(e)),a.addCommand(new MapExpress.Tools.LineMeasureCommand(e)),a.addCommand(new MapExpress.Tools.SqrtMeasureCommand(e)),a.addCommand(new MapExpress.Tools.CoordinatesRunnerCommand(e)),a.addCommand(new MapExpress.Tools.MapExportCommand(e,{showProjList:!1})),a.addCommand(new MapExpress.Tools.ShowFavoriteLayersCommand(e)),a.addCommand(new MapExpress.Tools.SelectorBaseMapsCommand(e));var o=new MapExpress.Tools.ShowLegendCommand(e);return a.addCommand(o),o.activate(),a}()),a.addControl(function(){var e=new MapExpress.Controls.MapStatusbarControl(window.MapManager);e.addSection(new MapExpress.Controls.ZoomStandartStatusbarSection(window.MapManager)),e.addSection(new MapExpress.Controls.CoordinatesStandartStatusbarSection(window.MapManager)),e.addSection(new MapExpress.Controls.CurrentToolStatusbarSection(window.MapManager));var a=new MapExpress.Controls.AttibutionStandartStatusbarSection(window.MapManager);return a.options.attibution.push({href:"http://leafletjs.com",prefix:"Leaflet"}),a.options.attibution.push({href:"https://openstreetmap.org",prefix:"© OpenStreetMap"}),a.options.attibution.push({href:"https: //www.google.ru",prefix:"© Google"}),a.options.attibution.push({href:"https://pkk5.rosreestr.ru",prefix:"Публичная кадастрвоая карта"}),e.addSection(a),window.MapManager.mapStatusBar=e}()),MapExpress.Utils.CadastreUtils.replaceRosreestrIdentifyFunc(),L.control.zoom({position:"topleft"}).addTo(a),MapExpress.Tools.IdentifyMapCommand.maxHeightMinus=.35,MapExpress.Tools.IdentifyMapCommand.maxWidthMinus=.6,MapExpress.Tools.IdentifyMapCommand.showFloatWindow=!1,e.refreshMap();var o,t}),MapExpress.Tools.ShowLayerControlMapCommandExt=MapExpress.Tools.ShowLayerControlMapCommand.extend({createContent:function(e){var a=MapExpress.Tools.ShowLayerControlMapCommand.prototype.createContent.call(this,e);MapExpress.Controls.MapControlUtils.setStyle(a,"float:left");var o=L.DomUtil.create("span","divider1",e);return MapExpress.Controls.MapControlUtils.setStyle(o,"float:left"),a}})}},BaltrosPkk.Mapping.LegendManager={addPkkParcelLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 24"><rect fill="#ffffff" stroke-width="3" x="0" y="0" width="48" height="24" stroke-dasharray="none" stroke="#f28383" opacity="1" fill-opacity="1" stroke-opacity="1"></rect></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addPkkOksLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 24"><rect fill="#ffbebe" stroke-width="3" x="0" y="0" width="48" height="24" stroke="#ffbebe"  opacity="1" fill-opacity="1" stroke-opacity="1"></rect></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addPkkZouitLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 24"><rect fill="#92d17b" stroke-width="3" x="0" y="0" width="48" height="24" stroke="#92d17b"  opacity="1" fill-opacity="0.5" stroke-opacity="1"></rect></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addBuildingSaveLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 24"><rect fill="#bed2ff" stroke-width="3" x="0" y="0" width="48" height="24" stroke="#0080C0"  opacity="1" fill-opacity="1" stroke-opacity="1"></rect></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addBuildingTrashLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 24"><rect fill="#fff5b4" stroke-width="3" x="0" y="0" width="48" height="24" stroke="#FFA579"  opacity="1" fill-opacity="1" stroke-opacity="1"></rect></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addProjectBorderLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 24"><line x1="0" y1="12" x2="48" y2="12" stroke-width="2" fill-opacity="0.1" stroke-opacity="1" fill="#D56A00" stroke="#D56A00" stroke-linecap="round" stroke-linejoin="round" min-zoom="1" max-zoom="24" override-style="true"></line></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addOknLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 24"><line x1="0" y1="12" x2="48" y2="12" stroke-width="2" fill-opacity="0.1" stroke-opacity="1" fill="#009933" stroke="#009933" stroke-linecap="round" stroke-linejoin="round" min-zoom="1" max-zoom="24" override-style="true"></line></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addMisCollectorLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 24"><rect fill="#ff4d4d" stroke-width="3" x="0" y="0" width="48" height="24" stroke="#990000"  opacity="0.5" fill-opacity="0.5" stroke-opacity="1"></rect></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addSewerNapornayLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 24"><line x1="0" y1="12" x2="48" y2="12" stroke-width="2" fill-opacity="0.1" stroke-opacity="1" fill="#990000" stroke="#990000" stroke-linecap="round" stroke-linejoin="round" min-zoom="1" max-zoom="24" override-style="true"></line></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addSewerLivnevLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 24"><line x1="0" y1="12" x2="48" y2="12" stroke-width="2" fill-opacity="0.1" stroke-opacity="1" fill="#33cc33" stroke="#33cc33" stroke-linecap="round" stroke-linejoin="round" min-zoom="1" max-zoom="24" override-style="true"></line></svg>',templateType:"svg",maxZoom:24,minZoom:0})},addTeploLegend:function(e){MapExpress.Utils.legendUtils.addLegendItemToLayer(e,{legendTemplate:'<svg width="48" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 24"><line x1="0" y1="12" x2="48" y2="12" stroke-width="2" fill-opacity="0.1" stroke-opacity="1" fill="#cc0099" stroke="#cc0099" stroke-linecap="round" stroke-linejoin="round" min-zoom="1" max-zoom="24" override-style="true"></line></svg>',templateType:"svg",maxZoom:24,minZoom:0})},add_selebit_office_view_Legend:function(){var e=window.MapManager.getMapModel().getLayerById("342c5c79-6421-4fa2-8933-e5067258cffa");e&&MapExpress.Utils.legendUtils.addLegendItemToLayer(e.mapLayer,{minZoom:0,maxZoom:24,imageUrl:"images/selebit_office_view.png",imageDataFormat:"png"})},add_selebit_otel_view_Legend:function(){var e=window.MapManager.getMapModel().getLayerById("dd7975e0-661f-49c0-b5b1-7ffbaf10f39d");e&&MapExpress.Utils.legendUtils.addLegendItemToLayer(e.mapLayer,{minZoom:0,maxZoom:24,imageUrl:"images/selebit_otel_view.png",imageDataFormat:"png"})},add_selebit_tk_view_Legend:function(){var e=window.MapManager.getMapModel().getLayerById("6bbd3b63-aeab-4c33-ac11-87aa25a3f027");e&&MapExpress.Utils.legendUtils.addLegendItemToLayer(e.mapLayer,{minZoom:0,maxZoom:24,imageUrl:"images/selebit_tk_view.png",imageDataFormat:"png"})},add_selebit_zhil_view_Legend:function(){var e=window.MapManager.getMapModel().getLayerById("f2872a88-1e9f-43bc-9d8d-908516fa3880");e&&MapExpress.Utils.legendUtils.addLegendItemToLayer(e.mapLayer,{minZoom:0,maxZoom:24,imageUrl:"images/selebit_zhil_view.png",imageDataFormat:"png"})}},MapExpress.Edit.ParcelEditor=MapExpress.Edit.BaseLayerEditor.extend({initialize:function(e,a){MapExpress.Edit.BaseLayerEditor.prototype.initialize.call(this,e,a),this.options.featureKeyFieldName="objectid",this.options.draggable=!0,window.REALTY_MAP_SITE_ROOT="http://realty.npobaltros.ru"},onSaveAsFeatureCollection:function(e){if(e){var a=this,o=MapExpress.Utils.GeoJSONUtils.convertFeatureCollectionToMultiPolygon(e);if(!MapExpress.Utils.GeoJSONUtils.featureHasCoordinates(o))return void a._showEror("У геометрии нет координат !");var t=window.REALTY_MAP_SITE_ROOT+"/MapApi/CreateOrUpdateRealtyGeometry",i={schema:"rsn_sokolov",table:"border_project",keyColumn:"objectid",geomColumn:"geom",itemId:1};i.geoJSON=JSON.stringify(o),$.post(t,i).done(function(e){e?(new MapExpress.Controls.MapControl(window.MapManager._map).showNotifyWindow("Контур объекта сохранен в БД"),window.MapManager.refreshMap(),a.clearEditLayer(),window.MapManager.clearSelections()):a._showEror("Не удалось сохранить контур !")}).fail(function(e){a._showEror("Не удалось сохранить контур !"),window.MapManager.refreshMap(),a.clearEditLayer(),window.MapManager.clearSelections()})}this.clearEditLayer()},save:function(){this.saveChanges()},_showEror:function(e){new MapExpress.Controls.MapControl(window.MapManager._map).showErrorWindow(e)}}),MapExpress.Tools.EditParcelToolbar=MapExpress.Tools.MapToolbar.extend({initialize:function(e,a){MapExpress.Tools.MapToolbar.prototype.initialize.call(this,e,a),e._map.parcelEditControl&&e._map.removeControl(e._map.parcelEditControl),(e._map.parcelEditControl=this)._addComands()},_addComands:function(){this.parcelEditor=new MapExpress.Edit.ParcelEditor("75a75472-4cc3-4fcf-a312-69e51462bd6a"),this.addCommand(new MapExpress.Tools.EditParcelCommand(window.MapManager,!1,this.parcelEditor)),this.addCommand(new MapExpress.Tools.SaveParcelCommand(window.MapManager,!1,this.parcelEditor))}}),MapExpress.Tools.EditParcelCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({options:{imageSrc:"images/inputParams.png",title:"Редактирование контура",id:"editParcelCommand"},initialize:function(e,a,o){MapExpress.Tools.ButtonBaseMapCommand.prototype.initialize.call(this,e,a),L.setOptions(this,a),this.layerEditor=o},activate:function(){this.layerEditor.startEdit()}}),MapExpress.Tools.SaveParcelCommand=MapExpress.Tools.ButtonBaseMapCommand.extend({options:{imageSrc:"images/start_@2X.png",title:"Сохранить",id:"saveParcelCommand"},initialize:function(e,a,o){MapExpress.Tools.ButtonBaseMapCommand.prototype.initialize.call(this,e,a),L.setOptions(this,a),this.layerEditor=o},activate:function(){this.layerEditor.save()}});